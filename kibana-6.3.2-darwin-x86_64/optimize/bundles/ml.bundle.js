/*! Copyright Elasticsearch B.V. and/or license to Elasticsearch B.V. under one or more contributor license agreements
 * Licensed under the Elastic License; you may not use this file except in compliance with the Elastic License. */
webpackJsonp([3],{101:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function checkLicense(Private,Promise,kbnBaseUrl){var xpackInfo=Private(_xpack_info.XPackInfoProvider),features=xpackInfo.get("features.ml");if(!features.isAvailable){var message=features.message,queryString="?"+_notify.Notifier.QS_PARAM_LOCATION+"=Machine Learning&";queryString+=_notify.Notifier.QS_PARAM_LEVEL+"=error&"+_notify.Notifier.QS_PARAM_MESSAGE+"="+message;var url=_chrome2.default.addBasePath(kbnBaseUrl)+"#"+queryString;return window.location.href=url,Promise.halt()}if(features.hasExpired||!1){var _message=features.message;_lodash2.default.find(_notify.notify._notifs,function(item){return item.content===_message})||_notify.notify.warning(_message,{lifetime:0})}return Promise.resolve(features)}function checkLicenseExpired(Private,Promise,kbnBaseUrl,kbnUrl){return checkLicense(Private,Promise,kbnBaseUrl).then(function(features){return features.hasExpired?(kbnUrl.redirect("/jobs"),Promise.halt()):Promise.resolve(features)}).catch(function(){return Promise.halt()})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.checkLicense=checkLicense,exports.checkLicenseExpired=checkLicenseExpired;var _xpack_info=__webpack_require__(46),_notify=__webpack_require__(10),_lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_chrome=__webpack_require__(8),_chrome2=_interopRequireDefault(_chrome)},108:function(module,exports,__webpack_require__){"use strict";function checkMlNodesAvailable(ml,kbnUrl){getMlNodeCount(ml).then(function(nodes){void 0!==nodes.count&&nodes.count>0?Promise.resolve():(kbnUrl.redirect("/jobs"),Promise.reject())})}function getMlNodeCount(ml){return new Promise(function(resolve){ml.mlNodeCount().then(function(nodes){mlNodeCount=nodes.count,userHasPermissionToViewMlNodeCount=!0,resolve(nodes)}).catch(function(error){mlNodeCount=0,403===error.statusCode?userHasPermissionToViewMlNodeCount=!1:console.error(error),resolve({count:0})})})}function mlNodesAvailable(){return 0!==mlNodeCount}function permissionToViewMlNodeCount(){return userHasPermissionToViewMlNodeCount}Object.defineProperty(exports,"__esModule",{value:!0}),exports.checkMlNodesAvailable=checkMlNodesAvailable,exports.getMlNodeCount=getMlNodeCount,exports.mlNodesAvailable=mlNodesAvailable,exports.permissionToViewMlNodeCount=permissionToViewMlNodeCount;var mlNodeCount=0,userHasPermissionToViewMlNodeCount=!1},1148:function(module,exports,__webpack_require__){"use strict";__webpack_require__(642);var _angular=__webpack_require__(13),_angular2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_angular);_angular2.default.module("ui.bootstrap.popover").directive("popoverHtmlUnsafePopup",function($compile){var template='<div class="popover {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">';return template+='<div class="arrow"></div>',template+='<div class="popover-inner">',template+='<h3 class="popover-title" bind-html-unsafe="title" ng-show="title"></h3>',template+='<div class="popover-content" bind-html-unsafe="content" ></div>',template+="</div></div>",{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},template:template,link:function(scope,element){scope.$apply();var cont=$compile(scope.content)(scope);element.find(".popover-content").html(cont),scope.closePopover=function(){scope.$parent.$parent.isOpen=!1,scope.$parent.$parent.$applyAsync(),element.remove()}}}}).directive("popoverHtmlUnsafe",["$tooltip",function($tooltip){return $tooltip("popoverHtmlUnsafe","popover","click")}]),_angular2.default.module("ui.bootstrap.dropdown",["ui.bootstrap.position"]).constant("dropdownConfig",{openClass:"open"}).service("dropdownService",["$document","$rootScope",function($document,$rootScope){var openScope=null,closeDropdown=function(evt){if(openScope&&(!evt||"disabled"!==openScope.getAutoClose())){var toggleElement=openScope.getToggleElement();if(!(evt&&toggleElement&&toggleElement[0].contains(evt.target))){var $element=openScope.getElement();evt&&"outsideClick"===openScope.getAutoClose()&&$element&&$element[0].contains(evt.target)||(openScope.isOpen=!1,$rootScope.$$phase||openScope.$apply())}}},escapeKeyBind=function(evt){27===evt.which&&(openScope.focusToggleElement(),closeDropdown())};this.open=function(dropdownScope){openScope||($document.bind("click",closeDropdown),$document.bind("keydown",escapeKeyBind)),openScope&&openScope!==dropdownScope&&(openScope.isOpen=!1),openScope=dropdownScope},this.close=function(dropdownScope){openScope===dropdownScope&&(openScope=null,$document.unbind("click",closeDropdown),$document.unbind("keydown",escapeKeyBind))}}]).controller("DropdownController",["$scope","$attrs","$parse","dropdownConfig","dropdownService","$animate","$position","$document",function($scope,$attrs,$parse,dropdownConfig,dropdownService,$animate,$position,$document){var self=this,scope=$scope.$new(),openClass=dropdownConfig.openClass,getIsOpen=void 0,setIsOpen=_angular2.default.noop,toggleInvoker=$attrs.onToggle?$parse($attrs.onToggle):_angular2.default.noop,appendToBody=!1;this.init=function(element){self.$element=element,$attrs.isOpen&&(getIsOpen=$parse($attrs.isOpen),setIsOpen=getIsOpen.assign,$scope.$watch(getIsOpen,function(value){scope.isOpen=!!value})),(appendToBody=_angular2.default.isDefined($attrs.dropdownAppendToBody))&&self.dropdownMenu&&($document.find("body").append(self.dropdownMenu),element.on("$destroy",function(){self.dropdownMenu.remove()}))},this.toggle=function(open){return scope.isOpen=arguments.length?!!open:!scope.isOpen},this.isOpen=function(){return scope.isOpen},scope.getToggleElement=function(){return self.toggleElement},scope.getAutoClose=function(){return $attrs.autoClose||"always"},scope.getElement=function(){return self.$element},scope.focusToggleElement=function(){self.toggleElement&&self.toggleElement[0].focus()},scope.$watch("isOpen",function(isOpen,wasOpen){if(appendToBody&&self.dropdownMenu){var pos=$position.positionElements(self.$element,self.dropdownMenu,"bottom-left",!0),css={top:pos.top+"px",display:isOpen?"block":"none"};self.dropdownMenu.hasClass("dropdown-menu-right")?(css.left="auto",css.right=window.innerWidth-(pos.left+self.$element.prop("offsetWidth"))+"px"):(css.left=pos.left+"px",css.right="auto"),self.dropdownMenu.css(css)}$animate[isOpen?"addClass":"removeClass"](self.$element,openClass),isOpen?(scope.focusToggleElement(),dropdownService.open(scope)):dropdownService.close(scope),setIsOpen($scope,isOpen),_angular2.default.isDefined(isOpen)&&isOpen!==wasOpen&&toggleInvoker($scope,{open:!!isOpen})}),$scope.$on("$locationChangeSuccess",function(){scope.isOpen=!1}),$scope.$on("$destroy",function(){scope.$destroy()})}]).directive("dropdown",function(){return{controller:"DropdownController",link:function(scope,element,attrs,dropdownCtrl){dropdownCtrl.init(element)}}}).directive("dropdownMenu",function(){return{restrict:"AC",require:"?^dropdown",link:function(scope,element,attrs,dropdownCtrl){dropdownCtrl&&(dropdownCtrl.dropdownMenu=element)}}}).directive("dropdownToggle",function(){return{require:"?^dropdown",link:function(scope,element,attrs,dropdownCtrl){if(dropdownCtrl){dropdownCtrl.toggleElement=element;var toggleDropdown=function(event){event.preventDefault(),element.hasClass("disabled")||attrs.disabled||scope.$apply(function(){dropdownCtrl.toggle()})};element.bind("click",toggleDropdown),element.attr({"aria-haspopup":!0,"aria-expanded":!1}),scope.$watch(dropdownCtrl.isOpen,function(isOpen){element.attr("aria-expanded",!!isOpen)}),scope.$on("$destroy",function(){element.unbind("click",toggleDropdown)})}}}})},1149:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3218),__webpack_require__(3219)},115:function(module,exports,__webpack_require__){(function(Buffer){var format_value=__webpack_require__(377).format_value,schema=exports.schema={},properties=exports.properties={CALSCALE:{type:"TEXT"},METHOD:{type:"TEXT"},PRODID:{type:"TEXT"},VERSION:{type:"TEXT"},ATTACH:{type:"URI"},CATEGORIES:{type:"TEXT",list:!0},CLASS:{type:"TEXT"},COMMENT:{type:"TEXT"},DESCRIPTION:{type:"TEXT"},GEO:{type:"FLOAT",list:!0},LOCATION:{type:"TEXT"},"PERCENT-COMPLETE":{type:"INTEGER"},PRIORITY:{type:"INTEGER"},RESOURCES:{type:"TEXT"},STATUS:{type:"TEXT"},SUMMARY:{type:"TEXT"},COMPLETED:{type:"DATE-TIME"},DTEND:{type:"DATE-TIME"},DUE:{type:"DATE-TIME"},DTSTART:{type:"DATE-TIME"},DURATION:{type:"DURATION"},FREEBUSY:{type:"PERIOD"},TRANSP:{type:"TEXT"},TZID:{type:"TEXT"},TZNAME:{type:"TEXT"},TZOFFSETFROM:{type:"UTC-OFFSET"},TZOFFSETTO:{type:"UTC-OFFSET"},TZURL:{type:"URI"},ATTENDEE:{type:"CAL-ADDRESS"},CONTACT:{type:"TEXT"},ORGANIZER:{type:"CAL-ADDRESS"},"RECURRENCE-ID":{type:"DATE-TIME"},"RELATED-TO":{type:"TEXT"},URL:{type:"URI"},UID:{type:"TEXT"},EXDATE:{type:"DATE-TIME",list:!0},RDATE:{type:"DATE-TIME",list:!0},RRULE:{type:"RECUR"},ACTION:{type:"TEXT"},REPEAT:{type:"INTEGER"},TRIGGER:{type:"DURATION"},CREATED:{type:"DATE-TIME"},DTSTAMP:{type:"DATE-TIME"},"LAST-MODIFIED":{type:"DATE-TIME"},SEQUENCE:{type:"INTEGER"},"REQUEST-STATUS":{type:"TEXT"}},CalendarObject=exports.CalendarObject=function(calendar,element){this.calendar=calendar,this.element=element,this.components={},this.properties={}};CalendarObject.create=function(element,calendar){var factory=(schema[element]||{}).factory;return void 0!==factory?new factory(calendar):new CalendarObject(calendar,element)},CalendarObject.prototype.clone=function(){var obj=CalendarObject.create(this.element,this.calendar);for(var prop in this.properties)obj.addProperties(this.properties[prop]);for(var comp=this.getComponents(),i=0;i<comp.length;++i)obj.addComponent(comp[i]);return obj},CalendarObject.prototype.addProperties=function(props){props.forEach(this.addProperty.bind(this))},CalendarObject.prototype.addProperty=function(prop,value,parameters){if(prop instanceof CalendarProperty)prop=prop.clone();else{if(void 0===value)return;prop=new CalendarProperty(prop,value,parameters)}return this.properties[prop.name]=this.properties[prop.name]||[],this.properties[prop.name].push(prop),prop},CalendarObject.prototype.setProperty=function(prop,value,parameters){this.removeProperty(prop instanceof CalendarProperty?prop.name:prop),this.addProperty(prop,value,parameters)},CalendarObject.prototype.addComponent=function(comp){if(!(comp instanceof CalendarObject)){var factory=(schema[comp]||{}).factory;comp=void 0!==factory?new factory(this.calendar):new CalendarObject(this.calendar,comp)}return comp.calendar&&comp.calendar!==this.calendar&&(comp=comp.clone()),this.components[comp.element]=this.components[comp.element]||[],this.components[comp.element].push(comp),comp.calendar=this.calendar,comp},CalendarObject.prototype.addComponents=function(comps){comps.forEach(this.addComponent.bind(this))},CalendarObject.prototype.getComponents=function(type){if(void 0===type){var all=[];for(var c in this.components)all=all.concat(this.components[c]);return all}return this.components[type]||[]},CalendarObject.prototype.getProperty=function(prop,i){return(this.properties[prop]||[])[i||0]},CalendarObject.prototype.getProperties=function(prop){return this.properties[prop]||[]},CalendarObject.prototype.getPropertyValue=function(prop,i){return(this.getProperty(prop,i)||{}).value},CalendarObject.prototype.removeProperty=function(prop){delete this.properties[prop]},CalendarObject.prototype.validate=function(){var self=this,_schema=schema[self.element];_schema&&_schema.required_properties&&_schema.required_properties.forEach(function(req){if(!self.getPropertyValue(req))throw new Error(req+" is a required property of "+self.element)});for(var type in self.components)self.components[type].forEach(function(comp){comp.validate()})},CalendarObject.prototype.toString=function(){var output;if("VCALENDAR"==this.element)output=this.format();else{var ical=new(__webpack_require__(487).iCalendar);ical.addComponent(this),output=ical.format()}return output.push(""),output.join("\r\n")},CalendarObject.prototype.format=function(){var lines=["BEGIN:"+this.element];for(var i in this.properties)this.properties[i].forEach(function(prop){lines.push.apply(lines,prop.format())});for(var comp in this.components)for(var comp=this.components[comp],i=0;i<comp.length;++i)lines.push.apply(lines,comp[i].format());return lines.push("END:"+this.element),lines};var CalendarProperty=exports.CalendarProperty=function(name,value,parameters){var propdef=properties[name];this.type=propdef&&propdef.type?propdef.type:"TEXT",this.name=name,this.value=value,this.parameters=parameters||{}};CalendarProperty.prototype.clone=function(){var obj=new CalendarProperty(this.name,this.value);obj.type=this.type;for(var param in this.parameters)obj.parameters[param]=this.parameters[param];return obj},CalendarProperty.prototype.getParameter=function(param){return this.parameters[param]},CalendarProperty.prototype.setParameter=function(param,value){this.parameters[param]=value},CalendarProperty.prototype.format=function(){var params=[];for(var k in this.parameters)params.push(k+"="+this.parameters[k]);params.length&&(params=";"+params.join(";"));for(var len,data=new Buffer(this.name+params+":"+format_value(this.type,this.value,this.parameters)),pos=0,output=[];;){for(len=75,pos+len>=data.length&&(len=data.length-pos);128==(192&data[pos+len]);)len--;if(output.push(data.toString("utf8",pos,pos+len)),pos+len>=data.length)break;pos+=len-1,data[pos]=32}return output}}).call(exports,__webpack_require__(28).Buffer)},1150:function(module,exports){module.exports='<td ng-click="toggleRow()" data-test-subj="docTableExpandToggleColumn">\n  <button class="discover-table-open-button kuiButton--hollow"\n  \taria-label="{{open ? \'Collapse row\' : \'Expand row\'}}" aria-expanded="{{open}}">\n    <span\n      class="kuiIcon"\n      ng-class="{ \'fa-caret-down\': open, \'fa-caret-right\': !open }"\n    ></span>\n  </button>\n</td>\n'},1152:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular),_lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash);__webpack_require__(3232),__webpack_require__(3238);var _string_utils=__webpack_require__(43),_detectors_list=__webpack_require__(3241),_detectors_list2=_interopRequireDefault(_detectors_list),_detector_modal=__webpack_require__(3242),_detector_modal2=_interopRequireDefault(_detector_modal),_detector_filter_modal=__webpack_require__(3243),_detector_filter_modal2=_interopRequireDefault(_detector_filter_modal);__webpack_require__(2).uiModules.get("apps/ml").directive("mlJobDetectorsList",function($modal,$q,mlJobService){return{restrict:"AE",replace:!0,scope:{detectors:"=mlDetectors",indices:"=mlIndices",fields:"=mlFields",catFieldNameSelected:"=mlCatFieldNameSelected",editMode:"=mlEditMode"},template:_detectors_list2.default,controller:function($scope){function validateDetector(dtr){if(void 0!==dtr.exclude_frequent&&""!==dtr.exclude_frequent){var exFrqs=["all","none","by","over"];if(-1===_lodash2.default.indexOf(exFrqs,dtr.exclude_frequent.trim()))return{then:function(callback){callback({success:!1,message:'exclude_frequent value must be: "all", "none", "by" or "over"'})}}}return mlJobService.validateDetector(dtr).then(function(resp){return{success:resp.acknowledged||!1}}).catch(function(resp){return{success:!1,message:resp.message||"Validation failed"}})}$scope.addDetector=function(dtr,index){void 0!==dtr&&(index>=0?$scope.detectors[index]=dtr:$scope.detectors.push(dtr))},$scope.removeDetector=function(index){$scope.detectors.splice(index,1)},$scope.editDetector=function(index){$scope.openNewWindow(index)},$scope.info=function(){},$scope.addFilter=function(dtr,filter,filterIndex){void 0===dtr.rules&&(dtr.rules=[]),filterIndex>=0?dtr.rules[filterIndex]=filter:dtr.rules.push(filter)},$scope.removeFilter=function(detector,filterIndex){detector.rules.splice(filterIndex,1)},$scope.editFilter=function(detector,index){$scope.openFilterWindow(detector,index)},$scope.detectorToString=_string_utils.detectorToString,$scope.openNewWindow=function(index){index=void 0!==index?index:-1;var dtr=void 0;index>=0&&(dtr=_angular2.default.copy($scope.detectors[index])),$modal.open({template:_detector_modal2.default,controller:"MlDetectorModal",backdrop:"static",keyboard:!1,size:"lg",resolve:{params:function(){return{fields:$scope.fields,validate:validateDetector,detector:dtr,index:index,add:$scope.addDetector,catFieldNameSelected:$scope.catFieldNameSelected}}}})},$scope.openFilterWindow=function(dtr,filterIndex){filterIndex=void 0!==filterIndex?filterIndex:-1;var filter=void 0;filterIndex>=0&&(filter=_angular2.default.copy(dtr.rules[filterIndex])),$modal.open({template:_detector_filter_modal2.default,controller:"MlDetectorFilterModal",backdrop:"static",keyboard:!1,size:"lg",resolve:{params:function(){return{fields:$scope.fields,validate:validateDetector,detector:dtr,filter:filter,index:filterIndex,add:$scope.addFilter}}}})}}}})},1153:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function replaceTokensInUrlValue(customUrlConfig,jobBucketSpanSecs,doc,timeFieldName){var urlValue=customUrlConfig.url_value,timestamp=doc[timeFieldName],timeRangeInterval=(0,_parse_interval.parseInterval)(customUrlConfig.time_range);if(urlValue.includes("$earliest$")){var earliestMoment=(0,_moment2.default)(timestamp);null!==timeRangeInterval?earliestMoment.subtract(timeRangeInterval):earliestMoment.subtract(jobBucketSpanSecs,"s"),doc.earliest=earliestMoment.toISOString()}if(urlValue.includes("$latest$")){var latestMoment=(0,_moment2.default)(timestamp).add(jobBucketSpanSecs,"s");null!==timeRangeInterval?latestMoment.add(timeRangeInterval):latestMoment.add(jobBucketSpanSecs,"s"),doc.latest=latestMoment.toISOString()}return getUrlForRecord(customUrlConfig,doc)}function getUrlForRecord(urlConfig,record){return!0===isKibanaUrl(urlConfig)?buildKibanaUrl(urlConfig,record):(0,_string_utils.replaceStringTokens)(urlConfig.url_value,record,!1)}function isKibanaUrl(urlConfig){var urlValue=urlConfig.url_value;return urlValue.startsWith("kibana#/discover")||urlValue.startsWith("kibana#/dashboard")}function buildKibanaUrl(urlConfig,record){var urlValue=urlConfig.url_value;return String(urlValue).replace(/\$([^?&$\'"]{1,40})\$/g,function(match,name){var tokenValue=_lodash2.default.get(record,name,null);return Array.isArray(tokenValue)&&(tokenValue=tokenValue[0]),null!==tokenValue&&"earliest"!==name&&"latest"!==name&&(tokenValue=""+(0,_string_utils.escapeForElasticsearchQuery)(tokenValue),tokenValue=tokenValue.replace(/[!']/g,"!$&"),tokenValue=encodeURIComponent(tokenValue)),null!==tokenValue?tokenValue:match})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.replaceTokensInUrlValue=replaceTokensInUrlValue,exports.getUrlForRecord=getUrlForRecord;var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment),_parse_interval=__webpack_require__(166),_string_utils=__webpack_require__(43)},1154:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3249),__webpack_require__(3251)},1155:function(module,exports,__webpack_require__){"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var _lodash=__webpack_require__(1),_lodash2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_lodash),_index_patterns=__webpack_require__(301);__webpack_require__(2).uiModules.get("apps/ml").service("mlForecastService",function($q,es,ml){this.getForecastsSummary=function(job,query,earliestMs,maxResults){var deferred=$q.defer(),obj={success:!0,forecasts:[]},filterCriteria=[{term:{result_type:"model_forecast_request_stats"}},{term:{job_id:job.job_id}},{range:{timestamp:{gte:earliestMs,format:"epoch_millis"}}}];return query&&filterCriteria.push(query),es.search({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:maxResults,body:{query:{bool:{filter:filterCriteria}},sort:[{forecast_create_timestamp:{order:"desc"}}]}}).then(function(resp){0!==resp.hits.total&&_lodash2.default.each(resp.hits.hits,function(hit){obj.forecasts.push(hit._source)}),deferred.resolve(obj)}).catch(function(resp){deferred.reject(resp)}),deferred.promise},this.getForecastDateRange=function(job,forecastId){var deferred=$q.defer(),obj={success:!0,earliest:null,latest:null},filterCriteria=[{query_string:{query:"result_type:model_forecast",analyze_wildcard:!0}},{term:{job_id:job.job_id}},{term:{forecast_id:forecastId}}];return es.search({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:filterCriteria}},aggs:{earliest:{min:{field:"timestamp"}},latest:{max:{field:"timestamp"}}}}}).then(function(resp){obj.earliest=_lodash2.default.get(resp,"aggregations.earliest.value",null),obj.latest=_lodash2.default.get(resp,"aggregations.latest.value",null),null===obj.earliest||null===obj.latest?deferred.reject(resp):deferred.resolve(obj)}).catch(function(resp){deferred.reject(resp)}),deferred.promise},this.getForecastData=function(job,detectorIndex,forecastId,entityFields,earliestMs,latestMs,interval,aggType){var criteriaFields=[],detector=job.analysis_config.detectors[detectorIndex];if(_lodash2.default.has(detector,"partition_field_name")){var partitionEntity=_lodash2.default.find(entityFields,{fieldName:detector.partition_field_name});void 0!==partitionEntity&&criteriaFields.push({fieldName:"partition_field_name",fieldValue:partitionEntity.fieldName},{fieldName:"partition_field_value",fieldValue:partitionEntity.fieldValue})}if(_lodash2.default.has(detector,"over_field_name")){var overEntity=_lodash2.default.find(entityFields,{fieldName:detector.over_field_name});void 0!==overEntity&&criteriaFields.push({fieldName:"over_field_name",fieldValue:overEntity.fieldName},{fieldName:"over_field_value",fieldValue:overEntity.fieldValue})}if(_lodash2.default.has(detector,"by_field_name")){var byEntity=_lodash2.default.find(entityFields,{fieldName:detector.by_field_name});void 0!==byEntity&&criteriaFields.push({fieldName:"by_field_name",fieldValue:byEntity.fieldName},{fieldName:"by_field_value",fieldValue:byEntity.fieldValue})}var deferred=$q.defer(),obj={success:!0,results:{}},filterCriteria=[{query_string:{query:"result_type:model_forecast",analyze_wildcard:!0}},{term:{job_id:job.job_id}},{term:{forecast_id:forecastId}},{term:{detector_index:detectorIndex}},{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}}];_lodash2.default.each(criteriaFields,function(criteria){filterCriteria.push({term:_defineProperty({},criteria.fieldName,criteria.fieldValue)})});var forecastAggs=void 0===aggType?{avg:"avg",max:"max",min:"min"}:{avg:aggType.avg,max:aggType.max,min:aggType.min};return es.search({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:filterCriteria}},aggs:{times:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:1},aggs:{prediction:_defineProperty({},forecastAggs.avg,{field:"forecast_prediction"}),forecastUpper:_defineProperty({},forecastAggs.max,{field:"forecast_upper"}),forecastLower:_defineProperty({},forecastAggs.min,{field:"forecast_lower"})}}}}}).then(function(resp){var aggregationsByTime=_lodash2.default.get(resp,["aggregations","times","buckets"],[]);_lodash2.default.each(aggregationsByTime,function(dataForTime){var time=dataForTime.key;obj.results[time]={prediction:_lodash2.default.get(dataForTime,["prediction","value"]),forecastUpper:_lodash2.default.get(dataForTime,["forecastUpper","value"]),forecastLower:_lodash2.default.get(dataForTime,["forecastLower","value"])}}),deferred.resolve(obj)}).catch(function(resp){deferred.reject(resp)}),deferred.promise},this.runForecast=function(jobId,duration){console.log("ML forecast service run forecast with duration:",duration);var deferred=$q.defer();return ml.forecast({jobId:jobId,duration:duration}).then(function(resp){deferred.resolve(resp)}).catch(function(err){deferred.reject(err)}),deferred.promise},this.getForecastRequestStats=function(job,forecastId){var deferred=$q.defer(),obj={success:!0,stats:{}},filterCriteria=[{query_string:{query:"result_type:model_forecast_request_stats",analyze_wildcard:!0}},{term:{job_id:job.job_id}},{term:{forecast_id:forecastId}}];return es.search({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:1,body:{query:{bool:{filter:filterCriteria}}}}).then(function(resp){0!==resp.hits.total&&(obj.stats=_lodash2.default.first(resp.hits.hits)._source),deferred.resolve(obj)}).catch(function(resp){deferred.reject(resp)}),deferred.promise}})},1156:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3285)},1157:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3289)},1158:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.VALIDATION_STATUS={ERROR:"error",INFO:"info",SUCCESS:"success",WARNING:"warning"},exports.SKIP_BUCKET_SPAN_ESTIMATION=!0},1177:function(module,exports,__webpack_require__){"use strict";function kbnTypeToMLJobType(field){var type=void 0;switch(field.type){case _field_types.KBN_FIELD_TYPES.STRING:type=field.aggregatable?_field_types.ML_JOB_FIELD_TYPES.KEYWORD:_field_types.ML_JOB_FIELD_TYPES.TEXT;break;case _field_types.KBN_FIELD_TYPES.NUMBER:type=_field_types.ML_JOB_FIELD_TYPES.NUMBER;break;case _field_types.KBN_FIELD_TYPES.DATE:type=_field_types.ML_JOB_FIELD_TYPES.DATE;break;case _field_types.KBN_FIELD_TYPES.IP:type=_field_types.ML_JOB_FIELD_TYPES.IP;break;case _field_types.KBN_FIELD_TYPES.BOOLEAN:type=_field_types.ML_JOB_FIELD_TYPES.BOOLEAN;break;case _field_types.KBN_FIELD_TYPES.GEO_POINT:type=_field_types.ML_JOB_FIELD_TYPES.GEO_POINT}return type}Object.defineProperty(exports,"__esModule",{value:!0}),exports.kbnTypeToMLJobType=kbnTypeToMLJobType;var _field_types=__webpack_require__(208)},1178:function(module,exports,__webpack_require__){"use strict";function changeJobIDCase(config){config.jobId&&(config.jobId=config.jobId.toLowerCase())}Object.defineProperty(exports,"__esModule",{value:!0}),exports.changeJobIDCase=changeJobIDCase},1179:function(module,exports,__webpack_require__){"use strict";function ChartDataUtilsProvider($q,Private,timefilter,mlSimpleJobSearchService,mlResultsService){function loadDocCountData(formConfig,chartData){return $q(function(resolve,reject){var BAR_TARGET=Math.ceil(formConfig.chartInterval.barTarget/10),MAX_BARS=BAR_TARGET+BAR_TARGET/100*100,query=formConfig.combinedQuery,bounds=timefilter.getActiveBounds(),buckets=new TimeBuckets;buckets.setBarTarget(BAR_TARGET),buckets.setMaxBars(MAX_BARS),buckets.setInterval("auto"),buckets.setBounds(bounds);var interval=buckets.getInterval().asMilliseconds(),end=formConfig.end,start=formConfig.start;mlResultsService.getEventRateData(formConfig.indexPattern.title,query,formConfig.timeField,start,end,interval+"ms").then(function(resp){var highestValue=0;chartData.job.bars=[],_lodash2.default.each(resp.results,function(value,t){isFinite(value)||(value=0),value>highestValue&&(highestValue=value);var time=+t,date=new Date(time);chartData.job.barsInterval=interval,chartData.job.bars.push({date:date,time:time,value:value})}),chartData.totalResults=resp.total,chartData.eventRateHighestValue=Math.ceil(highestValue),resolve(chartData)}).catch(function(resp){console.log("getEventRate visualization - error getting event rate data from elasticsearch:",resp),reject(resp)})})}function loadJobSwimlaneData(formConfig,chartData){return $q(function(resolve){mlResultsService.getScoresByBucket([formConfig.jobId],formConfig.start,formConfig.end,formConfig.resultsIntervalSeconds+"s",1).then(function(data){var time=formConfig.start,jobResults=data.results[formConfig.jobId];chartData.job.swimlane=[],_lodash2.default.each(jobResults,function(value,t){time=+t;var date=new Date(time);chartData.job.swimlane.push({date:date,time:time,value:value,color:""})});var pcnt=(time-formConfig.start+formConfig.resultsIntervalSeconds)/(formConfig.end-formConfig.start)*100;chartData.percentComplete=Math.round(pcnt),chartData.job.percentComplete=chartData.percentComplete,chartData.job.swimlaneInterval=1e3*formConfig.resultsIntervalSeconds,resolve(chartData)}).catch(function(){resolve(chartData)})})}function loadDetectorSwimlaneData(formConfig,chartData){return $q(function(resolve){mlSimpleJobSearchService.getScoresByRecord(formConfig.jobId,formConfig.start,formConfig.end,formConfig.resultsIntervalSeconds+"s",{name:void 0!==formConfig.splitField?formConfig.splitField.name:void 0,value:formConfig.firstSplitFieldName}).then(function(data){var dtrIndex=0;_lodash2.default.each(formConfig.fields,function(field,key){var dtr=chartData.detectors[key],times=data.results[dtrIndex];dtr.swimlane=[],_lodash2.default.each(times,function(timeObj,t){var time=+t,date=new Date(time);dtr.swimlane.push({date:date,time:time,value:timeObj.recordScore,color:""})}),dtr.percentComplete=chartData.percentComplete,dtr.swimlaneInterval=1e3*formConfig.resultsIntervalSeconds,dtrIndex++}),resolve(chartData)}).catch(function(){resolve(chartData)})})}function getSplitFields(formConfig,splitFieldName,size){var query=formConfig.combinedQuery;return mlSimpleJobSearchService.getCategoryFields(formConfig.indexPattern.title,splitFieldName,size,query)}function updateChartMargin(chartData){var longestTextWidth=(0,_string_utils.calculateTextWidth)(chartData.eventRateHighestValue,!0),textCheckMultipler=1+Math.sqrt(2)/100;_lodash2.default.each(chartData.detectors,function(detector){var longestWidthForDetector=0;if(void 0!==detector.fieldFormat){var longestTextForDetector=detector.fieldFormat.convert(detector.highestValue,"text");longestWidthForDetector=(0,_string_utils.calculateTextWidth)(longestTextForDetector,!1);var longestTextCheck=detector.fieldFormat.convert(detector.highestValue*textCheckMultipler,"text"),longestWidthCheck=(0,_string_utils.calculateTextWidth)(longestTextCheck,!1);longestWidthForDetector=Math.max(longestWidthForDetector,longestWidthCheck)}else longestWidthForDetector=(0,_string_utils.calculateTextWidth)(detector.highestValue,!0);longestTextWidth=Math.max(longestTextWidth,longestWidthForDetector)}),chartData.chartTicksMargin.width=longestTextWidth+10}var TimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);return{loadDocCountData:loadDocCountData,loadJobSwimlaneData:loadJobSwimlaneData,loadDetectorSwimlaneData:loadDetectorSwimlaneData,getSplitFields:getSplitFields,updateChartMargin:updateChartMargin}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ChartDataUtilsProvider=ChartDataUtilsProvider;var _lodash=__webpack_require__(1),_lodash2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_lodash),_ml_time_buckets=__webpack_require__(169),_string_utils=__webpack_require__(43)},1180:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3414),__webpack_require__(3415)},1181:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3420),__webpack_require__(3422),__webpack_require__(307)},1182:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3423),__webpack_require__(3425)},1183:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3426),__webpack_require__(3428)},1184:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3429)},1186:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3459),__webpack_require__(1187),__webpack_require__(3461)},1187:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function dataRecognizerProvider(ml){var DataRecognizer=function(_Component){function DataRecognizer(props){_classCallCheck(this,DataRecognizer);var _this=_possibleConstructorReturn(this,(DataRecognizer.__proto__||Object.getPrototypeOf(DataRecognizer)).call(this,props));return _this.state={results:[]},_this.indexPattern=props.indexPattern,_this.className=props.className,_this.results=props.results,_this}return _inherits(DataRecognizer,_Component),_createClass(DataRecognizer,[{key:"componentDidMount",value:function(){var _this2=this;ml.recognizeIndex({indexPatternTitle:this.indexPattern.title}).then(function(resp){var results=resp.map(function(r){return _react2.default.createElement(_recognized_result.RecognizedResult,{key:r.id,config:r,indexPattern:_this2.indexPattern})});"object"===_typeof(_this2.results)&&(_this2.results.count=results.length),_this2.setState({results:results})})}},{key:"render",value:function(){return _react2.default.createElement("div",{className:this.className},this.state.results)}}]),DataRecognizer}(_react.Component);return DataRecognizer.propTypes={indexPattern:_propTypes2.default.object,className:_propTypes2.default.string,results:_propTypes2.default.object},DataRecognizer}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();exports.dataRecognizerProvider=dataRecognizerProvider;var _propTypes=__webpack_require__(20),_propTypes2=_interopRequireDefault(_propTypes),_react=__webpack_require__(0),_react2=_interopRequireDefault(_react),_recognized_result=__webpack_require__(3460)},1188:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3485),__webpack_require__(3486),__webpack_require__(3508)},1189:function(module,exports,__webpack_require__){"use strict";function refreshIntervalWatcher($rootScope,$timeout){function init(listener){$rootScope.$watchCollection("timefilter.refreshInterval",function(interval){if(refresher&&$timeout.cancel(refresher),interval.value>0&&!interval.pause){!function startRefresh(){refresher=$timeout(function(){startRefresh(),listener()},interval.value)}()}})}function cancel(){$timeout.cancel(refresher)}var refresher=void 0;return{init:init,cancel:cancel}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.refreshIntervalWatcher=refreshIntervalWatcher},1190:function(module,exports,__webpack_require__){"use strict";function buildConfigFromDetector(job,detectorIndex){var analysisConfig=job.analysis_config,detector=analysisConfig.detectors[detectorIndex],config={jobId:job.job_id,detectorIndex:detectorIndex,metricFunction:(0,_job_utils.mlFunctionToESAggregation)(detector.function),timeField:job.data_description.time_field,interval:job.analysis_config.bucket_span,datafeedConfig:job.datafeed_config};void 0!==detector.field_name&&(config.metricFieldName=detector.field_name);var summaryCountFieldName=analysisConfig.summary_count_field_name;if("count"===config.metricFunction&&void 0!==summaryCountFieldName&&"doc_count"!==summaryCountFieldName){var cardinalityField=void 0,topAgg=_lodash2.default.get(job.datafeed_config,"aggregations")||_lodash2.default.get(job.datafeed_config,"aggs");void 0!==topAgg&&_lodash2.default.values(topAgg).length>0&&(cardinalityField=_lodash2.default.get(_lodash2.default.values(topAgg)[0],["aggregations",summaryCountFieldName,"cardinality","field"])||_lodash2.default.get(_lodash2.default.values(topAgg)[0],["aggs",summaryCountFieldName,"cardinality","field"])),"non_zero_count"===detector.function&&void 0!==cardinalityField?(config.metricFunction="cardinality",config.metricFieldName=cardinalityField):(config.metricFunction="sum",config.metricFieldName=summaryCountFieldName)}return config}Object.defineProperty(exports,"__esModule",{value:!0}),exports.buildConfigFromDetector=buildConfigFromDetector;var _lodash=__webpack_require__(1),_lodash2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_lodash),_job_utils=__webpack_require__(57)},1191:function(module,exports,__webpack_require__){"use strict";function createTimeSeriesJobData(jobs){return jobs.filter(_job_utils.isTimeSeriesViewJob).map(function(job){var bucketSpan=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span);return{id:job.job_id,selected:!1,bucketSpanSeconds:bucketSpan.asSeconds()}})}function processMetricPlotResults(metricPlotData,modelPlotEnabled){var metricPlotChartData=[];return!0===modelPlotEnabled?_lodash2.default.each(metricPlotData,function(dataForTime,time){metricPlotChartData.push({date:new Date(+time),lower:dataForTime.modelLower,value:dataForTime.actual,upper:dataForTime.modelUpper})}):_lodash2.default.each(metricPlotData,function(dataForTime,time){metricPlotChartData.push({date:new Date(+time),value:dataForTime.actual})}),metricPlotChartData}function processForecastResults(forecastData){var forecastPlotChartData=[];return _lodash2.default.each(forecastData,function(dataForTime,time){forecastPlotChartData.push({date:new Date(+time),isForecast:!0,lower:dataForTime.forecastLower,value:dataForTime.prediction,upper:dataForTime.forecastUpper})}),forecastPlotChartData}function processRecordScoreResults(scoreData){var bucketScoreData=[];return _lodash2.default.each(scoreData,function(dataForTime,time){bucketScoreData.push({date:new Date(+time),score:dataForTime.score})}),bucketScoreData}function processDataForFocusAnomalies(chartData,anomalyRecords,timeFieldName){return _lodash2.default.each(anomalyRecords,function(record){var recordTime=record[timeFieldName],chartPoint=findNearestChartPointToTime(chartData,recordTime);if(void 0===chartPoint&&chartData.length){var lastChartPoint=chartData[chartData.length-1],lastChartPointScore=lastChartPoint.anomalyScore||0;record.record_score>lastChartPointScore&&(chartPoint=lastChartPoint)}if(void 0!==chartPoint)if(chartPoint.anomalyScore=Math.max(_lodash2.default.get(chartPoint,"anomalyScore",0),record.record_score),chartPoint.function=record.function,_lodash2.default.has(record,"actual"))chartPoint.actual=record.actual,chartPoint.typical=record.typical;else{var causes=_lodash2.default.get(record,"causes",[]);if(causes.length>0&&(chartPoint.byFieldName=record.by_field_name,chartPoint.numberOfCauses=causes.length,1===causes.length)){var cause=_lodash2.default.first(record.causes);chartPoint.actual=cause.actual,chartPoint.typical=cause.typical}}}),chartData}function processScheduledEventsForChart(chartData,scheduledEvents){return void 0!==scheduledEvents&&_lodash2.default.each(scheduledEvents,function(events,time){var chartPoint=findNearestChartPointToTime(chartData,time);void 0!==chartPoint&&(chartPoint.scheduledEvents=events)}),chartData}function findNearestChartPointToTime(chartData,time){for(var chartPoint=void 0,i=0;i<chartData.length;i++)if(chartData[i].date.getTime()===time){chartPoint=chartData[i];break}if(void 0===chartPoint){for(var foundItem=void 0,_i=0;_i<chartData.length;_i++){var itemTime=chartData[_i].date.getTime();if(itemTime>time){var item=chartData[_i],previousItem=chartData[_i-1],diff1=Math.abs(time-previousItem.date.getTime()),diff2=Math.abs(time-itemTime);foundItem=void 0===previousItem||diff1>diff2?item:previousItem;break}}chartPoint=foundItem}return chartPoint}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createTimeSeriesJobData=createTimeSeriesJobData,exports.processMetricPlotResults=processMetricPlotResults,exports.processForecastResults=processForecastResults,exports.processRecordScoreResults=processRecordScoreResults,exports.processDataForFocusAnomalies=processDataForFocusAnomalies,exports.processScheduledEventsForChart=processScheduledEventsForChart,exports.findNearestChartPointToTime=findNearestChartPointToTime;var _lodash=__webpack_require__(1),_lodash2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_lodash),_parse_interval=__webpack_require__(107),_job_utils=__webpack_require__(57)},1193:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3588),__webpack_require__(3589)},1194:function(module,exports,__webpack_require__){exports.format_value=__webpack_require__(377).format_value,exports.parse_value=__webpack_require__(377).parse_value,exports.RRule=__webpack_require__(486).RRule,exports.parse_calendar=__webpack_require__(1195).parse_calendar,exports.ParseError=__webpack_require__(1195).ParseError,exports.CalendarObject=__webpack_require__(115).CalendarObject,exports.CalendarProperty=__webpack_require__(115).CalendarProperty,exports.iCalendar=__webpack_require__(487).iCalendar,exports.VEvent=__webpack_require__(3602).VEvent,exports.VTimezone=__webpack_require__(3603).VTimezone,exports.PRODID="-//Tri Tech Computers//node-icalendar//EN"},1195:function(module,exports,__webpack_require__){function expect(expect_element,expect_value,next_state){return function(element,value,parameters){if(element!=expect_element)throw new ParseError("Expected "+expect_element+" got "+element);if(expect_value&&expect_value!=value)throw new ParseError("Expected "+expect_value+" got "+value);return next_state}}function parse_component(component,next_state){var cal=component.calendar;return function this_state(element,value,parameters){if("BEGIN"==element){var factory=(schema[value]||{}).factory,child=void 0!==factory?new factory(cal):new CalendarObject(cal,value);return parse_component(child,function(){return component.addComponent(child),this_state.apply(this,arguments)})}if("END"==element)return next_state;var prop=properties[element]||{};return value=parse_value(prop.type,value,parameters,cal,prop.list),component.addProperty(element,value,parameters),this_state}}function parse_record(rec){function newstate(s){state=s,lastpos=i+1}function str(){return rec.substr(lastpos,i-lastpos)}for(var propname,current_param,params={},state=PROP_NAME,lastpos=0,i=0,j=rec.length;i<j;++i){var ch=rec[i];switch(state){case PROP_NAME:":"!=ch&&";"!=ch||(propname=str(),state=PARAM_OR_VALUE,--i);break;case PARAM_OR_VALUE:if(":"==ch)newstate(PROP_VALUE);else{if(";"!=ch)throw new Error("Parse error");newstate(PARAM_NAME)}break;case PARAM_NAME:"="==ch&&(current_param=str(),newstate(MAYBE_QUOTED_PARAM));break;case MAYBE_QUOTED_PARAM:'"'==ch?newstate(QUOTED_PARAM_VALUE):state=PARAM_VALUE;break;case PARAM_VALUE:":"!=ch&&";"!=ch||(params[current_param]=str(),state=PARAM_OR_VALUE,--i);break;case QUOTED_PARAM_VALUE:'"'==ch&&(params[current_param]=str(),state=PARAM_OR_VALUE);break;case PROP_VALUE:i=j;break;default:throw new Error("Invalid parser state")}}return[propname,str(),params]}var util=(__webpack_require__(691),__webpack_require__(309)),types=__webpack_require__(377),CalendarObject=__webpack_require__(115).CalendarObject,schema=__webpack_require__(115).schema,properties=__webpack_require__(115).properties,iCalendar=__webpack_require__(487).iCalendar,parse_value=types.parse_value,ParseError=(types.format_value,exports.ParseError=function(){Error.apply(this,arguments)});util.inherits(ParseError,Error),PROP_NAME=0,PARAM_NAME=1,PARAM_VALUE=2,MAYBE_QUOTED_PARAM=3,QUOTED_PARAM_VALUE=4,PARAM_OR_VALUE=5,PROP_VALUE=6,exports.parse_calendar=function(data,timezone){data=data.split(/\r?\n/);var calendar=new iCalendar(!0);if(timezone)if("string"==typeof timezone&&(timezone=exports.parse_calendar(timezone)),timezone instanceof iCalendar)for(var tzs=timezone.getComponents("VTIMEZONE"),i=0;i<tzs.length;++i)calendar.addComponent(tzs[i]);else calendar.addComponent(tzs[i]);for(var state=expect("BEGIN","VCALENDAR",parse_component(calendar)),i=0;i<data.length-1;++i)if(data[i].length){if(void 0===state)throw new ParseError("Mismatched BEGIN/END tags");for(var j=i;j+1<data.length&&(" "===data[j+1][0]||"\t"===data[j+1][0]);)++j;var record=data[i];if(j!=i){for(var d=data.slice(i,j+1),k=1;k<d.length;++k)d[k]=d[k].substr(1);record=d.join(""),i=j}state=state.apply(null,parse_record(record))}if(void 0!==state)throw new ParseError("Unable to parse calendar data; END:VCALENDAR not found!");return calendar}},132:function(module,exports,__webpack_require__){"use strict";function getIndexPatterns(Private){return Private(_saved_objects.SavedObjectsClientProvider).find({type:"index-pattern",fields:["title"],perPage:1e4}).then(function(response){return response.savedObjects})}function getIndexPattern(courier,indexPatternId){return courier.indexPatterns.get(indexPatternId)}function getIndexPatternWithRoute(courier,$route){return getIndexPattern(courier,$route.current.params.index)}function getIndexPatternProvider(courier){return function(indexPatternId){return getIndexPattern(courier,indexPatternId)}}function getSavedSearchWithRoute(courier,$route,savedSearches){return savedSearches.get($route.current.params.savedSearchId)}function timeBasedIndexCheck(indexPattern){var showNotification=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!1===indexPattern.isTimeBased()){if(showNotification){var message="The index pattern "+indexPattern.title+" is not time series based.         Anomaly detection can only be run over indices which are time based.";_notify.notify.warning(message,{lifetime:0})}return!1}return!0}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getIndexPatterns=getIndexPatterns,exports.getIndexPattern=getIndexPattern,exports.getIndexPatternWithRoute=getIndexPatternWithRoute,exports.getIndexPatternProvider=getIndexPatternProvider,exports.getSavedSearchWithRoute=getSavedSearchWithRoute,exports.timeBasedIndexCheck=timeBasedIndexCheck;var _notify=__webpack_require__(10),_saved_objects=__webpack_require__(67)},133:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function chartLimits(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],limits={max:0,min:0};if(limits.max=_d2.default.max(data,function(d){return d.value}),limits.min=_d2.default.min(data,function(d){return d.value}),limits.max===limits.min&&(limits.max=_d2.default.max(data,function(d){return d.typical?Math.max(d.value,d.typical):d.value}),limits.min=_d2.default.min(data,function(d){return d.typical?Math.min(d.value,d.typical):d.value})),limits.max===limits.min){var padding=.05*limits.max;limits.max+=padding,limits.min-=padding}return limits}function drawLineChartDots(data,lineChartGroup,lineChartValuesLine){var radius=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,dotsData=data.reduce(function(p,c,i){var previous=data[i-1],next=data[i+1];return(void 0===previous||previous&&null===previous.value)&&null!==c.value&&(void 0===next||next&&null===next.value)&&p.push(c),p},[]),dotGroup=lineChartGroup.select(".values-dots").empty()?lineChartGroup.append("g").classed("values-dots",!0):lineChartGroup.select(".values-dots"),dots=dotGroup.selectAll("circle").data(dotsData);dots.enter().append("circle").attr("r",radius),dots.attr("cx",lineChartValuesLine.x()).attr("cy",lineChartValuesLine.y()),dots.exit().remove()}function filterAxisLabels(selection,chartWidth){if(void 0===selection||void 0===selection.selectAll)throw new Error("Missing selection parameter");selection.selectAll(".tick text").text(function(){var parent=_d2.default.select(this.parentNode),labelWidth=parent.node().getBBox().width,labelXPos=_d2.default.transform(parent.attr("transform")).translate[0],minThreshold=labelXPos-labelWidth/2,maxThreshold=labelXPos+labelWidth/2;if(minThreshold>=0&&maxThreshold<=chartWidth)return this.textContent;parent.remove()})}function numTicks(axisWidth){return axisWidth/MAX_LABEL_WIDTH}function numTicksForDateFormat(axisWidth,dateFormat){return axisWidth/(1.75*(0,_string_utils.calculateTextWidth)((0,_moment2.default)().format(dateFormat),!1))}Object.defineProperty(exports,"__esModule",{value:!0}),exports.chartLimits=chartLimits,exports.drawLineChartDots=drawLineChartDots,exports.filterAxisLabels=filterAxisLabels,exports.numTicks=numTicks,exports.numTicksForDateFormat=numTicksForDateFormat;var _d=__webpack_require__(15),_d2=_interopRequireDefault(_d),_string_utils=__webpack_require__(43),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment),MAX_LABEL_WIDTH=100},1576:function(module,exports,__webpack_require__){"use strict";__webpack_require__(8),__webpack_require__(2524),__webpack_require__(134),__webpack_require__(135),__webpack_require__(136),__webpack_require__(137),__webpack_require__(378),__webpack_require__(139),__webpack_require__(379),__webpack_require__(380),__webpack_require__(381),__webpack_require__(140),__webpack_require__(141),__webpack_require__(142),__webpack_require__(143),__webpack_require__(144),__webpack_require__(145),__webpack_require__(146),__webpack_require__(110),__webpack_require__(147),__webpack_require__(148),__webpack_require__(149),__webpack_require__(150),__webpack_require__(8).bootstrap()},166:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function parseInterval(interval){var matches=String(interval).trim().match(INTERVAL_STRING_RE);if(!Array.isArray(matches))return null;if(matches.length<3)return null;try{var value=parseInt(matches[1]),unit=matches[2];return isNaN(value)||value<1&&-1===SUPPORT_ZERO_DURATION_UNITS.indexOf(unit)?null:_moment2.default.duration(value,unit)}catch(e){return null}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.parseInterval=parseInterval;var _moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment),_datemath=__webpack_require__(81),_datemath2=_interopRequireDefault(_datemath),INTERVAL_STRING_RE=new RegExp("^([0-9]*)\\s*("+_datemath2.default.units.join("|")+")$"),SUPPORT_ZERO_DURATION_UNITS=["ms","s","m","h"]},169:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function IntervalHelperProvider(Private,timefilter,config){function TimeBuckets(){this.barTarget=config.get("histogram:barTarget"),this.maxBars=config.get("histogram:maxBars")}function decorateInterval(interval,originalDuration){var esInterval=calcEsInterval(interval);interval.esValue=esInterval.value,interval.esUnit=esInterval.unit,interval.expression=esInterval.expression,interval.overflow=originalDuration>interval&&_moment2.default.duration(interval-originalDuration);var prettyUnits=_moment2.default.normalizeUnits(esInterval.unit);return 1===esInterval.value?interval.description=prettyUnits:interval.description=esInterval.value+" "+prettyUnits+"s",interval}var calcAuto=Private(_ml_calc_auto_interval.TimeBucketsCalcAutoIntervalProvider),calcEsInterval=Private(_calc_es_interval.TimeBucketsCalcEsIntervalProvider);return(0,_inherits.inherits)(TimeBuckets,Private(_time_buckets.TimeBucketsProvider)),TimeBuckets.prototype.setBarTarget=function(bt){this.barTarget=bt},TimeBuckets.prototype.setMaxBars=function(mb){this.maxBars=mb},TimeBuckets.prototype.getInterval=function(){var self=this,duration=self.getDuration();return decorateInterval(function(interval){if(!self.hasBounds())return interval;var maxLength=self.maxBars,approxLen=duration/interval,scaled=void 0;return approxLen>maxLength?+(scaled=calcAuto.lessThan(maxLength,duration))==+interval?interval:(decorateInterval(interval,duration),_lodash2.default.assign(scaled,{preScaled:interval,scale:interval/scaled,scaled:!0})):interval}(function(){var interval=self._i;return _moment2.default.isDuration(interval)?interval:calcAuto.near(self.barTarget,duration)}()),duration)},TimeBuckets.prototype.getIntervalToNearestMultiple=function(divisorSecs){var interval=this.getInterval(),intervalSecs=interval.asSeconds(),remainder=intervalSecs%divisorSecs;if(0===remainder)return interval;var nearestMultiple=remainder>divisorSecs/2?intervalSecs+divisorSecs-remainder:intervalSecs-remainder;nearestMultiple=0===nearestMultiple?divisorSecs:nearestMultiple;var nearestMultipleInt=_moment2.default.duration(nearestMultiple,"seconds");decorateInterval(nearestMultipleInt,this.getDuration());var preScaled=_lodash2.default.get(interval,"preScaled");return void 0!==preScaled&&preScaled<nearestMultipleInt&&(nearestMultipleInt.preScaled=preScaled,nearestMultipleInt.scale=preScaled/nearestMultipleInt,nearestMultipleInt.scaled=!0),nearestMultipleInt},TimeBuckets}function getBoundsRoundedToInterval(bounds,interval){var inclusiveEnd=arguments.length>2&&void 0!==arguments[2]&&arguments[2],intervalMs=interval.asMilliseconds(),adjustedMinMs=Math.floor(bounds.min.valueOf()/intervalMs)*intervalMs,adjustedMaxMs=Math.ceil(bounds.max.valueOf()/intervalMs)*intervalMs;return!1===inclusiveEnd&&(adjustedMaxMs-=1),{min:(0,_moment2.default)(adjustedMinMs),max:(0,_moment2.default)(adjustedMaxMs)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.IntervalHelperProvider=IntervalHelperProvider,exports.getBoundsRoundedToInterval=getBoundsRoundedToInterval;var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment),_ml_calc_auto_interval=__webpack_require__(3389),_inherits=__webpack_require__(3390),_calc_es_interval=__webpack_require__(1172),_time_buckets=__webpack_require__(168)},192:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getQueryFromSavedSearch(formConfig){var must=[],mustNot=[];return must.push(formConfig.query),formConfig.filters.forEach(function(f){var query=f.query||f;query=_lodash2.default.omit(query,["meta","$state"]),query=(0,_migrate_filter.migrateFilter)(query),!1===f.meta.disabled&&(f.meta.negate?mustNot.push(query):must.push(query))}),{bool:{must:must,must_not:mustNot}}}function createSearchItems($route){var indexPattern=$route.current.locals.indexPattern,query={query_string:{analyze_wildcard:!0,query:"*"}},filters=[],savedSearch=$route.current.locals.savedSearch,searchSource=savedSearch.searchSource;if(void 0===indexPattern.id&&void 0!==savedSearch.id){indexPattern=searchSource.get("index");var q=searchSource.get("query");void 0!==q&&"lucene"===q.language&&void 0!==q.query&&("string"==typeof q.query&&""!==q.query?query.query_string.query=q.query:"object"===_typeof(q.query)&&"object"===_typeof(q.query.query_string)&&""!==q.query.query_string.query&&(query.query_string.query=q.query.query_string.query));var fs=searchSource.get("filter");fs.length&&(filters=fs)}return{indexPattern:indexPattern,savedSearch:savedSearch,filters:filters,query:query,combinedQuery:getQueryFromSavedSearch({query:query,filters:filters})}}function createResultsUrl(jobIds,start,end,resultsPage){var idString=jobIds.map(function(j){return"'"+j+"'"}).join(","),from=(0,_moment2.default)(start).toISOString(),to=(0,_moment2.default)(end).toISOString(),path="";return path+="ml#/",path+=resultsPage,path+="?_g=(ml:(jobIds:!("+idString+"))",path+=",refreshInterval:(display:Off,pause:!f,value:0),time:(from:'"+from+"'",path+=",mode:absolute,to:'"+to+"'",path+="))&_a=(filters:!(),query:(query_string:(analyze_wildcard:!t,query:'*')))"}function addNewJobToRecentlyAccessed(jobId,resultsUrl){var urlParts=resultsUrl.match(/ml#\/(.+?)(\?.+)/);(0,_recently_accessed.addItemToRecentlyAccessed)(urlParts[1],jobId,urlParts[2])}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.getQueryFromSavedSearch=getQueryFromSavedSearch,exports.createSearchItems=createSearchItems,exports.createResultsUrl=createResultsUrl,exports.addNewJobToRecentlyAccessed=addNewJobToRecentlyAccessed;var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment),_migrate_filter=__webpack_require__(641),_recently_accessed=__webpack_require__(474)},208:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.ES_FIELD_TYPES={ATTACHMENT:"attachment",BOOLEAN:"boolean",BYTE:"byte",DATE:"date",DOUBLE:"double",FLOAT:"float",GEO_POINT:"geo_point",GEO_SHAPE:"geo_shape",HALF_FLOAT:"half_float",INTEGER:"integer",IP:"ip",KEYWORD:"keyword",LONG:"long",MURMUR3:"murmur3",SCALED_FLOAT:"scaled_float",SHORT:"short",TEXT:"text",TOKEN_COUNT:"token_count",_ID:"_id",_SOURCE:"_source",_TYPE:"_type"},exports.KBN_FIELD_TYPES={ATTACHMENT:"attachment",BOOLEAN:"boolean",DATE:"date",GEO_POINT:"geo_point",GEO_SHAPE:"geo_shape",IP:"ip",MURMUR3:"murmur3",NUMBER:"number",STRING:"string",_SOURCE:"_source",UNKNOWN:"unknown",CONFLICT:"conflict"},exports.ML_JOB_FIELD_TYPES={BOOLEAN:"boolean",DATE:"date",GEO_POINT:"geo_point",IP:"ip",KEYWORD:"keyword",NUMBER:"number",TEXT:"text"}},2524:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}__webpack_require__(251),__webpack_require__(642),__webpack_require__(130),__webpack_require__(186),__webpack_require__(3210),__webpack_require__(3211),__webpack_require__(473),__webpack_require__(372),__webpack_require__(1148),__webpack_require__(3213),__webpack_require__(3462),__webpack_require__(483),__webpack_require__(3463),__webpack_require__(3464),__webpack_require__(375),__webpack_require__(3466),__webpack_require__(3470),__webpack_require__(3482),__webpack_require__(3536),__webpack_require__(3549),__webpack_require__(3552),__webpack_require__(3556),__webpack_require__(3561),__webpack_require__(3564),__webpack_require__(3568);var _routes=__webpack_require__(11),_routes2=_interopRequireDefault(_routes),_momentTimezone=__webpack_require__(109),_momentTimezone2=_interopRequireDefault(_momentTimezone);__webpack_require__(2).uiModules.get("kibana").run(function(config){_momentTimezone2.default.tz.setDefault(config.get("dateFormat:tz"))}),"function"==typeof _routes2.default.enable&&_routes2.default.enable(),_routes2.default.otherwise({redirectTo:"/jobs"})},258:function(module,exports,__webpack_require__){"use strict";function loadNewJobDefaults(ml){return new Promise(function(resolve){ml.mlInfo().then(function(resp){defaults=resp.defaults,limits=resp.limits,resolve({defaults:defaults,limits:limits})}).catch(function(){resolve({defaults:defaults,limits:limits})})})}function newJobDefaults(){return defaults}function newJobLimits(){return limits}Object.defineProperty(exports,"__esModule",{value:!0}),exports.loadNewJobDefaults=loadNewJobDefaults,exports.newJobDefaults=newJobDefaults,exports.newJobLimits=newJobLimits;var defaults={anomaly_detectors:{},datafeeds:{}},limits={}},260:function(module,exports,__webpack_require__){"use strict";function getSeverity(normalizedScore){return normalizedScore>=75?"critical":normalizedScore>=50?"major":normalizedScore>=25?"minor":normalizedScore>=0?"warning":"unknown"}function getSeverityWithLow(normalizedScore){return normalizedScore>=75?"critical":normalizedScore>=50?"major":normalizedScore>=25?"minor":normalizedScore>=3?"warning":normalizedScore>=0?"low":"unknown"}function getSeverityColor(normalizedScore){return normalizedScore>=75?"#fe5050":normalizedScore>=50?"#fba740":normalizedScore>=25?"#fdec25":normalizedScore>=3?"#8bc8fb":normalizedScore>=0?"#d2e9f7":"#ffffff"}function labelDuplicateDetectorDescriptions(detectorsByJob){var checkedJobIds=[];return _lodash2.default.each(detectorsByJob,function(detectors,jobId){checkedJobIds.push(jobId);var otherJobs=_lodash2.default.omit(detectorsByJob,checkedJobIds);_lodash2.default.each(detectors,function(description,i){_lodash2.default.each(otherJobs,function(otherJobDetectors,otherJobId){_lodash2.default.each(otherJobDetectors,function(otherDescription,j){description===otherDescription&&(detectors[i]=description+" ("+jobId+")",otherJobDetectors[j]=description+" ("+otherJobId+")")})})})}),detectorsByJob}function getEntityFieldName(record){return _lodash2.default.has(record,"by_field_name")&&_lodash2.default.has(record,"by_field_value")?record.by_field_name:_lodash2.default.has(record,"over_field_name")?record.over_field_name:_lodash2.default.has(record,"partition_field_name")?record.partition_field_name:void 0}function getEntityFieldValue(record){return _lodash2.default.has(record,"by_field_value")?record.by_field_value:_lodash2.default.has(record,"over_field_value")?record.over_field_value:_lodash2.default.has(record,"partition_field_value")?record.partition_field_value:void 0}function showActualForFunction(functionDescription){return _lodash2.default.indexOf(DISPLAY_ACTUAL_FUNCTIONS,functionDescription)>-1}function showTypicalForFunction(functionDescription){return _lodash2.default.indexOf(DISPLAY_TYPICAL_FUNCTIONS,functionDescription)>-1}Object.defineProperty(exports,"__esModule",{value:!0}),exports.aggregationTypeTransform=void 0,exports.getSeverity=getSeverity,exports.getSeverityWithLow=getSeverityWithLow,exports.getSeverityColor=getSeverityColor,exports.labelDuplicateDetectorDescriptions=labelDuplicateDetectorDescriptions,exports.getEntityFieldName=getEntityFieldName,exports.getEntityFieldValue=getEntityFieldValue,exports.showActualForFunction=showActualForFunction,exports.showTypicalForFunction=showTypicalForFunction;var _lodash=__webpack_require__(1),_lodash2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_lodash),DISPLAY_ACTUAL_FUNCTIONS=["count","distinct_count","lat_long","mean","max","min","sum","median","varp","info_content","time"],DISPLAY_TYPICAL_FUNCTIONS=["count","distinct_count","mean","max","min","sum","median","varp","info_content","time"];exports.aggregationTypeTransform={toES:function(oldAggType){var newAggType=oldAggType;return"mean"===newAggType?newAggType="avg":"distinct_count"===newAggType?newAggType="cardinality":"median"===newAggType&&(newAggType="percentiles"),newAggType},toML:function(oldAggType){var newAggType=oldAggType;return"avg"===newAggType?newAggType="mean":"cardinality"===newAggType?newAggType="distinct_count":"percentiles"===newAggType&&(newAggType="median"),newAggType}}},301:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.ML_RESULTS_INDEX_PATTERN=".ml-anomalies-*",exports.ML_NOTIFICATION_INDEX_PATTERN=".ml-notifications"},302:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3253),__webpack_require__(3255)},305:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.EVENT_RATE_COUNT_FIELD="__ml_event_rate_count__"},306:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1),_lodash2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_lodash);__webpack_require__(2).uiModules.get("apps/ml").service("mlESMappingService",function($q,ml){this.getFieldTypeFromMapping=function(index,fieldName){return $q(function(resolve,reject){""!==index?ml.getFieldCaps({index:index,fields:[fieldName]}).then(function(resp){var fieldType="";_lodash2.default.each(resp.fields,function(field){_lodash2.default.each(field,function(type){""===fieldType&&(fieldType=type.type)})}),resolve(fieldType)}).catch(function(error){reject(error)}):reject()})}})},307:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3403),__webpack_require__(3405)},3210:function(module,exports){},3211:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _routes=__webpack_require__(11),_routes2=_interopRequireDefault(_routes),_chrome=__webpack_require__(8),_chrome2=_interopRequireDefault(_chrome),_index=__webpack_require__(3212),_index2=_interopRequireDefault(_index);_routes2.default.when("/access-denied",{template:_index2.default,controllerAs:"accessDenied",controller:function($window,kbnUrl,kbnBaseUrl){this.goToKibana=function(){$window.location.href=_chrome2.default.getBasePath()+kbnBaseUrl},this.retry=function(){return kbnUrl.redirect("/jobs")}}})},3212:function(module,exports){module.exports='<ml-nav-menu name="access-denied"></ml-nav-menu>\n<div class="col-md-12">\n  <div class="euiSpacer euiSpacer--m"></div>\n  <div class="euiCallOut euiCallOut--danger">\n    <div class="euiCallOutHeader">\n      <svg class="euiIcon euiIcon--medium euiCallOutHeader__icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n        width="16" height="16" viewBox="0 0 16 16">\n        <defs>\n          <path id="cross-a" d="M7.293 8l-4.147 4.146a.5.5 0 0 0 .708.708L8 8.707l4.146 4.147a.5.5 0 0 0 .708-.708L8.707 8l4.147-4.146a.5.5 0 0 0-.708-.708L8 7.293 3.854 3.146a.5.5 0 1 0-.708.708L7.293 8z"></path>\n        </defs>\n        <use fill-rule="nonzero" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#cross-a"></use>\n      </svg>\n      <span class="euiCallOutHeader__title">You need permission to access Machine Learning</span>\n    </div>\n    <div class="euiText euiText--small">\n      <p>You must have the privileges granted in the <span class="text-monospace">kibana_user</span> and <span class="text-monospace">machine_learning_user</span> roles.<br/>\n      Your system admin can set these roles on the Management User page.\n      </p>\n    </div>\n  </div>\n\n  <div style=\'margin-top:20px;\'>\n    <button ng-click="accessDenied.goToKibana();" class="kuiButton kuiButton--primary">Back to Kibana home</button>\n    <button ng-click="accessDenied.retry();" class="kuiButton kuiButton--basic">Retry</button>\n  </div>\n</div>\n'},3213:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3214),__webpack_require__(3215),__webpack_require__(3292),__webpack_require__(3308),__webpack_require__(3406),__webpack_require__(3430),__webpack_require__(3444),__webpack_require__(3450),__webpack_require__(1157)},3214:function(module,exports){},3215:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3216),__webpack_require__(3217),__webpack_require__(3230),__webpack_require__(3256),__webpack_require__(3268),__webpack_require__(3271),__webpack_require__(3274),__webpack_require__(660),__webpack_require__(1156),__webpack_require__(1157),__webpack_require__(3291)},3216:function(module,exports){},3217:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_jquery=__webpack_require__(12),_jquery2=_interopRequireDefault(_jquery),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular);__webpack_require__(1149);var _jobs_list_controls=__webpack_require__(3221),_jobs_list_controls2=_interopRequireDefault(_jobs_list_controls),_open=__webpack_require__(1150),_open2=_interopRequireDefault(_open),_job_utils=__webpack_require__(57),_string_utils=__webpack_require__(43),_routes=__webpack_require__(11),_routes2=_interopRequireDefault(_routes),_check_license=__webpack_require__(101),_check_privilege=__webpack_require__(93),_recently_accessed=__webpack_require__(474),_check_ml_nodes=__webpack_require__(108),_jobs_list=__webpack_require__(3224),_jobs_list2=_interopRequireDefault(_jobs_list),_delete_job_modal=__webpack_require__(3225),_delete_job_modal2=_interopRequireDefault(_delete_job_modal),_edit_job_modal=__webpack_require__(3226),_edit_job_modal2=_interopRequireDefault(_edit_job_modal),_create_watch_modal=__webpack_require__(3227),_create_watch_modal2=_interopRequireDefault(_create_watch_modal),_buttons_enabled_checks=__webpack_require__(3228),_cloud_service=__webpack_require__(3229),_new_job_defaults=__webpack_require__(258),_modules=__webpack_require__(2);_routes2.default.when("/jobs/?",{template:_jobs_list2.default,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkGetJobsPrivilege,mlNodeCount:_check_ml_nodes.getMlNodeCount,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults}}),_modules.uiModules.get("apps/ml",["ui.bootstrap"]).controller("MlJobsList",function($scope,$route,$location,$window,$timeout,$compile,$modal,es,timefilter,kbnUrl,Private,mlMessageBarService,mlClipboardService,mlJobService,mlCalendarService,mlDatafeedService,mlNotificationService){function latestTimeStamp(dataCounts){var obj={string:"",unix:0};if(dataCounts.latest_record_timestamp){var ts=(0,_moment2.default)(dataCounts.latest_record_timestamp);obj.string=ts.format(TIME_FORMAT),obj.unix=ts}return obj}function displayJobs(jobs){var rowStates={};_lodash2.default.each(rowScopes,function(rs){rowStates[rs.job.job_id]={open:rs.open,$expandElement:rs.$expandElement,currentTab:rs.currentTab}}),_lodash2.default.invoke(rowScopes,"$destroy"),rowScopes.length=0,$scope.jobs=jobs,$scope.table={},$scope.table.perPage=10,$scope.table.columns=[{title:"",sortable:!1,class:"col-expand-arrow"},{title:"Job ID"},{title:"",sortable:!1,class:"col-info"},{title:"Description"},{title:"Processed records",class:"col-align-right"},{title:"Memory status"},{title:"Job state"},{title:"Datafeed state"},{title:"Latest timestamp"},{title:"Actions",sortable:!1,class:"col-action"}];var jobCalendars=mlCalendarService.jobCalendars,rows=jobs.map(function(job){var rowScope=$scope.$new(),calendars=jobCalendars[job.job_id];calendars&&calendars.length&&(rowScope.calendars=calendars),rowScope.job=job,rowScope.closeJob=$scope.closeJob,rowScope.canCloseJob=$scope.permissions.canCloseJob&&$scope.mlNodesAvailable,rowScope.currentTab={index:0},rowScope.jobAudit={messages:"",update:function(){return loadAuditMessages(jobs,[rowScope],rowScope.job.job_id)},jobWarningClass:"",jobWarningText:""},rowScope.expandable=!0,rowScope.expandElement="ml-job-list-expanded-row-container",rowScope.initRow=function(){if(rowScope.$expandElement&&0===rowScope.$expandElement.children().length){var $el=(0,_jquery2.default)("<ml-job-list-expanded-row>",{job:"job",calendars:"calendars","current-tab":"currentTab","job-audit":"jobAudit","close-job":"closeJob","can-close-job":"canCloseJob"});$el.appendTo(this.$expandElement),$compile($el)(this)}},rowScope.time=latestTimeStamp,rowScope.jobUrl=mlJobService.jobUrls[job.job_id],rowScope.enableTimeSeries=(0,_job_utils.isTimeSeriesViewJob)(job),rowScope.addItemToRecentlyAccessed=_recently_accessed.addItemToRecentlyAccessed,rowScope.checks=(0,_buttons_enabled_checks.buttonsEnabledChecks)($scope.permissions,job,createPermissionFailureMessage,$scope.mlNodesAvailable),rowScopes.push(rowScope);var jobDescription=job.description||"";if(void 0===$scope.filterText||""===$scope.filterText||job.job_id.match(filterRegexp)||jobDescription.match(filterRegexp)){var iconTxt="<i ng-show=\"tab.jobWarningClass !== ''\" ";return iconTxt+='tooltip="{{jobAudit.jobWarningText}}" class="{{jobAudit.jobWarningClass}}"></i>',[{markup:_open2.default,scope:rowScope},{markup:filterHighlight(job.job_id),value:job.job_id},{markup:iconTxt,scope:rowScope},{markup:filterHighlight((0,_string_utils.mlEscape)(jobDescription)),value:jobDescription},{markup:'<div class="col-align-right">{{toLocaleString(job.data_counts.processed_record_count)}}</div>',value:job.data_counts.processed_record_count,scope:rowScope},{markup:"{{job.model_size_stats.memory_status}}",value:function(){return job.model_size_stats?job.model_size_stats.memory_status:""},scope:rowScope},{markup:"{{job.state}}",value:job.state,scope:rowScope},{markup:"{{job.datafeed_config.state}}",value:function(){return job.datafeed_config.state?job.datafeed_config.state:""},scope:rowScope},{markup:"{{ time(job.data_counts).string }}",value:function(){return rowScope.time(job.data_counts).unix},scope:rowScope},{markup:_jobs_list_controls2.default,scope:rowScope}]}});rows=_lodash2.default.filter(rows,function(row){if(void 0!==row)return row}),$scope.table.rows=rows,loadAuditSummary(jobs,rowScopes),_lodash2.default.each(rowScopes,function(rs){rowStates[rs.job.job_id]&&(rs.open=rowStates[rs.job.job_id].open,rs.$expandElement=rowStates[rs.job.job_id].$expandElement,rs.currentTab=rowStates[rs.job.job_id].currentTab)}),clearTimeout(refreshJobsTimeout),refreshCounts(),$scope.filterIcon=0}function refreshCounts(){function refresh(){mlJobService.updateAllJobStats().then(function(resp){resp.listChanged&&jobsUpdated(resp.jobs)})}refreshJobsTimeout=setTimeout(function(){refreshCounter%5==0?(refresh(),loadAuditSummary($scope.jobs,rowScopes)):mlJobService.getRunningJobs().length&&refresh(),clearTimeout(refreshJobsTimeout),refreshCounter++,"/jobs"===$location.$$path&&refreshCounts()},5e3)}function loadAuditMessages(jobs,rowScopesIn,jobId){function addMessage(id,msg){void 0!==auditMessages[id]&&msg.timeMs>=createTimes[id]&&(_lodash2.default.findWhere(auditMessages[id],{timeMs:msg.timeMs,message:msg.message,node_name:msg.node_name})||auditMessages[id].push(msg))}var createTimes={},aDayAgo=(0,_moment2.default)().subtract(1,"days");return _lodash2.default.each(jobs,function(job){void 0===auditMessages[job.job_id]&&(auditMessages[job.job_id]=[]),createTimes[job.job_id]=(0,_moment2.default)(job.create_time).valueOf()}),mlNotificationService.getJobAuditMessages("1M",jobId).then(function(resp){var messages=resp.messages;_lodash2.default.each(messages,function(msg){var time=(0,_moment2.default)(msg.timestamp);msg.time=time.format(TIME_FORMAT),msg.timeMs=time.valueOf(),msg.isRecent=time>aDayAgo,""===msg.job_id?(msg.level="system_info",addMessage(jobId,msg)):addMessage(msg.job_id,msg)}),auditMessages[jobId]=_lodash2.default.sortBy(auditMessages[jobId],"timeMs"),_lodash2.default.each(rowScopesIn,function(rs){rs.job.job_id===jobId&&(rs.jobAudit.messages=auditMessages[jobId])})}).catch(function(resp){console.log("loadAuditMessages: audit messages for "+jobId+" could not be loaded"),resp.message&&msgs.error(resp.message)})}function loadAuditSummary(jobs,rowScopesIn){var levels={system_info:-1,info:0,warning:1,error:2},jobMessages={},createTimes={};_lodash2.default.each(jobs,function(job){createTimes[job.job_id]=(0,_moment2.default)(job.create_time).valueOf()}),mlNotificationService.getAuditMessagesSummary().then(function(resp){var messagesPerJob=resp.messagesPerJob;_lodash2.default.each(messagesPerJob,function(job){if(""!==job.key&&job.levels&&job.levels.buckets&&job.levels.buckets.length){var highestLevel=0,highestLevelText="",msgTime=0;_lodash2.default.each(job.levels.buckets,function(level){var label=level.key;levels[label]>highestLevel&&(highestLevel=levels[label],level.latestMessage&&level.latestMessage.buckets&&level.latestMessage.buckets.length&&_lodash2.default.each(level.latestMessage.buckets,function(msg){if(highestLevelText=msg.key,msg.latestMessage&&msg.latestMessage.value_as_string){var time=(0,_moment2.default)(msg.latestMessage.value_as_string);msgTime=time.valueOf()}}))}),jobMessages[job.key]={job_id:job.key,highestLevelText:highestLevelText,highestLevel:highestLevel,msgTime:msgTime}}}),_lodash2.default.each(rowScopesIn,function(rs){var job=jobMessages[rs.job.job_id];job&&job.msgTime>=createTimes[job.job_id]&&(rs.jobAudit.jobWarningClass="",rs.jobAudit.jobWarningText=(0,_string_utils.mlEscape)(job.highestLevelText),1===job.highestLevel?rs.jobAudit.jobWarningClass="job-warning fa fa-exclamation-circle":2===job.highestLevel&&(rs.jobAudit.jobWarningClass="job-error fa fa-exclamation-triangle"))})}).catch(function(resp){console.log("loadAuditSummary: audit messages for all jobs could not be loaded"),resp.message&&msgs.error(resp.message)})}function openEditJobWindow(job){$modal.open({template:_edit_job_modal2.default,controller:"MlEditJobModal",backdrop:"static",keyboard:!1,size:"lg",resolve:{params:function(){return{pscope:$scope,job:job}}}})}function filterHighlight(txt){return $scope.filterText&&filterRegexp&&(txt=txt.replace(filterRegexp,'<span class="ml-mark">$1</span>')),txt}function jobsUpdated(jobs){$scope.noJobsCreated=0===jobs.length,displayJobs(jobs)}function refreshJobs(){mlJobService.loadJobs().then(function(resp){mlCalendarService.loadCalendars(resp.jobs).then(function(){jobsUpdated(resp.jobs)})}).catch(function(resp){jobsUpdated(resp.jobs)})}timefilter.disableTimeRangeSelector(),timefilter.disableAutoRefreshSelector();var rowScopes=[],msgs=mlMessageBarService,TIME_FORMAT="YYYY-MM-DD HH:mm:ss",refreshCounter=0,refreshJobsTimeout=null,auditMessages={};$scope.noJobsCreated,$scope.toLocaleString=_string_utils.toLocaleString,$scope.filterText="",$scope.filterIcon=0;var filterRegexp=void 0,jobFilterTimeout=void 0;$scope.kbnUrl=kbnUrl,$scope.mlNodesAvailable=(0,_check_ml_nodes.mlNodesAvailable)(),$scope.permissionToViewMlNodeCount=(0,_check_ml_nodes.permissionToViewMlNodeCount)();var _Private=Private(_cloud_service.cloudServiceProvider),isRunningOnCloud=_Private.isRunningOnCloud,getCloudId=_Private.getCloudId;$scope.isCloud=isRunningOnCloud(),$scope.cloudId=getCloudId();var _Private2=Private(_check_privilege.permissionCheckProvider),checkPermission=_Private2.checkPermission,createPermissionFailureMessage=_Private2.createPermissionFailureMessage;$scope.createPermissionFailureMessage=createPermissionFailureMessage,$scope.permissions={canCreateJob:checkPermission("canCreateJob"),canUpdateJob:checkPermission("canUpdateJob"),canDeleteJob:checkPermission("canDeleteJob"),canCloseJob:checkPermission("canCloseJob"),canUpdateDatafeed:checkPermission("canUpdateDatafeed"),canStartStopDatafeed:checkPermission("canStartStopDatafeed")},$scope.jobStats=mlJobService.jobStats,$scope.deleteJob=function(job){function doDelete(){status.deleteLock=!0,mlJobService.deleteJob(job,status).then(function(deleteResp){deleteResp.success&&(status.deleteLock=!1,msgs.clear(),msgs.info("Job '"+job.job_id+"' deleted"),status.deleteLock=!1,refreshJobs())})}var status={deleteLock:!1,deleteDatafeed:0,deleteJob:0,errorMessage:""};$modal.open({template:_delete_job_modal2.default,controller:"MlDeleteJobModal",backdrop:"static",keyboard:!1,size:"sm",resolve:{params:function(){return{doDelete:doDelete,status:status,jobId:job.job_id,isDatafeed:!(!job.datafeed_config||!Object.keys(job.datafeed_config).length)}}}})},$scope.newJob=function(){$location.path("jobs/new_job")},$scope.editJob=function(job){openEditJobWindow(job)},$scope.cloneJob=function(job){mlJobService.currentJob=job,$location.path("jobs/new_job/advanced")},$scope.closeJob=function(job){var closeFunc=mlJobService.closeJob;"failed"===job.state&&(closeFunc=mlJobService.forceCloseJob),closeFunc(job.job_id).then(function(){$scope.refreshJob(job.job_id)}).catch(function(resp){msgs.error("Job could not be closed",resp),refreshJobs()})},$scope.copyToClipboard=function(job){mlClipboardService.copy(_angular2.default.toJson(job))?(msgs.clear(),msgs.info(job.job_id+" JSON copied to clipboard")):msgs.error("Job could not be copied to the clipboard")},$scope.startDatafeed=function(job){mlDatafeedService.openJobTimepickerWindow(job,$scope)},$scope.stopDatafeed=function(job){job.datafeed_config&&(job.datafeed_config.state="stopping");var datafeedId=mlJobService.getDatafeedId(job.job_id);mlJobService.stopDatafeed(datafeedId,job.job_id).then(function(){$scope.refreshJob(job.job_id)})},$scope.openCreateWatchWindow=function(job){$modal.open({template:_create_watch_modal2.default,controller:"MlCreateWatchModal",backdrop:"static",keyboard:!1,resolve:{params:function(){return{job:job}}}})},$scope.applyFilter=function(){$timeout.cancel(jobFilterTimeout),jobFilterTimeout=$timeout(function(){filterRegexp=$scope.filterText?new RegExp("("+$scope.filterText+")","gi"):void 0,displayJobs($scope.jobs),jobFilterTimeout=void 0},1e3),$timeout(function(){$scope.filterIcon=1},250)},$scope.clearFilter=function(){$scope.filterText="",$scope.filterRegexp=void 0,$scope.applyFilter()},$scope.refreshJob=function(jobId){mlJobService.refreshJob(jobId).then(function(resp){jobsUpdated(resp.jobs)}).catch(function(resp){jobsUpdated(resp.jobs)})},refreshJobs(),$scope.$on("jobsUpdated",function(){refreshJobs()}),$scope.$on("openCreateWatchWindow",function(e,job){$scope.openCreateWatchWindow(job)}),$scope.$on("$destroy",function(){clearTimeout(refreshJobsTimeout)})})},3218:function(module,exports){},3219:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _form_filter_input=__webpack_require__(3220),_form_filter_input2=_interopRequireDefault(_form_filter_input),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular);__webpack_require__(2).uiModules.get("apps/ml").directive("mlFormFilterInput",function(){return{scope:{placeholder:"@?",filter:"=",filterIcon:"=",filterChanged:"=",clearFilter:"="},restrict:"E",replace:!1,template:_form_filter_input2.default,link:function(scope){scope.placeholder=_angular2.default.isDefined(scope.placeholder)?scope.placeholder:"Filter"}}})},3220:function(module,exports){module.exports='<div class="fa fa-search"></div>\n<input\n  class="form-control ml-filter-input-left-icon"\n  type="text"\n  aria-label="{{placeholder}}"\n  placeholder="{{placeholder}}"\n  ng-model="filter"\n  ng-change="filterChanged()" />\n<div class="ml-filter-progress-icon">\n  <div ng-show="filterIcon===1">\n    <i class=\'fa fa-spinner fa-spin\'></i>\n  </div>\n  <div ng-show="filterIcon===0">\n    <a aria-label="Clear filter" ng-click="clearFilter()">\n      <i class="fa fa-times-circle"></i>\n    </a>\n  </div>\n</div>\n'},3221:function(module,exports){module.exports='<div class="actions">\n\n  \x3c!-- start --\x3e\n  <div ng-class="checks.startButtonWrapperClass()" data-placement="right" data-toggle="tooltip"\n    ng-attr-tooltip="{{checks.startButtonWrapperTooltip()}}">\n    <button\n      ng-show="checks.startButtonVisible()"\n      ng-click="((job.datafeed_config && job.datafeed_config.state===\'started\')?stopDatafeed(job):startDatafeed(job))"\n      class="kuiButton kuiButton--basic kuiButton--small"\n      data-toggle="tooltip"\n      aria-label="{{check.startButtonAriaLabel()}}}"\n      ng-disabled="checks.startButtonDisabled()"\n      tooltip="{{checks.startButtonTooltip()}}">\n        <i aria-hidden="true" ng-class="checks.buttonIcon()"></i>\n    </button>\n  </div>\n\n  \x3c!-- loading --\x3e\n  <button\n    disabled\n    ng-show="checks.loadingButtonVisible()"\n    class="kuiButton kuiButton--basic kuiButton--small"\n    data-toggle="tooltip"\n    tooltip="No datafeed settings for {{job.job_id}}">\n      <i aria-hidden="true" class="fa fa-clock-o"></i>\n  </button>\n\n  \x3c!-- anomaly explorer --\x3e\n  <a\n    href=\'ml#/explorer/{{jobUrl.url}}\'\n    ng-click="addItemToRecentlyAccessed(\'explorer\',job.job_id,  jobUrl.url)"\n    class="kuiButton kuiButton--basic kuiButton--small"\n    data-toggle="tooltip"\n    aria-label="Open Anomaly Explorer"\n    tooltip="Open {{job.job_id}} in Anomaly Explorer">\n      <i aria-hidden="true" class="fa fa-table"></i>\n  </a>\n\n  \x3c!-- time series explorer --\x3e\n  \x3c!-- if time series job, show the link. otherwise show a disabled button --\x3e\n  <a\n    ng-if=\'enableTimeSeries\'\n    href=\'ml#/timeseriesexplorer/{{jobUrl.url}}\'\n    ng-click="addItemToRecentlyAccessed(\'timeseriesexplorer\', job.job_id, jobUrl.url)"\n    class="kuiButton kuiButton--basic kuiButton--small"\n    data-toggle="tooltip"\n    aria-label="Open Single Metric Viewer"\n    tooltip="Open {{job.job_id}} in Single Metric Viewer">\n      <i aria-hidden="true" class="fa fa-line-chart"></i>\n  </a>\n  <button\n    ng-if=\'!enableTimeSeries\'\n    disabled\n    class="kuiButton kuiButton--basic kuiButton--small"\n    aria-label="Open single metric viewer"\n    data-toggle="tooltip">\n      <i aria-hidden="true" class="fa fa-line-chart"></i>\n  </button>\n\n  \x3c!-- edit job --\x3e\n  <div ng-class="checks.editButtonWrapperClass()" data-placement="right" data-toggle="tooltip"\n    ng-attr-tooltip="{{checks.editButtonWrapperTooltip()}}">\n    <button\n      ng-click="editJob(job)"\n      ng-disabled="checks.editButtonDisabled()"\n      class="kuiButton kuiButton--basic kuiButton--small"\n      aria-label="Edit job"\n      data-toggle="tooltip"\n      tooltip="Edit job" >\n        <i aria-hidden="true" class="fa fa-pencil-square-o"></i>\n    </button>\n  </div>\n\n  \x3c!-- clone job --\x3e\n  <div ng-class="checks.cloneButtonWrapperClass()" data-placement="right" data-toggle="tooltip"\n    ng-attr-tooltip="{{checks.cloneButtonWrapperTooltip()}}">\n    <button\n      ng-click="cloneJob(job)"\n      class="kuiButton kuiButton--basic kuiButton--small"\n      data-toggle="tooltip"\n      ng-disabled=\'checks.cloneButtonDisabled()\'\n      aria-label="Clone job"\n      tooltip="Clone job" >\n        <i aria-hidden="true" class="fa fa-clone"></i>\n    </button>\n  </div>\n\n  \x3c!-- delete job --\x3e\n  <div ng-class="checks.deleteButtonWrapperClass()" data-placement="right" data-toggle="tooltip"\n    ng-attr-tooltip="{{checks.deleteButtonWrapperTooltip()}}">\n    <button\n      ng-click="deleteJob(job)"\n      class="kuiButton kuiButton--danger kuiButton--small"\n      data-toggle="tooltip"\n      ng-disabled=\'checks.deleteButtonDisabled()\'\n      aria-label="Delete job"\n      tooltip="Delete job">\n        <i aria-hidden="true" class="fa fa-trash"></i>\n    </button>\n  </div>\n</div>\n'},3223:function(module,exports,__webpack_require__){"use strict";function privilegesProvider(Promise,ml){function getPrivileges(){var privileges={canGetJobs:!1,canCreateJob:!1,canDeleteJob:!1,canOpenJob:!1,canCloseJob:!1,canForecastJob:!1,canGetDatafeeds:!1,canStartStopDatafeed:!1,canUpdateJob:!1,canUpdateDatafeed:!1,canPreviewDatafeed:!1,canCreateCalendar:!1,canDeleteCalendar:!1};return new Promise(function(resolve,reject){var priv={cluster:["cluster:monitor/xpack/ml/job/get","cluster:monitor/xpack/ml/job/stats/get","cluster:monitor/xpack/ml/datafeeds/get","cluster:monitor/xpack/ml/datafeeds/stats/get","cluster:admin/xpack/ml/job/put","cluster:admin/xpack/ml/job/delete","cluster:admin/xpack/ml/job/update","cluster:admin/xpack/ml/job/open","cluster:admin/xpack/ml/job/close","cluster:admin/xpack/ml/job/forecast","cluster:admin/xpack/ml/datafeeds/put","cluster:admin/xpack/ml/datafeeds/delete","cluster:admin/xpack/ml/datafeeds/start","cluster:admin/xpack/ml/datafeeds/stop","cluster:admin/xpack/ml/datafeeds/update","cluster:admin/xpack/ml/datafeeds/preview","cluster:admin/xpack/ml/calendars/put","cluster:admin/xpack/ml/calendars/delete","cluster:admin/xpack/ml/calendars/jobs/update","cluster:admin/xpack/ml/calendars/events/post","cluster:admin/xpack/ml/calendars/events/delete"]};ml.checkPrivilege(priv).then(function(resp){resp.securityDisabled?Object.keys(privileges).forEach(function(k){return privileges[k]=!0}):(resp.cluster["cluster:monitor/xpack/ml/job/get"]&&resp.cluster["cluster:monitor/xpack/ml/job/stats/get"]&&(privileges.canGetJobs=!0),resp.cluster["cluster:monitor/xpack/ml/datafeeds/get"]&&resp.cluster["cluster:monitor/xpack/ml/datafeeds/stats/get"]&&(privileges.canGetDatafeeds=!0),resp.cluster["cluster:admin/xpack/ml/job/put"]&&resp.cluster["cluster:admin/xpack/ml/job/open"]&&resp.cluster["cluster:admin/xpack/ml/datafeeds/put"]&&(privileges.canCreateJob=!0),resp.cluster["cluster:admin/xpack/ml/job/update"]&&(privileges.canUpdateJob=!0),resp.cluster["cluster:admin/xpack/ml/job/open"]&&(privileges.canOpenJob=!0),resp.cluster["cluster:admin/xpack/ml/job/close"]&&(privileges.canCloseJob=!0),resp.cluster["cluster:admin/xpack/ml/job/forecast"]&&(privileges.canForecastJob=!0),resp.cluster["cluster:admin/xpack/ml/job/delete"]&&resp.cluster["cluster:admin/xpack/ml/datafeeds/delete"]&&(privileges.canDeleteJob=!0),resp.cluster["cluster:admin/xpack/ml/job/open"]&&resp.cluster["cluster:admin/xpack/ml/datafeeds/start"]&&resp.cluster["cluster:admin/xpack/ml/datafeeds/stop"]&&(privileges.canStartStopDatafeed=!0),resp.cluster["cluster:admin/xpack/ml/datafeeds/update"]&&(privileges.canUpdateDatafeed=!0),resp.cluster["cluster:admin/xpack/ml/datafeeds/preview"]&&(privileges.canPreviewDatafeed=!0),resp.cluster["cluster:admin/xpack/ml/calendars/put"]&&resp.cluster["cluster:admin/xpack/ml/calendars/jobs/update"]&&resp.cluster["cluster:admin/xpack/ml/calendars/events/post"]&&(privileges.canCreateCalendar=!0),resp.cluster["cluster:admin/xpack/ml/calendars/delete"]&&resp.cluster["cluster:admin/xpack/ml/calendars/events/delete"]&&(privileges.canDeleteCalendar=!0)),resolve(privileges)}).catch(function(){reject(privileges)})})}return{getPrivileges:getPrivileges}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.privilegesProvider=privilegesProvider},3224:function(module,exports){module.exports='<ml-nav-menu name="jobs"></ml-nav-menu>\n<ml-config-jobs ng-controller="MlJobsList">\n  <div class=\'jobs-stats-bar\'>\n    <span ng-if=\'js.show\' class=\'stat\' ng-repeat=\'js in jobStats\'>\n      <span class=\'stat-label\'>{{js.label}}</span>: <span class=\'stat-value\'>{{js.value}}</span>\n    </span>\n  </div>\n  <ml-message-bar ></ml-message-bar>\n\n  <div class="jobs-container">\n    <div ng-if="mlNodesAvailable === false && permissionToViewMlNodeCount === true" class="euiCallOut euiCallOut--warning">\n      <div class="euiCallOutHeader">\n        <svg class="euiIcon euiCallOutHeader__icon euiIcon--medium" xmlns="http://www.w3.org/2000/svg"\n            width="16" height="16" viewBox="0 0 16 16">\n          <g fill-rule="evenodd">\n            <path d="M7.5 2.236L1.618 14h11.764L7.5 2.236zm.894-.447l5.882 11.764A1 1 0 0 1 13.382 15H1.618a1 1 0 0 1-.894-1.447L6.606 1.789a1 1 0 0 1 1.788 0z"\n            />\n            <path d="M7 6h1v5H7zM7 12h1v1H7z" />\n          </g>\n        </svg>\n        <span class="euiCallOutHeader__title">No ML Nodes available</span>\n      </div>\n      <div class="euiText euiText--small">\n        <p>\n          There are no ML nodes available.\n          <span ng-if="isCloud">\n            This can be configured in Cloud\n            <a class="euiLink euiLink--primary" href="#">here</a>.\n          </span>\n        </p>\n      </div>\n    </div>\n\n    <div>\n      <header>\n        <div class="row" >\n        <div class="col-xs-6 col-md-9">\n          <div ng-class="permissions.canCreateJob ? \'button-wrapper\' : [\'button-wrapper\', \'disabled\'] " data-placement="right" data-toggle="tooltip"\n            ng-attr-tooltip="{{permissions.canCreateJob ? undefined : createPermissionFailureMessage(\'canCreateJob\')}}">\n            <button\n              ng-click=\'newJob()\'\n              class="kuiButton kuiButton--primary"\n              ng-disabled=\'permissions.canCreateJob===false || mlNodesAvailable === false\'\n              aria-label="Create new job">\n              <i aria-hidden="true" class="fa fa-plus"></i>\n              Create new job\n            </button>\n          </div>\n\n        </div>\n\n\n        <div class="col-xs-6 col-md-3">\n          <ml-form-filter-input\n            placeholder="Job filter"\n            filter="filterText"\n            filter-icon="filterIcon"\n            filter-changed="applyFilter"\n            clear-filter="clearFilter" />\n        </div>\n      </div>\n\n      </header>\n      <ml-paginated-table\n        columns="table.columns"\n        rows="table.rows"\n        per-page="table.perPage">\n      </ml-paginated-table>\n\n      <div class="no-jobs-warning" ng-show="filterText && table.rows.length===0">No jobs found</div>\n      <div class="no-jobs-warning" ng-show="noJobsCreated===true">No jobs configured</div>\n      <ml-loading-indicator\n        label="Loading jobs"\n        is-loading="noJobsCreated===undefined"\n        class="no-jobs-warning"\n      />\n\n    </div>\n  </div>\n</ml-config-jobs>\n'},3225:function(module,exports){module.exports='<div class="delete-job-modal">\n  <h1 tooltip="Delete job {{ui.jobId}}" class="euiTitle euiTitle--small">Delete job {{ui.jobId}}</h1>\n  <div ng-show="ui.stage===1" class="status-item-list">\n    <div class="status-item" ng-show="ui.isDatafeed">Deleting datafeed...\n      <i ng-show="ui.status.deleteDatafeed === -1" aria-hidden="true" style="color:red;" class="fa fa-remove"></i>\n      <i ng-show="ui.status.deleteDatafeed === 0" aria-hidden="true" class="fa fa-spinner fa-spin"></i>\n      <i ng-show="ui.status.deleteDatafeed === 1" aria-hidden="true" style="color:green;" class="fa fa-check"></i>\n    </div>\n\n    <div class="status-item">Deleting job...\n      <i ng-show="ui.status.deleteJob === -1" aria-hidden="true" style="color:red;" class="fa fa-remove"></i>\n      <i ng-show="ui.status.deleteJob === 0" aria-hidden="true" class="fa fa-spinner fa-spin"></i>\n      <i ng-show="ui.status.deleteJob === 1" aria-hidden="true" style="color:green;" class="fa fa-check"></i>\n    </div>\n  </div>\n  <div ng-if="ui.status.errorMessage!==\'\'" class="validation-error">\n    {{ui.status.errorMessage}} request may have timed out and may still be running in the background.<br />\n    Please check status and retry in a few minutes.\n  </div>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n  <div ng-show= "ui.stage===0">\n    <button\n      ng-disabled="ui.status.deleteLock"\n      ng-click="delete();"\n      class="kuiButton kuiButton--danger"\n      aria-label="delete">\n        Delete job\n    </button>\n\n    <button\n      ng-disabled="ui.status.deleteLock"\n      ng-click="close();"\n      class="kuiButton kuiButton--primary"\n      aria-label="cancel">\n        Cancel\n    </button>\n  </div>\n  <div ng-show= "ui.stage===1">\n    <button\n      ng-click="close();"\n      class="kuiButton kuiButton--primary"\n      aria-label="close">\n        Close\n    </button>\n  </div>\n</div>\n'},3226:function(module,exports){module.exports='<div class="edit-job-modal">\n  <ml-message-bar ></ml-message-bar>\n  <h1 tooltip="{{ui.title}}" class="euiTitle">{{ui.title}}</h1>\n\n  <div class="euiSpacer euiSpacer--m"></div>\n\n  <ul class="nav nav-tabs" >\n    <li\n      class="kbn-settings-tab"\n      ng-class="{ active: ui.currentTab === tab.index }"\n      ng-repeat="tab in ui.tabs"\n      ng-hide="ui.tabs[{{tab.index}}].hidden">\n\n      <a ng-click="ui.changeTab(tab)">\n        {{ tab.title }}\n      </a>\n    </li>\n  </ul>\n\n  \x3c!-- Job Details --\x3e\n  <div class="tab_contents" ng-show="ui.currentTab === 0">\n    <div class="form-group">\n      <ml-form-label label-id="new_job_description">Job description</ml-form-label>\n      <input\n        aria-labelledby="ml_aria_label_new_job_description"\n        aria-describedby="ml_aria_description_new_job_description"\n        ng-model="job.description"\n        class="form-control" />\n    </div>\n\n    <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n    <div class="form-group">\n      <ml-form-label label-id="new_job_group">Job Groups</ml-form-label>\n      <ml-job-group-select\n        aria-labelledby="ml_aria_label_new_job_group"\n        aria-describedby="ml_aria_description_new_job_group"\n        job-groups=\'job.groups\' />\n    </div>\n\n    <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n    <div class="form-group">\n      <ml-form-label label-id="new_job_model_memory_limit">Model memory limit</ml-form-label>\n      <input\n        aria-labelledby="ml_aria_label_new_job_model_memory_limit"\n        aria-describedby="ml_aria_description_new_job_model_memory_limit"\n        placeholder="{{ui.modelMemoryLimitDefault}}"\n        type="text"\n        ng-model=\'job.analysis_limits.model_memory_limit\'\n        class="form-control" />\n        <div ng-hide="ui.validation.tabs[0].checks.modelMemoryLimit.valid" class="validation-error">\n          {{ui.validation.tabs[0].checks.modelMemoryLimit.message}}\n        </div>\n    </div>\n\n    <div class="form-group"\n      ng-show="(job.analysis_config.categorization_field_name !== undefined && job.analysis_config.categorization_field_name !== \'\') ||\n               (job.analysis_config.categorization_filters && job.analysis_config.categorization_filters.length)">\n      <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n      <label aria-describedby="ml_aria_description_new_job_categorizationfilters">Categorization Filters</label>\n      <i ml-info-icon="new_job_categorizationfilters" />\n      <div ng-if="job.analysis_config && job.analysis_config.categorization_filters">\n        <div ng-repeat="item in job.analysis_config.categorization_filters track by $index" class="categorization-filter">\n          <div class="field-cols">\n            <div class="form-group">\n              <input\n                ng-model="job.analysis_config.categorization_filters[$index]"\n                type="text"\n                class="form-control" />\n            </div>\n          </div>\n\n          <button\n            ng-click="removeCategorizationFilter($index)"\n            tooltip-append-to-body="true"\n            type="button"\n            class="kuiButton kuiButton--danger kuiButton--small remove-button">\n              <i aria-hidden="true" class="fa fa-times"></i>\n          </button>\n        </div>\n      </div>\n      <div>\n        <button\n          aria-labelledby="ml_aria_label_add_categorization_filter"\n          ng-click="addCategorizationFilter()"\n          type="button"\n          ng-disabled="job.analysis_config.categorization_field_name === undefined || job.analysis_config.categorization_field_name === \'\'"\n          class="kuiButton kuiButton--primary kuiButton--small">\n          <i aria-hidden="true" class="fa fa-plus"></i>\n          <span id="ml_aria_label_add_categorization_filter">Add Categorization Filter</span>\n        </button>\n      </div>\n    </div>\n\n    <div ng-hide="ui.validation.tabs[0].checks.categorizationFilters.valid" class="validation-error">\n      {{ ( ui.validation.tabs[2].checks.categorizationFilters.message || "Categorization filters must all be valid regular expressions" ) }}\n    </div>\n\n  </div>\n\n  \x3c!-- Detectors --\x3e\n  <div class="tab_contents" ng-show="ui.currentTab === 1">\n    <label class="kuiFormLabel">Edit detector descriptions</label>\n    <div ml-job-detectors-list\n      ml-detectors="job.analysis_config.detectors"\n      ml-indices="indices"\n      ml-properties="properties"\n      ml-edit-mode="\'EDIT\'"\n      ></div>\n  </div>\n\n  \x3c!-- Datafeed --\x3e\n  <div class="tab_contents" ng-show="ui.currentTab === 2">\n\n    <div ng-show="ui.datafeedStopped" >\n      <div class="form-group" >\n        <ml-form-label label-id="new_job_datafeed_query">Query</ml-form-label>\n        <input\n          aria-labelledby="ml_aria_label_new_job_datafeed_query"\n          aria-describedby="ml_aria_description_new_job_datafeed_query"\n          ng-model="ui.datafeed.queryText"\n          placeholder=\'{ "match_all": {}}\'\n          class="form-control" />\n\n      </div>\n      <div class="form-group" >\n        <ml-form-label label-id="new_job_datafeed_query_delay">Query delay</ml-form-label>\n        <input\n          aria-labelledby="ml_aria_label_new_job_datafeed_query_delay"\n          aria-describedby="ml_aria_description_new_job_datafeed_query_delay"\n          ng-model="ui.datafeed.queryDelayText"\n          placeholder="{{ui.datafeed.queryDelayDefault}}"\n          min="0"\n          class="form-control" />\n\n      </div>\n      <div class="form-group" >\n        <ml-form-label label-id="new_job_datafeed_frequency">Frequency</ml-form-label>\n        <input\n          aria-labelledby="ml_aria_label_new_job_datafeed_frequency"\n          aria-describedby="ml_aria_description_new_job_datafeed_frequency"\n          ng-model="ui.datafeed.frequencyText"\n          placeholder="{{ui.datafeed.frequencyDefault}}"\n          min="0"\n          class="form-control" />\n\n      </div>\n      <div class="form-group" >\n        <ml-form-label label-id="new_job_datafeed_scrollsize">scroll_size</ml-form-label>\n        <input\n          aria-labelledby="ml_aria_label_new_job_datafeed_scrollsize"\n          aria-describedby="ml_aria_description_new_job_datafeed_scrollsize"\n          ng-model="ui.datafeed.scrollSizeText"\n          placeholder="{{ui.datafeed.scrollSizeDefault}}"\n          type="number"\n          min="0"\n          class="form-control" />\n      </div>\n    </div>\n    <div ng-hide="ui.datafeedStopped" class="kuiText">\n      <div>Datafeed settings cannot be edited while the datafeed is running.</div>\n      <div ng-show="ui.stoppingDatafeed===false"><a ng-click="stopDatafeed()">Stop datafeed now</a></div>\n      <div ng-show="ui.stoppingDatafeed===true">Stopping...</div>\n    </div>\n  </div>\n\n  \x3c!-- Custom URLs --\x3e\n  <div class="tab_contents" ng-show="ui.currentTab === 3">\n    <div class="form-group">\n      <div ng-if="job.custom_settings && job.custom_settings.custom_urls">\n        <div ng-repeat="item in job.custom_settings.custom_urls track by $index" class="custom-url">\n\n            <div class="form-group label-input">\n              <label id="ml_aria_label_custom_url_label_{{$index}}" class="kuiFormLabel">Label</label>\n              <input\n                aria-labelledby="ml_aria_label_custom_url_label_{{$index}}"\n                ng-model="item.url_name"\n                type="text"\n                class="kuiTextInput form-control" />\n              <div ng-show="item.url_name === \'\'" class="validation-error">Enter a label</div>\n            </div>\n\n\n          <div class="field-cols">\n            <div class="form-group">\n              <label id="ml_aria_label_custom_url_{{$index}}" class="kuiFormLabel">URL</label>\n              <textarea\n                aria-labelledby="ml_aria_label_custom_url_{{$index}}"\n                ng-model="item.url_value"\n                type="text"\n                class="form-control" ></textarea>\n            </div>\n          </div>\n\n          <div class="form-group time-input">\n            <label id="ml_aria_label_custom_url_time_{{$index}}" class="kuiFormLabel">Time range</label>\n            <input\n              aria-labelledby="ml_aria_label_custom_url_time_{{$index}}"\n              ng-model="item.time_range"\n              ng-change="customUrlTimeRangeChanged($index)"\n              type="text"\n              class="form-control" />\n            <div ng-show="item.timeRangeError === true" class="validation-error">Invalid format</div>\n          </div>\n\n          <button\n            ng-if="showTestLinkForCustomUrl($index)"\n            ng-click="testCustomUrl($index)"\n            tooltip="Test custom URL"\n            tooltip-append-to-body="false"\n            aria-label="Test custom URL"\n            data-toggle="tooltip"\n            type="button"\n            class="kuiButton kuiButton--basic kuiButton--small test-url-button">\n              <i aria-hidden="true" class="fa fa-share-square-o"></i>\n          </button>\n\n          <button\n            ng-click="removeCustomUrl($index)"\n            tooltip="Delete custom URL"\n            tooltip-append-to-body="false"\n            aria-label="Delete custom URL"\n            data-toggle="tooltip"\n            type="button"\n            class="kuiButton kuiButton--danger kuiButton--small remove-button">\n              <i aria-hidden="true" class="fa fa-trash"></i>\n          </button>\n        </div>\n      </div>\n      <div ng-hide="ui.editingNewCustomUrl === true">\n        <button\n          aria-labelledby="ml_aria_label_new_job_custom_urls"\n          aria-describedby="ml_aria_description_new_job_custom_urls"\n          ng-click="editNewCustomUrl()"\n          type="button"\n          class="kuiButton kuiButton--primary kuiButton--small">\n          <i aria-hidden="true" class="fa fa-plus" />\n          <span id="ml_aria_label_new_job_custom_urls">Add Custom URL</span>\n        </button>\n      </div>\n      <div ng-show="ui.editingNewCustomUrl === true" class="custom-url-editor">\n        <h3 class="euiTitle">Create new custom URL</h3>\n        <ml-custom-url-editor\n          add-custom-url="addCustomUrl"\n          job="job">\n        </ml-custom-url-editor>\n      </div>\n    </div>\n  </div>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n  <button\n    ng-click="save()"\n    ng-disabled="(saveLock === true)"\n    class="kuiButton kuiButton--primary" >\n    Update\n  </button>\n  <button\n    ng-click="cancel()"\n    ng-disabled="(saveLock === true)"\n    class="kuiButton kuiButton--primary"\n    aria-label="Cancel">\n    Cancel\n  </button>\n</div>\n'},3227:function(module,exports){module.exports='<ml-message-bar ></ml-message-bar>\n<div class="create-watch-modal">\n  <h1 class="euiTitle">Create watch for {{jobId}}</h1>\n  <div class="euiSpacer euiSpacer--s"></div>\n\n  <div ng-if=\'watcherEnabled===true\'>\n    <ml-create-watch\n      job-id=\'jobId\'\n      bucket-span=\'bucketSpan\'\n      include-influencers=\'includeInfluencers\'\n    ></ml-create-watch>\n\n\n    <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n    <div ng-show= "status.watch===null">\n      <button\n        aria-label="Create watch"\n        ng-click="apply()"\n        type="button"\n        class="kuiButton kuiButton--primary">\n          Apply\n      </button>\n\n      <button\n        ng-disabled="status.deleteLock"\n        ng-click="close();"\n        class="kuiButton kuiButton--primary"\n        aria-label="cancel">\n          Cancel\n      </button>\n    </div>\n    <div ng-show= "status.watch === STATUS.SAVED || status.watch === STATUS.SAVE_FAILED">\n      <button\n        ng-click="close();"\n        class="kuiButton kuiButton--primary"\n        aria-label="close">\n          Close\n      </button>\n    </div>\n  </div>\n\n  <div ng-if=\'watcherEnabled===false\'>\n    Watcher is not enabled.\n    <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n    <button\n      ng-click="close();"\n      class="kuiButton kuiButton--primary"\n      aria-label="close">\n        Close\n    </button>\n  </div>\n\n</div>\n'},3228:function(module,exports,__webpack_require__){"use strict";function buttonsEnabledChecks(permissions,job,createPermissionFailureMessage,mlNodesAvailable){function startButtonWrapperClass(){return permissions.canStartStopDatafeed&&mlNodesAvailable?"button-wrapper":["button-wrapper","disabled"]}function startButtonWrapperTooltip(){var tooltip=void 0;return!1===permissions.canStartStopDatafeed?tooltip=createPermissionFailureMessage("canStartStopDatafeed"):!1===mlNodesAvailable&&(tooltip=NO_ML_NODES_ERROR),tooltip}function startButtonVisible(){return job.datafeed_config&&job.datafeed_config.state!==_states.DATAFEED_STATE.STOPPING&&job.datafeed_config.state!==_states.DATAFEED_STATE.STARTING}function startButtonTooltip(){return(job.datafeed_config&&job.datafeed_config.state===_states.DATAFEED_STATE.STARTED?"Stop datafeed for":"Start datafeed for")+" job.job_id"}function startButtonAriaLabel(){return(job.datafeed_config&&job.datafeed_config.state===_states.DATAFEED_STATE.STARTED?"Stop":"Start")+" datafeed"}function startButtonDisabled(){return void 0===job.datafeed_config.datafeed_id||!1===permissions.canStartStopDatafeed||job.state===_states.JOB_STATE.CLOSING||job.state===_states.JOB_STATE.OPENING||job.state===_states.JOB_STATE.FAILED||!1===mlNodesAvailable}function buttonIcon(){return job.datafeed_config&&job.datafeed_config.state===_states.DATAFEED_STATE.STARTED&&job.state!==_states.JOB_STATE.FAILED?"fa fa-stop":!job.datafeed_config||job.datafeed_config.state!==_states.DATAFEED_STATE.STOPPED||job.state!==_states.JOB_STATE.OPENED&&job.state!==_states.JOB_STATE.CLOSED?job.state===_states.JOB_STATE.FAILED?"fa fa-play":!job.datafeed_config||job.datafeed_config.state!==_states.DATAFEED_STATE.STOPPED||job.state!==_states.JOB_STATE.CLOSING&&job.state!==_states.JOB_STATE.OPENING?job.datafeed_config&&void 0===job.datafeed_config.state?"fa fa-play":void 0:"fa fa-clock-o":"fa fa-play"}function loadingButtonVisible(){return!job.datafeed_config||job.datafeed_config.state===_states.DATAFEED_STATE.STOPPING||job.datafeed_config.state===_states.DATAFEED_STATE.STARTING}function editButtonWrapperClass(){return permissions.canUpdateJob?"button-wrapper":["button-wrapper","disabled"]}function editButtonWrapperTooltip(){return permissions.canUpdateJob?void 0:createPermissionFailureMessage("canUpdateJob")}function editButtonDisabled(){return!1===permissions.canUpdateJob||!1===permissions.canUpdateDatafeed}function cloneButtonWrapperClass(){return permissions.canCreateJob&&mlNodesAvailable?"button-wrapper":["button-wrapper","disabled"]}function cloneButtonWrapperTooltip(){var tooltip=void 0;return!1===permissions.canCreateJob?tooltip=createPermissionFailureMessage("canCreateJob"):!1===mlNodesAvailable&&(tooltip=NO_ML_NODES_ERROR),tooltip}function cloneButtonDisabled(){return!1===permissions.canCreateJob||!1===mlNodesAvailable}function deleteButtonWrapperClass(){return permissions.canDeleteJob?"button-wrapper":["button-wrapper","disabled"]}function deleteButtonWrapperTooltip(){return permissions.canDeleteJob?void 0:createPermissionFailureMessage("canDeleteJob")}function deleteButtonDisabled(){return!1===permissions.canDeleteJob}var NO_ML_NODES_ERROR="No ML nodes available";return{startButtonWrapperClass:startButtonWrapperClass,startButtonWrapperTooltip:startButtonWrapperTooltip,startButtonVisible:startButtonVisible,startButtonTooltip:startButtonTooltip,startButtonAriaLabel:startButtonAriaLabel,startButtonDisabled:startButtonDisabled,buttonIcon:buttonIcon,loadingButtonVisible:loadingButtonVisible,editButtonWrapperClass:editButtonWrapperClass,editButtonWrapperTooltip:editButtonWrapperTooltip,editButtonDisabled:editButtonDisabled,cloneButtonWrapperClass:cloneButtonWrapperClass,cloneButtonWrapperTooltip:cloneButtonWrapperTooltip,cloneButtonDisabled:cloneButtonDisabled,deleteButtonWrapperClass:deleteButtonWrapperClass,deleteButtonWrapperTooltip:deleteButtonWrapperTooltip,deleteButtonDisabled:deleteButtonDisabled}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.buttonsEnabledChecks=buttonsEnabledChecks;var _states=__webpack_require__(475)},3229:function(module,exports,__webpack_require__){"use strict";function cloudServiceProvider(config){function isRunningOnCloud(){try{return config.get("cloud.enabled")}catch(error){return!1}}function getCloudId(){try{return config.get("cloud.id")}catch(error){return}}return{isRunningOnCloud:isRunningOnCloud,getCloudId:getCloudId}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.cloudServiceProvider=cloudServiceProvider},3230:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3231),__webpack_require__(3246),__webpack_require__(302)},3231:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash);__webpack_require__(1152),__webpack_require__(3244);var _angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular),_numeral=__webpack_require__(82),_numeral2=_interopRequireDefault(_numeral),_job_utils=__webpack_require__(57),_parse_interval=__webpack_require__(166),_custom_url_editor_service=__webpack_require__(3245),_string_utils=__webpack_require__(43),_new_job_defaults=__webpack_require__(258);__webpack_require__(2).uiModules.get("apps/ml").controller("MlEditJobModal",function($scope,$modalInstance,$modal,$window,params,Private,mlJobService,mlMessageBarService){function validateJob(){var valid=!0,tabs=$scope.ui.validation.tabs;if(_lodash2.default.each(tabs,function(tab){tab.valid=!0,_lodash2.default.each(tab.checks,function(check,c){tab.checks[c].valid=!0,tab.checks[c].message=""})}),$scope.job.analysis_config.categorization_filters){var v=!0;_lodash2.default.each($scope.job.analysis_config.categorization_filters,function(d){try{new RegExp(d)}catch(e){v=!1}""!==d&&!1!==v||(tabs[0].checks.categorization_filters.valid=!1,valid=!1)})}var mml=$scope.job.analysis_limits.model_memory_limit,maxMml=jobLimits.max_model_memory_limit;if(void 0!==maxMml&&(void 0!==mml||""!==mml)){var _maxBytes=(0,_numeral2.default)(maxMml.toUpperCase()).value();if((0,_numeral2.default)(mml.toUpperCase()).value()>_maxBytes){tabs[0].checks.modelMemoryLimit.valid=!1;var msg="Model memory limit cannot be higher than the maximum value of "+maxMml;tabs[0].checks.modelMemoryLimit.message=msg,valid=!1}}return valid}var msgs=mlMessageBarService;msgs.clear(),$scope.saveLock=!1;var refreshJob=params.pscope.refreshJob;$scope.job=_angular2.default.copy(params.job);var bucketSpan=(0,_parse_interval.parseInterval)($scope.job.analysis_config.bucket_span),jobLimits=(0,_new_job_defaults.newJobLimits)();if($scope.ui={title:"Edit "+$scope.job.job_id,currentTab:0,tabs:[{index:0,title:"Job Details",hidden:!1},{index:1,title:"Detectors",hidden:!1},{index:2,title:"Datafeed",hidden:!0},{index:3,title:"Custom URLs",hidden:!1}],changeTab:function(tab){$scope.ui.currentTab=tab.index},isDatafeed:!1,datafeedStopped:!1,datafeed:{scrollSizeDefault:1e3,queryDelayDefault:"60s",frequencyDefault:(0,_job_utils.calculateDatafeedFrequencyDefaultSeconds)(bucketSpan.asSeconds())+"s"},stoppingDatafeed:!1,validation:{tabs:[{index:0,valid:!0,checks:{categorizationFilters:{valid:!0},modelMemoryLimit:{valid:!0}}}]},editingNewCustomUrl:!1,modelMemoryLimitDefault:null},$scope.job.datafeed_config){var datafeedConfig=$scope.job.datafeed_config;$scope.ui.isDatafeed=!0,$scope.ui.tabs[2].hidden=!1,$scope.ui.datafeedStopped=!$scope.job.datafeed_config||"stopped"===$scope.job.datafeed_config.state,$scope.ui.datafeed.queryText=_angular2.default.toJson(datafeedConfig.query,!0),$scope.ui.datafeed.queryDelayText=datafeedConfig.query_delay,$scope.ui.datafeed.frequencyText=datafeedConfig.frequency,$scope.ui.datafeed.scrollSizeText=datafeedConfig.scroll_size}if($scope.job.custom_settings&&$scope.job.custom_settings.custom_urls&&$scope.job.custom_settings.custom_urls.forEach(function(customUrl){void 0===customUrl.time_range&&(customUrl.time_range="auto")}),void 0===$scope.job.analysis_limits)$scope.job.analysis_limits={};else if(void 0!==$scope.job.analysis_limits.model_memory_limit&&($scope.ui.modelMemoryLimitDefault=$scope.job.analysis_limits.model_memory_limit,void 0!==jobLimits.max_model_memory_limit)){var maxBytes=(0,_numeral2.default)(jobLimits.max_model_memory_limit.toUpperCase()).value(),mmlBytes=(0,_numeral2.default)($scope.job.analysis_limits.model_memory_limit.toUpperCase()).value();mmlBytes>maxBytes&&($scope.ui.modelMemoryLimitDefault=maxBytes/(0,_numeral2.default)("1MB").value()+"MB")}$scope.editNewCustomUrl=function(){$scope.ui.editingNewCustomUrl=!0},$scope.addCustomUrl=function(customUrl){$scope.job.custom_settings||($scope.job.custom_settings={}),$scope.job.custom_settings.custom_urls||($scope.job.custom_settings.custom_urls=[]),$scope.job.custom_settings.custom_urls.push(customUrl),$scope.ui.editingNewCustomUrl=!1},$scope.removeCustomUrl=function(index){$scope.job.custom_settings.custom_urls.splice(index,1)},$scope.customUrlTimeRangeChanged=function(index){var customUrl=$scope.job.custom_settings.custom_urls[index],timeRange=customUrl.time_range,interval=(0,_parse_interval.parseInterval)(timeRange);customUrl.timeRangeError=null===interval&&"auto"!==timeRange},$scope.showTestLinkForCustomUrl=function(index){return(0,_string_utils.isWebUrl)($scope.job.custom_settings.custom_urls[index].url_value)},$scope.testCustomUrl=function(index){Private(_custom_url_editor_service.CustomUrlEditorServiceProvider).getTestUrl($scope.job,$scope.job.custom_settings.custom_urls[index]).then(function(testUrl){$window.open(testUrl,"_blank")}).catch(function(resp){console.log("testCustomUrl() - error obtaining URL for test:",resp)})},$scope.addCategorizationFilter=function(){$scope.job.analysis_config&&($scope.job.analysis_config.categorization_filters||($scope.job.analysis_config.categorization_filters=[]),$scope.job.analysis_config.categorization_filters.push(""))},$scope.removeCategorizationFilter=function(index){$scope.job.analysis_config&&$scope.job.analysis_config.categorization_filters&&$scope.job.analysis_config.categorization_filters.splice(index,1)},$scope.stopDatafeed=function(){var datafeedId=$scope.job.datafeed_config.datafeed_id,jobId=$scope.job.job_id;$scope.ui.stoppingDatafeed=!0,mlJobService.stopDatafeed(datafeedId,jobId).then(function(resp){!0===resp.stopped&&($scope.ui.datafeedStopped=!0)})},$scope.save=function(){function saveDatafeed(){if(Object.keys(datafeedData).length){var datafeedId=$scope.job.datafeed_config.datafeed_id;mlJobService.updateDatafeed(datafeedId,datafeedData).then(function(resp){resp.success?saveComplete():saveFail(resp)})}else saveComplete()}function saveComplete(){$scope.saveLock=!1,msgs.clear(),refreshJob(jobId),$modalInstance.close()}function saveFail(resp){$scope.saveLock=!1,msgs.error(resp.message)}if(msgs.clear(),!1!==validateJob()){$scope.saveLock=!0;var jobId=$scope.job.job_id,jobData={},datafeedData={};if($scope.job.description!==params.job.description&&(jobData.description=$scope.job.description),Array.isArray($scope.job.groups)&&(jobData.groups=$scope.job.groups),void 0!==$scope.job.analysis_limits.model_memory_limit){var mml=$scope.job.analysis_limits.model_memory_limit;""===mml&&(mml=$scope.ui.modelMemoryLimitDefault),void 0!==params.job.analysis_limits&&mml===params.job.analysis_limits.model_memory_limit||(jobData.analysis_limits={model_memory_limit:mml})}if(_lodash2.default.each($scope.job.analysis_config.detectors,function(d,i){var changes=0,obj={detector_index:i};d.detector_description!==params.job.analysis_config.detectors[i].detector_description&&(obj.description=d.detector_description,changes++),changes>0&&(void 0===jobData.detectors&&(jobData.detectors=[]),jobData.detectors.push(obj))}),$scope.job.analysis_config.categorization_filters){var doUpdate=!1;$scope.job.analysis_config.categorization_filters.length!==params.job.analysis_config.categorization_filters.length&&(doUpdate=!0),_lodash2.default.each($scope.job.analysis_config.categorization_filters,function(d,i){d!==params.job.analysis_config.categorization_filters[i]&&(doUpdate=!0)}),doUpdate&&(jobData.categorization_filters=$scope.job.analysis_config.categorization_filters)}if($scope.job.custom_settings)if($scope.job.custom_settings.custom_urls&&$scope.job.custom_settings.custom_urls.length){var _doUpdate=!1;params.job.custom_settings&&params.job.custom_settings.custom_urls&&params.job.custom_settings.custom_urls.length?$scope.job.custom_settings.custom_urls.length!==params.job.custom_settings.custom_urls.length?_doUpdate=!0:_lodash2.default.each($scope.job.custom_settings.custom_urls,function(url,i){url.url_name===params.job.custom_settings.custom_urls[i].url_name&&url.url_value===params.job.custom_settings.custom_urls[i].url_value&&url.time_range===params.job.custom_settings.custom_urls[i].time_range||(_doUpdate=!0)}):_doUpdate=!0,_doUpdate&&(jobData.custom_settings=$scope.job.custom_settings,$scope.job.custom_settings.custom_urls.forEach(function(customUrl){delete customUrl.timeRangeError}))}else(params.job.custom_settings||params.job.custom_settings.custom_urls||params.job.custom_settings.custom_urls.length)&&(jobData.custom_settings={});if($scope.job.datafeed_config&&$scope.ui.datafeedStopped){var sch=$scope.ui.datafeed;""===sch.queryText&&(sch.queryText='{"match_all":{}}');var query=sch.queryText;try{query=JSON.parse(query)}catch(e){console.log("save(): could not parse query JSON")}_angular2.default.toJson($scope.job.datafeed_config.query,!0)!==sch.queryText&&(datafeedData.query=query),sch.queryDelayText!==$scope.job.datafeed_config.query_delay&&(datafeedData.query_delay=""===sch.queryDelayText||null===sch.queryDelayText||void 0===sch.queryDelayText?sch.queryDelayDefault:sch.queryDelayText),sch.frequencyText!==$scope.job.datafeed_config.frequency&&(datafeedData.frequency=""===sch.frequencyText||null===sch.frequencyText||void 0===sch.frequencyText?sch.frequencyDefault:sch.frequencyText),sch.scrollSizeText!==$scope.job.datafeed_config.scroll_size&&(datafeedData.scroll_size=""===sch.scrollSizeText||null===sch.scrollSizeText||void 0===sch.scrollSizeText?sch.scrollSizeDefault:sch.scrollSizeText)}Object.keys(jobData).length?mlJobService.updateJob(jobId,jobData).then(function(resp){resp.success?saveDatafeed():saveFail(resp)}):saveDatafeed()}},$scope.cancel=function(){msgs.clear(),$modalInstance.close()}})},3232:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3233),__webpack_require__(3234),__webpack_require__(3235)},3233:function(module,exports){},3234:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_string_utils=__webpack_require__(43),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular);__webpack_require__(2).uiModules.get("apps/ml").controller("MlDetectorModal",function($scope,$modalInstance,params,mlJobService,mlMessageBarService){var msgs=mlMessageBarService;msgs.clear(),$scope.title="Add new detector",$scope.detector={function:""},$scope.saveLock=!1,$scope.editMode=!1;var index=-1;$scope.functions=[{id:"count",uri:"ml-count-functions.html#ml-count"},{id:"low_count",uri:"ml-count-functions.html#ml-count"},{id:"high_count",uri:"ml-count-functions.html#ml-count"},{id:"non_zero_count",uri:"ml-count-functions.html#ml-nonzero-count"},{id:"low_non_zero_count",uri:"ml-count-functions.html#ml-nonzero-count"},{id:"high_non_zero_count",uri:"ml-count-functions.html#ml-nonzero-count"},{id:"distinct_count",uri:"ml-count-functions.html#ml-distinct-count"},{id:"low_distinct_count",uri:"ml-count-functions.html#ml-distinct-count"},{id:"high_distinct_count",uri:"ml-count-functions.html#ml-distinct-count"},{id:"rare",uri:"ml-rare-functions.html#ml-rare"},{id:"freq_rare",uri:"ml-rare-functions.html#ml-freq-rare"},{id:"info_content",uri:"ml-info-functions.html#ml-info-content"},{id:"low_info_content",uri:"ml-info-functions.html#ml-info-content"},{id:"high_info_content",uri:"ml-info-functions.html#ml-info-content"},{id:"metric",uri:"ml-metric-functions.html#ml-metric-metric"},{id:"median",uri:"ml-metric-functions.html#ml-metric-median"},{id:"low_median",uri:"ml-metric-functions.html#ml-metric-median"},{id:"high_median",uri:"ml-metric-functions.html#ml-metric-median"},{id:"mean",uri:"ml-metric-functions.html#ml-metric-mean"},{id:"low_mean",uri:"ml-metric-functions.html#ml-metric-mean"},{id:"high_mean",uri:"ml-metric-functions.html#ml-metric-mean"},{id:"min",uri:"ml-metric-functions.html#ml-metric-min"},{id:"max",uri:"ml-metric-functions.html#ml-metric-max"},{id:"varp",uri:"ml-metric-functions.html#ml-metric-varp"},{id:"low_varp",uri:"ml-metric-functions.html#ml-metric-varp"},{id:"high_varp",uri:"ml-metric-functions.html#ml-metric-varp"},{id:"sum",uri:"ml-sum-functions.html#ml-sum"},{id:"low_sum",uri:"ml-sum-functions.html#ml-sum"},{id:"high_sum",uri:"ml-sum-functions.html#ml-sum"},{id:"non_null_sum",uri:"ml-sum-functions.html#ml-nonnull-sum"},{id:"low_non_null_sum",uri:"ml-sum-functions.html#ml-nonnull-sum"},{id:"high_non_null_sum",uri:"ml-sum-functions.html#ml-nonnull-sum"},{id:"time_of_day",uri:"ml-time-functions.html#ml-time-of-day"},{id:"time_of_week",uri:"ml-time-functions.html#ml-time-of-week"},{id:"lat_long",uri:"ml-geo-functions.html#ml-lat-long"}],$scope.functionIds={},_lodash2.default.each($scope.functions,function(f){$scope.functionIds[f.id]=""}),$scope.fields=params.fields,$scope.fields_byFieldName=_angular2.default.copy($scope.fields),params.catFieldNameSelected&&($scope.fields_byFieldName.mlcategory="mlcategory");var validate=params.validate,add=params.add;params.detector&&($scope.detector=params.detector,index=params.index,$scope.title="Edit detector",$scope.editMode=!0),$scope.detectorToString=_string_utils.detectorToString,$scope.helpLink={},$scope.functionChange=function(){var func=_lodash2.default.findWhere($scope.functions,{id:$scope.detector.function});$scope.helpLink.label="Help for analytical functions",$scope.helpLink.uri="ml-functions.html",func&&($scope.helpLink.uri=func.uri,$scope.helpLink.label="Help for "+func.id)},$scope.functionChange(),$scope.setDetectorProperty=function(value,field){""===value||void 0===value?delete $scope.detector[field]:$scope.detector[field]=value,"function"===field&&$scope.functionChange()},$scope.save=function(){$scope.saveLock=!0,validate($scope.detector).then(function(resp){$scope.saveLock=!1,resp.success?(""===$scope.detector.detector_description&&delete $scope.detector.detector_description,add($scope.detector,index),$modalInstance.close($scope.detector),msgs.clear()):msgs.error(resp.message)})},$scope.cancel=function(){msgs.clear(),$modalInstance.close()}})},3235:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3236)},3236:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3237);var _metadata=__webpack_require__(159);__webpack_require__(2).uiModules.get("apps/ml").directive("mlDocumentationHelpLink",function(){return{scope:{uri:"@mlUri",label:"@mlLabel"},restrict:"AE",replace:!0,template:'<a href="{{fullUrl()}}" rel="noopener noreferrer" target="_blank"class="documentation-help-link" tooltip="{{label}}">{{label}}<i class="fa fa-external-link"></i></a>',controller:function($scope){var version=_metadata.metadata.branch;$scope.fullUrl=function(){return"https://www.elastic.co/guide/en/x-pack/"+version+"/"+$scope.uri}}}})},3237:function(module,exports){},3238:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3239),__webpack_require__(3240)},3239:function(module,exports){},3240:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular);__webpack_require__(2).uiModules.get("apps/ml").controller("MlDetectorFilterModal",function($scope,$modalInstance,params,mlJobService,mlMessageBarService){var msgs=mlMessageBarService;msgs.clear(),$scope.title="Add new filter",$scope.detector=params.detector,$scope.saveLock=!1,$scope.editMode=!1;var index=-1,add=params.add,validate=params.validate;$scope.fields=[],$scope.detector.field_name&&$scope.fields.push($scope.detector.field_name),$scope.detector.by_field_name&&$scope.fields.push($scope.detector.by_field_name),$scope.detector.over_field_name&&$scope.fields.push($scope.detector.over_field_name),$scope.detector.partition_field_name&&$scope.fields.push($scope.detector.partition_field_name),void 0===params.filter?$scope.filter={ruleAction:"filter_results",target_field_name:"",target_field_value:"",conditions_connective:"or",conditions:[],value_list:[]}:($scope.editMode=!0,$scope.filter=params.filter,$scope.title="Edit filter",index=params.index),$scope.ui={ruleAction:["filter_results"],target_field_name:"",target_field_value:"",conditions_connective:["or","and"],ruleCondition:{condition_type:[{label:"actual",value:"numerical_actual"},{label:"typical",value:"numerical_typical"},{label:"|actual - typical|",value:"numerical_diff_abs"}],field_name:"",field_value:"",condition:{operator:[{label:"<",value:"lt"},{label:">",value:"gt"},{label:"<=",value:"lte"},{label:">=",value:"gte"}]},value_list:[]}},$scope.addNewCondition=function(){$scope.filter.conditions.push({condition_type:"numerical_actual",field_name:"",field_value:"",condition:{operator:"lt",value:""}})},$scope.removeCondition=function(idx){$scope.filter.conditions.splice(idx,1)},$scope.helpLink={},$scope.save=function(){var filter=_angular2.default.copy($scope.filter);if(filter.conditions.length){$scope.saveLock=!0,""===filter.target_field_name&&delete filter.target_field_name,""===filter.target_field_value&&delete filter.target_field_value,_lodash2.default.each(filter.conditions,function(cond){delete cond.$$hashKey,""===cond.field_name&&delete cond.field_vname,""===cond.fieldValue&&delete cond.fieldValue}),filter.value_list&&0===filter.value_list.length&&delete filter.value_list;var dtr=_angular2.default.copy($scope.detector);void 0===dtr.rules&&(dtr.rules=[]),index>=0?dtr.rules[index]=filter:dtr.rules.push(filter),validate(dtr).then(function(resp){msgs.clear(),$scope.saveLock=!1,resp.success?(add($scope.detector,filter,index),$modalInstance.close()):msgs.error(resp.message)})}},$scope.cancel=function(){msgs.clear(),$modalInstance.close()}})},3241:function(module,exports){module.exports='<div>\n  <div class="form-group">\n    <div ng-repeat="detector in detectors track by $index">\n      <div class="detector" ng-class="{\'detector-edit-mode\':(editMode===\'EDIT\')}">\n        <div class="detector-fields">\n          <label ng-show="editMode===\'EDIT\'">Detector:</label>\n          <div aria-label="Customised description" ng-hide="editMode===\'EDIT\' || detector.detector_description === \'\' || detector.detector_description === detectorToString(detector) ">{{ detector.detector_description }}</div>\n          <div aria-label="Default description" style="font-style:italic;" >{{ detectorToString(detector) }}</div>\n\n          <div ng-show="editMode===\'EDIT\'">\n            <label class="kuiFormLabel">Description:</label>\n            <input\n              ng-model="detector.detector_description"\n              class="form-control" />\n          </div>\n\n        </div>\n\n        <div class="button-container" ng-show="editMode===\'NEW\'">\n          <button\n            ng-click="editDetector($index)"\n            aria-label="Edit"\n            class="kuiButton kuiButton--basic kuiButton--small"\n            data-toggle="tooltip"\n            tooltip="Edit Detector">\n              <i aria-hidden="true" class="fa fa-pencil"></i>\n          </button>\n\n          <button\n            aria-label="Remove Detector"\n            ng-click="removeDetector($index)"\n            tooltip-append-to-body="true"\n            type="button"\n            class="kuiButton kuiButton--danger kuiButton--small remove-button">\n              <i aria-hidden="true" class="fa fa-trash"></i>\n          </button>\n        </div>\n\n      </div>\n\n    </div>\n\n    <div ng-show="editMode===\'NEW\'">\n      <button\n        aria-labelledby="ml_aria_description_new_job_detectors"\n        aria-describedby="ml_aria_label_new_job_add_detector"\n        ng-click="openNewWindow()"\n        type="button"\n        class="kuiButton kuiButton--primary kuiButton--small">\n          <i aria-hidden="true" class="fa fa-plus"></i>\n          <span id="ml_aria_label_new_job_add_detector">Add Detector</span>\n      </button>\n    </div>\n  </div>\n\n</div>\n'},3242:function(module,exports){module.exports='<div class="detector-modal">\n  <ml-message-bar ></ml-message-bar>\n  <h1 class="euiTitle">{{title}}</h1>\n  <div class="euiSpacer euiSpacer--m"></div>\n\n  <div class="form-group">\n    <ml-form-label label-id="new_job_detector_description">Description</ml-form-label>\n    <input\n      aria-labelledby="ml_aria_label_new_job_detector_description"\n      aria-describedby="ml_aria_description_new_job_detector_description"\n      ng-model="detector.detector_description"\n      placeholder="{{ detectorToString(detector) }}"\n      class="form-control" />\n  </div>\n\n  <div class="editor-color detector_field_form">\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_detector_function">function</ml-form-label>\n        <field-select\n          label-id=\'"new_job_detector_function"\'\n          on-change=\'setDetectorProperty\'\n          value=\'detector.function\'\n          field=\'"function"\'\n          options=\'functionIds\'>\n        </field-select>\n      </div>\n    </div>\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_detector_fieldname">field_name</ml-form-label>\n        <field-select\n          label-id=\'"new_job_detector_fieldname"\'\n          on-change=\'setDetectorProperty\'\n          value=\'detector.field_name\'\n          field=\'"field_name"\'\n          options=\'fields\'>\n        </field-select>\n      </div>\n    </div>\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_detector_byfieldname">by_field_name</ml-form-label>\n        <field-select\n          label-id=\'"new_job_detector_byfieldname"\'\n          on-change=\'setDetectorProperty\'\n          value=\'detector.by_field_name\'\n          field=\'"by_field_name"\'\n          options=\'fields_byFieldName\'>\n        </field-select>\n      </div>\n    </div>\n\n  </div>\n  <div class="editor-color detector_field_form">\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_detector_overfieldname">over_field_name</ml-form-label>\n        <field-select\n          label-id=\'"new_job_detector_overfieldname"\'\n          on-change=\'setDetectorProperty\'\n          value=\'detector.over_field_name\'\n          field=\'"over_field_name"\'\n          options=\'fields\'>\n        </field-select>\n      </div>\n    </div>\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_detector_partitionfieldname">partition_field_name</ml-form-label>\n        <field-select\n          label-id=\'"new_job_detector_partitionfieldname"\'\n          on-change=\'setDetectorProperty\'\n          value=\'detector.partition_field_name\'\n          field=\'"partition_field_name"\'\n          options=\'fields\'>\n        </field-select>\n      </div>\n    </div>\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_detector_excludefrequent">exclude_frequent</ml-form-label>\n        <field-select\n          label-id=\'"new_job_detector_excludefrequent"\'\n          on-change=\'setDetectorProperty\'\n          value=\'detector.exclude_frequent\'\n          field=\'"exclude_frequent"\'\n          options=\'{all: "", none: ""}\'>\n        </field-select>\n      </div>\n    </div>\n\n  </div>\n  <small><div class=\'help-pane\'><ml-documentation-help-link ml-uri="{{helpLink.uri}}" ml-label="{{helpLink.label}}"></ml-documentation-help-link></div></small>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n  <button\n    ng-click="save()"\n    ng-disabled="(saveLock === true) || (detector.function === \'\')"\n    class="kuiButton kuiButton--primary"\n    aria-label="Save">\n    {{ (editMode? "Update" : "Add") }}\n  </button>\n  <button\n    ng-click="cancel()"\n    ng-disabled="(saveLock === true)"\n    class="kuiButton kuiButton--primary"\n    aria-label="Cancel">\n    Cancel\n  </button>\n</div>\n'},3243:function(module,exports){module.exports='<div class="detector-filter-modal">\n  <ml-message-bar ></ml-message-bar>\n  <h3 class="euiTitle euiTitle--small">{{title}}</h3>\n  <div class="editor-color filter-field-form target-container">\n\n    <datalist id="fields_datalist">\n      <option ng-repeat="field in fields" >{{field}}</option>\n    </datalist>\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_filter_targetfieldname">target_field_name</ml-form-label>\n\n        <input\n          aria-labelledby="ml_aria_label_new_filter_targetfieldname"\n          aria-describedby="ml_aria_description_new_filter_targetfieldname"\n          ng-model="filter.target_field_name"\n          tabindex="2"\n          ng-change="functionChange()"\n          list=\'fields_datalist\'\n          class="form-control" />\n\n        <ml-form-label label-id="new_action_targetfieldvalue">target_field_value</ml-form-label>\n\n        <input\n          aria-labelledby="ml_aria_label_new_action_targetfieldvalue"\n          aria-describedby="ml_aria_description_new_action_targetfieldvalue"\n          ng-model="filter.target_field_value"\n          tabindex="2"\n          ng-change="functionChange()"\n          class="form-control" />\n      </div>\n    </div>\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_action_conditionsconnective">conditions_connective</ml-form-label>\n        <select\n          aria-labelledby="ml_aria_label_new_action_conditionsconnective"\n          aria-describedby="ml_aria_description_new_action_conditionsconnective"\n          ng-model="filter.conditions_connective"\n          tabindex="2"\n          placeholder=""\n          class="form-control">\n            <option ng-repeat="index in ui.conditions_connective" value="{{index}}" >{{index}}</option>\n        </select>\n      </div>\n    </div>\n  </div>\n\n  <div class="conditions-list-container" >\n    <div class="title"><span aria-describedby="ml_aria_description_new_action_ruleconditions">Conditions</span><i ml-info-icon="new_action_ruleconditions" /></div>\n    <div class="table-title">\n      <div><span aria-describedby="ml_aria_description_new_action_conditiontype">Type</span><i ml-info-icon="new_action_conditiontype" /></div>\n      <div><span aria-describedby="ml_aria_description_new_action_fieldname">field_name</span><i ml-info-icon="new_action_fieldname" /></div>\n      <div><span aria-describedby="ml_aria_description_new_action_fieldvalue">field_value</span><i ml-info-icon="new_action_fieldvalue" /></div>\n      <div><span aria-describedby="ml_aria_description_new_action_condition">lt/gt</span><i ml-info-icon="new_action_condition" /></div>\n      <div><span aria-describedby="ml_aria_description_new_action_value">value</span><i ml-info-icon="new_action_value" /></div>\n      <div></div>\n    </div>\n    <div ng-repeat="cond in filter.ruleConditions track by $index" class="rule-condition">\n      <div>\n        <select\n          ng-model="cond.conditionType"\n          placeholder=""\n          class="form-control">\n            <option ng-repeat="type in ui.ruleCondition.conditionType" value="{{type.value}}" >{{type.label}}</option>\n        </select>\n        <div ng-hide="$index === filter.ruleConditions.length-1" class=\'conditions-connective\'>-- {{filter.conditions_connective}} --</div>\n      </div>\n      <div>\n        <select\n          ng-model="cond.field_name"\n          placeholder=""\n          class="form-control">\n            <option ng-repeat="field in fields" >{{field}}</option>\n        </select>\n        \x3c!-- <input\n          ng-model="cond.field_name"\n          tabindex="2"\n          list=\'fields_datalist\'\n          class="form-control" /> --\x3e\n      </div>\n      <div>\n        <input\n          ng-model="cond.field_value"\n          tabindex="2"\n          class="form-control" />\n      </div>\n      <div>\n        <select\n          ng-model="cond.condition.operator"\n          placeholder=""\n          class="form-control">\n            <option ng-repeat="op in ui.ruleCondition.condition.operator" value="{{op.value}}" >{{op.label}}</option>\n        </select>\n      </div>\n      <div>\n        <input\n          ng-model="cond.condition.value"\n          tabindex="2"\n          class="form-control" />\n      </div>\n      <div>\n        <button\n          aria-label="Remove Condition"\n          ng-click="removeCondition($index)"\n          tooltip-append-to-body="true"\n          type="button"\n          class="kuiButton kuiButton--danger kuiButton--small remove-button">\n            <i aria-hidden="true" class="fa fa-trash"></i>\n        </button>\n      </div>\n    </div>\n  </div>\n  <button\n    aria-label="Add new condition"\n    ng-click="addNewCondition()"\n    type="button"\n    class="kuiButton kuiButton--primary kuiButton--small add-new">\n      <span class="sr-only">Add new condition</span>\n      <i aria-hidden="true" class="fa fa-plus"></i> Add new condition\n  </button>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n  <button\n    ng-click="save()"\n    ng-disabled="(saveLock === true || filter.ruleConditions.length === 0)"\n    class="kuiButton kuiButton--primary"\n    aria-label="Save">\n    {{ (editMode? "Update" : "Add") }}\n  </button>\n  <button\n    ng-click="cancel()"\n    ng-disabled="(saveLock === true)"\n    class="kuiButton kuiButton--primary"\n    aria-label="Cancel">\n    Cancel\n  </button>\n</div>\n'},3244:function(module,exports){},3245:function(module,exports,__webpack_require__){"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function CustomUrlEditorServiceProvider(es,mlJobService,$q){function getTestUrl(job,urlConfig){var urlValue=urlConfig.url_value,bucketSpanSecs=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span).asSeconds(),testUrl=urlConfig.url_value,body={query:{bool:{must:[{term:{job_id:job.job_id}},{term:{result_type:"record"}}]}},size:1,_source:{excludes:[]},sort:[{record_score:{order:"desc"}}]};return $q(function(resolve,reject){es.search({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,body:body}).then(function(resp){if(resp.hits.total>0){var record=resp.hits.hits[0]._source;testUrl=(0,_custom_url_utils.replaceTokensInUrlValue)(urlConfig,bucketSpanSecs,record,"timestamp"),resolve(testUrl)}else mlJobService.searchPreview(job).then(function(response){var testDoc=void 0,docTimeFieldName=job.data_description.time_field;if(response.aggregations){var firstBucket=response.aggregations.buckets.buckets[0];testDoc=_defineProperty({},docTimeFieldName,firstBucket.key),urlValue.replace(/\$([^?&$\'"]{1,40})\$/g,function(match,name){if("earliest"!==name&&"latest"!==name&&void 0!==firstBucket[name]){var tokenBuckets=firstBucket[name];tokenBuckets.buckets&&(testDoc[name]=tokenBuckets.buckets[0].key)}})}else response.hits.total>0&&(testDoc=response.hits.hits[0]._source);void 0!==testDoc&&(testUrl=(0,_custom_url_utils.replaceTokensInUrlValue)(urlConfig,bucketSpanSecs,testDoc,docTimeFieldName)),resolve(testUrl)})}).catch(function(resp){reject(resp)})})}return{getTestUrl:getTestUrl}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.CustomUrlEditorServiceProvider=CustomUrlEditorServiceProvider;var _parse_interval=__webpack_require__(107),_index_patterns=__webpack_require__(301),_custom_url_utils=__webpack_require__(1153)},3246:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3247),__webpack_require__(3252)},3247:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_risonNode=__webpack_require__(191),_risonNode2=_interopRequireDefault(_risonNode),_custom_url_editor=__webpack_require__(3248),_custom_url_editor2=_interopRequireDefault(_custom_url_editor);__webpack_require__(1154);var _parse_interval=__webpack_require__(166),_string_utils=__webpack_require__(43),_saved_objects=__webpack_require__(67);__webpack_require__(2).uiModules.get("apps/ml").directive("mlCustomUrlEditor",function(Private){return{scope:{addCustomUrl:"&",job:"="},restrict:"AE",replace:!0,transclude:!0,template:_custom_url_editor2.default,controller:function($scope,$q){function addDashboardUrl(){var settings=$scope.newCustomUrl;savedObjectsClient.get("dashboard",settings.kibanaSettings.dashboardId).then(function(response){var filters=[],query=void 0,searchSourceJSON=response.get("kibanaSavedObjectMeta.searchSourceJSON");if(void 0!==searchSourceJSON){var searchSource=JSON.parse(searchSourceJSON);filters=_lodash2.default.get(searchSource,"filter",[]),query=searchSource.query}var _g=_risonNode2.default.encode({time:{from:"$earliest$",to:"$latest$",mode:"absolute"}}),appState={filters:filters};if(settings.kibanaSettings.queryFieldNames.length>0){var queryString="";_lodash2.default.each(settings.kibanaSettings.queryFieldNames,function(fieldName,index){index>0&&(queryString+=" AND "),queryString+=(0,_string_utils.escapeForElasticsearchQuery)(fieldName)+':"$'+fieldName+'$"'}),query={language:"lucene",query:queryString}}void 0!==query&&(appState.query=query);var _a=_risonNode2.default.encode(appState),urlValue="kibana#/dashboard/"+settings.kibanaSettings.dashboardId+"?_g="+_g+"&_a="+_a,urlToAdd={url_name:settings.label,url_value:urlValue,time_range:TIME_RANGE_TYPE.AUTO};settings.timeRange.type===TIME_RANGE_TYPE.INTERVAL&&(urlToAdd.time_range=settings.timeRange.interval),$scope.addCustomUrl()(urlToAdd),initFields()}).catch(function(resp){console.log("Custom URL editor - error getting details on dashboard",resp)})}function addDiscoverUrl(){var settings=$scope.newCustomUrl,_g=_risonNode2.default.encode({time:{from:"$earliest$",to:"$latest$",mode:"absolute"}}),appState={index:settings.kibanaSettings.discoverIndexPatternId},query=$scope.job.datafeed_config.query;if(settings.kibanaSettings.queryFieldNames.length>0){var queryString="";_lodash2.default.each(settings.kibanaSettings.queryFieldNames,function(fieldName,i){i>0&&(queryString+=" AND "),queryString+=(0,_string_utils.escapeForElasticsearchQuery)(fieldName)+':"$'+fieldName+'$"'}),query={language:"lucene",query:queryString}}void 0!==query&&(appState.query=query);var _a=_risonNode2.default.encode(appState),urlValue="kibana#/discover?_g="+_g+"&_a="+_a,urlToAdd={url_name:settings.label,url_value:urlValue};settings.timeRange.type===TIME_RANGE_TYPE.INTERVAL&&(urlToAdd.time_range=settings.timeRange.interval),$scope.addCustomUrl()(urlToAdd),initFields()}function initFields(){if($scope.newCustomUrl.label="",$scope.newCustomUrl.otherUrlSettings={urlValue:""},$scope.newCustomUrl.timeRange={type:TIME_RANGE_TYPE.AUTO},$scope.newCustomUrl.kibanaSettings={queryFieldNames:[]},"function"==typeof $scope.updateQueryFieldNames.update&&$scope.updateQueryFieldNames.update([]),$scope.dashboards.length>0?($scope.newCustomUrl.type=URL_TYPE.KIBANA_DASHBOARD,$scope.newCustomUrl.kibanaSettings.dashboardId=$scope.dashboards[0].id):$scope.newCustomUrl.type=$scope.indexPatterns.length>0?URL_TYPE.KIBANA_DASHBOARD:URL_TYPE.OTHER,$scope.indexPatterns.length>0&&void 0!==$scope.job.datafeed_config.indices&&$scope.job.datafeed_config.indices.length>0){var datafeedIndex=$scope.job.datafeed_config.indices[0],defaultIndexPattern=_lodash2.default.find($scope.indexPatterns,{title:datafeedIndex});void 0===defaultIndexPattern&&(defaultIndexPattern=$scope.indexPatterns[0]),$scope.newCustomUrl.kibanaSettings.discoverIndexPatternId=defaultIndexPattern.id}}var URL_TYPE={KIBANA_DASHBOARD:"KIBANA_DASHBOARD",KIBANA_DISCOVER:"KIBANA_DISCOVER",OTHER:"OTHER"};$scope.URL_TYPE=URL_TYPE;var TIME_RANGE_TYPE={AUTO:"auto",INTERVAL:"interval"};$scope.TIME_RANGE_TYPE=TIME_RANGE_TYPE,$scope.newCustomUrl={label:void 0,type:URL_TYPE.OTHER,timeRange:{type:TIME_RANGE_TYPE.AUTO},kibanaSettings:{queryFieldNames:[]},otherUrlSettings:{urlValue:""}},$scope.dashboards=[],$scope.indexPatterns=[],$scope.timeRangeIntervalError=!1,$scope.updateQueryFieldNames={};var savedObjectsClient=Private(_saved_objects.SavedObjectsClientProvider);$q.all([function(){return savedObjectsClient.find({type:"dashboard",fields:["title"],perPage:1e3})}(),function(){return savedObjectsClient.find({type:"index-pattern",fields:["title"],perPage:1e3})}()]).then(function(response){$scope.dashboards=_lodash2.default.chain(response[0]).get("savedObjects",[]).map(function(savedObj){return{id:savedObj.id,title:savedObj.attributes.title}}).sortBy(function(obj){return obj.title.toLowerCase()}).value(),$scope.indexPatterns=_lodash2.default.chain(response[1]).get("savedObjects",[]).map(function(savedObj){return{id:savedObj.id,title:savedObj.attributes.title}}).sortBy(function(obj){return obj.title.toLowerCase()}).value(),initFields()}).catch(function(resp){console.log("Custom URL editor - error loading saved dashboards and index patterns",resp)});var detectors=$scope.job.analysis_config.detectors,jobFieldNames=_lodash2.default.get($scope.job.analysis_config,"influencers",[]);_lodash2.default.each(detectors,function(detector){_lodash2.default.has(detector,"partition_field_name")&&jobFieldNames.push(detector.partition_field_name),_lodash2.default.has(detector,"by_field_name")&&jobFieldNames.push(detector.by_field_name),_lodash2.default.has(detector,"over_field_name")&&jobFieldNames.push(detector.over_field_name)}),$scope.jobFieldNames=_lodash2.default.chain(jobFieldNames).uniq().sortBy(function(fieldName){return fieldName.toLowerCase()}).map(function(fieldName){return{id:fieldName}}).value(),$scope.addQueryEntity=function(){$scope.jobFieldNames.length>0&&$scope.newCustomUrl.kibanaSettings.queryFieldNames.push($scope.jobFieldNames[0])},$scope.removeQueryEntity=function(index){$scope.newCustomUrl.kibanaSettings.queryFieldNames.splice(index,1)},$scope.timeRangeIntervalChanged=function(){var interval=(0,_parse_interval.parseInterval)($scope.newCustomUrl.timeRange.interval);$scope.timeRangeIntervalError=null===interval},$scope.addUrl=function(){var settings=$scope.newCustomUrl;if(settings.type===URL_TYPE.KIBANA_DASHBOARD)addDashboardUrl();else if(settings.type===URL_TYPE.KIBANA_DISCOVER)addDiscoverUrl();else{var urlToAdd={url_name:settings.label,url_value:settings.otherUrlSettings.urlValue};$scope.addCustomUrl()(urlToAdd),initFields()}}}}})},3248:function(module,exports){module.exports='<div class=\'ml-custom-url-manager\'>\n  <div class="add-url-form">\n\n    <div class="form-group">\n      <ml-form-label label-id="new_custom_url_label">Label</ml-form-label>\n      <input\n        type="text"\n        class="kuiTextInput add-url-input"\n        ng-model="newCustomUrl.label"\n        aria-labelledby="ml_aria_label_new_custom_url_label"\n        aria-describedby="ml_aria_description_new_custom_url_label" />\n    </div>\n\n    <div class="form-group">\n      <ml-form-label label-id="new_custom_url_link_to">Link to</ml-form-label>\n      <div class="euiSpacer euiSpacer--s"></div>\n      <div>\n        <label\n          class="kuiFormLabel link-to-label"\n          ng-class="{\'disabled\': dashboards.length === 0}"\n          data-toggle="tooltip"\n          ng-attr-tooltip="{{dashboards.length === 0 ?  \'No Kibana dashboards have been created\' : undefined}}"\n          tooltip-placement="bottom">\n          <input type="radio"\n            name="linkToRadio"\n            ng-disabled="dashboards.length === 0"\n            ng-model="newCustomUrl.type"\n            required\n            value="{{URL_TYPE.KIBANA_DASHBOARD}}" /> Kibana dashboard\n        </label>\n        <label\n        class="kuiFormLabel link-to-label"\n        ng-class="{\'disabled\': indexPatterns.length === 0}"\n        data-toggle="tooltip"\n        ng-attr-tooltip="{{indexPatterns.length === 0 ?  \'No Kibana index patterns have been created\' : undefined}}"\n        tooltip-placement="bottom">\n          <input type="radio"\n            name="linkToRadio"\n            ng-disabled="indexPatterns.length === 0"\n            ng-model="newCustomUrl.type"\n            value="{{URL_TYPE.KIBANA_DISCOVER}}" /> Discover\n        </label>\n        <label class="kuiFormLabel link-to-label">\n          <input type="radio"\n            name="linkToRadio"\n            ng-model="newCustomUrl.type"\n            value="{{URL_TYPE.OTHER}}" /> Other URL\n        </label>\n      </div>\n    </div>\n\n    <div ng-show="newCustomUrl.type === URL_TYPE.KIBANA_DASHBOARD" class="form-group">\n      <ml-form-label label-id="new_custom_url_dashboard">Dashboard name</ml-form-label>\n      <select\n        class="kuiSelect add-url-input"\n        ng-model="newCustomUrl.kibanaSettings.dashboardId"\n        aria-labelledby="ml_aria_label_new_custom_url_dashboard"\n        aria-describedby="ml_aria_description_new_custom_url_dashboard"\n        placeholder="Select dashboard">\n        <option ng-repeat="dashboard in dashboards" value="{{dashboard.id}}">{{dashboard.title}}</option>\n      </select>\n    </div>\n\n    <div ng-show="newCustomUrl.type === URL_TYPE.KIBANA_DISCOVER" class="form-group">\n      <ml-form-label label-id="new_custom_url_discover_index">Index pattern</ml-form-label>\n      <select\n        class="kuiSelect add-url-input"\n        ng-model="newCustomUrl.kibanaSettings.discoverIndexPatternId"\n        aria-labelledby="ml_aria_label_new_custom_url_discover_index"\n        aria-describedby="ml_aria_description_new_custom_url_discover_index"\n        placeholder="Select index pattern">\n        <option ng-repeat="index in indexPatterns" value="{{index.id}}">{{index.title}}</option>\n      </select>\n    </div>\n\n    <div class="form-group" ng-show="(newCustomUrl.type === URL_TYPE.KIBANA_DASHBOARD ||\n      newCustomUrl.type === URL_TYPE.KIBANA_DISCOVER) && jobFieldNames.length > 0">\n      <ml-form-label label-id="new_custom_url_query_entity">Query entities</ml-form-label>\n      <ml-item-select\n        item-ids=\'newCustomUrl.kibanaSettings.queryFieldNames\'\n        all-items=\'jobFieldNames\'\n        external-update-function=\'updateQueryFieldNames\'\n        placeholder=\'"Entities"\'>\n      </ml-item-select>\n    </div>\n\n    \x3c!-- Text area for entering other non-Kibana dashboard URLs --\x3e\n    <div ng-show="newCustomUrl.type === URL_TYPE.OTHER" class="form-group">\n      <ml-form-label label-id="new_custom_url_value">URL</ml-form-label>\n      <textarea\n        aria-labelledby="new_custom_url_value"\n        ng-model="newCustomUrl.otherUrlSettings.urlValue"\n        type="text"\n        class="form-control">\n      </textarea>\n    </div>\n\n    \x3c!-- Control for selecting the drilldown time range --\x3e\n    <div class="add-url-time-range" ng-show="(newCustomUrl.type === URL_TYPE.KIBANA_DASHBOARD ||\n      newCustomUrl.type === URL_TYPE.KIBANA_DISCOVER)">\n      <div class="form-group">\n        <ml-form-label label-id="new_custom_url_time_range">Time range</ml-form-label>\n        <select\n          class="kuiSelect kuiSelect--medium add-url-input"\n          ng-model="newCustomUrl.timeRange.type"\n          aria-labelledby="ml_aria_label_new_custom_url_time_range"\n          aria-describedby="ml_aria_description_new_custom_url_time_range">\n          <option value="{{TIME_RANGE_TYPE.AUTO}}">auto</option>\n          <option value="{{TIME_RANGE_TYPE.INTERVAL}}">interval</option>\n        </select>\n      </div>\n\n      <div ng-show="newCustomUrl.timeRange.type === TIME_RANGE_TYPE.INTERVAL" class="form-group">\n        <label id="ml_aria_label_custom_url_time_range_interval" class="kuiFormLabel">Interval</label>\n        <input\n          aria-labelledby="ml_aria_label_custom_url_time_range_interval"\n          ng-model="newCustomUrl.timeRange.interval"\n          ng-change="timeRangeIntervalChanged()"\n          type="text"\n          class="form-control" />\n        <div ng-show="timeRangeIntervalError === true" class="validation-error">Invalid interval format</div>\n      </div>\n    </div>\n\n    <div>\n      <button\n        aria-labelledby="ml_aria_label_new_job_custom_urls"\n        aria-describedby="ml_aria_description_new_job_custom_urls"\n        ng-click="addUrl()"\n        ng-disabled="newCustomUrl.label === undefined || newCustomUrl.label === \'\' ||\n          (newCustomUrl.timeRange.type === TIME_RANGE_TYPE.INTERVAL && timeRangeIntervalError === true)"\n        type="button"\n        class="kuiButton kuiButton--primary">\n        <span id="ml_aria_label_new_job_custom_urls">Add</span>\n      </button>\n    </div>\n\n  </div>\n\n</div>\n'},3249:function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_item_select=__webpack_require__(3250),_item_select2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_item_select),_compat=__webpack_require__(60);__webpack_require__(2).uiModules.get("apps/ml").directive("mlItemSelect",function(){return{restrict:"E",template:_item_select2.default,scope:{itemIds:"=",allItems:"=",disabled:"=",placeholder:"=",externalUpdateFunction:"=",allowTagging:"=",taggingText:"="},controllerAs:"mlItemSelect",bindToController:!0,controller:function(_InitAfterBindingsWor){function MlItemSelectController(){return _classCallCheck(this,MlItemSelectController),_possibleConstructorReturn(this,(MlItemSelectController.__proto__||Object.getPrototypeOf(MlItemSelectController)).apply(this,arguments))}return _inherits(MlItemSelectController,_InitAfterBindingsWor),_createClass(MlItemSelectController,[{key:"initAfterBindings",value:function($scope){var _this2=this;this.$scope=$scope,this.selectedItems=[],this.populateSelectedItems(this.itemIds),void 0!==this.externalUpdateFunction&&(this.externalUpdateFunction.update=function(itemIds){_this2.populateSelectedItems(itemIds)})}},{key:"populateSelectedItems",value:function(ids){var _this3=this;this.selectedItems=ids.map(function(id){return _this3.allItems.find(function(i){return i.id===id})})}},{key:"onItemsChanged",value:function(){this.itemIds.length=0,this.itemIds=this.selectedItems.map(function(i){return i.id})}},{key:"createNewItem",value:function(id){return{id:id.toLowerCase(),isTag:!0}}},{key:"dontCreateNewItem",value:function(){return!1}}]),MlItemSelectController}(_compat.InitAfterBindingsWorkaround)}})},3250:function(module,exports){module.exports='<div class="ml-item-select">\n  <ui-select\n    ng-model="mlItemSelect.selectedItems"\n    on-select="mlItemSelect.onItemsChanged()"\n    on-remove="mlItemSelect.onItemsChanged()"\n    ng-disabled="mlItemSelect.disabled"\n    multiple\n    append-to-body=true\n    tagging="(mlItemSelect.allowTagging ? mlItemSelect.createNewItem : mlItemSelect.dontCreateNewItem)"\n  >\n    <ui-select-match placeholder="{{mlItemSelect.placeholder}}">\n      {{$item.id}}\n    </ui-select-match>\n    <ui-select-choices\n      repeat="item in mlItemSelect.allItems | filter: { id: $select.search }"\n    >\n      <div ng-if="item.isTag"  class="select-item" ng-bind-html="(item.id | highlight: $select.search) +\' <small>\'+ (mlItemSelect.taggingText === undefined ? \'(new item)\' : mlItemSelect.taggingText) +\'</small>\'"></div>\n      <div ng-if="!item.isTag" class="select-item" >\n        <div ng-bind-html="item.id | highlight: $select.search"></div>\n        <small ng-if="item.extra!==undefined">\n          {{item.extra}}\n        </small>\n      </div>\n    </ui-select-choices>\n  </ui-select>\n</div>\n'},3251:function(module,exports){},3252:function(module,exports){},3253:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_job_group_select=__webpack_require__(3254),_job_group_select2=_interopRequireDefault(_job_group_select),_compat=__webpack_require__(60);__webpack_require__(2).uiModules.get("apps/ml").directive("mlJobGroupSelect",function(es,ml,$timeout,mlJobService,mlCalendarService){return{restrict:"E",template:_job_group_select2.default,scope:{jobGroups:"=",disabled:"=",externalUpdateFunction:"="},controllerAs:"mlGroupSelect",bindToController:!0,controller:function(_InitAfterBindingsWor){function MlGroupSelectController(){return _classCallCheck(this,MlGroupSelectController),_possibleConstructorReturn(this,(MlGroupSelectController.__proto__||Object.getPrototypeOf(MlGroupSelectController)).apply(this,arguments))}return _inherits(MlGroupSelectController,_InitAfterBindingsWor),_createClass(MlGroupSelectController,[{key:"initAfterBindings",value:function($scope){var _this2=this;this.$scope=$scope,this.selectedGroups=[],this.groups=[],mlJobService.loadJobs().then(function(){var tempGroupIds={},jobGroups=mlJobService.getJobGroups();_this2.groups=jobGroups.map(function(g){return tempGroupIds[g.id]=null,{id:g.id,count:g.jobs.length,isTag:!1}}),!1===Array.isArray(_this2.jobGroups)&&(_this2.jobGroups=[]),mlCalendarService.loadCalendars(mlJobService.jobs).then(function(){mlCalendarService.getCalendarGroups().forEach(function(g){void 0===tempGroupIds[g.id]&&_this2.groups.push({id:g.id,count:0,isTag:!1})}),_this2.populateSelectedGroups(_this2.jobGroups)}).catch(function(error){console.log("Could not load groups from calendars",error),_this2.populateSelectedGroups(_this2.jobGroups)})}),void 0!==this.externalUpdateFunction&&(this.externalUpdateFunction.update=function(groups){_this2.populateSelectedGroups(groups)})}},{key:"populateSelectedGroups",value:function(groups){var _this3=this;this.selectedGroups=[],groups.forEach(function(gId){var tempGroup=_lodash2.default.filter(_this3.groups,{id:gId});tempGroup.length?_this3.selectedGroups.push(tempGroup[0]):_this3.selectedGroups.push(_this3.createNewItem(gId))})}},{key:"onGroupsChanged",value:function(){var _this4=this;this.jobGroups.length=0,this.selectedGroups.forEach(function(group){_this4.jobGroups.push(group.id)})}},{key:"createNewItem",value:function(groupId){return{id:groupId.toLowerCase(),count:0,isTag:!0}}},{key:"groupTypes",value:function(group){if(!1===group.isTag)return"Existing groups"}}]),MlGroupSelectController}(_compat.InitAfterBindingsWorkaround)}})},3254:function(module,exports){module.exports='<div class="ml-job-group-select">\n  <ui-select\n    ng-model="mlGroupSelect.selectedGroups"\n    on-select="mlGroupSelect.onGroupsChanged()"\n    on-remove="mlGroupSelect.onGroupsChanged()"\n    ng-disabled="mlGroupSelect.disabled"\n    multiple\n    tagging=\'mlGroupSelect.createNewItem\'\n    append-to-body=true\n  >\n    <ui-select-match placeholder="Job Group">\n      {{$item.id}}\n    </ui-select-match>\n    <ui-select-choices\n      repeat="group in mlGroupSelect.groups | filter: { id: $select.search }"\n      group-by="mlGroupSelect.groupTypes"\n    >\n      <div ng-if="group.isTag"  class="select-item" ng-bind-html="(group.id | highlight: $select.search) +\' <small>(new group)</small>\'"></div>\n      <div ng-if="!group.isTag" class="select-item" >\n        <div ng-bind-html="group.id | highlight: $select.search"></div>\n        <small>\n          Other jobs in this group: {{group.count}}\n        </small>\n      </div>\n    </ui-select-choices>\n  </ui-select>\n</div>\n'},3255:function(module,exports){},3256:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3257),__webpack_require__(3259),__webpack_require__(3260),__webpack_require__(674)},3257:function(module,exports,__webpack_require__){"use strict";var _job_timepicker_modal=__webpack_require__(3258),_job_timepicker_modal2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_job_timepicker_modal);__webpack_require__(2).uiModules.get("apps/ml").service("mlDatafeedService",function($modal){this.openJobTimepickerWindow=function(job){$modal.open({template:_job_timepicker_modal2.default,controller:"MlJobTimepickerModal",backdrop:"static",keyboard:!1,resolve:{params:function(){return{job:job}}}})}})},3258:function(module,exports){module.exports='<div class="job-timepicker-modal">\n  <ml-message-bar ></ml-message-bar>\n  <h1 tooltip="Start datafeed for {{jobId}}" class="euiTitle">Start datafeed for {{jobId}}</h1>\n\n  <div class="euiSpacer euiSpacer--s"></div>\n\n  <div class="ml-timepicker-contents" >\n    <div class="row">\n      <div\n        class="ml-timepicker-section"\n        ng-class="{\n          \'ml-timepicker-right-border\':\n            (+ui.startRadio <= 1 && ui.endRadio === \'0\') ||\n            (ui.startRadio === \'2\' && +ui.endRadio <= 1)\n        }">\n        <label class="kuiFormLabel">Search start time</label>\n\n        <div class="ml-timepicker-radios" >\n          <ul class="nav nav-pills nav-stacked">\n            <li ng-class="{ active: ui.startRadio === \'1\' }">\n              <a ng-click="ui.startRadio = \'1\'" >{{ ( isNew?"Start at beginning of data" : "Continue from " + ui.lastTime ) }}</a>\n            </li>\n            <li ng-class="{ active: ui.startRadio === \'0\' }">\n              <a ng-click="ui.startRadio = \'0\'">{{ ( isNew?"Start now" : "Continue from now" ) }}</a>\n            </li>\n            <li ng-class="{ active: ui.startRadio === \'2\' }">\n              <a ng-click="ui.startRadio = \'2\'" ng-class="{\'ml-timepicker-radio-bottom\': ui.startRadio === \'2\'}">{{ ( isNew?"Specify start time" : "Continue from specified time" ) }}</a>\n            </li>\n          </ul>\n        </div>\n        <div class=\'ml-timepicker\' ng-show="ui.startRadio == \'2\'">\n          <div>\n            <input type="text" class="form-control" input-datetime="YYYY-MM-DD HH:mm:ss" ng-model="ui.timepicker.from" >\n          </div>\n          <div>\n            <datepicker\n              offset-timezone\n              ng-model="ui.timepicker.from"\n              show-weeks="false">\n            </datepicker>\n          </div>\n        </div>\n      </div>\n\n      <div class="ml-timepicker-section"\n        ng-class="{\n          \'ml-timepicker-left-border\':\n            (+ui.startRadio <= 1 && ui.endRadio === \'1\')\n        }">\n        <label class="kuiFormLabel">Search end time</label>\n        <div class="ml-timepicker-radios" >\n          <ul class="nav nav-pills nav-stacked">\n            <li ng-class="{ active: ui.endRadio === \'0\' }">\n              <a ng-click="ui.endRadio = \'0\'">No end time (Real-time search)</a>\n            </li>\n            <li ng-class="{ active: ui.endRadio === \'1\' }">\n              <a ng-click="ui.endRadio = \'1\'" ng-class="{\'ml-timepicker-radio-bottom\': ui.endRadio === \'1\'}">Specify end time</a>\n            </li>\n          </ul>\n        </div>\n        <div class=\'ml-timepicker\' ng-show="ui.endRadio == \'1\'">\n          <div>\n            <input type="text" class="form-control" input-datetime="{{format}}" ng-model="ui.timepicker.to">\n          </div>\n          <div>\n            <datepicker\n              offset-timezone\n              ng-model="ui.timepicker.to"\n              show-weeks="false">\n            </datepicker>\n          </div>\n        </div>\n      </div>\n    </div>\n\n  </div>\n\n  <div ng-if="ui.endRadio === \'0\' && watcherEnabled">\n    <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n    <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n      <input ng-model=\'ui.createWatch\' type="checkbox" class=\'kuiCheckBox\'/>\n      <span class="kuiCheckBoxLabel__text">\n        Create watch after datafeed has started\n      </span>\n    </label>\n  </div>\n  <div class="clearfix"></div>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n  <button\n    ng-click="save()"\n    ng-disabled="(\n      saveLock === true ||\n      ( ui.startRadio===\'2\' && ui.timepicker.from===\'\' ) ||\n      ( ui.endRadio===\'1\' && ui.timepicker.to===\'\' )\n    )"\n    class="kuiButton kuiButton--primary" >\n    Start\n  </button>\n  <button\n    ng-click="cancel()"\n    ng-disabled="(saveLock === true)"\n    class="kuiButton kuiButton--primary"\n    aria-label="Cancel">\n    Cancel\n  </button>\n\n</div>\n'},3259:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular);__webpack_require__(2).uiModules.get("apps/ml").controller("MlJobTimepickerModal",function($scope,$rootScope,$modalInstance,params,mlJobService,mlCreateWatchService,mlMessageBarService){function extractForm(){"0"===$scope.ui.startRadio?$scope.start="now":"1"===$scope.ui.startRadio?$scope.start="0":"2"===$scope.ui.startRadio&&($scope.start=1e3*(0,_moment2.default)($scope.ui.timepicker.from).unix()),"0"===$scope.ui.endRadio?$scope.end=void 0:"1"===$scope.ui.endRadio&&($scope.end=1e3*(0,_moment2.default)($scope.ui.timepicker.to).unix())}var msgs=mlMessageBarService;$scope.saveLock=!1,$scope.watcherEnabled=mlCreateWatchService.isWatcherEnabled();var job=_angular2.default.copy(params.job);$scope.jobId=job.job_id,$scope.datafeedId=mlJobService.getDatafeedId(job.job_id),$scope.start="",$scope.end="";var lastTime="";job.data_counts&&job.data_counts.latest_record_timestamp&&(lastTime=(0,_moment2.default)(job.data_counts.latest_record_timestamp).format("YYYY-MM-DD HH:mm:ss")),$scope.isNew=!(job.data_counts&&job.data_counts.input_record_count>0),$scope.ui={lastTime:lastTime,startDateText:"",startRadio:"1",endDateText:"",endRadio:"1",timepicker:{from:"",to:(0,_moment2.default)()},setStartRadio:function(i){$scope.ui.startRadio=i},createWatch:!1},$scope.save=function(){function doStart(){!1===doStartCalled&&(doStartCalled=!0,mlJobService.startDatafeed($scope.datafeedId,$scope.jobId,$scope.start,$scope.end).then(function(){$rootScope.$broadcast("jobsUpdated"),$scope.ui.createWatch&&$rootScope.$broadcast("openCreateWatchWindow",job)}).catch(function(){$scope.saveLock=!1}))}$scope.saveLock=!0,extractForm();var doStartCalled=!1;window.setTimeout(doStart,1e4),mlJobService.openJob($scope.jobId).then(function(){doStart()}).catch(function(resp){409===resp.statusCode?doStart():(500===resp.statusCode?!1===doStartCalled&&msgs.error("Could not open "+$scope.jobId,resp):msgs.error("Could not open "+$scope.jobId,resp),$scope.saveLock=!1)}),$modalInstance.close(),window.setTimeout(function(){$rootScope.$broadcast("jobsUpdated")},500)},$scope.cancel=function(){$modalInstance.close()}})},3260:function(module,exports){},3261:function(module,exports){},3262:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_parse_interval=__webpack_require__(107),_create_watch=__webpack_require__(3263),_create_watch2=_interopRequireDefault(_create_watch);__webpack_require__(2).uiModules.get("apps/ml").directive("mlCreateWatch",function(es,ml,mlCreateWatchService){return{restrict:"AE",replace:!1,scope:{jobId:"=",bucketSpan:"=",embedded:"="},template:_create_watch2.default,link:function($scope){if($scope.config=mlCreateWatchService.config,$scope.status=mlCreateWatchService.status,$scope.STATUS=mlCreateWatchService.STATUS,$scope.ui={thresholdOptions:[{display:"critical",val:75},{display:"major",val:50},{display:"minor",val:25},{display:"warning",val:0}],setThreshold:function(t){$scope.config.threshold=t},emailEnabled:!1,embedded:$scope.embedded,watchAlreadyExists:!1},$scope.bucketSpan){var interval=(0,_parse_interval.parseInterval)($scope.bucketSpan),bs=2*interval.asMinutes();bs<1&&(bs=1),$scope.config.interval=bs+"m"}ml.getNotificationSettings().then(function(resp){_lodash2.default.has(resp,"defaults.xpack.notification.email")&&($scope.ui.emailEnabled=!0)}),mlCreateWatchService.loadWatch($scope.jobId).then(function(){$scope.ui.watchAlreadyExists=!0}).catch(function(){$scope.ui.watchAlreadyExists=!1})}}})},3263:function(module,exports){module.exports='<div class="create-watch" ng-class="{\'create-watch-embedded\': ui.embedded}">\n\t<div ng-show="status.watch===null || status.watch===STATUS.SAVING || status.watch===STATUS.SAVE_FAILED">\n\t\t<div class="form-group">\n\t\t\t<div class="sub-form-group">\n\t\t\t\t<label for="selectInterval" class="kuiFormLabel kuiVerticalRhythm">Time range</label><br />\n\t\t\t\tNow - <input id="selectInterval" ng-model="config.interval" type="text" class="kuiTextInput kuiTextInput--small interval" placeholder="m">\n\t\t\t</div>\n\n\t\t\t<div class="sub-form-group">\n\t\t\t\t<label for="selectSeverity" class="kuiFormLabel kuiVerticalRhythm">Severity threshold</label><br />\n\t\t    <div class="dropdown-group" dropdown>\n\t\t      <button id="selectSeverity" type="button" class="form-control dropdown-toggle" dropdown-toggle ng-disabled="disabled">\n\t\t        <span><i class="fa fa-exclamation-triangle ml-icon-severity-{{config.threshold.display}}"></i> {{config.threshold.display}}</span> <span class="caret"></span>\n\t\t      </button>\n\t\t      <ul class="dropdown-menu" role="menu">\n\t\t        <li ng-repeat="thresholdOption in ui.thresholdOptions">\n\t\t        \t<a href="" ng-click="ui.setThreshold(thresholdOption)"><i class="fa fa-exclamation-triangle ml-icon-severity-{{thresholdOption.display}}"></i> {{thresholdOption.display}}</a>\n\t\t        </li>\n\t\t      </ul>\n\t\t    </div>\n\t    </div>\n\t\t</div>\n\t\t<div ng-show="ui.emailEnabled" class="form-group">\n\t\t\t<label for="sendEmail" class="kuiCheckBoxLabel kuiVerticalRhythm">\n\t\t\t\t<input id="sendEmail" ng-model="config.includeEmail" type="checkbox" class="kuiCheckBox" />\n\t\t\t\t<span class="kuiCheckBoxLabel__text">Send email</span>\n\t\t\t</label>\n\t\t\t<div ng-show="config.includeEmail" class="email-section">\n\t\t\t\t<input type="text" ng-model="config.email" class="kuiTextInput kuiTextInput--large" placeholder="email address">\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div ng-if="ui.watchAlreadyExists" class="watch-exists-warning">\n\t\t\tWarning, watch ml-{{jobId}} already exists, clicking apply with overwrite the original.\n\t\t</div>\n\n\t</div>\n\n\t<div ng-show="status.watch===STATUS.SAVED">\n\t\t<div>Watch: <strong>{{config.id}}</strong> created</div>\n\t\t<br />\n\t\t<div>\n\t\t\t<a href="{{config.watcherEditURL}}" target="_blank" rel="noopener noreferrer">Edit {{config.id}} in Watcher <i class="fa fa-external-link"></i></a>\n\t\t</div>\n\t</div>\n\n</div>\n'},3264:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _chrome=__webpack_require__(8),_chrome2=_interopRequireDefault(_chrome),_lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_xpack_info=__webpack_require__(46),_email=__webpack_require__(3265),_email2=_interopRequireDefault(_email),_emailInfluencers=__webpack_require__(3266),_emailInfluencers2=_interopRequireDefault(_emailInfluencers),_watch=__webpack_require__(3267);__webpack_require__(2).uiModules.get("apps/ml").service("mlCreateWatchService",function($http,$q,Private){function randomNumber(min,max){return Math.floor(Math.random()*(max-min+1)+min)}function saveWatch(watchModel){var basePath=_chrome2.default.addBasePath("/api/watcher"),url=basePath+"/watch/"+watchModel.id;return $http.put(url,watchModel.upstreamJSON).catch(function(e){throw e.data.message})}var xpackInfo=Private(_xpack_info.XPackInfoProvider);this.config={},this.STATUS={SAVE_FAILED:-1,SAVING:0,SAVED:1},this.status={realtimeJob:null,watch:null},this.reset=function(){this.status.realtimeJob=null,this.status.watch=null,this.config.id="",this.config.includeEmail=!1,this.config.email="",this.config.interval="20m",this.config.watcherEditURL="",this.config.includeInfluencers=!1,this.config.threshold={display:"critical",val:75}};var compiledEmailBody=_lodash2.default.template(_email2.default),emailSection={send_email:{throttle_period_in_millis:9e5,email:{profile:"standard",to:[],subject:"ML Watcher Alert",body:{html:""}}}};this.createNewWatch=function(jobId){var _this=this,deferred=$q.defer();if(this.status.watch=this.STATUS.SAVING,void 0!==jobId){var id="ml-"+jobId;if(this.config.id=id,_watch.watch.input.search.request.body.query.bool.filter[0].term.job_id=jobId,_watch.watch.input.search.request.body.query.bool.filter[1].range.timestamp.gte="now-"+this.config.interval,_watch.watch.input.search.request.body.aggs.bucket_results.filter.range.anomaly_score.gte=this.config.threshold.val,this.config.includeEmail&&""!==this.config.email){var emails=this.config.email.split(",");emailSection.send_email.email.to=emails,emailSection.send_email.email.body.html=compiledEmailBody({serverAddress:_chrome2.default.getAppUrl(),influencersSection:!0===this.config.includeInfluencers?_emailInfluencers2.default:""}),_watch.watch.actions.send_email=emailSection.send_email}var triggerInterval=randomNumber(60,120);_watch.watch.trigger.schedule.interval=triggerInterval+"s";var watchModel={id:id,upstreamJSON:{id:id,type:"json",watch:_watch.watch}};""!==id&&saveWatch(watchModel).then(function(){_this.status.watch=_this.STATUS.SAVED,_this.config.watcherEditURL=_chrome2.default.getBasePath()+"/app/kibana#/management/elasticsearch/watcher/watches/watch/"+id+"/edit?_g=()",deferred.resolve()}).catch(function(resp){_this.status.watch=_this.STATUS.SAVE_FAILED,deferred.reject(resp)})}else this.status.watch=this.STATUS.SAVE_FAILED,deferred.reject();return deferred.promise},this.isWatcherEnabled=function(){return xpackInfo.get("features.watcher.isAvailable",!1)},this.loadWatch=function(jobId){var id="ml-"+jobId,basePath=_chrome2.default.addBasePath("/api/watcher"),url=basePath+"/watch/"+id;return $http.get(url).catch(function(e){throw e.data.message})}})},3265:function(module,exports){module.exports="<html>\n  <body>\n    <strong>Elastic Stack Machine Learning Alert</strong>\n    <br />\n    <br />\n\n    <strong>Job</strong>: {{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0._source.job_id}}\n    <br />\n\n    <strong>Time</strong>: {{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.timestamp_iso8601.0}}\n    <br />\n\n    <strong>Anomaly score</strong>: {{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.score.0}}\n    <br />\n    <br />\n\n    <a href=\"<%= serverAddress %>#/explorer/?_g=(ml:(jobIds:!('{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0._source.job_id}}')),refreshInterval:(display:Off,pause:!f,value:0),time:(from:'{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.start.0}}',mode:absolute,to:'{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.end.0}}'))&_a=(filters:!(),mlAnomaliesTable:(intervalValue:auto,thresholdValue:0),mlExplorerSwimlane:(selectedLane:Overall,selectedTime:{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.timestamp_epoch.0}},selectedType:overall),query:(query_string:(analyze_wildcard:!t,query:'*')))\">\n    Click here to open in Anomaly Explorer</a>.\n    <br />\n    <br />\n\n    <%= influencersSection %>\n\n    <strong>Top records:</strong>\n    <br />\n    {{#ctx.payload.aggregations.record_results.top_record_hits.hits.hits}}\n      {{_source.function}}({{_source.field_name}}) {{_source.by_field_value}} {{_source.over_field_value}} {{_source.partition_field_value}} [{{fields.score.0}}]\n      <br />\n    {{/ctx.payload.aggregations.record_results.top_record_hits.hits.hits}}\n\n  </body>\n</html>\n"},3266:function(module,exports){module.exports="<strong>Top influencers:</strong>\n<br />\n  {{#ctx.payload.aggregations.influencer_results.top_influencer_hits.hits.hits}}\n    {{_source.influencer_field_name}} = {{_source.influencer_field_value}} [{{fields.score.0}}]\n    <br />\n  {{/ctx.payload.aggregations.influencer_results.top_influencer_hits.hits.hits}}\n<br />\n"},3267:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.watch=void 0;var _index_patterns=__webpack_require__(301),watch=exports.watch={trigger:{schedule:{interval:"60s"}},input:{search:{request:{search_type:"query_then_fetch",indices:[_index_patterns.ML_RESULTS_INDEX_PATTERN],types:[],body:{size:0,query:{bool:{filter:[{term:{job_id:null}},{range:{timestamp:{gte:null}}},{terms:{result_type:["bucket","record","influencer"]}}]}},aggs:{bucket_results:{filter:{range:{anomaly_score:{gte:null}}},aggs:{top_bucket_hits:{top_hits:{sort:[{anomaly_score:{order:"desc"}}],_source:{includes:["job_id","result_type","timestamp","anomaly_score","is_interim"]},size:1,script_fields:{start:{script:{lang:"painless",inline:'LocalDateTime.ofEpochSecond((doc["timestamp"].date.getMillis()-((doc["bucket_span"].value * 1000)\n * params.padding)) / 1000, 0, ZoneOffset.UTC)',params:{padding:10}}},end:{script:{lang:"painless",inline:'LocalDateTime.ofEpochSecond((doc["timestamp"].date.getMillis()+((doc["bucket_span"].value * 1000)\n * params.padding)) / 1000, 0, ZoneOffset.UTC)',params:{padding:10}}},timestamp_epoch:{script:{lang:"painless",inline:'doc["timestamp"].date.getMillis()/1000'}},timestamp_iso8601:{script:{lang:"painless",inline:'doc["timestamp"].date'}},score:{script:{lang:"painless",inline:'Math.round(doc["anomaly_score"].value)'}}}}}}},influencer_results:{filter:{range:{influencer_score:{gte:3}}},aggs:{top_influencer_hits:{top_hits:{sort:[{influencer_score:{order:"desc"}}],_source:{includes:["result_type","timestamp","influencer_field_name","influencer_field_value","influencer_score","isInterim"]},size:3,script_fields:{score:{script:{lang:"painless",inline:'Math.round(doc["influencer_score"].value)'}}}}}}},record_results:{filter:{range:{record_score:{gte:3}}},aggs:{top_record_hits:{top_hits:{sort:[{record_score:{order:"desc"}}],_source:{includes:["result_type","timestamp","record_score","is_interim","function","field_name","by_field_value","over_field_value","partition_field_value"]},size:3,script_fields:{score:{script:{lang:"painless",inline:'Math.round(doc["record_score"].value)'}}}}}}}}}}}},condition:{compare:{"ctx.payload.aggregations.bucket_results.doc_count":{gt:0}}},actions:{log:{logging:{level:"info",text:""}}}},txt="Alert for job [{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0._source.job_id}}] at ";txt+="[{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.timestamp_iso8601.0}}] score ",txt+="[{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.score.0}}]",watch.actions.log.logging.text=txt},3268:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3269),__webpack_require__(3270)},3269:function(module,exports){},3270:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2).uiModules.get("apps/ml").controller("MlDeleteJobModal",function($scope,$modalInstance,params){$scope.ui={stage:0,status:params.status,jobId:params.jobId,isDatafeed:params.isDatafeed},$scope.delete=function(){$scope.ui.stage=1,params.doDelete()},$scope.close=function(){$modalInstance.close()}})},3271:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3272),__webpack_require__(3273),__webpack_require__(674)},3272:function(module,exports){},3273:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2).uiModules.get("apps/ml").controller("MlCreateWatchModal",function($scope,$modalInstance,params,mlMessageBarService,mlCreateWatchService){var msgs=mlMessageBarService;msgs.clear(),$scope.jobId=params.job.job_id,$scope.bucketSpan=params.job.analysis_config.bucket_span,$scope.watcherEnabled=mlCreateWatchService.isWatcherEnabled(),$scope.status=mlCreateWatchService.status,$scope.STATUS=mlCreateWatchService.STATUS,mlCreateWatchService.reset(),mlCreateWatchService.config.includeInfluencers=!!params.job.analysis_config.influencers.length,$scope.apply=function(){mlCreateWatchService.createNewWatch($scope.jobId).catch(function(resp){msgs.clear(),msgs.error("Watch could not be saved"),"string"==typeof resp&&msgs.error(resp),$scope.status.watch=null})},$scope.close=function(){$modalInstance.close()}})},3274:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3275),__webpack_require__(3276),__webpack_require__(3278),__webpack_require__(3284)},3275:function(module,exports){},3276:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment),_string_utils=__webpack_require__(43),_states=__webpack_require__(475),_job_utils=__webpack_require__(57),_check_privilege=__webpack_require__(93),_numeral=__webpack_require__(82),_numeral2=_interopRequireDefault(_numeral),_chrome=__webpack_require__(8),_chrome2=_interopRequireDefault(_chrome),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular),_expanded_row=__webpack_require__(3277),_expanded_row2=_interopRequireDefault(_expanded_row);__webpack_require__(2).uiModules.get("apps/ml").directive("mlJobListExpandedRow",function($location,mlMessageBarService,mlJobService,mlClipboardService,Private){return{restrict:"AE",replace:!1,scope:{job:"=",calendars:"=",currentTab:"=",jobAudit:"=",closeJob:"=",canCloseJob:"=",validateJob:"="},template:_expanded_row2.default,link:function($scope,$element){function updateDatafeedPreview(){$scope.datafeedPreview.json="",$scope.permissions.canPreviewDatafeed&&mlJobService.getDatafeedPreview($scope.job.job_id).then(function(resp){Array.isArray(resp)?$scope.datafeedPreview.json=_angular2.default.toJson(resp.slice(0,_job_utils.ML_DATA_PREVIEW_COUNT),!0):msgs.error("Datafeed preview could not be loaded",resp)}).catch(function(resp){msgs.error("Datafeed preview could not be loaded",resp)})}function replaceHost(url){return url.match("localhost")&&(url=url.replace("localhost",$location.host())),url}var msgs=mlMessageBarService;$scope.urlBasePath=_chrome2.default.getBasePath();var _Private=Private(_check_privilege.permissionCheckProvider),checkPermission=_Private.checkPermission;$scope.permissions={canPreviewDatafeed:checkPermission("canPreviewDatafeed")},$scope.toLocaleString=_string_utils.toLocaleString,$scope.init=function(){var tempJob=_angular2.default.copy($scope.job);delete tempJob.calendars,$scope.jobJson=_angular2.default.toJson(tempJob,!0),$scope.jobAuditText="",$scope.datafeedPreview={update:updateDatafeedPreview,json:""},$scope.detectorToString=_string_utils.detectorToString,$scope.JOB_STATE=_states.JOB_STATE,$scope.DATAFEED_STATE=_states.DATAFEED_STATE,$scope.ui={currentTab:$scope.currentTab,tabs:[{index:0,title:"Job settings"},{index:1,title:"Job config"},{index:3,title:"Counts"},{index:4,title:"JSON"},{index:5,title:"Job messages",showIcon:!0},{index:6,title:"Datafeed preview"},{index:7,title:"Forecasts"}],changeTab:function(tab){this.currentTab.index=tab.index,5===tab.index?$scope.jobAudit.update().then(function(){var div=_angular2.default.element("#ml-job-audit-list-"+$scope.job.job_id);div&&div.length&&window.setTimeout(function(){var table=div.find("table");table&&table.length&&(div[0].scrollTop=table[0].offsetHeight-div[0].offsetHeight+14)},0)}):6===tab.index&&updateDatafeedPreview()},closeJobDisabled:function(){return!1===$scope.canCloseJob||(!$scope.job.datafeed_config||$scope.job.datafeed_config.state!==_states.DATAFEED_STATE.STOPPED||$scope.job.state!==_states.JOB_STATE.OPENED)&&(void 0!==$scope.job.datafeed_config&&void 0!==$scope.job.datafeed_config.datafeed_id||$scope.job.state!==_states.JOB_STATE.OPENED)&&$scope.job.state!==_states.JOB_STATE.FAILED},getCloseJobTooltip:function(){return $scope.job.datafeed_config&&$scope.job.datafeed_config.state===_states.DATAFEED_STATE.STARTED?"Datafeed must be stopped to close job":$scope.job.state===_states.JOB_STATE.CLOSED?"Job already closed":""}},void 0!==$scope.job.datafeed_config&&$scope.ui.tabs.splice(2,0,{index:2,title:"Datafeed"}),$scope.job.location&&($scope.job.location=replaceHost($scope.job.location)),$scope.job.endpoints&&_lodash2.default.each($scope.job.endpoints,function(url,i){$scope.job.endpoints[i]=replaceHost(url)}),$scope.ui.changeTab($scope.ui.currentTab)},$scope.init(),$scope.copyToClipboard=function(job){var newJob=_angular2.default.copy(job);if(mlClipboardService.copy(_angular2.default.toJson(newJob))){var el=$element.find(".ml-pre");el.css("transition","none"),el.css("background-color","aliceblue"),el.css("color","white"),window.setTimeout(function(){el.css("transition","background 0.3s linear, color 0.3s linear"),el.css("background-color","white"),el.css("color","inherit")},1)}else msgs.error("Job could not be copied to the clipboard")},$scope.formatData=function(txt){return(0,_numeral2.default)(txt).format("0.0 b")},$scope.formatMS=function(txt){var dur=_moment2.default.duration(txt),str="";return dur._data.days>0&&(str+=" "+dur._data.days+"d"),dur._data.hours>0&&(str+=" "+dur._data.hours+"h"),dur._data.minutes>0&&(str+=" "+dur._data.minutes+"m"),dur._data.seconds>0&&(str+=" "+dur._data.seconds+"s"),dur._data.milliseconds>0&&(str+=" "+Math.ceil(dur._data.milliseconds)+"ms"),str},$scope.formatDate=function(txt){return(0,_moment2.default)(txt).format("YYYY-MM-DD HH:mm:ss")},$scope.getDuration=function(){return{start:$scope.job.data_counts.earliest_record_timestamp,end:$scope.job.data_counts.latest_record_timestamp}},$scope.getJobConfig=function(){return $scope.job}}}}).filter("filterObjects",function(){return function(input){var allowArrays=arguments.length>1&&void 0!==arguments[1]&&arguments[1],tempObj={};return _lodash2.default.each(input,function(v,i){var isObj="object"===(void 0===v?"undefined":_typeof(v));(!1===isObj||allowArrays&&isObj&&Array.isArray(v))&&(tempObj[i]=v)}),tempObj}})},3277:function(module,exports){module.exports='  <div >\n    <ul class="nav nav-tabs">\n      <li class="kbn-settings-tab" ng-class="{ active: ui.currentTab.index === tab.index }" ng-repeat="tab in ui.tabs">\n        <a ng-click="ui.changeTab(tab)">\n        {{ tab.title }}<i ng-show="tab.showIcon && jobAudit.jobWarningClass !== \'\'" class=\'job-tab-icon job-warning-small {{jobAudit.jobWarningClass}}\'></i>\n      </a>\n      </li>\n    </ul>\n\n    \x3c!-- tab 0 General--\x3e\n    <ml-job-tab-0 ng-show="ui.currentTab.index === 0">\n      <div class="tab_contents">\n        <ng-include src="urlBasePath+\'/plugins/ml/jobs/jobs_list/expanded_row/tabs/tab_general.html\'"></ng-include>\n      </div>\n    </ml-job-tab-0>\n\n    \x3c!-- tab 1 Config --\x3e\n    <ml-job-tab-1 ng-show="ui.currentTab.index === 1">\n      <div class="tab_contents">\n        <ng-include src="urlBasePath+\'/plugins/ml/jobs/jobs_list/expanded_row/tabs/tab_config.html\'"></ng-include>\n      </div>\n    </ml-job-tab-1>\n\n    \x3c!-- tab 2 Datafeed --\x3e\n    <ml-job-tab-2 ng-show="ui.currentTab.index === 2" >\n      <div class="tab_contents">\n        <ng-include src="urlBasePath+\'/plugins/ml/jobs/jobs_list/expanded_row/tabs/tab_datafeed.html\'"></ng-include>\n      </div>\n    </ml-job-tab-2>\n\n  \x3c!-- tab 3 Counts --\x3e\n    <ml-job-tab-3 ng-show="ui.currentTab.index === 3" >\n      <div class="tab_contents">\n        <ng-include src="urlBasePath+\'/plugins/ml/jobs/jobs_list/expanded_row/tabs/tab_counts.html\'"></ng-include>\n      </div>\n    </ml-job-tab-3>\n\n    \x3c!-- tab 4 JSON --\x3e\n    <ml-job-tab-4 ng-show="ui.currentTab.index === 4" >\n      <div class="tab_contents">\n        <button ng-click="copyToClipboard(job)" class="kuiButton kuiButton--primary" aria-label="Copy JSON to clipboard">\n          Copy JSON to clipboard\n        </button>\n        <div class="ml-pre">{{jobJson}}</div>\n      </div>\n    </ml-job-tab-4>\n\n    \x3c!-- tab 5 Job log --\x3e\n    <ml-job-tab-5 ng-show="ui.currentTab.index === 5" >\n      <div class="tab_contents">\n        <button ng-click="jobAudit.update()" class="kuiButton kuiButton--primary">\n          Refresh\n        </button>\n        <div id="ml-job-audit-list-{{job.job_id}}" class="job-audit-list-container">\n\n          <table class="euiTable euiTable--compressed">\n            <thead>\n              <tr>\n                <th class="euiTableHeaderCell" scope="col" width="25px">\n                  <div class="euiTableCellContent"></div>\n                </th>\n                <th class="euiTableHeaderCell" scope="col">\n                  <div class="euiTableCellContent">Time</div>\n                </th>\n                <th class="euiTableHeaderCell" scope="col">\n                  <div class="euiTableCellContent">Node</div>\n                </th>\n                <th class="euiTableHeaderCell" scope="col" width="60%">\n                  <div class="euiTableCellContent">Message</div>\n                </th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr ng-repeat="msg in jobAudit.messages" class="euiTableRow">\n                <td class="euiTableRowCell">\n                  <div class="euiTableCellContent">\n                    <span class="euiTableCellContent__text">\n                      <i ng-show="msg.level === \'system_info\'" tooltip=\'System Info\' class="job-system-info fa fa-cogs"></i>\n                      <i ng-show="msg.level === \'info\'" tooltip=\'Info\' class="job-info fa fa-info-circle"></i>\n                      <i ng-show="msg.level === \'warning\'" tooltip=\'Warning\' class="job-warning fa fa-exclamation-circle"></i>\n                      <i ng-show="msg.level === \'error\'" tooltip=\'Error\' class="job-error fa fa-exclamation-triangle"></i>\n                    </span>\n                  </div>\n                </td>\n                <td class="euiTableRowCell">\n                  <div class="euiTableCellContent">\n                    <span class="euiTableCellContent__text">{{msg.time}}</span>\n                  </div>\n                </td>\n                <td class="euiTableRowCell">\n                  <div class="euiTableCellContent">\n                    <span class="euiTableCellContent__text">{{msg.node_name}}</span>\n                  </div>\n                </td>\n                <td class="euiTableRowCell">\n                  <div class="euiTableCellContent">\n                    <span class="euiTableCellContent__text">{{msg.message}}</span>\n                  </div>\n                </td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </ml-job-tab-5>\n\n    \x3c!-- tab 6 Datafeed Preview --\x3e\n    <ml-job-tab-6 ng-show="ui.currentTab.index === 6" >\n      <div class="tab_contents" ng-if="permissions.canPreviewDatafeed===true">\n        <button ng-click="datafeedPreview.update()" class="kuiButton kuiButton--primary">\n          Refresh\n        </button>\n        <ml-loading-indicator\n          label="Loading datafeed preview"\n          is-loading="(datafeedPreview.json === \'\')"\n        />\n        <div ng-hide="(datafeedPreview.json === \'\')">\n          <div class="ml-pre">{{datafeedPreview.json}}</div>\n        </div>\n      </div>\n      <div class="tab_contents" ng-if="permissions.canPreviewDatafeed===false">\n        <div class="euiCallOut euiCallOut--warning">\n          <div class="euiCallOutHeader">\n            <svg class="euiIcon euiCallOutHeader__icon euiIcon--medium" xmlns="http://www.w3.org/2000/svg"\n              width="16" height="16" viewBox="0 0 16 16">\n              <g fill-rule="evenodd">\n                <path d="M7.5 2.236L1.618 14h11.764L7.5 2.236zm.894-.447l5.882 11.764A1 1 0 0 1 13.382 15H1.618a1 1 0 0 1-.894-1.447L6.606 1.789a1 1 0 0 1 1.788 0z"\n                />\n                <path d="M7 6h1v5H7zM7 12h1v1H7z" />\n              </g>\n            </svg>\n            <span class="euiCallOutHeader__title">You do not have permission to view the datafeed preview</span>\n          </div>\n          <div class="euiText euiText--small">\n            <p>\n              Please contact your administrator\n          </div>\n        </div>\n      </div>\n    </ml-job-tab-6>\n\n    \x3c!-- tab 7 Forecasts --\x3e\n    <ml-job-tab-6 ng-show="ui.currentTab.index === 7" >\n      <div class="tab_contents">\n        <div>\n          <ml-forecasts-table\n            job="job"\n          />\n        </div>\n      </div>\n    </ml-job-tab-6>\n\n  </div>\n'},3278:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3279),__webpack_require__(3283)},3279:function(module,exports,__webpack_require__){"use strict";__webpack_require__(183),__webpack_require__(1155);var _modules=__webpack_require__(2),_forecasts_table=__webpack_require__(3280);_modules.uiModules.get("apps/ml",["react"]).directive("mlForecastsTable",function($injector){var mlForecastService=$injector.get("mlForecastService");return $injector.get("reactDirective")(_forecasts_table.ForecastsTable,void 0,{restrict:"E"},{mlForecastService:mlForecastService})})},3280:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ForecastsTable=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_propTypes=__webpack_require__(20),_propTypes2=_interopRequireDefault(_propTypes),_risonNode=__webpack_require__(191),_risonNode2=_interopRequireDefault(_risonNode),_react=__webpack_require__(0),_react2=_interopRequireDefault(_react),_eui=__webpack_require__(5),_format=__webpack_require__(593),_chrome=__webpack_require__(8),_chrome2=_interopRequireDefault(_chrome),_states=__webpack_require__(475),_recently_accessed=__webpack_require__(474),TIME_FORMAT="YYYY-MM-DD HH:mm:ss",ForecastsTable=function(_Component){function ForecastsTable(props){_classCallCheck(this,ForecastsTable);var _this=_possibleConstructorReturn(this,(ForecastsTable.__proto__||Object.getPrototypeOf(ForecastsTable)).call(this,props));return _this.state={isLoading:0!==props.job.data_counts.processed_record_count,forecasts:[]},_this}return _inherits(ForecastsTable,_Component),_createClass(ForecastsTable,[{key:"componentDidMount",value:function(){var _this2=this,dataCounts=this.props.job.data_counts;dataCounts.processed_record_count>0&&this.props.mlForecastService.getForecastsSummary(this.props.job,null,dataCounts.earliest_record_timestamp,500).then(function(resp){_this2.setState({isLoading:!1,forecasts:resp.forecasts})}).catch(function(resp){console.log("Error loading list of forecasts for jobs list:",resp),_this2.setState({isLoading:!1,errorMessage:"Error loading the list of forecasts run on this job",forecasts:[]})})}},{key:"openSingleMetricView",value:function(forecast){var dataCounts=this.props.job.data_counts,jobEarliest=dataCounts.earliest_record_timestamp,from=new Date(dataCounts.earliest_record_timestamp).toISOString(),to=void 0!==forecast?new Date(forecast.forecast_end_timestamp).toISOString():new Date(dataCounts.latest_record_timestamp).toISOString(),_g=_risonNode2.default.encode({ml:{jobIds:[this.props.job.job_id]},refreshInterval:{display:"Off",pause:!1,value:0},time:{from:from,to:to,mode:"absolute"}}),appState={filters:[],query:{query_string:{analyze_wildcard:!0,query:"*"}}};if(void 0!==forecast){var forecastDurationMs=forecast.forecast_end_timestamp-forecast.forecast_start_timestamp,zoomFrom=Math.max(forecast.forecast_start_timestamp-forecastDurationMs,jobEarliest);appState.mlTimeSeriesExplorer={forecastId:forecast.forecast_id,zoom:{from:new Date(zoomFrom).toISOString(),to:new Date(forecast.forecast_end_timestamp).toISOString()}}}var _a=_risonNode2.default.encode(appState),url="?_g="+_g+"&_a="+_a;(0,_recently_accessed.addItemToRecentlyAccessed)("timeseriesexplorer",this.props.job.job_id,url),window.open(_chrome2.default.getBasePath()+"/app/ml#/timeseriesexplorer"+url,"_self")}},{key:"render",value:function(){var _this3=this;if(!0===this.state.isLoading)return _react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceAround"},_react2.default.createElement(_eui.EuiFlexItem,{grow:!1},_react2.default.createElement(_eui.EuiLoadingSpinner,{size:"l"})));if(void 0!==this.state.errorMessage)return _react2.default.createElement(_eui.EuiCallOut,{title:this.state.errorMessage,color:"danger",iconType:"cross"});var forecasts=this.state.forecasts;if(0===forecasts.length)return _react2.default.createElement(_eui.EuiCallOut,{title:"No forecasts have been run for this job",iconType:"iInCircle"},_react2.default.createElement("p",null,"To run a forecast, open the ",_react2.default.createElement(_eui.EuiLink,{onClick:function(){return _this3.openSingleMetricView()}},"Single Metric Viewer"),"."));var columns=[{field:"forecast_create_timestamp",name:"Created",dataType:"date",render:function(date){return(0,_format.formatDate)(date,TIME_FORMAT)},sortable:!0},{field:"forecast_start_timestamp",name:"From",dataType:"date",render:function(date){return(0,_format.formatDate)(date,TIME_FORMAT)},sortable:!0},{field:"forecast_end_timestamp",name:"To",dataType:"date",render:function(date){return(0,_format.formatDate)(date,TIME_FORMAT)},sortable:!0},{field:"forecast_status",name:"Status",sortable:!0},{field:"forecast_memory_bytes",name:"Memory size",render:function(bytes){return(0,_format.formatNumber)(bytes,"0b")},sortable:!0},{field:"processing_time_ms",name:"Processing time",render:function(ms){return ms+" ms"},sortable:!0},{field:"forecast_expiry_timestamp",name:"Expires",render:function(date){return(0,_format.formatDate)(date,TIME_FORMAT)},sortable:!0},{field:"forecast_messages",name:"Messages",sortable:!1,render:function(messages){return _react2.default.createElement("div",null,messages.map(function(message,index){return _react2.default.createElement("p",{key:index},message)}))}},{name:"View",render:function(forecast){return _react2.default.createElement(_eui.EuiButton,{onClick:function(){return _this3.openSingleMetricView(forecast)},className:"view-forecast-btn",isDisabled:forecast.forecast_status!==_states.FORECAST_REQUEST_STATE.FINISHED},_react2.default.createElement("i",{"aria-hidden":"true",className:"fa fa-line-chart"}))}}];return _react2.default.createElement(_eui.EuiInMemoryTable,{items:forecasts,columns:columns,pagination:{pageSizeOptions:[5,10,25]},sorting:!0})}}]),ForecastsTable}(_react.Component);ForecastsTable.propTypes={job:_propTypes2.default.object.isRequired,mlForecastService:_propTypes2.default.object.isRequired},exports.ForecastsTable=ForecastsTable},3283:function(module,exports){},3284:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2).uiModules.get("apps/ml").controller("TabController",function($scope){$scope.formatDelimiter=function(del){var txt=del;switch(del){case" ":txt="space";break;case"\t":txt="tab";break;default:txt=del}return txt}})},3285:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}__webpack_require__(3286),__webpack_require__(3287),__webpack_require__(1135),__webpack_require__(1147);var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_paginated_table=__webpack_require__(3288),_paginated_table2=_interopRequireDefault(_paginated_table);__webpack_require__(2).uiModules.get("apps/ml").directive("mlPaginatedTable",function($filter){var orderBy=$filter("orderBy");return{restrict:"E",template:_paginated_table2.default,transclude:!0,scope:{rows:"=",columns:"=",perPage:"=?",sortHandler:"=?",showSelector:"=?"},controllerAs:"mlPaginatedTable",controller:function($scope){var self=this;self.sort={columnIndex:null,direction:null},self.sortColumn=function(colIndex){var col=$scope.columns[colIndex];if(col&&!1!==col.sortable){var sortDirection=void 0;sortDirection=self.sort.columnIndex!==colIndex?"asc":{null:"asc",asc:"desc",desc:null}[self.sort.direction],self.sort.columnIndex=colIndex,self.sort.direction=sortDirection,self._setSortGetter(colIndex)}},self._setSortGetter=function(index){_lodash2.default.isFunction($scope.sortHandler)?self.sort.getter=$scope.sortHandler(index):self.sort.getter=function(row){var value=row[index];return value&&void 0!==value.value&&null!==value.value?"function"==typeof value.value?value.value():value.value:value}},$scope.$watchMulti(["rows","columns","[]mlPaginatedTable.sort"],function(){if(!$scope.rows||!$scope.columns)return void($scope.sortedRows=!1);var sort=self.sort;null==sort.direction?$scope.sortedRows=$scope.rows.slice(0):$scope.sortedRows=orderBy($scope.rows,sort.getter,"desc"===sort.direction)})}}})},3286:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _jquery=__webpack_require__(12),_jquery2=_interopRequireDefault(_jquery),_lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_agg_config_result=__webpack_require__(299),_agg_config_result2=_interopRequireDefault(_agg_config_result),_filter_bar_click_handler=__webpack_require__(371);__webpack_require__(2).uiModules.get("apps/ml").directive("mlRows",function($compile,getAppState,Private){var filterBarClickHandler=Private(_filter_bar_click_handler.FilterBarClickHandlerProvider);return{restrict:"A",link:function($scope,$el,attr){function addCell($tr,contents){var $cell=(0,_jquery2.default)(document.createElement("td"));_lodash2.default.isNumber(contents)&&$cell.addClass("numeric-value"),contents instanceof _agg_config_result2.default&&("bucket"===contents.type&&contents.aggConfig.field()&&contents.aggConfig.field().filterable&&($cell=function(aggConfigResult){var $resultCell=(0,_jquery2.default)(document.createElement("td")),$state=getAppState(),clickHandler=filterBarClickHandler($state);return $resultCell.scope=$scope.$new(),$resultCell.addClass("cell-hover"),$resultCell.attr("ng-click","clickHandler($event)"),$resultCell.scope.clickHandler=function(event){(0,_jquery2.default)(event.target).is("a")||clickHandler({point:{aggConfigResult:aggConfigResult}})},$compile($resultCell)($cell.scope)}(contents)),contents=contents.toString("html")),_lodash2.default.isObject(contents)?(contents.attr&&$cell.attr(contents.attr),contents.class&&$cell.addClass(contents.class),contents.scope?$cell=$compile($cell.html(contents.markup))(contents.scope):$cell.html(contents.markup)):""===contents?$cell.html("&nbsp;"):$cell.html(contents),$tr.append($cell)}$scope.$watchMulti([attr.mlRows,attr.mlRowsMin],function(vals){var rows=vals[0],min=vals[1];$el.empty(),_lodash2.default.isArray(rows)||(rows=[]),isFinite(min)&&rows.length<min&&(rows=_lodash2.default.clone(rows)),rows.forEach(function(row){if(row.length){var rowScope=row[0].scope,$tr=(0,_jquery2.default)(document.createElement("tr")).appendTo($el);if(rowScope&&void 0!==rowScope.mouseenterRow&&"function"==typeof rowScope.mouseenterRow&&($tr.attr({"ng-mouseenter":"mouseenterRow($event)"}),$tr.attr({"ng-mouseleave":"mouseleaveRow($event)"}),$compile($tr)(rowScope)),row.forEach(function(cell){addCell($tr,cell)}),rowScope&&rowScope.expandable&&rowScope.expandElement&&""!==row.join("")){void 0===rowScope.open&&(rowScope.open=!1),void 0===rowScope.rowInitialised&&(rowScope.rowInitialised=!1),rowScope.toggleRow=function(){this.open=!this.open,this.initRow&&!1===this.rowInitialised&&(this.rowInitialised=!0,this.initRow())};var $trExpand=(0,_jquery2.default)(document.createElement("tr")).appendTo($el);$trExpand.attr("ng-show","open"),$trExpand.addClass("row-expand");var $td=(0,_jquery2.default)(document.createElement("td")).appendTo($trExpand);$td.attr("colspan",row.length);var expEl=rowScope.expandElement,$exp=(0,_jquery2.default)(document.createElement(expEl)).appendTo($td);rowScope.$expandElement&&rowScope.$expandElement.children().length&&$exp.append(rowScope.$expandElement.children()[0]),$compile($trExpand)(rowScope),rowScope.$expandElement=$exp}}})})}}})},3287:function(module,exports){},3288:function(module,exports){module.exports='<paginate\n  ng-if="sortedRows.length"\n  list="sortedRows"\n  per-page-prop="perPage"\n  class="agg-table">\n  <div class="agg-table-paginated">\n    <table class="table table-condensed">\n      <thead>\n        <tr>\n          <th\n            ng-repeat-start="col in columns"\n            ng-if="col.title"\n            ng-click="mlPaginatedTable.sortColumn($index)"\n            scope="col"\n            class="{{ col.class }}">\n            <span ng-bind="col.title"></span>\n\n            <icon-tip\n              ng-if="col.info"\n              content="\'{{ col.info }}\'"\n            ></icon-tip>\n\n            <button\n              ng-if="col.sortable !== false"\n              id="docTableHeaderFieldSort{{col.title}}"\n              tabindex="0"\n              aria-label="Sort {{col.title}} ascending"\n              class="table-header-button fa fa-sort"\n              ng-class="{\n                \'fa-sort-asc\': mlPaginatedTable.sort.columnIndex === $index && mlPaginatedTable.sort.direction === \'asc\',\n                \'fa-sort-desc\': mlPaginatedTable.sort.columnIndex === $index && mlPaginatedTable.sort.direction === \'desc\',\n                \'fa-sort\': mlPaginatedTable.sort.columnIndex !== $index || mlPaginatedTable.sort.direction === null\n              }"\n              tooltip="Sort by {{col.title}}"\n              tooltip-append-to-body="1">\n            </button>\n\n            <i aria-label="Click on a cell to filter" ng-if="col.filterable" class="fa fa-search" ng-click="$event.stopPropagation()" tooltip="Click on a cell to filter"></i>\n          </th>\n          <td\n            ng-repeat-end\n            ng-if="!col.title"\n            class="{{ col.class }}">\n          </td>\n        </tr>\n      </thead>\n      <tbody ml-rows="page" ml-rows-min="perPage"></tbody>\n    </table>\n  </div>\n\n  \x3c!-- auto-inserted by the paginate directive... --\x3e\n  \x3c!-- <paginate-controls></paginate-controls> --\x3e\n  <div class="pagination-container" ng-transclude></div>\n\n</paginate>\n'},3289:function(module,exports,__webpack_require__){"use strict";__webpack_require__(183);var _modules=__webpack_require__(2),_validate_job_view=__webpack_require__(3290);_modules.uiModules.get("apps/ml",["react"]).directive("mlValidateJob",function($injector){var mlJobService=$injector.get("mlJobService");return $injector.get("reactDirective")(_validate_job_view.ValidateJob,void 0,{restrict:"E"},{mlJobService:mlJobService})})},3290:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ValidateJob=void 0;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_propTypes=__webpack_require__(20),_propTypes2=_interopRequireDefault(_propTypes),_react=__webpack_require__(0),_react2=_interopRequireDefault(_react),_eui=__webpack_require__(5),_validation=__webpack_require__(1158),_validation_utils=__webpack_require__(476),getDefaultState=function(){return{ui:{iconType:"questionInCircle",isLoading:!1,isModalVisible:!1},data:{messages:[],success:!1},title:""}},statusToEuiColor=function(status){switch(status){case _validation.VALIDATION_STATUS.INFO:return"primary";case _validation.VALIDATION_STATUS.ERROR:return"danger";default:return status}},statusToEuiIconType=function(status){switch(status){case _validation.VALIDATION_STATUS.INFO:return"iInCircle";case _validation.VALIDATION_STATUS.ERROR:return"cross";case _validation.VALIDATION_STATUS.SUCCESS:return"check";case _validation.VALIDATION_STATUS.WARNING:return"alert";default:return status}},Link=function(_ref){var url=_ref.url;return _react2.default.createElement(_eui.EuiLink,{href:url,target:"_BLANK"},"Learn more")};Link.propTypes={url:_propTypes2.default.string.isRequired};var Message=function(_ref2){var message=_ref2.message;return _react2.default.createElement(_react2.default.Fragment,null,message.text," ",message.url&&_react2.default.createElement(Link,{url:message.url}))};Message.propTypes={message:_propTypes2.default.shape({text:_propTypes2.default.string,url:_propTypes2.default.string})};var Callout=function(_ref3){var message=_ref3.message;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiCallOut,{color:statusToEuiColor(message.status),size:"s",title:_react2.default.createElement(Message,{message:message}),iconType:statusToEuiIconType(message.status)}),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}))};Callout.propTypes={message:_propTypes2.default.shape({status:_propTypes2.default.string,text:_propTypes2.default.string,url:_propTypes2.default.string})};var Modal=function(_ref4){var close=_ref4.close,title=_ref4.title,children=_ref4.children;return _react2.default.createElement(_eui.EuiOverlayMask,null,_react2.default.createElement(_eui.EuiModal,{onClose:close,style:{width:"800px"}},_react2.default.createElement(_eui.EuiModalHeader,null,_react2.default.createElement(_eui.EuiModalHeaderTitle,null,title)),_react2.default.createElement(_eui.EuiModalBody,null,children),_react2.default.createElement(_eui.EuiModalFooter,null,_react2.default.createElement(_eui.EuiButton,{onClick:close,size:"s",fill:!0},"Close"))))};Modal.propType={close:_propTypes2.default.func.isRequired,title:_propTypes2.default.string};var ValidateJob=function(_Component){function ValidateJob(props){_classCallCheck(this,ValidateJob);var _this=_possibleConstructorReturn(this,(ValidateJob.__proto__||Object.getPrototypeOf(ValidateJob)).call(this,props));return _this.closeModal=function(){var newState=getDefaultState();newState.ui.iconType=_this.state.ui.iconType,_this.setState(newState)},_this.openModal=function(){var job=_this.props.getJobConfig(),getDuration=_this.props.getDuration,duration="function"==typeof getDuration?getDuration():void 0,fields=_this.props.fields;if("object"===(void 0===job?"undefined":_typeof(job))){var shouldShowLoadingIndicator=!0;_this.props.mlJobService.validateJob({duration:duration,fields:fields,job:job}).then(function(data){shouldShowLoadingIndicator=!1,_this.setState(_extends({},_this.state,{ui:_extends({},_this.state.ui,{iconType:statusToEuiIconType((0,_validation_utils.getMostSevereMessageStatus)(data.messages)),isLoading:!1,isModalVisible:!0}),data:data,title:job.job_id}))});setTimeout(function(){shouldShowLoadingIndicator&&_this.setState(_extends({},_this.state,{ui:_extends({},_this.state.ui,{isLoading:!0,isModalVisible:!1})}))},250)}},_this.state=getDefaultState(),_this}return _inherits(ValidateJob,_Component),_createClass(ValidateJob,[{key:"render",value:function(){var fill=!1!==this.props.fill,isCurrentJobConfig=!0===this.props.isCurrentJobConfig,isDisabled=!0===this.props.isDisabled;return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiButton,{onClick:this.openModal,size:"s",fill:fill,iconType:isCurrentJobConfig?this.state.ui.iconType:"questionInCircle",iconSide:"right",isDisabled:isDisabled,isLoading:this.state.ui.isLoading},"Validate Job"),!isDisabled&&this.state.ui.isModalVisible&&_react2.default.createElement(Modal,{close:this.closeModal,title:"Validate job "+this.state.title},this.state.data.messages.map(function(m,i){return _react2.default.createElement(Callout,{key:m.id+"_"+i,message:m})})))}}]),ValidateJob}(_react.Component);ValidateJob.propTypes={fields:_propTypes2.default.object,fill:_propTypes2.default.bool,getDuration:_propTypes2.default.func,getJobConfig:_propTypes2.default.func.isRequired,isCurrentJobConfig:_propTypes2.default.bool,isDisabled:_propTypes2.default.bool,mlJobService:_propTypes2.default.object.isRequired},exports.ValidateJob=ValidateJob},3291:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1),_lodash2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_lodash),_index_patterns=__webpack_require__(301);__webpack_require__(2).uiModules.get("apps/ml").service("mlNotificationService",function($q,es){this.getJobAuditMessages=function(fromRange,jobId){var deferred=$q.defer(),messages=[],jobFilter={};void 0!==jobId&&(jobFilter={bool:{should:[{term:{job_id:""}},{term:{job_id:jobId}}]}});var timeFilter={};return void 0!==fromRange&&""!==fromRange&&(timeFilter={range:{timestamp:{gte:"now-"+fromRange,lte:"now"}}}),es.search({index:_index_patterns.ML_NOTIFICATION_INDEX_PATTERN,ignore_unavailable:!0,size:1e3,body:{sort:[{timestamp:{order:"asc"}},{job_id:{order:"asc"}}],query:{bool:{filter:[{bool:{must_not:{term:{level:"activity"}}}},jobFilter,timeFilter]}}}}).then(function(resp){0!==resp.hits.total&&_lodash2.default.each(resp.hits.hits,function(hit){messages.push(hit._source)}),deferred.resolve({messages:messages})}).catch(function(resp){deferred.reject(resp)}),deferred.promise},this.getAuditMessagesSummary=function(){var deferred=$q.defer(),aggs=[];return es.search({index:_index_patterns.ML_NOTIFICATION_INDEX_PATTERN,ignore_unavailable:!0,size:0,body:{query:{bool:{filter:{range:{timestamp:{gte:"now-1d"}}}}},aggs:{levelsPerJob:{terms:{field:"job_id"},aggs:{levels:{terms:{field:"level"},aggs:{latestMessage:{terms:{field:"message.raw",size:1,order:{latestMessage:"desc"}},aggs:{latestMessage:{max:{field:"timestamp"}}}}}}}}}}}).then(function(resp){0!==resp.hits.total&&resp.aggregations&&resp.aggregations.levelsPerJob&&resp.aggregations.levelsPerJob.buckets&&resp.aggregations.levelsPerJob.buckets.length&&_lodash2.default.each(resp.aggregations.levelsPerJob.buckets,function(agg){aggs.push(agg)}),deferred.resolve({messagesPerJob:aggs})}).catch(function(resp){deferred.reject(resp)}),deferred.promise}})},3292:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3293),__webpack_require__(3294),__webpack_require__(1152),__webpack_require__(3297),__webpack_require__(3300),__webpack_require__(302)},3293:function(module,exports){},3294:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular),_parse_interval=__webpack_require__(107);__webpack_require__(251);var _routes=__webpack_require__(11),_routes2=_interopRequireDefault(_routes),_check_license=__webpack_require__(101),_check_privilege=__webpack_require__(93),_new_job=__webpack_require__(3295),_new_job2=_interopRequireDefault(_new_job),_save_status_modal=__webpack_require__(3296),_save_status_modal2=_interopRequireDefault(_save_status_modal),_new_job_utils=__webpack_require__(192),_index_utils=__webpack_require__(132),_field_types=__webpack_require__(208),_check_ml_nodes=__webpack_require__(108),_new_job_defaults=__webpack_require__(258),_job_utils=__webpack_require__(57),_modules=__webpack_require__(2);_routes2.default.when("/jobs/new_job/advanced",{template:_new_job2.default,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.getIndexPatternWithRoute,indexPatterns:_index_utils.getIndexPatterns,savedSearch:_index_utils.getSavedSearchWithRoute,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults}}).when("/jobs/new_job/advanced/:jobId",{template:_new_job2.default,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.getIndexPatternWithRoute,indexPatterns:_index_utils.getIndexPatterns,savedSearch:_index_utils.getSavedSearchWithRoute,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults}}),_modules.uiModules.get("apps/ml").controller("MlNewJob",function($scope,$route,$location,$modal,$q,$timeout,courier,es,ml,Private,timefilter,esServerUrl,mlJobService,mlMessageBarService,mlDatafeedService,mlConfirmModalService){function changeTab(tab){$scope.ui.currentTab=tab.index,4===tab.index?createJSONText():5===tab.index&&"ES"===$scope.ui.dataLocation&&loadDataPreview()}function loadFields(){return $q(function(resolve,reject){clear($scope.fields),clear($scope.dateFields),clear($scope.catFields),clear($scope.ui.influencers);var index=$scope.ui.datafeed.indicesText;""!==index?ml.getFieldCaps({index:index}).then(function(resp){$scope.ui.fieldsUpToDate=!0,_lodash2.default.each(resp,function(fieldList){_lodash2.default.each(fieldList,function(field,fieldName){_lodash2.default.each(field,function(type){if(-1===fieldsToIgnore.indexOf(fieldName)){var addField=!0;if(fieldName.match(/\.keyword$/)){var keywordLess=fieldName.replace(".keyword");void 0!==$scope.fields[keywordLess]&&delete $scope.fields[keywordLess]}else void 0!==$scope.fields[fieldName+".keyword"]&&(addField=!1);addField&&($scope.fields[fieldName]=type,type.type===_field_types.ML_JOB_FIELD_TYPES.DATE&&($scope.dateFields[fieldName]=type),type.type!==_field_types.ML_JOB_FIELD_TYPES.TEXT&&type.type!==_field_types.ML_JOB_FIELD_TYPES.KEYWORD||($scope.catFields[fieldName]=type),-1!==allowedInfluencerTypes.indexOf(type.type)&&$scope.ui.influencers.push(fieldName))}})})}),Object.keys($scope.fields).length&&($scope.ui.indexTextOk=!0),validateIndex($scope.ui.validation.tabs),guessTimeField(),resolve()}).catch(function(error){$scope.ui.indexTextOk=!1,validateIndex($scope.ui.validation.tabs),reject(error)}):reject()})}function guessTimeField(){var currentTimeField=$scope.job.data_description.time_field;void 0===$scope.dateFields[currentTimeField]&&(currentTimeField="",$scope.job.data_description.time_field=""),""===currentTimeField&&Object.keys($scope.dateFields).length&&($scope.job.data_description.time_field=Object.keys($scope.dateFields)[0],console.log("guessTimeField: guessed time fields: ",$scope.job.data_description.time_field))}function populateFormFromUrl(){var _createSearchItems=(0,_new_job_utils.createSearchItems)($route),indexPattern=_createSearchItems.indexPattern,savedSearch=_createSearchItems.savedSearch,combinedQuery=_createSearchItems.combinedQuery;void 0!==indexPattern.id&&((0,_index_utils.timeBasedIndexCheck)(indexPattern,!0),$scope.ui.datafeed.indicesText=indexPattern.title,$scope.job.data_description.time_field=indexPattern.timeFieldName,void 0!==savedSearch.id&&($scope.ui.datafeed.queryText=JSON.stringify(combinedQuery)))}function clear(obj){Object.keys(obj).forEach(function(key){delete obj[key]}),Array.isArray(obj)&&(obj.length=0)}function setDatafeedUIText(){if($scope.job.datafeed_config&&Object.keys($scope.job.datafeed_config).length){var datafeedConfig=$scope.job.datafeed_config;$scope.ui.isDatafeed=!0,$scope.ui.tabs[2].hidden=!0,$scope.ui.dataLocation="ES",showDataPreviewTab();var queryDelayDefault=$scope.ui.datafeed.queryDelayDefault,queryDelay=datafeedConfig.query_delay;void 0!==datafeedConfig.query_delay&&$scope.ui.datafeed.queryDelayDefault!==datafeedConfig.query_delay||(queryDelay="");var frequencyDefault=$scope.ui.datafeed.frequencyDefault,freq=datafeedConfig.frequency;void 0!==datafeedConfig.frequency&&$scope.ui.datafeed.frequencyDefault!==datafeedConfig.frequency||(freq="");var scrollSizeDefault=$scope.ui.datafeed.scrollSizeDefault,scrollSize=datafeedConfig.scroll_size;void 0!==datafeedConfig.scroll_size&&$scope.ui.datafeed.scrollSizeDefault!==datafeedConfig.scroll_size||(scrollSize=""),clear($scope.types),_lodash2.default.each(datafeedConfig.types,function(type){$scope.types[type]=$scope.ui.types[type]}),clear($scope.indices),_lodash2.default.each(datafeedConfig.indices,function(index){$scope.indices[index]=$scope.ui.indices[index]});var indicesText=datafeedConfig.indices.join(",");$scope.ui.fieldsUpToDate=indicesText===$scope.ui.datafeed.indicesText,$scope.ui.datafeed={queryText:_angular2.default.toJson(datafeedConfig.query,!0),queryDelayText:queryDelay,queryDelayDefault:queryDelayDefault,frequencyText:freq,frequencyDefault:frequencyDefault,scrollSizeText:scrollSize,scrollSizeDefault:scrollSizeDefault,indicesText:indicesText,typesText:datafeedConfig.types.join(",")},!1===$scope.ui.fieldsUpToDate&&$scope.loadFields()}else $scope.ui.isDatafeed=!1,$scope.ui.tabs[2].hidden=!1}function setAnalysisLimitsUIText(){void 0!==$scope.job.analysis_limits&&void 0!==$scope.job.analysis_limits.model_memory_limit&&($scope.ui.modelMemoryLimitText=$scope.job.analysis_limits.model_memory_limit)}function calculateDatafeedFrequencyDefaultSeconds(){var bucketSpan=(0,_parse_interval.parseInterval)($scope.job.analysis_config.bucket_span);null!==bucketSpan&&($scope.ui.datafeed.frequencyDefault=(0,_job_utils.calculateDatafeedFrequencyDefaultSeconds)(bucketSpan.asSeconds())+"s")}function setFieldDelimiterControlsFromText(){if($scope.job.data_description&&$scope.job.data_description.field_delimiter){void 0===$scope.job.data_description.format&&($scope.job.data_description.format="delimited");var fieldDelimiter=$scope.job.data_description.field_delimiter;$scope.ui.selectedFieldDelimiter="custom",$scope.ui.customFieldDelimiter="";for(var isCustom=!0,i=0;i<$scope.ui.fieldDelimiterOptions.length-1;i++)$scope.ui.fieldDelimiterOptions[i].value===fieldDelimiter&&(isCustom=!1,$scope.ui.selectedFieldDelimiter=$scope.ui.fieldDelimiterOptions[i].value);isCustom&&($scope.ui.customFieldDelimiter=fieldDelimiter)}}function getDelimiterSelection(){if("delimited"===$scope.job.data_description.format){var selectedFieldDelimiter=$scope.ui.selectedFieldDelimiter;$scope.job.data_description.field_delimiter="custom"===selectedFieldDelimiter?$scope.ui.customFieldDelimiter:selectedFieldDelimiter}else delete $scope.job.data_description.field_delimiter,delete $scope.job.data_description.quote_character}function getAnalysisLimitsSelection(){var ui=$scope.ui,job=$scope.job;""===ui.modelMemoryLimitText||null===ui.modelMemoryLimitText||void 0===ui.modelMemoryLimitText?void 0!==job.analysis_limits&&(delete job.analysis_limits.model_memory_limit,0===Object.keys(job.analysis_limits).length&&delete job.analysis_limits):(void 0===job.analysis_limits&&(job.analysis_limits={}),job.analysis_limits.model_memory_limit=ui.modelMemoryLimitText)}function getDatafeedSelection(){if($scope.ui.isDatafeed){var df=$scope.ui.datafeed;""===df.queryText&&(df.queryText='{"match_all":{}}');var query=df.queryText;try{query=JSON.parse(query)}catch(e){console.log("getDatafeedSelection(): could not parse query JSON")}var indices=[];df.indicesText&&(indices=df.indicesText.split(",").map(function(i){return i.trim()}));var types=[];if(df.typesText){types=df.typesText.split(",");for(var i=0;i<types.length;i++)types[i]=types[i].trim()}var typeKeys=Object.keys($scope.ui.types);0===_lodash2.default.difference(typeKeys,types).length&&(types=[]),$scope.job.datafeed_config||($scope.job.datafeed_config={});var config=$scope.job.datafeed_config;config.query=query,""===df.queryDelayText||null===df.queryDelayText||void 0===df.queryDelayText?delete config.query_delay:config.query_delay=df.queryDelayText,""===df.frequencyText||null===df.frequencyText||void 0===df.frequencyText?delete config.frequency:config.frequency=df.frequencyText,""===df.scrollSizeText||null===df.scrollSizeText||void 0===df.scrollSizeText?delete config.scroll_size:config.scroll_size=df.scrollSizeText,config.indices=indices,config.types=types}}function getCustomUrlSelection(){$scope.job.custom_settings&&$scope.job.custom_settings.custom_urls&&0===$scope.job.custom_settings.custom_urls.length&&delete $scope.job.custom_settings}function getCategorizationFilterSelection(){$scope.job.analysis_config&&$scope.job.analysis_config.categorization_filters&&0===$scope.job.analysis_config.categorization_filters.length&&delete $scope.job.analysis_config.categorization_filters}function createJSONText(){getDelimiterSelection(),getAnalysisLimitsSelection(),getDatafeedSelection(),getCustomUrlSelection(),getCategorizationFilterSelection(),$scope.ui.jsonText=_angular2.default.toJson($scope.job,!0)}function extractCustomInfluencers(){var allInfluencersList=$scope.ui.influencers;$scope.ui.customInfluencers=_lodash2.default.difference($scope.job.analysis_config.influencers,allInfluencersList),console.log("extractCustomInfluencers: ",$scope.ui.customInfluencers)}function validateJob(){var limits=(0,_new_job_defaults.newJobLimits)(),validationResults=(0,_job_utils.basicJobValidation)($scope.job,$scope.fields,limits),valid=validationResults.valid,tabs=$scope.ui.validation.tabs;_lodash2.default.each(tabs,function(tab){tab.valid=!0;for(var check in tab.checks)tab.checks.hasOwnProperty(check)&&(tab.checks[check].valid=!0,tab.checks[check].message="")});var job=$scope.job;if(job){if(validationResults.contains("job_id_empty"))tabs[0].checks.jobId.valid=!1;else if(validationResults.contains("job_id_invalid")){tabs[0].checks.jobId.valid=!1;var msg="Job name can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";msg+="must start and end with an alphanumeric character",tabs[0].checks.jobId.message=msg}if(validationResults.contains("job_group_id_invalid")){tabs[0].checks.groupIds.valid=!1;var _msg="Job group names can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";_msg+="must start and end with an alphanumeric character",tabs[0].checks.groupIds.message=_msg}if(validationResults.contains("model_memory_limit_invalid")){tabs[0].checks.modelMemoryLimit.valid=!1;var _msg2="Model memory limit cannot be higher than the maximum value of "+limits.max_model_memory_limit.toUpperCase();tabs[0].checks.modelMemoryLimit.message=_msg2}if(validationResults.contains("categorization_filter_invalid")&&(tabs[1].checks.categorizationFilters.message="categorizationFieldName must be set to allow filters",tabs[1].checks.categorizationFilters.valid=!1),validationResults.contains("detectors_empty")&&(tabs[1].checks.detectors.valid=!1),validationResults.contains("detectors_duplicates")){var _msg3="Duplicate detectors were found. Detectors having the same combined configuration for";_msg3+=" 'function', 'field_name', 'by_field_name', 'over_field_name' and",_msg3+=" 'partition_field_name' are not allowed within the same job.",tabs[1].checks.detectors.message=_msg3,tabs[1].checks.detectors.valid=!1}if(validationResults.contains("influencers_empty"),validationResults.contains("bucket_span_empty"))tabs[1].checks.bucketSpan.message="bucket_span must be set",tabs[1].checks.bucketSpan.valid=!1;else if(validationResults.contains("bucket_span_invalid")){var _msg4=job.analysis_config.bucket_span+" is not a valid time interval format e.g. 10m, 1h.";_msg4+=" It also needs to be higher than zero.",tabs[1].checks.bucketSpan.message=_msg4,tabs[1].checks.bucketSpan.valid=!1}validateIndex(tabs,function(){return validationResults.contains("index_fields_invalid")})}return _lodash2.default.each(tabs,function(tab){_lodash2.default.each(tab.checks,function(item){!1===item.valid&&(tab.valid=!1)})}),{valid:valid,message:"Fill in all required fields"}}function validateIndex(tabs){(arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return 0===Object.keys($scope.fields).length})()?(tabs[3].checks.hasAccessToIndex.valid=!1,tabs[3].checks.hasAccessToIndex.message="Could not load fields from index",tabs[3].valid=!1):(tabs[3].checks.hasAccessToIndex.valid=!0,tabs[3].valid=!0)}function openSaveStatusWindow(){$modal.open({template:_save_status_modal2.default,controller:"MlSaveStatusModal",backdrop:"static",keyboard:!1,size:"sm",resolve:{params:function(){return{pscope:$scope,openDatafeed:function(){mlDatafeedService.openJobTimepickerWindow($scope.job)}}}}})}function loadDataPreview(){createJSONText(),$scope.ui.dataPreview="";var job=$scope.job;job.datafeed_config&&job.datafeed_config.indices.length?mlJobService.searchPreview(job).then(function(resp){var data=void 0;data=resp.aggregations?resp.aggregations.buckets.buckets.slice(0,_job_utils.ML_DATA_PREVIEW_COUNT):resp.hits.hits,$scope.ui.dataPreview=_angular2.default.toJson(data,!0)}).catch(function(resp){$scope.ui.dataPreview=_angular2.default.toJson(resp,!0)}):$scope.ui.dataPreview="Datafeed does not exist"}function showDataPreviewTab(){var hidden=!0;$scope.ui.isDatafeed&&(hidden=!1),"NONE"===$scope.ui.dataLocation&&$scope.mode===MODE.CLONE&&(hidden=!0),$scope.ui.tabs[5].hidden=hidden,$scope.$applyAsync()}function allInfluencers(){var influencers=$scope.ui.influencers.concat($scope.ui.customInfluencers);return influencers=_lodash2.default.uniq(influencers),_lodash2.default.sortBy(influencers,function(inf){return inf})}timefilter.disableTimeRangeSelector(),timefilter.disableAutoRefreshSelector();var MODE={NEW:0,EDIT:1,CLONE:2},INDEX_INPUT_TYPE={TEXT:"TEXT",LIST:"LIST"};$scope.INDEX_INPUT_TYPE=INDEX_INPUT_TYPE;var fieldsToIgnore=["_id","_field_names","_index","_parent","_routing","_seq_no","_source","_type","_uid","_version"],allowedInfluencerTypes=[_field_types.ES_FIELD_TYPES.TEXT,_field_types.ES_FIELD_TYPES.KEYWORD,_field_types.ES_FIELD_TYPES.IP],msgs=mlMessageBarService,mlConfirm=mlConfirmModalService;msgs.clear();var jobDefaults=(0,_new_job_defaults.newJobDefaults)();$scope.job={},$scope.mode=MODE.NEW,$scope.saveLock=!1,$scope.indices={},$scope.types={},$scope.fields={},$scope.dateFields={},$scope.catFields={},$scope.maximumFileSize,$scope.mlElasticDataDescriptionExposedFunctions={},$scope.elasticServerInfo={},$scope.jobGroupsUpdateFunction={},$scope.ui={pageTitle:"Create a new job",dataLocation:"ES",dataPreview:"",currentTab:0,tabs:[{index:0,title:"Job Details"},{index:1,title:"Analysis Configuration"},{index:2,title:"Data Description",hidden:!0},{index:3,title:"Datafeed"},{index:4,title:"Edit JSON"},{index:5,title:"Data Preview",hidden:!0}],validation:{tabs:[{index:0,valid:!0,checks:{jobId:{valid:!0},groupIds:{valid:!0},modelMemoryLimit:{valid:!0}}},{index:1,valid:!0,checks:{detectors:{valid:!0},influencers:{valid:!0},categorizationFilters:{valid:!0},bucketSpan:{valid:!0}}},{index:2,valid:!0,checks:{timeField:{valid:!0},timeFormat:{valid:!0}}},{index:3,valid:!0,checks:{isDatafeed:{valid:!0},hasAccessToIndex:{valid:!0}}},{index:4,valid:!0,checks:{}},{index:5,valid:!0,checks:{}}],setTabValid:function(tab,valid){$scope.ui.validation.tabs[tab].valid=valid}},jsonText:"",changeTab:changeTab,influencers:[],allInfluencers:allInfluencers,customInfluencers:[],tempCustomInfluencer:"",inputDataFormat:[{value:"delimited",title:"Delimited"},{value:"json",title:"JSON"}],fieldDelimiterOptions:[{value:"\t",title:"tab"},{value:" ",title:"space"},{value:",",title:","},{value:";",title:";"},{value:"custom",title:"custom"}],selectedFieldDelimiter:",",customFieldDelimiter:"",indexTextOk:!1,fieldsUpToDate:!1,indices:{},types:{},isDatafeed:!0,useDedicatedIndex:!1,modelMemoryLimit:"",modelMemoryLimitDefault:jobDefaults.anomaly_detectors.model_memory_limit,datafeed:{queryText:'{"match_all":{}}',queryDelayText:"",queryDelayDefault:"60s",frequencyText:"",frequencyDefault:"",scrollSizeText:"",scrollSizeDefault:1e3,indicesText:"",typesText:""},saveStatus:{job:0}},$scope.indexChanged=function(){$scope.ui.fieldsUpToDate=!1},$scope.loadFields=function(){loadFields().catch(function(){})},$scope.isCurrentJobConfig=!1,$scope.$watch("job",function(){$scope.isCurrentJobConfig=!1},!0),$scope.getJobConfig=function(){return getDelimiterSelection(),getDatafeedSelection(),getAnalysisLimitsSelection(),$scope.isCurrentJobConfig=!0,$scope.job},$scope.save=function(){console.log("save() job: ",$scope.job),msgs.clear(),getDelimiterSelection(),getDatafeedSelection(),getAnalysisLimitsSelection();var jobValid=validateJob();jobValid.valid?mlJobService.loadJobs().then(function(){function createJobForSaving(job){var newJob=_angular2.default.copy(job);return delete newJob.datafeed_config,newJob}function saveFunc(){$scope.ui.useDedicatedIndex?""===$scope.job.results_index_name&&($scope.job.results_index_name=$scope.job.job_id):delete $scope.job.results_index_name,$scope.saveLock=!0,$scope.ui.saveStatus.job=1,openSaveStatusWindow();var job=createJobForSaving($scope.job);mlJobService.saveNewJob(job).then(function(result){if(result.success){var saveNewDatafeed=function(datafeedConfig,jobId){datafeedConfig?mlJobService.saveNewDatafeed(datafeedConfig,jobId).then(function(){$scope.saveLock=!1}).catch(function(resp){msgs.error("Could not create datafeed: ",resp),$scope.saveLock=!1}):$scope.saveLock=!1};msgs.info("New Job '"+result.resp.job_id+"' added"),$scope.ui.saveStatus.job=2,mlJobService.openJob($scope.job.job_id).then(function(){saveNewDatafeed($scope.job.datafeed_config,$scope.job.job_id)}).catch(function(resp){msgs.error("Could not open job: ",resp),msgs.error("Job created, creating datafeed anyway"),saveNewDatafeed($scope.job.datafeed_config,$scope.job.job_id)})}else $scope.ui.saveStatus.job=-1,$scope.saveLock=!1,msgs.error("Save failed: "+result.resp.message)}).catch(function(result){$scope.ui.saveStatus.job=-1,$scope.saveLock=!1,msgs.error("Save failed: "+result.resp.message)})}if(mlJobService.getJob($scope.job.job_id)){var tab=$scope.ui.validation.tabs[0];tab.valid=!1,tab.checks.jobId.valid=!1,tab.checks.jobId.message="'"+$scope.job.job_id+"' already exists, please choose a different name",changeTab({index:0})}else!function(){$scope.job.analysis_config.influencers&&$scope.job.analysis_config.influencers.length?saveFunc():mlConfirm.open({message:"You have not chosen any influencers, do you want to continue?",title:"No Influencers"}).then(saveFunc).catch(function(){changeTab({index:1})})}()}).catch(function(){msgs.error("Save failed"),console.log("save(): job validation failed. Jobs list could not be loaded.")}):(msgs.error(jobValid.message),console.log("save(): job validation failed"))},$scope.cancel=function(){mlConfirm.open({message:"Are you sure you want to cancel job creation?",title:"Are you sure?"}).then(function(){msgs.clear(),$location.path("jobs")})},$scope.cloneJobDataDescriptionCallback=function(){extractCustomInfluencers()},$scope.timeFieldSelected=function(){return""!==$scope.job.data_description.time_field},$scope.jsonTextChange=function(){try{$scope.job=JSON.parse($scope.ui.jsonText),$scope.changeJobIDCase(),void 0!==$scope.jobGroupsUpdateFunction.update&&$scope.jobGroupsUpdateFunction.update($scope.job.groups),extractCustomInfluencers(),setFieldDelimiterControlsFromText(),setDatafeedUIText(),setAnalysisLimitsUIText(),void 0!==$scope.job.results_index_name?$scope.ui.useDedicatedIndex=!0:$scope.ui.useDedicatedIndex=!1}catch(e){console.log("JSON could not be parsed")}},$scope.changeJobIDCase=function(){$scope.job.job_id&&($scope.job.job_id=$scope.job.job_id.toLowerCase())},$scope.datafeedChange=function(){$scope.ui.isDatafeed?($scope.job.datafeed_config={},$scope.ui.tabs[2].hidden=!0,calculateDatafeedFrequencyDefaultSeconds()):(delete $scope.job.datafeed_config,$scope.ui.tabs[2].hidden=!1,$scope.job.data_description.format="json"),showDataPreviewTab()},$scope.setDedicatedIndex=function(){$scope.ui.useDedicatedIndex?$scope.job.results_index_name="":delete $scope.job.results_index_name},$scope.setAnalysisConfigProperty=function(value,field){""===value?delete $scope.job.analysis_config[field]:$scope.job.analysis_config[field]=value},$scope.calculateDatafeedFrequencyDefaultSeconds=calculateDatafeedFrequencyDefaultSeconds,$scope.addCustomUrl=function(){$scope.job.custom_settings||($scope.job.custom_settings={}),$scope.job.custom_settings.custom_urls||($scope.job.custom_settings.custom_urls=[]),$scope.job.custom_settings.custom_urls.push({url_name:"",url_value:""})},$scope.removeCustomUrl=function(index){$scope.job.custom_settings.custom_urls.splice(index,1)},$scope.addCategorizationFilter=function(){$scope.job.analysis_config&&($scope.job.analysis_config.categorization_filters||($scope.job.analysis_config.categorization_filters=[]),$scope.job.analysis_config.categorization_filters.push(""))},$scope.removeCategorizationFilter=function(index){$scope.job.analysis_config&&$scope.job.analysis_config.categorization_filters&&$scope.job.analysis_config.categorization_filters.splice(index,1)},$scope.influencerChecked=function(inf){return _lodash2.default.contains($scope.job.analysis_config.influencers,inf)},$scope.toggleInfluencer=function(inf){var influencers=$scope.job.analysis_config.influencers;if($scope.influencerChecked(inf))for(var i=0;i<influencers.length;i++)influencers[i]===inf&&$scope.job.analysis_config.influencers.splice(i,1);else $scope.job.analysis_config.influencers.push(inf)},$scope.addCustomInfluencer=function(){""!==$scope.ui.tempCustomInfluencer&&($scope.ui.customInfluencers.push($scope.ui.tempCustomInfluencer),$scope.ui.tempCustomInfluencer="")},function(){if(mlJobService.loadJobs(),mlJobService.currentJob){var jobId=$route.current.params.jobId;$scope.job=mlJobService.cloneJob(mlJobService.currentJob),jobId?($scope.mode=MODE.EDIT,console.log("Editing job",mlJobService.currentJob),$scope.ui.pageTitle="Editing Job "+$scope.job.job_id):($scope.mode=MODE.CLONE,console.log("Cloning job",mlJobService.currentJob),$scope.ui.pageTitle="Clone Job from "+$scope.job.job_id,$scope.job.job_id="",setDatafeedUIText(),setFieldDelimiterControlsFromText(),$scope.job.datafeed_config||($scope.ui.dataLocation="NONE",$scope.ui.influencers=_angular2.default.copy($scope.job.analysis_config.influencers)),$scope.job.analysis_limits&&$scope.job.analysis_limits.model_memory_limit&&($scope.ui.modelMemoryLimitText=$scope.job.analysis_limits.model_memory_limit),"shared"===$scope.job.results_index_name?delete $scope.job.results_index_name:($scope.ui.useDedicatedIndex=!0,$scope.job.results_index_name="")),mlJobService.currentJob=void 0}else $scope.mode=MODE.NEW,console.log("Creating new job"),$scope.job=mlJobService.getBlankJob(),$scope.job.data_description.format="json",delete $scope.job.data_description.time_format,delete $scope.job.data_description.format,populateFormFromUrl();loadFields().then(function(){calculateDatafeedFrequencyDefaultSeconds(),showDataPreviewTab()}).catch(function(){calculateDatafeedFrequencyDefaultSeconds()})}()})},3295:function(module,exports){module.exports='<ml-nav-menu name="new_job_advanced"></ml-nav-menu>\n<ml-new-job>\n  <ml-message-bar></ml-message-bar>\n  <div ng-controller="MlNewJob" class="container">\n    <div>\n      <h3 class="euiTitle euiTitle--large">{{ui.pageTitle}}</h3>\n      <div class="euiSpacer euiSpacer--s"></div>\n        <ul class="nav nav-tabs">\n          <li\n            class="kbn-settings-tab"\n            ng-class="{ active: ui.currentTab === tab.index }"\n            ng-repeat="tab in ui.tabs"\n            ng-hide="ui.tabs[{{tab.index}}].hidden">\n\n            <a ng-click="ui.changeTab(tab)">\n              {{ tab.title }}\n              <i ng-hide=\'ui.validation.tabs[tab.index].valid\' class=\'validataion-error fa fa-exclamation-circle\' />\n            </a>\n          </li>\n        </ul>\n\n        \x3c!-- tab 0 Job Details --\x3e\n        <ml-job-tab-0 class="tab" ng-show="ui.currentTab === 0">\n          <div class="tab_contents">\n            \x3c!-- ID --\x3e\n            <div class="form-group">\n              <ml-form-label label-id="new_job_id" tooltip-append-to-body="true">Name</ml-form-label>\n              <input\n                aria-labelledby="ml_aria_label_new_job_id"\n                aria-describedby="ml_aria_description_new_job_id"\n                ng-model="job.job_id"\n                required\n                placeholder="Job ID"\n                ng-change="changeJobIDCase()"\n                input-focus\n                class="form-control lowercase" />\n              <div ng-hide="ui.validation.tabs[0].checks.jobId.valid" class="validation-error">{{ ( ui.validation.tabs[0].checks.jobId.message || "Enter a name for the job" ) }}</div>\n            </div>\n            \x3c!-- description --\x3e\n            <div class="form-group">\n              <ml-form-label label-id="new_job_description">Description</ml-form-label>\n              <input\n                aria-labelledby="ml_aria_label_new_job_description"\n                aria-describedby="ml_aria_description_new_job_description"\n                ng-model="job.description"\n                placeholder="Job description"\n                class="form-control" />\n            </div>\n\n            <div class="form-group">\n              <ml-form-label label-id="new_job_group" tooltip-placement="top">Job Groups</ml-form-label>\n              <ml-job-group-select\n                aria-labelledby="ml_aria_label_new_job_group"\n                aria-describedby="ml_aria_description_new_job_group"\n                job-groups=\'job.groups\'\n                external-update-function=\'jobGroupsUpdateFunction\' />\n              <div ng-hide="ui.validation.checks.groupIds.valid" class="validation-error">{{ ui.validation.tabs[0].checks.groupIds.message }}</div>\n            </div>\n\n            <div class="form-group">\n              <label class="kuiFormLabel">Custom URLs</label><i ml-info-icon="new_job_custom_urls" />\n              <div class="euiSpacer euiSpacer--s"></div>\n              <div ng-if="job.custom_settings && job.custom_settings.custom_urls">\n                <div ng-repeat="item in job.custom_settings.custom_urls track by $index" class="custom-url">\n                  <div class="field-cols">\n\n                    <div class="form-group">\n                      <label class="kuiFormLabel" id="ml_aria_label_custom_url_label_{{$index}}">Label</label>\n                      <input\n                        aria-labelledby="ml_aria_label_custom_url_label_{{$index}}"\n                        ng-model="item.url_name"\n                        type="text"\n                        class="form-control" />\n                    </div>\n                  </div>\n\n                  <div class="field-cols">\n                    <div class="form-group">\n                      <label class="kuiFormLabel" id="ml_aria_label_custom_url_{{$index}}">URL</label>\n                      <textarea\n                        aria-labelledby="ml_aria_label_custom_url_{{$index}}"\n                        ng-model="item.url_value"\n                        type="text"\n                        class="form-control" ></textarea>\n                    </div>\n                  </div>\n\n                  <button\n                    aria-label="Remove Custom URL"\n                    ng-click="removeCustomUrl($index)"\n                    tooltip-append-to-body="true"\n                    type="button"\n                    class="kuiButton kuiButton--danger kuiButton--small remove-button">\n                      <i aria-hidden="true" class="fa fa-times" />\n                  </button>\n                </div>\n              </div>\n              <div>\n                <button\n                  aria-labelledby="ml_aria_label_new_job_custom_urls"\n                  aria-describedby="ml_aria_description_new_job_custom_urls"\n                  ng-click="addCustomUrl()"\n                  type="button"\n                  class="kuiButton kuiButton--primary kuiButton--small">\n                  <i aria-hidden="true" class="fa fa-plus" />\n                  <span id="ml_aria_label_new_job_custom_urls">Add Custom URL</span>\n                </button>\n              </div>\n\n            </div>\n\n            <div class="form-group">\n              <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n                <input type="checkbox"\n                  aria-labelledby="ml_aria_label_new_job_dedicated_index"\n                  aria-describedby="ml_aria_description_new_job_dedicated_index"\n                  class=\'kuiCheckBox\'\n                  ng-change="setDedicatedIndex()"\n                  ng-model  ="ui.useDedicatedIndex" />\n                <span class=\'kuiCheckBoxLabel__text\'>\n                  <span id="ml_aria_label_new_job_dedicated_index">Use dedicated index</span>\n                  <i ml-info-icon="new_job_dedicated_index" />\n                </span>\n              </label>\n            </div>\n\n            <div class="form-group">\n              <ml-form-label label-id="new_job_model_memory_limit">Model memory limit</ml-form-label>\n              <input\n                aria-labelledby="ml_aria_label_new_job_model_memory_limit"\n                aria-describedby="ml_aria_description_new_job_model_memory_limit"\n                ng-model="ui.modelMemoryLimitText"\n                placeholder="{{ui.modelMemoryLimitDefault}}"\n                class="form-control" />\n              <div ng-hide="ui.validation.tabs[0].checks.modelMemoryLimit.valid" class="validation-error">{{ ui.validation.tabs[0].checks.modelMemoryLimit.message }}</div>\n            </div>\n\n          </div>\n        </ml-job-tab-0>\n\n        \x3c!-- tab2 1 Analysis Configuration --\x3e\n        <ml-job-tab-1 ng-show="ui.currentTab === 1">\n          <div class="tab_contents">\n            <div class="form-group">\n              <ml-form-label label-id="new_job_bucketspan">bucket_span</ml-form-label>\n              <input\n                aria-labelledby="ml_aria_label_new_job_bucketspan"\n                aria-describedby="ml_aria_description_new_job_bucketspan"\n                type="text"\n                ng-model="job.analysis_config.bucket_span"\n                placeholder=""\n                ng-change="calculateDatafeedFrequencyDefaultSeconds()"\n                class="form-control" />\n              <div ng-hide="ui.validation.tabs[1].checks.bucketSpan.valid" class="validation-error">\n                {{ ( ui.validation.tabs[1].checks.bucketSpan.message || "bucket_span is not a valid time interval format" ) }}\n              </div>\n            </div>\n            <div class="form-group">\n              <ml-form-label label-id="new_job_summarycountfieldname">summary_count_field_name</ml-form-label>\n              <field-select\n                label-id=\'"new_job_summarycountfieldname"\'\n                on-change=\'setAnalysisConfigProperty\'\n                value=\'job.analysis_config.summary_count_field_name\'\n                field=\'"summary_count_field_name"\'\n                options=\'fields\'>\n              </field-select>\n            </div>\n            <div class="form-group">\n              <ml-form-label label-id="new_job_categorizationfieldname">categorization_field_name</ml-form-label>\n              <field-select\n                label-id=\'"new_job_categorizationfieldname"\'\n                on-change=\'setAnalysisConfigProperty\'\n                value=\'job.analysis_config.categorization_field_name\'\n                field=\'"categorization_field_name"\'\n                options=\'catFields\'>\n              </field-select>\n            </div>\n\n            <div class="form-group"\n              ng-show="(job.analysis_config.categorization_field_name !== undefined && job.analysis_config.categorization_field_name !== \'\') ||\n                       (job.analysis_config.categorization_filters && job.analysis_config.categorization_filters.length)">\n\n              <label class="kuiFormLabel" aria-describedby="ml_aria_description_new_job_categorizationfilters">Categorization Filters</label>\n              <i ml-info-icon="new_job_categorizationfilters" />\n              <div class="euiSpacer euiSpacer--s"></div>\n              <div ng-if="job.analysis_config && job.analysis_config.categorization_filters">\n                <div ng-repeat="item in job.analysis_config.categorization_filters track by $index" class="categorization-filter">\n                  <div class="field-cols">\n\n                    <div class="form-group">\n                      <input\n                        aria-label="Categorization filter regular expression"\n                        ng-model="job.analysis_config.categorization_filters[$index]"\n                        type="text"\n                        class="form-control" />\n                    </div>\n                  </div>\n\n                  <button\n                    aria-label="Remove categorization filter"\n                    ng-click="removeCategorizationFilter($index)"\n                    tooltip-append-to-body="true"\n                    type="button"\n                    class="kuiButton kuiButton--danger kuiButton--small remove-button">\n                      <i aria-hidden="true" class="fa fa-times" />\n                  </button>\n                </div>\n              </div>\n              <div>\n                <button\n                  aria-labelledby="ml_aria_label_add_categorization_filter"\n                  ng-click="addCategorizationFilter()"\n                  type="button"\n                  ng-disabled="job.analysis_config.categorization_field_name === undefined || job.analysis_config.categorization_field_name === \'\'"\n                  class="kuiButton kuiButton--primary kuiButton--small">\n                  <i aria-hidden="true" class="fa fa-plus" />\n                  <span id="ml_aria_label_add_categorization_filter">Add Categorization Filter</span>\n                </button>\n              </div>\n            </div>\n            <div ng-hide="ui.validation.tabs[1].checks.categorizationFilters.valid" class="validation-error">\n              {{ ( ui.validation.tabs[1].checks.categorizationFilters.message || "Categorization filters must all be valid regular expressions" ) }}\n            </div>\n\n            <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n            <label class="kuiFormLabel" aria-describedby="ml_aria_description_new_job_detectors">Detectors</label>\n            <i ml-info-icon="new_job_detectors" />\n\n            <div class="euiSpacer euiSpacer--s"></div>\n\n            <div ml-job-detectors-list\n              ml-detectors="job.analysis_config.detectors"\n              ml-indices="indices"\n              ml-fields="fields"\n              ml-cat-field-name-selected="(job.analysis_config.categorization_field_name?true:false)"\n              ml-edit-mode="\'NEW\'"\n              ></div>\n            <div ng-hide="ui.validation.tabs[1].checks.detectors.valid" class="validation-error">\n              {{ ( ui.validation.tabs[1].checks.detectors.message || "At least one detector should be configured" ) }}\n            </div>\n\n            <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n            <label class="kuiFormLabel" aria-describedby="ml_aria_description_new_job_influencers">Influencers</label>\n            <i ml-info-icon="new_job_influencers" />\n            <div class="influencer-list-container">\n\n              <div ng-repeat="inf in ui.allInfluencers()" >\n                <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n                  <input class=\'kuiCheckBox\' type="checkbox" ng-checked="influencerChecked(inf)" ng-click="toggleInfluencer(inf)" />\n                  <span class=\'kuiCheckBoxLabel__text\'>{{inf}}</span>\n                </label>\n              </div>\n\n              <div class="custom-influencer">\n                <input\n                  type="text"\n                  ng-model="ui.tempCustomInfluencer"\n                  placeholder="Custom influencer"\n                  class="form-control"  />\n                <button\n                  aria-label="Add Custom Influencer"\n                  ng-click="addCustomInfluencer()"\n                  ng-disabled="ui.tempCustomInfluencer===\'\'"\n                  type="button"\n                  class="kuiButton kuiButton--primary kuiButton--small">\n                  <i aria-hidden="true" class="fa fa-plus" /> Add\n                </button>\n              </div>\n            </div>\n            <div ng-hide="ui.validation.tabs[1].checks.influencers.valid" class="validation-error">\n              {{ ( ui.validation.tabs[1].checks.influencers.message || "At least one influencer should be selected" ) }}\n            </div>\n          </div>\n        </ml-job-tab-1>\n\n\n        \x3c!-- tab 2 Data Description --\x3e\n        <ml-job-tab-2 ng-show="ui.currentTab === 2">\n          <div class="tab_contents">\n            <div class="form-group">\n              <ml-form-label label-id="new_job_data_format">Data format</ml-form-label>\n              <select\n                aria-labelledby="ml_aria_label_new_job_data_format"\n                aria-describedby="ml_aria_description_new_job_data_format"\n                ng-model="job.data_description.format"\n                ng-disabled="ui.isDatafeed"\n                ng-options="item.value as item.title for item in ui.inputDataFormat"\n                class="form-control">\n              </select>\n            </div>\n            <ml-job-delimited-options ng-show="job.data_description.format===\'delimited\'">\n              <div class="form-group">\n                <ml-form-label label-id="new_job_delimiter">Delimiter</ml-form-label>\n                <select\n                  aria-labelledby="ml_aria_label_new_job_delimiter"\n                  aria-describedby="ml_aria_description_new_job_delimiter"\n                  ng-model="ui.selectedFieldDelimiter"\n                  ng-options="item.value as item.title for item in ui.fieldDelimiterOptions"\n                  class="form-control" />\n              </div>\n              <div class="form-group">\n                <input\n                  ng-model="ui.customFieldDelimiter"\n                  ng-show="ui.selectedFieldDelimiter===\'custom\'"\n                  ng-required="job.data_description.format===\'delimited\' && ui.selectedFieldDelimiter===\'custom\'"\n                  class="form-control" />\n              </div>\n              <div class="form-group">\n                <ml-form-label label-id="new_job_quote_character">Quote character</ml-form-label>\n                <input\n                  aria-labelledby="ml_aria_label_new_job_quote_character"\n                  aria-describedby="ml_aria_description_new_job_quote_character"\n                  ng-model="job.data_description.quote_character"\n                  ng-required="job.data_description.format===\'delimited\'"\n                  placeholder=""\n                  class="form-control" />\n              </div>\n            </ml-job-delimited-options>\n\n            <div class="form-group">\n              <ml-form-label label-id="new_job_time_field">Time field</ml-form-label>\n              <input\n                aria-labelledby="ml_aria_label_new_job_time_field"\n                aria-describedby="ml_aria_description_new_job_time_field"\n                ng-model="job.data_description.time_field"\n                required\n                placeholder=""\n                class="form-control" />\n              <div ng-hide="ui.validation.tabs[2].checks.timeField.valid" class="validation-error">\n                {{ ( ui.validation.tabs[2].checks.timeField.message || "Time field should be specified" ) }}\n              </div>\n            </div>\n\n            <div class="form-group">\n              <ml-form-label label-id="new_job_time_format">Time format</ml-form-label>\n              <input\n                aria-labelledby="ml_aria_label_new_job_time_format"\n                aria-describedby="ml_aria_description_new_job_time_format"\n                ng-model="job.data_description.time_format"\n                required\n                placeholder=""\n                class="form-control" />\n              <div ng-hide="ui.validation.tabs[2].checks.timeFormat.valid" class="validation-error">\n                {{ ( ui.validation.tabs[2].checks.timeFormat.message || "Time format should be specified" ) }}\n              </div>\n              <div class="time-example">{{ ((exampleTime)?"e.g. "+ exampleTime:"") }}</div>\n            </div>\n          </div>\n        </ml-job-tab-2>\n\n        \x3c!-- tab 3 Datafeed --\x3e\n        <ml-job-tab-3 ng-show="ui.currentTab === 3">\n          <div class="tab_contents">\n            <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n              <input\n                aria-labelledby="ml_aria_label_new_job_enable_datafeed_job"\n                aria-describedby="ml_aria_description_new_job_enable_datafeed_job"\n                class=\'kuiCheckBox\'\n                ng-model="ui.isDatafeed"\n                ng-change="datafeedChange()"\n                ng-disabled="job.data_description.format!==\'json\'"\n                type="checkbox" />\n              <span class=\'kuiCheckBoxLabel__text\'>\n                <span id="ml_aria_label_new_job_enable_datafeed_job">Datafeed job</span>\n                <i ml-info-icon="new_job_enable_datafeed_job" />\n              </span>\n            </label>\n            <div class="euiSpacer euiSpacer--s"></div>\n            <div class="form-group help-pane" ng-show="job.data_description.format!==\'json\' && job.data_description.format!==undefined">\n              <small class="info">Data format must be set to \'JSON\' to enable the datafeed.</small>\n            </div>\n\n            <div ng-if="ui.isDatafeed">\n              <div class="form-group">\n                <ml-form-label label-id="new_job_datafeed_query" tooltip-append-to-body="true">Query</ml-form-label>\n                <input\n                  aria-labelledby="ml_aria_label_new_job_datafeed_query"\n                  aria-describedby="ml_aria_description_new_job_datafeed_query"\n                  ng-model="ui.datafeed.queryText"\n                  placeholder=\'{ "match_all": {}}\'\n                  class="form-control" />\n\n              </div>\n              <div class="form-group" >\n                <ml-form-label label-id="new_job_datafeed_query_delay">Query delay</ml-form-label>\n                <input\n                  aria-labelledby="ml_aria_label_new_job_datafeed_query_delay"\n                  aria-describedby="ml_aria_description_new_job_datafeed_query_delay"\n                  ng-model="ui.datafeed.queryDelayText"\n                  placeholder="{{ui.datafeed.queryDelayDefault}}"\n                  min="0"\n                  class="form-control" />\n\n              </div>\n              <div class="form-group" >\n                <ml-form-label label-id="new_job_datafeed_frequency">Frequency</ml-form-label>\n                <input\n                  aria-labelledby="ml_aria_label_new_job_datafeed_frequency"\n                  aria-describedby="ml_aria_description_new_job_datafeed_frequency"\n                  ng-model="ui.datafeed.frequencyText"\n                  placeholder="{{ui.datafeed.frequencyDefault}}"\n                  min="0"\n                  class="form-control" />\n\n              </div>\n              <div class="form-group" >\n                <ml-form-label label-id="new_job_datafeed_scrollsize" tooltip-append-to-body="true">scroll_size</ml-form-label>\n                <input\n                  aria-labelledby="ml_aria_label_new_job_datafeed_scrollsize"\n                  aria-describedby="ml_aria_description_new_job_datafeed_scrollsize"\n                  ng-model="ui.datafeed.scrollSizeText"\n                  placeholder="{{ui.datafeed.scrollSizeDefault}}"\n                  type="number"\n                  min="0"\n                  class="form-control" />\n\n              </div>\n              <div class="form-group" >\n                <div class="form-group">\n                  <label class="kuiFormLabel">Index</label>\n                  <div class="input-group">\n                  <input\n                    ng-model="ui.datafeed.indicesText"\n                    placeholder=""\n                    class="form-control"\n                    aria-describedby="index-text-status"\n                    ng-change="indexChanged()"\n                    list=\'index_datalist\' />\n                    <span class="input-group-addon" id="index-text-status">\n                      <i ng-show="ui.indexTextOk === true && ui.fieldsUpToDate === true" aria-hidden="true" style=\'color:green;\' class="fa fa-check"></i>\n                      <i ng-show="ui.indexTextOk === false || ui.fieldsUpToDate === false" aria-hidden="true" style=\'color:red;\' class="fa fa-remove"></i>\n                    </span>\n                  </div>\n                  <div ng-hide="ui.validation.tabs[3].checks.hasAccessToIndex.valid"  class="validation-error">{{ ( ui.validation.tabs[3].checks.hasAccessToIndex.message) }}</div>\n                </div>\n                <div class="form-group" ng-show="ui.fieldsUpToData === false || ui.fieldsUpToDate === false">\n                  <button\n                    ng-click="loadFields()"\n                    type="button"\n                    class="kuiButton kuiButton--primary kuiButton--small">\n                    <i aria-hidden="true" class="fa fa-refresh"></i>\n                    <span>Reload index</span>\n                  </button>\n                </div>\n\n                <div ng-show="ui.indexTextOk && ui.fieldsUpToDate === true" class="form-group">\n                  <label class="kuiFormLabel">Time-field name</label>\n                  <select\n                    ng-model="job.data_description.time_field"\n                    class="form-control">\n                    <option ng-repeat="(key, value) in dateFields">{{key}}</option>\n                  </select>\n                </div>\n\n                <div class="clearfix"></div>\n\n              </div>\n            </div>\n          </div>\n        </ml-job-tab-3>\n\n        \x3c!-- tab 4 Edit JSON --\x3e\n        <ml-job-tab-4 ng-show="ui.currentTab === 4" class="ml_json_tab">\n          <div class="tab_contents">\n            <label class="kuiFormLabel" id="ml_aria_label_new_job_json">JSON</label>\n            <textarea\n              aria-labelledby="ml_aria_label_new_job_json"\n              ng-model="ui.jsonText"\n              class="form-control ml-pre json-textarea"\n              ng-change="jsonTextChange()" >\n            </textarea>\n          </div>\n        </ml-job-tab-4>\n\n        \x3c!-- tab 5 Data preview --\x3e\n        <ml-job-tab-5 ng-show="ui.currentTab === 5" class="ml_data_preview_tab">\n          <div class="tab_contents">\n            <ml-form-label label-id="new_job_data_preview">Data preview</ml-form-label>\n            <ml-loading-indicator\n              label="Loading data preview"\n              is-loading="(ui.dataPreview === \'\')"\n            />\n            <div ng-hide="(ui.dataPreview === \'\')">\n              <textarea\n                aria-labelledby="ml_aria_label_new_job_data_preview"\n                aria-describedby="ml_aria_description_new_job_data_preview"\n                readonly\n                class="form-control ml-pre json-textarea">{{ui.dataPreview}}</textarea>\n                <div class="note">\n                  Preview returns the content of the _source field only.\n                </div>\n            </div>\n          </div>\n        </ml-job-tab-5>\n\n        <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n        <div class="euiFlexGroup euiFlexGroup--gutterSmall euiFlexGroup--alignItemsCenter euiFlexGroup--responsive">\n          <div class="euiFlexItem euiFlexItem--flexGrowZero">\n            <ml-validate-job\n              fields="fields"\n              fill="false"\n              get-job-config="getJobConfig"\n              is-current-job-config="isCurrentJobConfig"\n              is-disabled="(saveLock === true)"\n              ng-show="jobState === JOB_STATE.NOT_STARTED"\n            />\n          </div>\n          <div class="euiFlexItem euiFlexItem--flexGrowZero">\n            <button\n              ng-click="save()"\n              ng-disabled="(saveLock === true)"\n              class="euiButton euiButton--primary euiButton--small euiButton--fill"\n              aria-label="Save">\n              <span class="euiButton__content">\n                <span>Save</span>\n              </span>\n            </button>\n          </div>\n          <div class="euiFlexItem euiFlexItem--flexGrowZero">\n            <button\n              ng-click="cancel()"\n              ng-disabled="(saveLock === true)"\n              class="euiButton euiButton--primary euiButton--small euiButton--fill"\n              aria-label="Cancel">\n              <span class="euiButton__content">\n                <span>Cancel</span>\n              </span>\n            </button>\n          </div>\n        </div>\n\n      </div>\n  </div>\n</ml-new-job>\n'},3296:function(module,exports){module.exports='<div class="save-status-modal">\n  \x3c!-- <ml-message-bar ></ml-message-bar> --\x3e\n  <h3 class="euiTitle euiTitle--small">Saving new job</h3>\n  <div class="status-item">Saving job...\n  \t<i ng-show="pscope.ui.saveStatus.job === -1" aria-hidden="true" style="color:red;" class="fa fa-remove"></i>\n  \t<i ng-show="pscope.ui.saveStatus.job === 1" aria-hidden="true" class="fa fa-spinner fa-spin"></i>\n  \t<i ng-show="pscope.ui.saveStatus.job === 2" aria-hidden="true" style="color:green;" class="fa fa-check"></i>\n  </div>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n  <button\n    ng-show="(pscope.ui.saveStatus.job === 2 && pscope.ui.isDatafeed)"\n    ng-disabled="pscope.saveLock"\n    ng-click="openDatafeed();"\n    class="kuiButton kuiButton--primary"\n    aria-label="Back">\n      Start datafeed\n  </button>\n\n  <button\n  \tng-disabled="pscope.saveLock"\n    ng-click="close();"\n    class="kuiButton kuiButton--primary"\n    aria-label="Back">\n    \tClose\n  </button>\n</div>\n'},3297:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3298),__webpack_require__(3299)},3298:function(module,exports){},3299:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2).uiModules.get("apps/ml").controller("MlSaveStatusModal",function($scope,$location,$modalInstance,params){$scope.pscope=params.pscope,$scope.ui={showTimepicker:!1},$scope.openDatafeed=function(){$location.path("jobs"),$modalInstance.close(),params.openDatafeed()},$scope.close=function(){2===$scope.pscope.ui.saveStatus.job&&$location.path("jobs"),$scope.pscope.ui.saveStatus.job=0,$modalInstance.close()}})},3300:function(module,exports,__webpack_require__){"use strict";__webpack_require__(183);var _field_select=__webpack_require__(3301);__webpack_require__(2).uiModules.get("apps/ml",["react"]).directive("fieldSelect",function(reactDirective){return reactDirective(_field_select.FieldSelect)})},3301:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.FieldSelect=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_propTypes=__webpack_require__(20),_propTypes2=_interopRequireDefault(_propTypes),_react=__webpack_require__(0),_react2=_interopRequireDefault(_react),_lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_reactSelect=__webpack_require__(50),_reactSelect2=_interopRequireDefault(_reactSelect);__webpack_require__(3307),(exports.FieldSelect=function(_Component){function FieldSelect(){return _classCallCheck(this,FieldSelect),_possibleConstructorReturn(this,(FieldSelect.__proto__||Object.getPrototypeOf(FieldSelect)).apply(this,arguments))}return _inherits(FieldSelect,_Component),_createClass(FieldSelect,[{key:"render",value:function(){function change(selection){var val=selection?selection.value:"";onChange(val,field)}var _props=this.props,labelId=_props.labelId,onChange=_props.onChange,value=_props.value,options=_props.options,field=_props.field,placeholder=_props.placeholder;return _react2.default.createElement(_reactSelect2.default,{"aria-describedby":"ml_aria_description_"+labelId,"aria-labelledby":"ml_aria_label_"+labelId,placeholder:placeholder,options:function(){var ops=[];return _lodash2.default.each(options,function(op,key){ops.push({label:key,value:key})}),ops}(),value:value,onChange:change})}}]),FieldSelect}(_react.Component)).propTypes={labelId:_propTypes2.default.string,onChange:_propTypes2.default.func,value:_propTypes2.default.string,options:_propTypes2.default.object,field:_propTypes2.default.string,placeholder:_propTypes2.default.string}},3307:function(module,exports){},3308:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3309)},3309:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3310),__webpack_require__(3311),__webpack_require__(3392),__webpack_require__(3393),__webpack_require__(374),__webpack_require__(306),__webpack_require__(687),__webpack_require__(688),__webpack_require__(3397),__webpack_require__(302),__webpack_require__(480),__webpack_require__(307)},3310:function(module,exports){},3311:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash);__webpack_require__(303);var _index=__webpack_require__(259),_validation_utils=__webpack_require__(476),_parse_interval=__webpack_require__(166),_datemath=__webpack_require__(81),_datemath2=_interopRequireDefault(_datemath),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular),_routes=__webpack_require__(11),_routes2=_interopRequireDefault(_routes),_job_utils=__webpack_require__(57),_check_license=__webpack_require__(101),_check_privilege=__webpack_require__(93),_ml_time_buckets=__webpack_require__(169),_filter_agg_types=__webpack_require__(682),_validate_job=__webpack_require__(683),_adjust_interval=__webpack_require__(684),_new_job_utils=__webpack_require__(192),_app_state_settings=__webpack_require__(685),_create_fields=__webpack_require__(686),_change_job_id_case=__webpack_require__(1178),_states=__webpack_require__(373),_index_utils=__webpack_require__(132),_check_ml_nodes=__webpack_require__(108),_new_job_defaults=__webpack_require__(258),_create_job=__webpack_require__(3391),_create_job2=_interopRequireDefault(_create_job),_modules=__webpack_require__(2);_routes2.default.when("/jobs/new_job/simple/single_metric",{template:_create_job2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.getIndexPatternWithRoute,savedSearch:_index_utils.getSavedSearchWithRoute,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults}}),_modules.uiModules.get("apps/ml").controller("MlCreateSingleMetricJob",function($scope,$route,$filter,$q,timefilter,Private,mlJobService,mlSingleMetricJobService,mlMessageBarService,mlFullTimeRangeSelectorService,AppState){function setTime(){$scope.ui.bucketSpanValid=!0,$scope.formConfig.start=_datemath2.default.parse(timefilter.time.from).valueOf(),$scope.formConfig.end=_datemath2.default.parse(timefilter.time.to).valueOf(),$scope.formConfig.format="epoch_millis";var bucketSpanInterval=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan);null!==bucketSpanInterval&&0!==bucketSpanInterval.asMilliseconds()||($scope.ui.bucketSpanValid=!1);var bounds=timefilter.getActiveBounds();$scope.formConfig.chartInterval=new MlTimeBuckets,$scope.formConfig.chartInterval.setBarTarget(BAR_TARGET),$scope.formConfig.chartInterval.setMaxBars(MAX_BARS),$scope.formConfig.chartInterval.setInterval("auto"),$scope.formConfig.chartInterval.setBounds(bounds),(0,_adjust_interval.adjustIntervalDisplayed)($scope.formConfig),$scope.ui.isFormValid(),$scope.ui.dirty=!0}function loadFields(){var agg=$scope.formConfig.agg,fields=[];agg.type.params.forEach(function(param){"field"===param.name&&(fields=(0,_create_fields.getIndexedFields)(indexPattern,param.filterFieldTypes.split(",")))}),$scope.ui.fields=[],_lodash2.default.each(fields,function(field,i){var id=(0,_job_utils.getSafeAggregationName)(field.displayName,i),f={id:id,name:field.displayName,tooltip:field.displayName,agg:agg,mlType:field.mlType};$scope.ui.fields.push(f)}),(1===$scope.ui.fields.length||null===$scope.formConfig.field&&"cardinality"===agg.type.name)&&($scope.formConfig.field=$scope.ui.fields[0])}function loadCharts(){function run(){refreshCounter++,reloadSwimlane().then(function(){if(!1===forceStop&&$scope.chartData.percentComplete<100?$scope.jobState===_states.JOB_STATE.STOPPING?$scope.jobState=_states.JOB_STATE.STOPPING:$scope.jobState=_states.JOB_STATE.RUNNING:$scope.jobState=_states.JOB_STATE.FINISHED,ignoreModel)jobCheck();else{var fullModelRefresh=!1;_lodash2.default.each(jobProgressChecks,function(c,i){!1===jobProgressChecks[i]&&$scope.chartData.percentComplete>=i&&(jobProgressChecks[i]=!0,fullModelRefresh=!0)}),fullModelRefresh&&($scope.chartData.model=[]),reloadModelChart().catch(function(){refreshCounter%10==0&&(console.log("Model has failed to load 10 times. Stop trying to load it."),ignoreModel=!0)}).finally(function(){jobCheck()})}})}var forceStop=globalForceStop;refreshCounter>=20-refreshInterval/REFRESH_INTERVAL_MS?(refreshCounter=0,mlSingleMetricJobService.checkDatafeedState($scope.formConfig).then(function(state){"stopped"===state&&(console.log("Stopping poll because datafeed state is: "+state),$scope.$broadcast("render-results"),forceStop=!0),run()})):run()}function jobCheck(){var isLastRun=!1;$scope.jobState===_states.JOB_STATE.RUNNING||$scope.jobState===_states.JOB_STATE.STOPPING?(refreshInterval=adjustRefreshInterval($scope.chartData.loadingDifference,refreshInterval),_lodash2.default.delay(loadCharts,refreshInterval)):($scope.chartData.percentComplete=100,isLastRun=!0),isLastRun&&!ignoreModel?($scope.chartData.model=[],reloadModelChart().finally(function(){$scope.chartData.percentComplete=100,$scope.$broadcast("render-results")})):$scope.$broadcast("render-results")}function reloadModelChart(){return mlSingleMetricJobService.loadModelData($scope.formConfig)}function reloadSwimlane(){return mlSingleMetricJobService.loadSwimlaneData($scope.formConfig)}function adjustRefreshInterval(loadingDifference,currentInterval){var interval=currentInterval;return interval<1e4&&(loadingDifference<MAX_BUCKET_DIFF?interval+=100:interval-100>=REFRESH_INTERVAL_MS&&(interval-=100)),interval}timefilter.enableTimeRangeSelector(),timefilter.disableAutoRefreshSelector();var msgs=mlMessageBarService,MlTimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider),stateDefaults={mlJobSettings:{}},appState=new AppState(stateDefaults),aggTypes=Private(_index.AggTypesIndexProvider);$scope.index=$route.current.params.index,$scope.chartData=mlSingleMetricJobService.chartData,$scope.changeJobIDCase=_change_job_id_case.changeJobIDCase,$scope.addNewJobToRecentlyAccessed=_new_job_utils.addNewJobToRecentlyAccessed;var PAGE_WIDTH=_angular2.default.element(".single-metric-job-container").width(),BAR_TARGET=PAGE_WIDTH>2e3?1e3:PAGE_WIDTH/2,MAX_BARS=BAR_TARGET+BAR_TARGET/100*100,REFRESH_INTERVAL_MS=100,MAX_BUCKET_DIFF=3,jobProgressChecks={25:!1,50:!1,75:!1},refreshCounter=0;$scope.JOB_STATE=_states.JOB_STATE,$scope.jobState=$scope.JOB_STATE.NOT_STARTED,$scope.CHART_STATE=_states.CHART_STATE,$scope.chartState=_states.CHART_STATE.NOT_STARTED;var globalForceStop=!1,_createSearchItems=(0,_new_job_utils.createSearchItems)($route),indexPattern=_createSearchItems.indexPattern,savedSearch=_createSearchItems.savedSearch,query=_createSearchItems.query,filters=_createSearchItems.filters,combinedQuery=_createSearchItems.combinedQuery;(0,_index_utils.timeBasedIndexCheck)(indexPattern,!0);var pageTitle=void 0!==savedSearch.id?"saved search "+savedSearch.title:"index pattern "+indexPattern.title;$scope.ui={indexPattern:indexPattern,pageTitle:pageTitle,showJobInput:!1,showJobFinished:!1,dirty:!0,formValid:!1,bucketSpanValid:!0,bucketSpanEstimator:{status:0,message:""},aggTypeOptions:(0,_filter_agg_types.filterAggTypes)(aggTypes.byType.metrics),fields:[],timeFields:[],intervals:[{title:"Auto",value:"auto"},{title:"Millisecond",value:"ms"},{title:"Second",value:"s"},{title:"Minute",value:"m"},{title:"Hourly",value:"h"},{title:"Daily",value:"d"},{title:"Weekly",value:"w"},{title:"Monthly",value:"M"},{title:"Yearly",value:"y"},{title:"Custom",value:"custom"}],chartHeight:310,showAdvanced:!1,resultsUrl:"",validation:{checks:{jobId:{valid:!0},groupIds:{valid:!0},modelMemoryLimit:{valid:!0}}},isCountOrSum:!1},$scope.formConfig={agg:{type:void 0},field:null,bucketSpan:"15m",chartInterval:void 0,resultsIntervalSeconds:void 0,start:0,end:0,timeField:indexPattern.timeFieldName,indexPattern:void 0,query:query,filters:filters,combinedQuery:combinedQuery,jobId:void 0,description:void 0,jobGroups:[],useDedicatedIndex:!1,isSparseData:!1,modelMemoryLimit:"10MB"},$scope.bucketSpanEstimatorExportedFunctions={},$scope.aggChange=function(){loadFields(),$scope.ui.isFormValid(),$scope.ui.dirty=!0,$scope.ui.isCountOrSum="count"===$scope.formConfig.agg.type.dslName||"sum"===$scope.formConfig.agg.type.dslName,"count"===$scope.formConfig.agg.type.dslName&&($scope.formConfig.field=null)},$scope.fieldChange=function(){$scope.ui.isFormValid(),$scope.ui.dirty=!0},$scope.bucketSpanFieldChange=function(){$scope.ui.isFormValid(),$scope.ui.bucketSpanEstimator.status=0,$scope.ui.bucketSpanEstimator.message="",$scope.ui.bucketSpanValid=!0;var bucketSpanInterval=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan);null!==bucketSpanInterval&&0!==bucketSpanInterval.asMilliseconds()||($scope.ui.bucketSpanValid=!1)},$scope.ui.isFormValid=function(){return void 0===$scope.formConfig.agg.type||void 0===$scope.formConfig.timeField?$scope.ui.formValid=!1:$scope.ui.formValid=!0,$scope.ui.formValid},$scope.loadVis=function(){setTime(),$scope.ui.isFormValid(),$scope.ui.formValid&&($scope.ui.showJobInput=!0,$scope.ui.showJobFinished=!1,$scope.formConfig.indexPattern=indexPattern,$scope.ui.dirty=!1,$scope.chartState=_states.CHART_STATE.LOADING,mlSingleMetricJobService.getLineChartResults($scope.formConfig).then(function(resp){$scope.chartState=resp.totalResults?_states.CHART_STATE.LOADED:_states.CHART_STATE.NO_RESULTS}).catch(function(resp){msgs.error(resp.message),$scope.chartState=_states.CHART_STATE.NO_RESULTS}).finally(function(){$scope.$broadcast("render")}))};var ignoreModel=!1,refreshInterval=REFRESH_INTERVAL_MS;$scope.createJob=function(){function saveNewDatafeed(job,startDatafeedAfterSave){mlJobService.saveNewDatafeed(job.datafeed_config,job.job_id).then(function(){startDatafeedAfterSave&&mlSingleMetricJobService.startDatafeed($scope.formConfig).then(function(){$scope.jobState=_states.JOB_STATE.RUNNING,refreshCounter=0,ignoreModel=!1,refreshInterval=REFRESH_INTERVAL_MS,$scope.formConfig.resultsIntervalSeconds=$scope.formConfig.chartInterval.getInterval().asSeconds();var bucketSpanSeconds=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan).asSeconds();$scope.formConfig.resultsIntervalSeconds<bucketSpanSeconds&&($scope.formConfig.resultsIntervalSeconds=bucketSpanSeconds),$scope.resultsUrl=(0,_new_job_utils.createResultsUrl)([$scope.formConfig.jobId],$scope.formConfig.start,$scope.formConfig.end,"timeseriesexplorer"),loadCharts()}).catch(function(resp){msgs.error("Could not start datafeed: ",resp)})}).catch(function(resp){msgs.error("Save datafeed failed: ",resp)})}var tempJob=mlSingleMetricJobService.getJobFromConfig($scope.formConfig);(0,_validate_job.validateJob)(tempJob,$scope.ui.validation.checks)?(msgs.clear(),mlSingleMetricJobService.createJob($scope.formConfig).then(function(job){mlJobService.openJob(job.job_id).then(function(){saveNewDatafeed(job,!0)}).catch(function(resp){msgs.error("Could not open job: ",resp),msgs.error("Job created, creating datafeed anyway"),saveNewDatafeed(job,!1)})}).catch(function(resp){msgs.error("Save failed: ",resp.resp)})):!1===$scope.ui.validation.checks.modelMemoryLimit.valid&&($scope.ui.showAdvanced=!0)},(0,_validation_utils.addJobValidationMethods)($scope,mlSingleMetricJobService),$scope.resetJob=function(){$scope.jobState=_states.JOB_STATE.NOT_STARTED,_angular2.default.element(".model-chart, .swimlane").css("opacity",0),_lodash2.default.each(jobProgressChecks,function(c,i){jobProgressChecks[i]=!1}),window.setTimeout(function(){$scope.ui.showJobInput=!0,$scope.loadVis()},500)},$scope.stopJob=function(){$scope.jobState=_states.JOB_STATE.STOPPING,mlSingleMetricJobService.stopDatafeed($scope.formConfig)},$scope.setFullTimeRange=function(){mlFullTimeRangeSelectorService.setFullTimeRange($scope.ui.indexPattern,$scope.formConfig.combinedQuery)},$scope.$listen(timefilter,"fetch",$scope.loadVis),$scope.$on("$destroy",function(){globalForceStop=!0}),$scope.$evalAsync(function(){(0,_app_state_settings.populateAppStateSettings)(appState,$scope)})})},3389:function(module,exports,__webpack_require__){"use strict";function TimeBucketsCalcAutoIntervalProvider(){function find(rules,check,last){function pick(buckets,duration){for(var target=duration/buckets,lastResp=void 0,i=0;i<rules.length;i++){var rule=rules[i],resp=check(rule[0],rule[1],target);if(null==resp){if(!last)continue;if(lastResp)return lastResp;break}if(!last)return resp;lastResp=resp}var ms=Math.max(Math.floor(target),1);return _moment2.default.duration(ms,"ms")}return function(buckets,duration){var interval=pick(buckets,duration);if(interval)return _moment2.default.duration(interval._data)}}var roundingRules=[[d(500,"ms"),d(100,"ms")],[d(5,"second"),d(1,"second")],[d(10,"second"),d(5,"second")],[d(15,"second"),d(10,"second")],[d(30,"second"),d(15,"second")],[d(1,"minute"),d(30,"second")],[d(5,"minute"),d(1,"minute")],[d(10,"minute"),d(5,"minute")],[d(15,"minute"),d(10,"minute")],[d(30,"minute"),d(10,"minute")],[d(1,"hour"),d(30,"minute")],[d(2,"hour"),d(1,"hour")],[d(4,"hour"),d(2,"hour")],[d(6,"hour"),d(4,"hour")],[d(8,"hour"),d(6,"hour")],[d(12,"hour"),d(8,"hour")],[d(24,"hour"),d(12,"hour")],[d(2,"d"),d(1,"d")],[d(4,"d"),d(2,"d")],[d(1,"week"),d(4,"d")],[d(1,"month"),d(1,"week")],[d(1,"year"),d(1,"month")],[1/0,d(1,"year")]],revRoundingRules=roundingRules.slice(0).reverse();return{near:find(revRoundingRules,function(upperBound,lowerBound,target){if(upperBound>target){if(upperBound===1/0)return lowerBound;var boundMs=upperBound.asMilliseconds(),intervalMs=lowerBound.asMilliseconds();return Math.abs(boundMs-target)<=Math.abs(intervalMs)?upperBound:lowerBound}},!0),lessThan:find(revRoundingRules,function(upperBound,lowerBound,target){if(lowerBound<target)return upperBound!==1/0?upperBound:lowerBound}),atLeast:find(revRoundingRules,function(upperBound,lowerBound,target){if(lowerBound<=target)return lowerBound})}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.TimeBucketsCalcAutoIntervalProvider=TimeBucketsCalcAutoIntervalProvider;var _moment=__webpack_require__(9),_moment2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_moment),d=_moment2.default.duration},3390:function(module,exports,__webpack_require__){"use strict";function describeConst(val){return{writable:!1,enumerable:!1,configurable:!1,value:val}}function inherits(SubClass,SuperClass){var prototype=Object.create(SuperClass.prototype,{constructor:describeConst(SubClass),superConstructor:describeConst(SuperClass)});return Object.defineProperties(SubClass,{prototype:describeConst(prototype),Super:describeConst(SuperClass)}),SubClass}Object.defineProperty(exports,"__esModule",{value:!0}),exports.inherits=inherits},3391:function(module,exports){module.exports='<ml-nav-menu name="new_job_single_metric"></ml-nav-menu>\n<ml-new-job-single-metric>\n  <ml-message-bar></ml-message-bar>\n  <div ng-controller="MlCreateSingleMetricJob" class="single-metric-job-container">\n    <div class="row">\n      <div class="col-md-6">\n        <h1 class="euiTitle euiTitle--large">New job from {{ui.pageTitle}}</h1>\n      </div>\n      <div class="col-md-6">\n        <div class="pull-right">\n          <span style="font-size:10px;" ng-show="formConfig.chartInterval !== undefined">Chart interval: {{formConfig.chartInterval.getInterval().expression}}</span>\n          <ml-full-time-range-selector\n            disabled=\'(jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)\'\n            index-pattern=\'ui.indexPattern\'\n            query=\'formConfig.combinedQuery\'\n          ></ml-full-time-range-selector>\n        </div>\n      </div>\n    </div>\n\n    <div class="euiSpacer euiSpacer--l"></div>\n\n    <div class="row form-controls">\n\n      <div class="form-group col-md-4">\n        <ml-form-label label-id="new_job_detector_function">Aggregation</ml-form-label>\n        <ui-select\n          aria-labelledby="ml_aria_label_new_job_detector_function"\n          aria-describedby="ml_aria_description_new_job_detector_function"\n          ng-model="formConfig.agg.type"\n          name="agg-type"\n          required\n          on-select="aggChange()"\n          ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n          class=""\n        >\n          <ui-select-match placeholder="Select an aggregation">\n            {{$select.selected.title}}\n          </ui-select-match>\n          <ui-select-choices\n            repeat="agg in ui.aggTypeOptions | filter: { title: $select.search }"\n          >\n            <div ng-bind-html="agg.title | highlight: $select.search"></div>\n          </ui-select-choices>\n        </ui-select>\n      </div>\n\n      <div class="form-group col-md-4">\n        <ml-form-label label-id="new_job_detector_fieldname_subset" tooltip-append-to-body="true">Field</ml-form-label>\n        <ui-select\n          aria-labelledby="ml_aria_label_new_job_detector_fieldname_subset"\n          aria-describedby="ml_aria_description_new_job_detector_fieldname_subset"\n          ng-model="formConfig.field"\n          name="field-type"\n          required\n          on-select="fieldChange()"\n          ng-disabled="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n          class=""\n        >\n          <ui-select-match placeholder="Select a field">\n            <ml-field-type-icon type="$select.selected.mlType"></ml-field-type-icon>{{$select.selected.name}}\n          </ui-select-match>\n          <ui-select-choices repeat="field in ui.fields | filter: { name: $select.search }" group-by="\'mlType\'">\n            <ml-field-type-icon type="field.mlType"></ml-field-type-icon>\n            <span class="select-item" ng-bind-html="field.name | highlight: $select.search"></span>\n          </ui-select-choices>\n        </ui-select>\n      </div>\n\n      <div class="form-group col-md-4">\n        <ml-form-label label-id="new_job_bucketspan">Bucket span</ml-form-label>\n        <div class=\'bucket-span-container\'>\n          <input\n            aria-labelledby="ml_aria_label_new_job_bucketspan"\n            aria-describedby="ml_aria_description_new_job_bucketspan"\n            ng-model="formConfig.bucketSpan"\n            required\n            placeholder={{formConfig-bucketSpan}}\n            ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED || ui.bucketSpanEstimator.status===1"\n            ng-change="bucketSpanFieldChange()"\n            ng-class=\'{"ng-invalid": (!ui.bucketSpanValid)}\'\n            class="form-control lowercase bucket-span-input" />\n\n          <ml-bucket-span-estimator\n            form-config=\'formConfig\'\n            job-state-wrapper=\'{jobState:jobState}\'\n            job-state=\'JOB_STATE\'\n            ui=\'ui\'\n            exported-functions=\'bucketSpanEstimatorExportedFunctions\'>\n          </ml-bucket-span-estimator>\n\n          <button class="euiButton euiButton--primary euiButton--small euiButton--fill navbar-btn-link btn-load-vis"\n            ng-click="loadVis()"\n            ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED" >\n            <i class="fa fa-play" ></i>\n          </button>\n        </div>\n        <div ng-hide="ui.bucketSpanValid" class="validation-error">Invalid interval format</div>\n        <div ng-show="ui.bucketSpanEstimator.status===-1" class="validation-error">{{ui.bucketSpanEstimator.message}}</div>\n      </div>\n    </div>\n    <div class="row form-controls" ng-show=\'ui.isCountOrSum\'>\n      <div class="col-md-12">\n        <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n          <input type="checkbox"\n            aria-labelledby="ml_aria_label_new_job_sparsedata"\n            aria-describedby="ml_aria_description_new_job_sparsedata"\n            class=\'kuiCheckBox\'\n            ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n            ng-model="formConfig.isSparseData" />\n          <span id="ml_aria_label_new_job_sparsedata" class=\'kuiCheckBoxLabel__text\'>Sparse data</span>\n          <i ml-info-icon="new_job_sparsedata" />\n        </label>\n      </div>\n    </div>\n\n    <div ng-show="ui.showJobInput">\n      <div class=\'chart-container\'>\n        <ml-single-metric-job-chart\n          chart-data="chartData"\n          chart-height=\'ui.chartHeight\'\n          chart-ticks-margin="chartData.chartTicksMargin">\n        </ml-single-metric-job-chart>\n\n        <div ng-show="chartState === CHART_STATE.NOT_STARTED || chartState === CHART_STATE.LOADING || chartState === CHART_STATE.NO_RESULTS"\n          class=\'chart-loader\'\n          style=\'height: {{ui.chartHeight}}px; margin-top: -{{ui.chartHeight + 32}}px; margin-left: {{chartData.chartTicksMargin.width - 1}}px;\'>\n            <div class=\'status-label\' ng-show="chartState === CHART_STATE.NOT_STARTED"></div>\n            <div class=\'status-label\' ng-show="chartState === CHART_STATE.LOADING">\n              <h2 class="euiTitle euiTitle"><i class=\'fa fa-spinner fa-spin\'></i></h2>\n            </div>\n            <div class=\'status-label\' ng-show="chartState === CHART_STATE.NO_RESULTS">\n              <div class=\'no-results\'>\n                <h4 class="euiTitle euiTitle--small"><i class="fa fa-info-circle"></i> No results found</h4>\n                <span>Consider using the <a ng-click="setFullTimeRange()">full {{ui.indexPattern.title}} data</a></span>\n              </div>\n            </div>\n        </div>\n      </div>\n    </div>\n\n    <div ng-show="ui.showJobInput && (jobState === JOB_STATE.NOT_STARTED || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING)">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_id" tooltip-append-to-body="true">Name</ml-form-label>\n        <input\n          aria-labelledby="ml_aria_label_new_job_id"\n          aria-describedby="ml_aria_description_new_job_id"\n          id="job-id-input"\n          ng-model="formConfig.jobId"\n          required\n          placeholder="Job ID"\n          ng-change="changeJobIDCase(formConfig)"\n          ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n          class="form-control lowercase" />\n          <div ng-hide="ui.validation.checks.jobId.valid" class="validation-error">{{ ( ui.validation.checks.jobId.message || "Enter a name for the job" ) }}</div>\n      </div>\n\n      <div class="form-group">\n        <ml-form-label label-id="new_job_description">Description</ml-form-label>\n        <input\n          aria-labelledby="ml_aria_label_new_job_description"\n          aria-describedby="ml_aria_description_new_job_description"\n          ng-model="formConfig.description"\n          placeholder="Job description"\n          ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n          class="form-control" />\n      </div>\n\n      <div class="form-group">\n        <ml-form-label label-id="new_job_group">Job Groups</ml-form-label>\n        <ml-job-group-select\n          aria-labelledby="ml_aria_label_new_job_group"\n          aria-describedby="ml_aria_description_new_job_group"\n          job-groups=\'formConfig.jobGroups\'\n          disabled=\'(jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)\' />\n        <div ng-hide="ui.validation.checks.groupIds.valid" class="validation-error">{{ ui.validation.checks.groupIds.message }}</div>\n      </div>\n\n      <div class="form-group">\n        <div ng-click="ui.showAdvanced = (!ui.showAdvanced || formConfig.useDedicatedIndex)" class="advanced-button-container">\n          <button\n            aria-label="{{ ui.showAdvanced ? \'Hide Advanced\' : \'Show Advanced\' }}"\n            aria-describedby="ml_aria_description_new_job_advanced_settings"\n            type="button"\n            ng-disabled="formConfig.useDedicatedIndex"\n            class="kuiButton kuiButton--small kuiButton--hollow advanced-button">\n            <i aria-hidden="true" ng-class="{ \'fa-caret-down\': ui.showAdvanced, \'fa-caret-right\': !ui.showAdvanced }" class="fa"></i>\n          </button>\n          <label>Advanced</label><i ml-info-icon="new_job_advanced_settings" />\n        </div>\n        <div class=\'advanced-group\' ng-show="ui.showAdvanced">\n          <div class="form-group">\n            <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n              <input type="checkbox"\n                aria-labelledby="ml_aria_label_new_job_dedicated_index"\n                aria-describedby="ml_aria_description_new_job_dedicated_index"\n                class=\'kuiCheckBox\'\n                ng-model="formConfig.useDedicatedIndex" />\n              <span class=\'kuiCheckBoxLabel__text\'>\n                <span id="ml_aria_label_new_job_dedicated_index">Use dedicated index</span>\n                <i ml-info-icon="new_job_dedicated_index" />\n              </span>\n            </label>\n          </div>\n          <div class="form-group">\n            <label class=\'kuiFormLabel kuiVerticalRhythm\'>\n              <span id="ml_aria_label_new_job_model_memory_limit">\n                Model memory limit\n              </span>\n              <i ml-info-icon="new_job_model_memory_limit" />\n            </label>\n            <div></div>\n            <input\n              aria-labelledby="ml_aria_label_new_job_model_memory_limit"\n              aria-describedby="ml_aria_description_new_job_model_memory_limit"\n              type="text"\n              ng-model=\'formConfig.modelMemoryLimit\'\n              class="kuiTextInput kuiTextInput--large" />\n            <div ng-hide="ui.validation.checks.modelMemoryLimit.valid" class="validation-error">{{ ui.validation.checks.modelMemoryLimit.message }}</div>\n          </div>\n        </div>\n      </div>\n\n      <div class="euiFlexGroup euiFlexGroup--gutterSmall euiFlexGroup--alignItemsCenter euiFlexGroup--responsive">\n        <div class="euiFlexItem euiFlexItem--flexGrowZero">\n          <ml-validate-job\n            get-duration="getDuration"\n            get-job-config="getJobConfig"\n            fill="false"\n            is-current-job-config="isCurrentJobConfig"\n            is-disabled=\'ui.formValid === false || ui.dirty === true || formConfig.jobId === undefined || ui.bucketSpanValid === false\'\n            ng-show="jobState === JOB_STATE.NOT_STARTED"\n          />\n        </div>\n        <div class="euiFlexItem euiFlexItem--flexGrowZero">\n          <button\n            aria-label="Create Job"\n            ng-click="createJob()"\n            type="button"\n            ng-show="jobState === JOB_STATE.NOT_STARTED"\n            ng-disabled=\'ui.formValid === false || ui.dirty === true || formConfig.jobId === undefined || ui.bucketSpanValid === false\'\n            class="euiButton euiButton--primary euiButton--small euiButton--fill">\n            <span class="euiButton__content">\n              Create Job\n            </span>\n          </button>\n        </div>\n      </div>\n\n      <div class=\'job-state-info\' ng-show="jobState === JOB_STATE.RUNNING">Analysis running <i class=\'fa fa-spinner fa-spin\'></i></div>\n      <div class=\'job-state-info\' ng-show="jobState === JOB_STATE.STOPPING">Analysis stopping <i class=\'fa fa-spinner fa-spin\'></i></div>\n\n      <button\n        aria-label="Stop Job"\n        ng-click="stopJob()"\n        type="button"\n        ng-show="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING"\n        ng-disabled="jobState === JOB_STATE.STOPPING"\n        class="euiButton euiButton--danger euiButton--small">\n        <span class="euiButton__content">\n          {{(jobState === JOB_STATE.STOPPING) ? \'Analysis stopping\' : \'Stop analysis\' }}\n        </span>\n      </button>\n\n      <a\n        href=\'{{resultsUrl}}\'\n        ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n        aria-label="View Results"\n        ng-show="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING"\n        class="euiButton euiButton--primary euiButton--small euiButton--fill">\n        <span class="euiButton__content">\n          View Results\n        </span>\n      </a>\n\n    </div>\n    <div ng-show="jobState === JOB_STATE.FINISHED">\n      <h3 class="euiTitle euiTitle--large">Job {{formConfig.jobId }} created\n        <i style="color:green;" class="fa fa-check" aria-label="Saved"></i>\n      </h3>\n      <div class="euiSpacer euiSpacer--m"></div>\n\n      <button\n        aria-label="Reset"\n        ng-click="resetJob()"\n        type="button"\n        class="euiButton euiButton--primary euiButton--small euiButton--fill">\n        <span class="euiButton__content">\n          Reset\n        </span>\n      </button>\n      <a\n        href=\'{{resultsUrl}}\'\n        ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n        aria-label="View Results"\n        class="euiButton euiButton--primary euiButton--small euiButton--fill">\n        <span class="euiButton__content">\n          View Results\n        </span>\n      </a>\n\n    </div>\n    <div ng-if=\'jobState === JOB_STATE.FINISHED\'>\n      <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n      <ml-post-save-options\n        job-id=\'formConfig.jobId\'\n        bucket-span=\'formConfig.bucketSpan\'\n        include-influencers=\'false\'\n      ></ml-post-save-options>\n    </div>\n  </div>\n</ml-new-job-single-metric>\n'},3392:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular);__webpack_require__(181);var _parse_interval=__webpack_require__(107),_job_utils=__webpack_require__(57),_string_utils=__webpack_require__(43);__webpack_require__(2).uiModules.get("apps/ml").service("mlSingleMetricJobService",function($q,es,timefilter,Private,mlFieldFormatService,mlJobService,mlResultsService){function processLineChartResults(data){var scale=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,lineData=[];return _lodash2.default.each(data,function(dataForTime,t){var time=+t,date=new Date(time);lineData.push({date:date,time:time,lower:dataForTime.modelLower*scale,value:dataForTime.actual,upper:dataForTime.modelUpper*scale})}),_lodash2.default.sortBy(lineData,"time")}function processSwimlaneResults(bucketScoreData,init){var swimlaneData=[];return _lodash2.default.each(bucketScoreData,function(value,t){var time=+t,date=new Date(time);value=init?0:value,swimlaneData.push({date:date,time:time,value:value,color:""})}),swimlaneData}function getSearchJsonFromConfig(formConfig){var interval=formConfig.chartInterval.getInterval().asMilliseconds()+"ms",query=_lodash2.default.cloneDeep(formConfig.combinedQuery),json={index:formConfig.indexPattern.title,size:0,body:{query:{},aggs:{times:{date_histogram:{field:formConfig.timeField,interval:interval,min_doc_count:0,extended_bounds:{min:formConfig.start,max:formConfig.end}}}}}};return query.bool.must.push({range:_defineProperty({},formConfig.timeField,{gte:formConfig.start,lte:formConfig.end,format:formConfig.format})}),json.body.query=query,null!==formConfig.field&&(json.body.aggs.times.aggs={field_value:_defineProperty({},formConfig.agg.type.dslName,{field:formConfig.field.name})}),json}function createJobForSaving(job){var newJob=_angular2.default.copy(job);return delete newJob.datafeed_config,newJob}this.chartData={line:[],model:[],swimlane:[],hasBounds:!1,percentComplete:0,highestValue:0,chartTicksMargin:{width:30},totalResults:0},this.job={},this.getLineChartResults=function(formConfig){var _this=this,deferred=$q.defer();this.chartData.line=[],this.chartData.model=[],this.chartData.swimlane=[],this.chartData.hasBounds=!1,this.chartData.percentComplete=0,this.chartData.loadingDifference=0,this.chartData.eventRateHighestValue=0,this.chartData.totalResults=0;var aggType=formConfig.agg.type.dslName;formConfig.field&&formConfig.field.id?this.chartData.fieldFormat=mlFieldFormatService.getFieldFormatFromIndexPattern(formConfig.indexPattern,formConfig.field.id,aggType):delete this.chartData.fieldFormat;var obj={success:!0,results:{}},searchJson=getSearchJsonFromConfig(formConfig);return es.search(searchJson).then(function(resp){var aggregationsByTime=_lodash2.default.get(resp,["aggregations","times","buckets"],[]),highestValue=0;if(_lodash2.default.each(aggregationsByTime,function(dataForTime){var time=dataForTime.key,value=_lodash2.default.get(dataForTime,["field_value","value"]);void 0===value&&null!==formConfig.field&&(value=_lodash2.default.get(dataForTime,["field_value","values",_job_utils.ML_MEDIAN_PERCENTS])),void 0===value&&null===formConfig.field&&(value=dataForTime.doc_count),isFinite(value)&&0!==dataForTime.doc_count||(value=null),value>highestValue&&(highestValue=value),obj.results[time]={actual:value}}),_this.chartData.totalResults=resp.hits.total,_this.chartData.line=processLineChartResults(obj.results),_this.chartData.highestValue=Math.ceil(highestValue),void 0!==_this.chartData.fieldFormat){var highValueFormatted=_this.chartData.fieldFormat.convert(_this.chartData.highestValue,"text");_this.chartData.chartTicksMargin.width=(0,_string_utils.calculateTextWidth)(highValueFormatted,!1)+10}else _this.chartData.chartTicksMargin.width=(0,_string_utils.calculateTextWidth)(_this.chartData.highestValue,!0)+10;deferred.resolve(_this.chartData)}).catch(function(resp){deferred.reject(resp)}),deferred.promise},this.getJobFromConfig=function(formConfig){var _aggregations2,_aggregations3,job=mlJobService.getBlankJob();job.data_description.time_field=formConfig.timeField;var func=formConfig.agg.type.mlName;formConfig.isSparseData&&("count"===formConfig.agg.type.dslName?func=func.replace(/count/,"non_zero_count"):"sum"===formConfig.agg.type.dslName&&(func=func.replace(/sum/,"non_null_sum")));var dtr={function:func},query={match_all:{}};("*"!==formConfig.query.query_string.query||formConfig.filters.length)&&(query=formConfig.combinedQuery),formConfig.field&&formConfig.field.id&&(dtr.field_name=formConfig.field.id),job.analysis_config.detectors.push(dtr),job.analysis_config.bucket_span=formConfig.bucketSpan,job.analysis_limits={model_memory_limit:formConfig.modelMemoryLimit},delete job.data_description.field_delimiter,delete job.data_description.quote_character,delete job.data_description.time_format,delete job.data_description.format;var bucketSpanSeconds=(0,_parse_interval.parseInterval)(formConfig.bucketSpan).asSeconds(),indices=formConfig.indexPattern.title.split(",").map(function(i){return i.trim()});job.datafeed_config={query:query,indices:indices},job.job_id=formConfig.jobId,job.description=formConfig.description,job.groups=formConfig.jobGroups,job.model_plot_config={enabled:!0},formConfig.useDedicatedIndex&&(job.results_index_name=job.job_id);var aggType=formConfig.agg.type.dslName,interval=1e3*bucketSpanSeconds;switch(aggType){case"count":job.analysis_config.summary_count_field_name="doc_count",job.datafeed_config.aggregations={buckets:{date_histogram:{field:formConfig.timeField,interval:interval},aggregations:_defineProperty({},formConfig.timeField,{max:{field:formConfig.timeField}})}};break;case"avg":case"median":case"sum":case"min":case"max":job.analysis_config.summary_count_field_name="doc_count",job.datafeed_config.aggregations={buckets:{date_histogram:{field:formConfig.timeField,interval:interval/100*10},aggregations:(_aggregations2={},_defineProperty(_aggregations2,dtr.field_name,_defineProperty({},aggType,{field:formConfig.field.name})),_defineProperty(_aggregations2,formConfig.timeField,{max:{field:formConfig.timeField}}),_aggregations2)}};break;case"cardinality":job.analysis_config.summary_count_field_name="dc_"+dtr.field_name,job.datafeed_config.aggregations={buckets:{date_histogram:{field:formConfig.timeField,interval:interval},aggregations:(_aggregations3={},_defineProperty(_aggregations3,formConfig.timeField,{max:{field:formConfig.timeField}}),_defineProperty(_aggregations3,job.analysis_config.summary_count_field_name,_defineProperty({},aggType,{field:formConfig.field.name})),_aggregations3)}},dtr.function="non_zero_count",dtr.detector_description=func+" ("+dtr.field_name+")",delete dtr.field_name}return console.log("auto created job: ",job),job},this.createJob=function(formConfig){var _this2=this,deferred=$q.defer();this.job=this.getJobFromConfig(formConfig);var job=createJobForSaving(this.job);return mlJobService.saveNewJob(job).then(function(resp){resp.success?deferred.resolve(_this2.job):deferred.reject(resp)}),deferred.promise},this.startDatafeed=function(formConfig){var datafeedId=mlJobService.getDatafeedId(formConfig.jobId);return mlJobService.startDatafeed(datafeedId,formConfig.jobId,formConfig.start,formConfig.end)},this.stopDatafeed=function(formConfig){var datafeedId=mlJobService.getDatafeedId(formConfig.jobId);return mlJobService.stopDatafeed(datafeedId,formConfig.jobId)},this.checkDatafeedState=function(formConfig){return mlJobService.updateSingleJobDatafeedState(formConfig.jobId)},this.loadModelData=function(formConfig){var _this3=this,deferred=$q.defer(),start=formConfig.start;if(this.chartData.model.length>5){start=this.chartData.model[this.chartData.model.length-5].time;for(var i=0;i<5;i++)this.chartData.model.pop()}return mlResultsService.getModelPlotOutput(formConfig.jobId,0,[],start,formConfig.end,formConfig.resultsIntervalSeconds+"s",formConfig.agg.type.mlModelPlotAgg).then(function(data){var scale=1;if(formConfig&&("count"===formConfig.agg.type.mlName||"high_count"===formConfig.agg.type.mlName||"low_count"===formConfig.agg.type.mlName||"distinct_count"===formConfig.agg.type.mlName)){var chartIntervalSeconds=formConfig.chartInterval.getInterval().asSeconds(),bucketSpan=(0,_parse_interval.parseInterval)(formConfig.bucketSpan);null!==bucketSpan&&(scale=chartIntervalSeconds/bucketSpan.asSeconds())}_this3.chartData.model=_this3.chartData.model.concat(processLineChartResults(data.results,scale));var lastBucket=_this3.chartData.model[_this3.chartData.model.length-1],time=void 0!==lastBucket?lastBucket.time:formConfig.start,pcnt=(time-formConfig.start+formConfig.resultsIntervalSeconds)/(formConfig.end-formConfig.start)*100;_this3.chartData.percentComplete=Math.round(pcnt),deferred.resolve(_this3.chartData)}).catch(function(){deferred.reject(_this3.chartData)}),deferred.promise},this.loadSwimlaneData=function(formConfig){var _this4=this,deferred=$q.defer();return mlResultsService.getScoresByBucket([formConfig.jobId],formConfig.start,formConfig.end,formConfig.resultsIntervalSeconds+"s",1).then(function(data){var jobResults=data.results[formConfig.jobId];_this4.chartData.swimlane=processSwimlaneResults(jobResults),_this4.chartData.swimlaneInterval=1e3*formConfig.resultsIntervalSeconds,deferred.resolve(_this4.chartData)}).catch(function(){deferred.resolve(_this4.chartData)}),deferred.promise}})},3393:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _jquery=__webpack_require__(12),_jquery2=_interopRequireDefault(_jquery),_d=__webpack_require__(15),_d2=_interopRequireDefault(_d),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment);__webpack_require__(181);var _time_buckets=__webpack_require__(168),_chart_utils=__webpack_require__(133);__webpack_require__(2).uiModules.get("apps/ml").directive("mlSingleMetricJobChart",function(Private){function link(scope,element){function init(){margin.left=scope.chartTicksMargin.width,vizWidth=svgWidth-margin.left-margin.right,lineChartXScale=_d2.default.time.scale().range([0,vizWidth]),lineChartYScale=_d2.default.scale.linear().range([lineChartHeight,0]),lineChartValuesLine=_d2.default.svg.line().x(function(d){return lineChartXScale(d.date)}).y(function(d){return lineChartYScale(d.value)}).defined(function(d){return null!==d.value}),lineChartBoundedArea=_d2.default.svg.area().x(function(d){return lineChartXScale(d.date)||0}).y0(function(d){return lineChartYScale(Math.max(chartLimits.min,Math.min(chartLimits.max,d.upper)))}).y1(function(d){return lineChartYScale(Math.min(chartLimits.max,Math.max(chartLimits.min,d.lower)))})}function createSVGGroups(){if(void 0!==scope.chartData.line){var chartElement=_d2.default.select(element.get(0));if(chartElement.select("svg").remove(),chartElement.select(".progress").remove(),null===chartElement.select(".progress-bar")[0][0]){var style="width: "+(+vizWidth+2)+"px;\n          margin-bottom: -"+(+lineChartHeight+5)+"px;\n          margin-left: "+(+margin.left-1)+"px;'";chartElement.append("div").attr("class","progress").attr("style",style).append("div").attr("class","progress-bar")}$progressBar=(0,_jquery2.default)(".progress-bar");var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);swimlaneGroup=svg.append("g").attr("class","swimlane").attr("transform","translate("+margin.left+","+margin.top+")"),modelChartGroup=svg.append("g").attr("class","model-chart").attr("transform","translate("+margin.left+","+margin.top+")"),lineChartGroup=svg.append("g").attr("class","line-chart").attr("transform","translate("+margin.left+","+margin.top+")")}}function drawLineChart(){var data=scope.chartData.line;lineChartXScale=lineChartXScale.domain(_d2.default.extent(data,function(d){return d.date}));var timeBuckets=new TimeBuckets;if(timeBuckets.setInterval("auto"),data.length>0){var xDomain=lineChartXScale.domain(),bounds={min:(0,_moment2.default)(xDomain[0]),max:(0,_moment2.default)(xDomain[1])};timeBuckets.setBounds(bounds)}var xAxisTickFormat=timeBuckets.getScaledDateFormat();chartLimits.max=_d2.default.max(data,function(d){return d.value}),chartLimits.min=_d2.default.min(data,function(d){return d.value});var padding=.1*(chartLimits.max-chartLimits.min);chartLimits.max+=padding,chartLimits.min-=padding,lineChartYScale=lineChartYScale.domain([chartLimits.min,chartLimits.max]);var xAxis=_d2.default.svg.axis().scale(lineChartXScale).orient("bottom").innerTickSize(-lineChartHeight).outerTickSize(0).tickPadding(10).ticks((0,_chart_utils.numTicksForDateFormat)(vizWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)}),yAxis=_d2.default.svg.axis().scale(lineChartYScale).orient("left").innerTickSize(-vizWidth).outerTickSize(0).tickPadding(10);void 0!==scope.chartData.fieldFormat&&yAxis.tickFormat(function(d){return scope.chartData.fieldFormat.convert(d,"text")}),lineChartGroup.append("rect").attr("x",0).attr("y",0).attr("height",lineChartHeight).attr("width",vizWidth).style("stroke","#cccccc").style("fill","none").style("stroke-width",1),drawLineChartAxes(xAxis,yAxis),drawLineChartPaths(data),(0,_chart_utils.drawLineChartDots)(data,lineChartGroup,lineChartValuesLine)}function drawLineChartAxes(xAxis,yAxis){var axes=lineChartGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0,"+lineChartHeight+")").call(xAxis),axes.append("g").attr("class","y axis").call(yAxis)}function drawLineChartPaths(data){lineChartGroup.append("path").attr("class","values-line").attr("d",lineChartValuesLine(data))}function drawResults(){drawModelPaths(scope.chartData.model),drawSwimlane(vizWidth,lineChartHeight),updateProgressBar()}function drawModelPaths(model){modelChartGroup.selectAll("*").remove(),modelChartGroup.append("path").attr("class","area bounds").attr("d",lineChartBoundedArea(model))}function drawSwimlane(swlWidth,swlHeight){var data=scope.chartData.swimlane,cellWidth=0;data.length>0&&(cellWidth=lineChartXScale(data[0].time+scope.chartData.swimlaneInterval)-lineChartXScale(data[0].time)),_d2.default.time.scale().range([0,swlWidth]).domain(_d2.default.extent(data,function(d){return d.date})),_d2.default.scale.linear().range([swlHeight,0]).domain([0,swlHeight]);var color=_d2.default.scale.threshold().domain([3,25,50,75,100]).range(["#d2e9f7","#8bc8fb","#ffdd00","#ff7e00","#fe5050"]);swimlaneGroup.select(".swimlane-cells").remove(),swimlaneGroup.append("g").attr("class","swimlane-cells").selectAll("cells").data(data).enter().append("rect").attr("x",function(d){return lineChartXScale(d.date)}).attr("y",0).attr("rx",0).attr("ry",0).attr("class",function(d){return d.value>0?"swimlane-cell":"swimlane-cell-hidden"}).attr("width",cellWidth).attr("height",swlHeight).style("fill",function(d){return color(d.value)})}function updateProgressBar(){var pcnt=scope.chartData.percentComplete<100?scope.chartData.percentComplete:0;$progressBar.css("width",pcnt+"%")}var svgWidth=_angular2.default.element(".single-metric-job-container").width(),lineChartHeight=scope.chartHeight,margin={top:0,right:0,bottom:0,left:scope.chartTicksMargin.width},svgHeight=lineChartHeight+30+margin.top+margin.bottom,vizWidth=svgWidth-margin.left-margin.right,chartLimits={max:0,min:0},TimeBuckets=Private(_time_buckets.TimeBucketsProvider),lineChartXScale=null,lineChartYScale=null,lineChartValuesLine=null,lineChartBoundedArea=null,lineChartGroup=void 0,modelChartGroup=void 0,swimlaneGroup=void 0,$progressBar=void 0;scope.$on("render",function(){init(),createSVGGroups(),drawLineChart()}),scope.$on("render-results",function(){drawResults()}),element.on("$destroy",function(){scope.$destroy()})}return{scope:{chartData:"=",chartHeight:"=",chartTicksMargin:"="},link:link}})},3394:function(module,exports){},3395:function(module,exports,__webpack_require__){"use strict";var _post_save_options=__webpack_require__(3396),_post_save_options2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_post_save_options);__webpack_require__(2).uiModules.get("apps/ml").directive("mlPostSaveOptions",function(mlPostSaveService,mlCreateWatchService){return{restrict:"AE",replace:!1,scope:{jobId:"=",bucketSpan:"=",includeInfluencers:"="},template:_post_save_options2.default,link:function($scope){$scope.watcherEnabled=mlCreateWatchService.isWatcherEnabled(),$scope.status=mlPostSaveService.status,$scope.STATUS=mlPostSaveService.STATUS,mlCreateWatchService.reset(),mlCreateWatchService.config.includeInfluencers=$scope.includeInfluencers,$scope.runInRealtime=!1,$scope.createWatch=!1,$scope.embedded=!0,$scope.clickRunInRealtime=function(){$scope.createWatch=!!$scope.runInRealtime&&$scope.createWatch},$scope.apply=function(){mlPostSaveService.apply($scope.jobId,$scope.runInRealtime,$scope.createWatch)}}}}).service("mlPostSaveService",function(mlJobService,mlMessageBarService,$q,mlCreateWatchService){var msgs=mlMessageBarService;this.STATUS={SAVE_FAILED:-1,SAVING:0,SAVED:1},this.status={realtimeJob:null,watch:null},mlCreateWatchService.status=this.status,this.externalCreateWatch,this.startRealtimeJob=function(jobId){var _this=this,deferred=$q.defer();this.status.realtimeJob=this.STATUS.SAVING;var datafeedId=mlJobService.getDatafeedId(jobId);return mlJobService.openJob(jobId).finally(function(){mlJobService.startDatafeed(datafeedId,jobId,0,void 0).then(function(){_this.status.realtimeJob=_this.STATUS.SAVED,deferred.resolve()}).catch(function(resp){msgs.error("Could not start datafeed: ",resp),_this.status.realtimeJob=_this.STATUS.SAVE_FAILED,deferred.reject()})}),deferred.promise},this.apply=function(jobId,runInRealtime,createWatch){runInRealtime&&this.startRealtimeJob(jobId).then(function(){createWatch&&mlCreateWatchService.createNewWatch(jobId)})}})},3396:function(module,exports){module.exports='<div class=\'post-save-options\'>\n\n  <div class=\'form-group\'>\n    <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n      <input ng-model=\'runInRealtime\' ng-disabled="status.realtimeJob!==null" type="checkbox" class=\'kuiCheckBox\' ng-click="clickRunInRealtime()"/>\n      <span class="kuiCheckBoxLabel__text">\n        Continue job in real-time\n        <span ng-hide="status.realtimeJob===null">\n          <i ng-show="status.realtimeJob === STATUS.SAVE_FAILED" aria-hidden="true" style="color:red;" class="fa fa-remove"></i>\n          <i ng-show="status.realtimeJob === STATUS.SAVING" aria-hidden="true" class="fa fa-spinner fa-spin"></i>\n          <i ng-show="status.realtimeJob === STATUS.SAVED" aria-hidden="true" style="color:green;" class="fa fa-check"></i>\n         </span>\n      </span>\n    </label>\n  </div>\n  <div ng-show=\'watcherEnabled\' class=\'form-group\'>\n    <label\n      class=\'kuiCheckBoxLabel kuiVerticalRhythm\'\n      ng-class="{\'disabled\': !runInRealtime}">\n      <input ng-model=\'createWatch\' ng-disabled="!runInRealtime || status.realtimeJob!==null" type="checkbox" class=\'kuiCheckBox\' />\n      <span class="kuiCheckBoxLabel__text">\n        Create watch for real-time job\n        <span ng-hide="status.watch===null">\n          <i ng-show="status.watch === STATUS.SAVE_FAILED" aria-hidden="true" style="color:red;" class="fa fa-remove"></i>\n          <i ng-show="status.watch === STATUS.SAVING" aria-hidden="true" class="fa fa-spinner fa-spin"></i>\n          <i ng-show="status.watch === STATUS.SAVED" aria-hidden="true" style="color:green;" class="fa fa-check"></i>\n        </span>\n      </span>\n    </label>\n\n    <div ng-if=\'runInRealtime && createWatch\'>\n      <ml-create-watch\n        job-id=\'jobId\'\n        bucket-span=\'bucketSpan\'\n        include-influencers=\'includeInfluencers\'\n        embedded=\'embedded\'\n      ></ml-create-watch>\n    </div>\n  </div>\n\n  <button\n    aria-label="Create watch"\n    ng-click="apply()"\n    ng-hide=\'(status.realtimeJob===STATUS.SAVED && createWatch===false) || (status.realtimeJob===STATUS.SAVED && status.watch===STATUS.SAVED && createWatch===true)\'\n    ng-disabled=\'runInRealtime===false\'\n    type="button"\n    class="kuiButton kuiButton--primary">\n      Apply\n  </button>\n\n</div>\n'},3397:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3398),__webpack_require__(3399)},3398:function(module,exports){},3399:function(module,exports,__webpack_require__){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_bucket_span_estimator=__webpack_require__(3400),_bucket_span_estimator2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_bucket_span_estimator),_new_job_utils=__webpack_require__(192),_general=__webpack_require__(305);__webpack_require__(2).uiModules.get("apps/ml").directive("mlBucketSpanEstimator",function($injector){var ml=$injector.get("ml");return{restrict:"AE",replace:!1,scope:{bucketSpanFieldChange:"=",formConfig:"=",jobStateWrapper:"=",JOB_STATE:"=jobState",ui:"=ui",exportedFunctions:"="},template:_bucket_span_estimator2.default,link:function($scope){var STATUS={FAILED:-1,NOT_RUNNING:0,RUNNING:1,FINISHED:2};$scope.STATUS=STATUS;var errorHandler=function(error){console.log("Bucket span could not be estimated",error),$scope.ui.bucketSpanEstimator.status=STATUS.FAILED,$scope.ui.bucketSpanEstimator.message="Bucket span could not be estimated"};$scope.guessBucketSpan=function(){$scope.ui.bucketSpanEstimator.status=STATUS.RUNNING,$scope.ui.bucketSpanEstimator.message="";var data={aggTypes:[],duration:{start:$scope.formConfig.start,end:$scope.formConfig.end},fields:[],filters:$scope.formConfig.filters,index:$scope.formConfig.indexPattern.title,query:(0,_new_job_utils.getQueryFromSavedSearch)($scope.formConfig),splitField:$scope.formConfig.splitField&&$scope.formConfig.splitField.name,timeField:$scope.formConfig.timeField};if(void 0===$scope.formConfig.fields){var fieldName=null===$scope.formConfig.field?null:$scope.formConfig.field.name;data.fields.push(fieldName),data.aggTypes.push($scope.formConfig.agg.type.name)}else Object.keys($scope.formConfig.fields).map(function(id){var field=$scope.formConfig.fields[id],fieldName=field.id===_general.EVENT_RATE_COUNT_FIELD?null:field.name;data.fields.push(fieldName),data.aggTypes.push(field.agg.type.name)});ml.estimateBucketSpan(data).then(function(interval){if(interval.error)return void errorHandler(interval.message);var notify=$scope.formConfig.bucketSpan!==interval.name;$scope.formConfig.bucketSpan=interval.name,$scope.ui.bucketSpanEstimator.status=STATUS.FINISHED,notify&&"function"==typeof $scope.bucketSpanFieldChange&&$scope.bucketSpanFieldChange()}).catch(errorHandler)},void 0!==$scope.exportedFunctions&&"object"===_typeof($scope.exportedFunctions)&&($scope.exportedFunctions.guessBucketSpan=$scope.guessBucketSpan)}}})},3400:function(module,exports){module.exports='<div class=\'bucket-span-estimator\'>\n  <button\n    ng-click="guessBucketSpan()"\n    ng-disabled="ui.showJobInput===false || ui.formValid === false || formConfig.agg.type===undefined || jobStateWrapper.jobState===JOB_STATE.RUNNING || jobStateWrapper.jobState===JOB_STATE.STOPPING || jobStateWrapper.jobState===JOB_STATE.FINISHED || ui.bucketSpanEstimator.status===STATUS.RUNNING"\n    type="button"\n    tooltip="Experimental feature for estimating bucket span."\n    tooltip-append-to-body="true"\n    ng-class=\'{"running": (ui.bucketSpanEstimator.status===STATUS.RUNNING)}\'\n    class="kuiButton kuiButton--basic kuiButton--small">\n      {{ui.bucketSpanEstimator.status===STATUS.RUNNING ? \'Estimating bucket span \' : \'Estimate bucket span\'}}\n      <i ng-show=\'ui.bucketSpanEstimator.status===STATUS.RUNNING\' class="fa fa-spinner fa-spin"></i>\n  </button>\n</div>\n'},3401:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment),_full_time_range_selector=__webpack_require__(3402),_full_time_range_selector2=_interopRequireDefault(_full_time_range_selector),_fields_service=__webpack_require__(481);__webpack_require__(2).uiModules.get("apps/ml").directive("mlFullTimeRangeSelector",function(mlFullTimeRangeSelectorService){return{restrict:"E",replace:!0,template:_full_time_range_selector2.default,scope:{indexPattern:"=",disabled:"=",query:"="},controller:function($scope){$scope.setFullTimeRange=function(){mlFullTimeRangeSelectorService.setFullTimeRange($scope.indexPattern,$scope.query)}}}}).service("mlFullTimeRangeSelectorService",function(timefilter,Notifier,Private){var notify=new Notifier,fieldsService=Private(_fields_service.FieldsServiceProvider);this.setFullTimeRange=function(indexPattern,query){fieldsService.getTimeFieldRange(indexPattern.title,indexPattern.timeFieldName,query).then(function(resp){timefilter.time.from=(0,_moment2.default)(resp.start.epoch).toISOString(),timefilter.time.to=(0,_moment2.default)(resp.end.epoch).toISOString()}).catch(function(resp){notify.error(resp)})}})},3402:function(module,exports){module.exports='<button\n  ng-click="setFullTimeRange()"\n  type="button"\n  ng-disabled="disabled"\n  class="euiButton euiButton--primary euiButton--small euiButton--fill">\n  <span class="euiButton__content">\n    Use full {{indexPattern.title}} data\n  </span>\n</button>\n'},3403:function(module,exports,__webpack_require__){"use strict";var _field_type_icon=__webpack_require__(3404),_field_type_icon2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_field_type_icon),_field_types=__webpack_require__(208);__webpack_require__(2).uiModules.get("apps/ml").directive("mlFieldTypeIcon",function(){return{restrict:"E",replace:!0,scope:{type:"="},template:_field_type_icon2.default,controller:function($scope){$scope.ML_JOB_FIELD_TYPES=_field_types.ML_JOB_FIELD_TYPES}}})},3404:function(module,exports){module.exports='<span class="field-type-icon-container">\n  <span\n    ng-if="type===ML_JOB_FIELD_TYPES.BOOLEAN"\n    aria-label="Boolean field"\n    class="field-type-icon kuiIcon fa-adjust">\n  </span>\n  <span\n    ng-if="type===ML_JOB_FIELD_TYPES.DATE"\n    aria-label="Date field"\n    class="field-type-icon kuiIcon fa-clock-o">\n  </span>\n  <span\n    ng-if="type===ML_JOB_FIELD_TYPES.NUMBER"\n    aria-label="Metric field"\n    class="field-type-icon">\n      <strong aria-hidden="true">#</strong>\n  </span>\n  <span\n    ng-if="type===ML_JOB_FIELD_TYPES.GEO_POINT"\n    aria-label="Geo-point field"\n    class="field-type-icon kuiIcon fa-globe">\n  </span>\n  <span\n    ng-if="type===ML_JOB_FIELD_TYPES.KEYWORD"\n    aria-label="Aggregatable string field"\n    class="field-type-icon">\n      <strong aria-hidden="true">t</strong>\n  </span>\n  <span ng-if="type===ML_JOB_FIELD_TYPES.TEXT"\n    aria-label="String field"\n    class="field-type-icon kuiIcon fa-file-text-o">\n  </span>\n  <span ng-if="type===ML_JOB_FIELD_TYPES.IP"\n    aria-label="IP address field"\n    class="field-type-icon kuiIcon fa-laptop">\n  </span>\n</span>\n'},3405:function(module,exports){},3406:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3407)},3407:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3408),__webpack_require__(3409),__webpack_require__(3412),__webpack_require__(3413),__webpack_require__(374),__webpack_require__(306),__webpack_require__(687),__webpack_require__(688),__webpack_require__(1180),__webpack_require__(3416),__webpack_require__(1181),__webpack_require__(1182),__webpack_require__(1183),__webpack_require__(1184),__webpack_require__(302),__webpack_require__(480),__webpack_require__(307)},3408:function(module,exports){},3409:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash);__webpack_require__(303);var _index=__webpack_require__(259),_validation_utils=__webpack_require__(476),_parse_interval=__webpack_require__(166),_datemath=__webpack_require__(81),_datemath2=_interopRequireDefault(_datemath),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular),_routes=__webpack_require__(11),_routes2=_interopRequireDefault(_routes),_check_license=__webpack_require__(101),_check_privilege=__webpack_require__(93),_calculate_memory_limit=__webpack_require__(3410),_ml_time_buckets=__webpack_require__(169),_filter_agg_types=__webpack_require__(682),_validate_job=__webpack_require__(683),_adjust_interval=__webpack_require__(684),_new_job_utils=__webpack_require__(192),_app_state_settings=__webpack_require__(685),_states=__webpack_require__(373),_create_fields=__webpack_require__(686),_index_utils=__webpack_require__(132),_chart_data_utils=__webpack_require__(1179),_check_ml_nodes=__webpack_require__(108),_new_job_defaults=__webpack_require__(258),_string_utils=__webpack_require__(43),_create_job=__webpack_require__(3411),_create_job2=_interopRequireDefault(_create_job),_modules=__webpack_require__(2);_routes2.default.when("/jobs/new_job/simple/multi_metric",{template:_create_job2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.getIndexPatternWithRoute,savedSearch:_index_utils.getSavedSearchWithRoute,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults}}),_modules.uiModules.get("apps/ml").controller("MlCreateMultiMetricJob",function($scope,$route,timefilter,Private,mlJobService,mlMultiMetricJobService,mlMessageBarService,mlFullTimeRangeSelectorService,AppState){function setTime(){$scope.ui.bucketSpanValid=!0,$scope.formConfig.start=_datemath2.default.parse(timefilter.time.from).valueOf(),$scope.formConfig.end=_datemath2.default.parse(timefilter.time.to).valueOf(),$scope.formConfig.format="epoch_millis";var bucketSpanInterval=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan);null!==bucketSpanInterval&&0!==bucketSpanInterval.asMilliseconds()||($scope.ui.bucketSpanValid=!1);var bounds=timefilter.getActiveBounds();$scope.formConfig.chartInterval=new MlTimeBuckets,$scope.formConfig.chartInterval.setBarTarget(BAR_TARGET),$scope.formConfig.chartInterval.setMaxBars(MAX_BARS),$scope.formConfig.chartInterval.setInterval("auto"),$scope.formConfig.chartInterval.setBounds(bounds),(0,_adjust_interval.adjustIntervalDisplayed)($scope.formConfig),$scope.ui.isFormValid(),$scope.ui.dirty=!0}function setFieldsChartStates(state){_lodash2.default.each($scope.chartStates.fields,function(chart,key){$scope.chartStates.fields[key]=state})}function showSparseDataCheckbox(){$scope.ui.isCountOrSum=!1,_lodash2.default.each($scope.formConfig.fields,function(fd){"count"!==fd.agg.type.dslName&&"sum"!==fd.agg.type.dslName||($scope.ui.isCountOrSum=!0)})}function drawCards(labels){function fadeCard(callTime){if(i<cardsBehind.length){var now=callTime,elapsed=now-then;elapsed>fpsInterval&&(cardsBehind[i].style.opacity=1,i++,then=now-elapsed%fpsInterval),window.requestAnimationFrame(fadeCard)}}var $frontCard=_angular2.default.element(".multi-metric-job-container .detector-container .card-front");$frontCard.addClass("card"),$frontCard.find(".card-title").text(labels[0]);var w=$frontCard.width(),marginTop=labels.length>1?54:0;$frontCard.css("margin-top",marginTop);var backCardTitle="";2===labels.length&&(backCardTitle=$scope.formConfig.fields[Object.keys($scope.formConfig.fields)[0]].agg.type.title,backCardTitle+=" ",backCardTitle+=Object.keys($scope.formConfig.fields)[0]),_angular2.default.element(".card-behind").remove();for(var _i=0;_i<labels.length;_i++){var el='<div class="card card-behind"><div class="card-title">';el+=(0,_string_utils.mlEscape)(labels[_i]),el+='</div><label class="kuiFormLabel">',el+=(0,_string_utils.mlEscape)(backCardTitle),el+="</label></div>";var $backCard=_angular2.default.element(el);$backCard.css("width",w),$backCard.css("height",100),$backCard.css("display","auto"),$backCard.css("z-index",9-_i),$backCard.insertBefore($frontCard)}for(var cardsBehind=_angular2.default.element(".card-behind"),marginLeft=0,backWidth=w,_i2=0;_i2<cardsBehind.length;_i2++)cardsBehind[_i2].style.marginTop=marginTop+"px",cardsBehind[_i2].style.marginLeft=marginLeft+"px",cardsBehind[_i2].style.width=backWidth+"px",marginTop-=(10-_i2*(10/labels.length))*(10/labels.length),marginLeft+=5-_i2/2,backWidth-=2*(5-_i2/2);var i=0,then=window.performance.now(),fpsInterval=50;fadeCard()}function destroyCards(){_angular2.default.element(".card-behind").remove();var $frontCard=_angular2.default.element(".multi-metric-job-container .detector-container .card-front");$frontCard.removeClass("card"),$frontCard.find(".card-title").text(""),$frontCard.css("margin-top",0)}function loadCharts(){function run(){refreshCounter++,reloadJobSwimlaneData().then(function(){reloadDetectorSwimlane().then(function(){!1===forceStop&&$scope.chartData.percentComplete<100?$scope.jobState===_states.JOB_STATE.STOPPING?$scope.jobState=_states.JOB_STATE.STOPPING:$scope.jobState=_states.JOB_STATE.RUNNING:$scope.jobState=_states.JOB_STATE.FINISHED,jobCheck()})})}var forceStop=globalForceStop;refreshCounter>=20-refreshInterval/REFRESH_INTERVAL_MS?(refreshCounter=0,mlJobService.updateSingleJobDatafeedState($scope.formConfig.jobId).then(function(state){"stopped"===state&&(console.log("Stopping poll because datafeed state is: "+state),$scope.$broadcast("render-results"),forceStop=!0),run()})):run()}function jobCheck(){$scope.jobState===_states.JOB_STATE.RUNNING||$scope.jobState===_states.JOB_STATE.STOPPING?(refreshInterval=adjustRefreshInterval($scope.chartData.loadingDifference,refreshInterval),_lodash2.default.delay(loadCharts,refreshInterval)):_lodash2.default.each($scope.chartData.detectors,function(chart){chart.percentComplete=100}),$scope.chartData.percentComplete>0&&toggleSwimlaneVisibility(),$scope.$broadcast("render-results")}function reloadJobSwimlaneData(){return chartDataUtils.loadJobSwimlaneData($scope.formConfig,$scope.chartData)}function reloadDetectorSwimlane(){return chartDataUtils.loadDetectorSwimlaneData($scope.formConfig,$scope.chartData)}function adjustRefreshInterval(loadingDifference,currentInterval){var interval=currentInterval;return interval<1e4&&(loadingDifference<MAX_BUCKET_DIFF?interval+=100:interval-100>=REFRESH_INTERVAL_MS&&(interval-=100)),interval}function toggleSwimlaneVisibility(){$scope.jobState===_states.JOB_STATE.NOT_STARTED?(_angular2.default.element(".swimlane-cells").css("opacity",0),_angular2.default.element(".bar").css("opacity",1)):_angular2.default.element(".bar").css("opacity",.1)}function resize(){if(void 0!==$scope.formConfig.splitField)for(var width=_angular2.default.element(".card-front").width(),cardsBehind=_angular2.default.element(".card-behind"),i=0;i<cardsBehind.length;i++)cardsBehind[i].style.width=width+"px",width-=2*(5-i/2)}timefilter.enableTimeRangeSelector(),timefilter.disableAutoRefreshSelector();var msgs=mlMessageBarService,MlTimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider),calculateModelMemoryLimit=Private(_calculate_memory_limit.CalculateModelMemoryLimitProvider),chartDataUtils=Private(_chart_data_utils.ChartDataUtilsProvider);$scope.addNewJobToRecentlyAccessed=_new_job_utils.addNewJobToRecentlyAccessed;var stateDefaults={mlJobSettings:{}},appState=new AppState(stateDefaults),aggTypes=Private(_index.AggTypesIndexProvider);mlMultiMetricJobService.clearChartData(),$scope.chartData=mlMultiMetricJobService.chartData;var PAGE_WIDTH=_angular2.default.element(".multi-metric-job-container").width(),BAR_TARGET=PAGE_WIDTH>1600?800:PAGE_WIDTH/2,MAX_BARS=BAR_TARGET+BAR_TARGET/100*100,REFRESH_INTERVAL_MS=100,MAX_BUCKET_DIFF=3,refreshCounter=0;$scope.JOB_STATE=_states.JOB_STATE,$scope.jobState=$scope.JOB_STATE.NOT_STARTED,$scope.CHART_STATE=_states.CHART_STATE,$scope.chartStates={eventRate:_states.CHART_STATE.LOADING,fields:{}};var globalForceStop=!1,_createSearchItems=(0,_new_job_utils.createSearchItems)($route),indexPattern=_createSearchItems.indexPattern,savedSearch=_createSearchItems.savedSearch,query=_createSearchItems.query,filters=_createSearchItems.filters,combinedQuery=_createSearchItems.combinedQuery;(0,_index_utils.timeBasedIndexCheck)(indexPattern,!0);var pageTitle=void 0!==savedSearch.id?"saved search "+savedSearch.title:"index pattern "+indexPattern.title;$scope.ui={indexPattern:indexPattern,pageTitle:pageTitle,showJobInput:!0,showJobFinished:!1,dirty:!1,formValid:!1,bucketSpanValid:!0,bucketSpanEstimator:{status:0,message:""},aggTypeOptions:(0,_filter_agg_types.filterAggTypes)(aggTypes.byType.metrics),fields:[],splitFields:[],timeFields:[],splitText:"",intervals:[{title:"Auto",value:"auto"},{title:"Millisecond",value:"ms"},{title:"Second",value:"s"},{title:"Minute",value:"m"},{title:"Hourly",value:"h"},{title:"Daily",value:"d"},{title:"Weekly",value:"w"},{title:"Monthly",value:"M"},{title:"Yearly",value:"y"},{title:"Custom",value:"custom"}],eventRateChartHeight:100,chartHeight:150,showFieldCharts:!1,showAdvanced:!1,validation:{checks:{jobId:{valid:!0},groupIds:{valid:!0},modelMemoryLimit:{valid:!0}}},isCountOrSum:!1},$scope.formConfig={agg:{type:void 0},fields:{},bucketSpan:"15m",chartInterval:void 0,resultsIntervalSeconds:void 0,start:0,end:0,timeField:indexPattern.timeFieldName,splitField:void 0,influencerFields:[],firstSplitFieldName:void 0,indexPattern:indexPattern,query:query,filters:filters,combinedQuery:combinedQuery,jobId:void 0,description:void 0,jobGroups:[],useDedicatedIndex:!1,isSparseData:!1,modelMemoryLimit:"10MB"},$scope.formChange=function(){$scope.ui.isFormValid(),$scope.ui.dirty=!0,$scope.loadVis()},$scope.splitChange=function(){var splitField=$scope.formConfig.splitField;$scope.formConfig.firstSplitFieldName=void 0,void 0!==splitField?($scope.addDefaultFieldsToInfluencerList(),$scope.ui.splitText="Data split by "+splitField.name,chartDataUtils.getSplitFields($scope.formConfig,$scope.formConfig.splitField.name,10).then(function(resp){resp.results.values&&resp.results.values.length&&($scope.formConfig.firstSplitFieldName=resp.results.values[0]),setFieldsChartStates(_states.CHART_STATE.LOADING),drawCards(resp.results.values),$scope.formChange()}),$scope.setModelMemoryLimit()):(setFieldsChartStates(_states.CHART_STATE.LOADING),$scope.ui.splitText="",$scope.formConfig.modelMemoryLimit="10MB",destroyCards(),$scope.formChange())},$scope.splitReset=function(){$scope.formConfig.splitField=void 0,$scope.splitChange()},$scope.ui.isFormValid=function(){return void 0===$scope.formConfig.agg.type||void 0===$scope.formConfig.timeField||0===Object.keys($scope.formConfig.fields).length?$scope.ui.formValid=!1:$scope.ui.formValid=!0,$scope.ui.formValid},$scope.loadVis=function(){function loadDocCountData(dtrs){chartDataUtils.loadDocCountData($scope.formConfig,$scope.chartData).then(function(resp){thisLoadTimestamp===$scope.chartData.lastLoadTimestamp&&(_lodash2.default.each(dtrs,function(dtr,id){var state=resp.totalResults?_states.CHART_STATE.LOADED:_states.CHART_STATE.NO_RESULTS;$scope.chartStates.fields[id]=state}),$scope.chartData.lastLoadTimestamp=null,chartDataUtils.updateChartMargin($scope.chartData),$scope.$broadcast("render"),$scope.chartStates.eventRate=resp.totalResults?_states.CHART_STATE.LOADED:_states.CHART_STATE.NO_RESULTS)}).catch(function(resp){$scope.chartStates.eventRate=_states.CHART_STATE.NO_RESULTS,msgs.error(resp.message)})}var thisLoadTimestamp=Date.now();$scope.chartData.lastLoadTimestamp=thisLoadTimestamp,setTime(),$scope.ui.isFormValid(),$scope.ui.showJobInput=!0,$scope.ui.showJobFinished=!1,$scope.ui.dirty=!1,showSparseDataCheckbox(),mlMultiMetricJobService.clearChartData(),setFieldsChartStates(_states.CHART_STATE.LOADING),Object.keys($scope.formConfig.fields).length?($scope.ui.showFieldCharts=!0,mlMultiMetricJobService.getLineChartResults($scope.formConfig,thisLoadTimestamp).then(function(resp){loadDocCountData(resp.detectors)}).catch(function(resp){msgs.error(resp.message),_lodash2.default.each($scope.formConfig.fields,function(field,id){$scope.chartStates.fields[id]=_states.CHART_STATE.NO_RESULTS})})):($scope.ui.showFieldCharts=!1,loadDocCountData([]))};var refreshInterval=REFRESH_INTERVAL_MS;$scope.createJob=function(){function saveNewDatafeed(job,startDatafeedAfterSave){mlJobService.saveNewDatafeed(job.datafeed_config,job.job_id).then(function(){startDatafeedAfterSave&&mlMultiMetricJobService.startDatafeed($scope.formConfig).then(function(){$scope.jobState=_states.JOB_STATE.RUNNING,refreshCounter=0,refreshInterval=REFRESH_INTERVAL_MS,$scope.formConfig.resultsIntervalSeconds=$scope.formConfig.chartInterval.getInterval().asSeconds();var bucketSpanSeconds=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan).asSeconds();$scope.formConfig.resultsIntervalSeconds<bucketSpanSeconds&&($scope.formConfig.resultsIntervalSeconds=bucketSpanSeconds),$scope.resultsUrl=(0,_new_job_utils.createResultsUrl)([$scope.formConfig.jobId],$scope.formConfig.start,$scope.formConfig.end,"explorer"),loadCharts()}).catch(function(resp){msgs.error("Could not start datafeed: ",resp)})}).catch(function(resp){msgs.error("Save datafeed failed: ",resp)})}var tempJob=mlMultiMetricJobService.getJobFromConfig($scope.formConfig);(0,_validate_job.validateJob)(tempJob,$scope.ui.validation.checks)?(msgs.clear(),mlMultiMetricJobService.createJob($scope.formConfig).then(function(job){mlJobService.openJob(job.job_id).then(function(){saveNewDatafeed(job,!0)}).catch(function(resp){msgs.error("Could not open job: ",resp),msgs.error("Job created, creating datafeed anyway"),saveNewDatafeed(job,!1)})}).catch(function(resp){msgs.error("Save failed: ",resp.resp)})):!1===$scope.ui.validation.checks.modelMemoryLimit.valid&&($scope.ui.showAdvanced=!0)},(0,_validation_utils.addJobValidationMethods)($scope,mlMultiMetricJobService),$scope.resetJob=function(){$scope.jobState=_states.JOB_STATE.NOT_STARTED,toggleSwimlaneVisibility(),window.setTimeout(function(){$scope.ui.showJobInput=!0,$scope.loadVis()},500)},$scope.stopJob=function(){$scope.jobState=_states.JOB_STATE.STOPPING,mlMultiMetricJobService.stopDatafeed($scope.formConfig)},$scope.setModelMemoryLimit=function(){var formConfig=$scope.formConfig;calculateModelMemoryLimit(formConfig.indexPattern.title,formConfig.splitField.name,formConfig.query,Object.keys(formConfig.fields),formConfig.influencerFields.map(function(f){return f.name}),formConfig.timeField,formConfig.start,formConfig.end).then(function(resp){formConfig.modelMemoryLimit=resp}).catch(function(){formConfig.modelMemoryLimit="10MB"})},$scope.setFullTimeRange=function(){mlFullTimeRangeSelectorService.setFullTimeRange($scope.ui.indexPattern,$scope.formConfig.combinedQuery)},function(){_lodash2.default.each($scope.ui.aggTypeOptions,function(agg){"Mean"===agg.title&&($scope.formConfig.agg.type=agg)})}(),(0,_create_fields.createFields)($scope,indexPattern),$scope.loadVis(),$scope.$evalAsync(function(){(0,_app_state_settings.populateAppStateSettings)(appState,$scope)}),$scope.$listen(timefilter,"fetch",function(){$scope.loadVis(),void 0!==$scope.formConfig.splitField&&$scope.setModelMemoryLimit()}),_angular2.default.element(window).resize(function(){resize()}),$scope.$on("$destroy",function(){globalForceStop=!0,_angular2.default.element(window).off("resize")})})},3410:function(module,exports,__webpack_require__){"use strict";function CalculateModelMemoryLimitProvider(ml){return function(indexPattern,splitFieldName,query,fieldNames,influencerNames,timeFieldName,earliestMs,latestMs){return ml.calculateModelMemoryLimit({indexPattern:indexPattern,splitFieldName:splitFieldName,query:query,fieldNames:fieldNames,influencerNames:influencerNames,timeFieldName:timeFieldName,earliestMs:earliestMs,latestMs:latestMs})}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.CalculateModelMemoryLimitProvider=CalculateModelMemoryLimitProvider},3411:function(module,exports){module.exports='<ml-nav-menu name="new_job_multi_metric"></ml-nav-menu>\n<ml-new-job-multi-metric>\n  <ml-message-bar></ml-message-bar>\n  <div ng-controller="MlCreateMultiMetricJob" class="multi-metric-job-container">\n    <div class="row">\n      <div class="col-md-6">\n        <h1 class="euiTitle euiTitle--large">New job from {{ui.pageTitle}}</h1>\n      </div>\n      <div class="col-md-6">\n        <div class="pull-right">\n          <span style="font-size:10px;" ng-show="formConfig.chartInterval !== undefined">Chart interval: {{formConfig.chartInterval.getInterval().expression}}</span>\n          <ml-full-time-range-selector\n            disabled=\'(jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)\'\n            index-pattern=\'ui.indexPattern\'\n            query=\'formConfig.combinedQuery\'\n          ></ml-full-time-range-selector>\n        </div>\n      </div>\n    </div>\n\n    <div class="euiSpacer euiSpacer--s"></div>\n\n    <div class="row">\n      <div class="col-md-4">\n        <div class="row form-controls">\n          <h4 class="euiTitle euiTitle--small">Job settings</h4>\n          <div>\n            <div class=\'form-section\'>\n              <ml-fields-selection></ml-fields-selection>\n            </div>\n\n            <div class=\'form-section form-section-overflow\' >\n              <h4 class="euiTitle euiTitle--small">\n                Split Data\n                <button\n                  ng-if="formConfig.splitField !== undefined && (!ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)"\n                  ng-click="splitReset()"\n                  aria-label="Reset Split Data to none."\n                  ng-disabled="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                  class="euiButton euiButton--primary euiButton--small remove-split"\n                >\n                  Remove split\n                </button>\n              </h4>\n              <div class="euiSpacer euiSpacer--s"></div>\n              <div class="row">\n                <div class="col-md-12">\n                  <div class="form-group">\n                    <ui-select\n                      ng-model="formConfig.splitField"\n                      ng-change="splitChange()"\n                      ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                    >\n                        <ui-select-match placeholder="Select a field">\n                          <ml-field-type-icon type="$select.selected.mlType"></ml-field-type-icon>{{$select.selected.name}}\n                        </ui-select-match>\n                        <ui-select-choices repeat="field in ui.splitFields | filter: { name: $select.search }" group-by="\'mlType\'">\n                          <div>\n                            <ml-field-type-icon type="field.mlType"></ml-field-type-icon>\n                            <span\n                              class="select-item"\n                              ng-bind-html="field.name | highlight: $select.search">\n                            </span>\n                          </div>\n                        </ui-select-choices>\n                    </ui-select>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div class=\'form-section\' >\n              <ml-influencers-selection></ml-influencers-selection>\n            </div>\n\n            <div class=\'form-section\' >\n              <ml-bucket-span-selection></ml-bucket-span-selection>\n            </div>\n\n            <div class=\'form-section\' >\n              <div ng-show="jobState !== JOB_STATE.FINISHED">\n                <h4 class="euiTitle euiTitle--small">Job Details</h4>\n                <div class="euiSpacer euiSpacer--s"></div>\n              </div>\n\n              <div class="form-group">\n                <div ng-show="ui.showJobInput && (jobState === JOB_STATE.NOT_STARTED || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING)">\n                  <ml-general-job-details></ml-general-job-details>\n\n                  <div class="euiFlexGroup euiFlexGroup--gutterSmall euiFlexGroup--alignItemsCenter euiFlexGroup--responsive">\n                    <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                      <ml-validate-job\n                        get-duration="getDuration"\n                        get-job-config="getJobConfig"\n                        fill="false"\n                        is-current-job-config="isCurrentJobConfig"\n                        is-disabled="!ui.formValid"\n                        ng-show="jobState === JOB_STATE.NOT_STARTED"\n                      />\n                    </div>\n                    <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                      <button\n                        aria-label="Create Job"\n                        ng-click="createJob()"\n                        type="button"\n                        ng-show="jobState === JOB_STATE.NOT_STARTED"\n                        ng-disabled="!ui.formValid"\n                        class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                        <span class="euiButton__content">\n                          Create Job\n                        </span>\n                      </button>\n                    </div>\n                  </div>\n\n                  <div class=\'job-state-info\' ng-show="jobState === JOB_STATE.RUNNING">Analysis running <i class=\'fa fa-spinner fa-spin\'></i></div>\n                  <div class=\'job-state-info\' ng-show="jobState === JOB_STATE.STOPPING">Analysis stopping <i class=\'fa fa-spinner fa-spin\'></i></div>\n\n                  <div class="euiSpacer euiSpacer--s"></div>\n\n                  <button\n                    aria-label="Stop Job"\n                    ng-click="stopJob()"\n                    type="button"\n                    ng-show="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING"\n                    ng-disabled="jobState === JOB_STATE.STOPPING"\n                    class="euiButton euiButton--danger euiButton--small">\n                    <span class="euiButton__content">\n                      {{(jobState === JOB_STATE.STOPPING) ? \'Analysis stopping\' : \'Stop analysis\' }}\n                    </span>\n                  </button>\n\n                  <a\n                    href=\'{{resultsUrl}}\'\n                    ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n                    aria-label="View Results"\n                    ng-show="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      View Results\n                    </span>\n                  </a>\n                </div>\n                <div ng-show="jobState === JOB_STATE.FINISHED">\n                  <h3 class="euiTitle euiTitle--large">Job {{formConfig.jobId }} created\n                    <i style="color:green;" class="fa fa-check" aria-label="Saved"></i>\n                  </h3>\n                  <div class="euiSpacer euiSpacer--m"></div>\n\n                  <button\n                    aria-label="Reset"\n                    ng-click="resetJob()"\n                    type="button"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      Reset\n                    </span>\n                  </button>\n                  <a\n                    href=\'{{resultsUrl}}\'\n                    ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n                    aria-label="View Results"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      View Results\n                    </span>\n                  </a>\n                </div>\n\n                <div ng-if=\'jobState === JOB_STATE.FINISHED\'>\n                  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n                  <ml-post-save-options\n                    job-id=\'formConfig.jobId\'\n                    bucket-span=\'formConfig.bucketSpan\'\n                    include-influencers=\'true\'\n                    ></ml-post-save-options>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="col-md-8">\n        <div class="row charts-container">\n          <h4 class="euiTitle euiTitle--small">Results</h4>\n          <div>\n            <div class=\'chart-list-panel event-rate-container\' style=\'height: {{ui.eventRateChartHeight + 70}}px;\'>\n              <label class="kuiFormLabel">Document count</label>\n\n              <div class=\'chart-container\'>\n                <div style=\'height: {{ui.eventRateChartHeight + 25}}px;\'>\n                  <ml-event-rate-chart\n                    chart-data="chartData.job"\n                    event-rate-chart-height=\'ui.eventRateChartHeight\'\n                    chart-ticks-margin="chartData.chartTicksMargin">\n                  </ml-event-rate-chart>\n                </div>\n\n                <div ng-show="chartStates.eventRate === CHART_STATE.NOT_STARTED || chartStates.eventRate === CHART_STATE.LOADING || chartStates.eventRate === CHART_STATE.NO_RESULTS"\n                  class=\'chart-loader event-rate-chart-loader\'\n                  style=\'height: {{ui.eventRateChartHeight}}px; margin-top: -{{ui.eventRateChartHeight + 30}}px;\'>\n                    <div class=\'status-label\' ng-if="chartStates.eventRate === CHART_STATE.NOT_STARTED"></div>\n                    <div class=\'status-label\' ng-if="chartStates.eventRate === CHART_STATE.LOADING">\n                      <h2 class="euiTitle euiTitle"><i class=\'fa fa-spinner fa-spin\'></i></h2>\n                    </div>\n                    <div class=\'status-label\' ng-if="chartStates.eventRate === CHART_STATE.NO_RESULTS">\n                      <div class=\'no-results\'>\n                        <h4 class="euiTitle euiTitle--small"><i class="fa fa-info-circle"></i> No results found</h4>\n                        <span>Consider using the <a ng-click="setFullTimeRange()">full {{ui.indexPattern.title}} data</a></span>\n                      </div>\n                    </div>\n                </div>\n\n              </div>\n\n            </div>\n            <div class=\'chart-list-panel detector-container\' ng-show=\'ui.showFieldCharts\'>\n              <label  class="kuiFormLabel" ng-hide="ui.splitText === \'\'">{{ui.splitText}}</label>\n              <div class=\'card-front\'>\n                <div class="card-title"></div>\n                <div ng-repeat=\'(id, chart) in chartData.detectors\' class=\'chart\' style=\'height: {{ui.chartHeight + 50}}px;\'>\n                  <label class="kuiFormLabel">{{formConfig.fields[id].agg.type.title}} {{formConfig.fields[id].name}}</label>\n                  <div class=\'chart-container\'>\n                    <div style=\'height: {{ui.chartHeight + 25}}px;\'>\n                      <ml-multi-metric-job-chart\n                        chart-data="chart"\n                        chart-height=\'ui.chartHeight\'\n                        chart-ticks-margin="chartData.chartTicksMargin">\n                      </ml-multi-metric-job-chart>\n                    </div>\n\n                    <div ng-show="chartStates.fields[id] === CHART_STATE.NOT_STARTED || chartStates.fields[id] === CHART_STATE.LOADING || chartStates.fields[id] === CHART_STATE.NO_RESULTS"\n                      class=\'chart-loader fields-chart-loader\'\n                      style=\'height: {{ui.chartHeight}}px; margin-top: -{{ui.chartHeight + 30}}px; margin-left: {{chartData.chartTicksMargin.width - 1}}px;\'>\n                        <div class=\'status-label\' ng-show="chartStates.fields[id] === CHART_STATE.NOT_STARTED"></div>\n                        <div class=\'status-label\' ng-show="chartStates.fields[id] === CHART_STATE.LOADING">\n                          <h2 class="euiTitle euiTitle"><i class=\'fa fa-spinner fa-spin\'></i></h2>\n                        </div>\n                        <div class=\'status-label\' ng-show="chartStates.fields[id] === CHART_STATE.NO_RESULTS">\n                          <div class=\'no-results\'>\n                            <h4 class="euiTitle euiTitle--small"><i class="fa fa-info-circle"></i> No results found</h4>\n                          </div>\n                        </div>\n                    </div>\n\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</ml-new-job-multi-metric>\n'},3412:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular),_general=__webpack_require__(305),_job_utils=__webpack_require__(57);__webpack_require__(2).uiModules.get("apps/ml").service("mlMultiMetricJobService",function($q,es,timefilter,Private,mlFieldFormatService,mlJobService){function getSearchJsonFromConfig(formConfig){var interval=formConfig.chartInterval.getInterval().asMilliseconds()+"ms",query=_lodash2.default.cloneDeep(formConfig.combinedQuery),json={index:formConfig.indexPattern.title,size:0,body:{query:{},aggs:{times:{date_histogram:{field:formConfig.timeField,interval:interval,min_doc_count:0,extended_bounds:{min:formConfig.start,max:formConfig.end}}}}}};return query.bool.must.push({range:_defineProperty({},formConfig.timeField,{gte:formConfig.start,lte:formConfig.end,format:formConfig.format})}),void 0!==formConfig.firstSplitFieldName&&query.bool.must.push({term:_defineProperty({},formConfig.splitField.name,formConfig.firstSplitFieldName)}),json.body.query=query,Object.keys(formConfig.fields).length&&(json.body.aggs.times.aggs={},_lodash2.default.each(formConfig.fields,function(field){field.id!==_general.EVENT_RATE_COUNT_FIELD&&(json.body.aggs.times.aggs[field.id]=_defineProperty({},field.agg.type.dslName,{field:field.name}),"percentiles"===field.agg.type.dslName&&(json.body.aggs.times.aggs[field.id][field.agg.type.dslName].percents=[_job_utils.ML_MEDIAN_PERCENTS]))})),json}function createJobForSaving(job){var newJob=_angular2.default.copy(job);return delete newJob.datafeed_config,newJob}this.chartData={job:{swimlane:[],line:[],bars:[],earliestTime:Number.MAX_SAFE_INTEGER},detectors:{},percentComplete:0,loadingDifference:0,lastLoadTimestamp:null,eventRateHighestValue:0,chartTicksMargin:{width:30},totalResults:0},this.job={},this.clearChartData=function(){this.chartData.job.swimlane=[],this.chartData.job.line=[],this.chartData.job.bars=[],this.chartData.detectors={},this.chartData.percentComplete=0,this.chartData.loadingDifference=0,this.chartData.eventRateHighestValue=0,this.chartData.totalResults=0,this.job={}},this.getLineChartResults=function(formConfig,thisLoadTimestamp){var _this=this,deferred=$q.defer(),fieldIds=Object.keys(formConfig.fields).sort();this.chartData.job.earliestTime=formConfig.start;var idx=_lodash2.default.findIndex(fieldIds,function(id){return id===_general.EVENT_RATE_COUNT_FIELD});-1!==idx&&(fieldIds.splice(idx,1),fieldIds.splice(0,0,_general.EVENT_RATE_COUNT_FIELD)),_lodash2.default.each(fieldIds,function(fieldId){_this.chartData.detectors[fieldId]={line:[],swimlane:[],highestValue:0}});var searchJson=getSearchJsonFromConfig(formConfig);return es.search(searchJson).then(function(resp){thisLoadTimestamp===_this.chartData.lastLoadTimestamp?_lodash2.default.each(fieldIds,function(fieldId){if(_this.chartData.detectors[fieldId]={line:[],swimlane:[],highestValue:0},fieldId!==_general.EVENT_RATE_COUNT_FIELD){var field=formConfig.fields[fieldId],aggType=field.agg.type.dslName;_this.chartData.detectors[fieldId].fieldFormat=mlFieldFormatService.getFieldFormatFromIndexPattern(formConfig.indexPattern,fieldId,aggType)}}):deferred.resolve(_this.chartData);var aggregationsByTime=_lodash2.default.get(resp,["aggregations","times","buckets"],[]);_lodash2.default.each(aggregationsByTime,function(dataForTime){var time=+dataForTime.key,date=new Date(time),docCount=+dataForTime.doc_count;_this.chartData.job.swimlane.push({date:date,time:time,value:0,color:"",percentComplete:0}),_this.chartData.job.earliestTime=time<_this.chartData.job.earliestTime?time:_this.chartData.job.earliestTime,_this.chartData.job.line.push({date:date,time:time,value:null}),_lodash2.default.each(fieldIds,function(fieldId){var value=void 0;fieldId===_general.EVENT_RATE_COUNT_FIELD?value=docCount:void 0!==dataForTime[fieldId].value?value=dataForTime[fieldId].value:void 0!==dataForTime[fieldId].values&&(value=dataForTime[fieldId].values[_job_utils.ML_MEDIAN_PERCENTS]),isFinite(value)&&0!==docCount||(value=null),_this.chartData.detectors[fieldId]&&(_this.chartData.detectors[fieldId].line.push({date:date,time:time,value:value}),_this.chartData.detectors[fieldId].swimlane.push({date:date,time:time,value:0,color:"",percentComplete:0}),null!==value&&(_this.chartData.detectors[fieldId].highestValue=Math.ceil(Math.max(_this.chartData.detectors[fieldId].highestValue,Math.abs(value)))))})}),deferred.resolve(_this.chartData)}).catch(function(resp){deferred.reject(resp)}),deferred.promise},this.getJobFromConfig=function(formConfig){var job=mlJobService.getBlankJob();job.data_description.time_field=formConfig.timeField,_lodash2.default.each(formConfig.fields,function(field,key){var func=field.agg.type.mlName;formConfig.isSparseData&&("count"===field.agg.type.dslName?func=func.replace(/count/,"non_zero_count"):"sum"===field.agg.type.dslName&&(func=func.replace(/sum/,"non_null_sum")));var dtr={function:func};dtr.detector_description=func,key!==_general.EVENT_RATE_COUNT_FIELD&&(dtr.field_name=field.name,dtr.detector_description+="("+field.name+")"),void 0!==formConfig.splitField&&(dtr.partition_field_name=formConfig.splitField.name),job.analysis_config.detectors.push(dtr)});var influencerFields=formConfig.influencerFields.map(function(f){return f.name});influencerFields&&influencerFields.length&&(job.analysis_config.influencers=influencerFields);var query={match_all:{}};("*"!==formConfig.query.query_string.query||formConfig.filters.length)&&(query=formConfig.combinedQuery),job.analysis_config.bucket_span=formConfig.bucketSpan,job.analysis_limits={model_memory_limit:formConfig.modelMemoryLimit},delete job.data_description.field_delimiter,delete job.data_description.quote_character,delete job.data_description.time_format,delete job.data_description.format;var indices=formConfig.indexPattern.title.split(",").map(function(i){return i.trim()});return job.datafeed_config={query:query,indices:indices},job.job_id=formConfig.jobId,job.description=formConfig.description,job.groups=formConfig.jobGroups,formConfig.useDedicatedIndex&&(job.results_index_name=job.job_id),job},this.createJob=function(formConfig){var _this2=this,deferred=$q.defer();this.job=this.getJobFromConfig(formConfig);var job=createJobForSaving(this.job);return mlJobService.saveNewJob(job).then(function(resp){resp.success?deferred.resolve(_this2.job):deferred.reject(resp)}),deferred.promise},this.startDatafeed=function(formConfig){var datafeedId=mlJobService.getDatafeedId(formConfig.jobId);return mlJobService.startDatafeed(datafeedId,formConfig.jobId,formConfig.start,formConfig.end)},this.stopDatafeed=function(formConfig){var datafeedId=mlJobService.getDatafeedId(formConfig.jobId);return mlJobService.stopDatafeed(datafeedId,formConfig.jobId)}})},3413:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _jquery=__webpack_require__(12),_jquery2=_interopRequireDefault(_jquery),_d=__webpack_require__(15),_d2=_interopRequireDefault(_d),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment),_time_buckets=__webpack_require__(168),_chart_utils=__webpack_require__(133);__webpack_require__(2).uiModules.get("apps/ml").directive("mlMultiMetricJobChart",function(Private){function link(scope,element){function init(){var $el=_angular2.default.element(".multi-metric-job-container .card-front"),offset=$el.hasClass("card")?30:0;margin.left=scope.chartTicksMargin.width,svgWidth=$el.width()-offset,vizWidth=svgWidth-margin.left-margin.right,lineChartXScale=_d2.default.time.scale().range([0,vizWidth]),lineChartYScale=_d2.default.scale.linear().range([lineChartHeight,0]),lineChartValuesLine=_d2.default.svg.line().x(function(d){return lineChartXScale(d.date)}).y(function(d){return lineChartYScale(d.value)}).defined(function(d){return null!==d.value})}function createSVGGroups(){if(void 0!==scope.chartData.line){var chartElement=_d2.default.select(element.get(0));if(chartElement.select("svg").remove(),chartElement.select(".progress").remove(),null===chartElement.select(".progress-bar")[0][0]){var style="width: "+(+vizWidth+2)+"px;\n          margin-bottom: -"+(+lineChartHeight-15)+"px;\n          margin-left: "+(+margin.left-1)+"px;'";chartElement.append("div").attr("class","progress").attr("style",style).append("div").attr("class","progress-bar")}$progressBar=(0,_jquery2.default)(".progress-bar");var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);swimlaneGroup=svg.append("g").attr("class","swimlane").attr("transform","translate("+margin.left+", "+margin.top+")"),lineChartGroup=svg.append("g").attr("class","line-chart").attr("transform","translate("+margin.left+", "+margin.top+")")}}function drawLineChart(){var data=scope.chartData.line;lineChartXScale=lineChartXScale.domain(_d2.default.extent(data,function(d){return d.date})),chartLimits.max=_d2.default.max(data,function(d){return d.value}),chartLimits.min=_d2.default.min(data,function(d){return d.value});var padding=.05*(chartLimits.max-chartLimits.min);chartLimits.max+=padding,chartLimits.min-=padding,lineChartYScale=lineChartYScale.domain([chartLimits.min,chartLimits.max]);var timeBuckets=new TimeBuckets;if(timeBuckets.setInterval("auto"),data.length>0){var xDomain=lineChartXScale.domain(),bounds={min:(0,_moment2.default)(xDomain[0]),max:(0,_moment2.default)(xDomain[1])};timeBuckets.setBounds(bounds)}var xAxisTickFormat=timeBuckets.getScaledDateFormat(),xAxis=_d2.default.svg.axis().scale(lineChartXScale).orient("bottom").innerTickSize(-lineChartHeight).outerTickSize(0).tickPadding(10).ticks((0,_chart_utils.numTicksForDateFormat)(vizWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)}),yAxis=_d2.default.svg.axis().scale(lineChartYScale).orient("left").innerTickSize(-vizWidth).outerTickSize(0).tickPadding(10);void 0!==scope.chartData.fieldFormat&&yAxis.tickFormat(function(d){return scope.chartData.fieldFormat.convert(d,"text")}),swimlaneGroup.append("rect").attr("x",0).attr("y",0).attr("height",lineChartHeight).attr("width",vizWidth).style("fill","#FFFFFF"),lineChartGroup.append("rect").attr("x",0).attr("y",0).attr("height",lineChartHeight).attr("width",vizWidth).style("stroke","#cccccc").style("fill","none").style("stroke-width",1),drawLineChartAxes(xAxis,yAxis),drawLineChartPaths(data),(0,_chart_utils.drawLineChartDots)(data,lineChartGroup,lineChartValuesLine)}function drawLineChartAxes(xAxis,yAxis){var axes=lineChartGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0, "+lineChartHeight+")").call(xAxis),axes.append("g").attr("class","y axis").call(yAxis)}function drawLineChartPaths(data){lineChartGroup.append("path").attr("class","values-line").attr("d",lineChartValuesLine(data))}function drawResults(){drawSwimlane(vizWidth,lineChartHeight),updateProgressBar()}function drawSwimlane(swlWidth,swlHeight){var data=scope.chartData.swimlane,cellWidth=0;data.length>0&&(cellWidth=lineChartXScale(data[0].time+scope.chartData.swimlaneInterval)-lineChartXScale(data[0].time)),_d2.default.time.scale().range([0,swlWidth]).domain(_d2.default.extent(data,function(d){return d.date})),_d2.default.scale.linear().range([swlHeight,0]).domain([0,swlHeight]);var color=_d2.default.scale.threshold().domain([3,25,50,75,100]).range(["#d2e9f7","#8bc8fb","#ffdd00","#ff7e00","#fe5050"]);swimlaneGroup.select(".swimlane-cells").remove(),swimlaneGroup.append("g").attr("class","swimlane-cells").selectAll("cells").data(data).enter().append("rect").attr("x",function(d){return lineChartXScale(d.date)}).attr("y",0).attr("rx",0).attr("ry",0).attr("class",function(d){return d.value>0?"swimlane-cell":"swimlane-cell-hidden"}).attr("width",cellWidth-0).attr("height",swlHeight-0).style("fill",function(d){return color(d.value)})}function updateProgressBar(){var pcnt=scope.chartData.percentComplete<100?scope.chartData.percentComplete:0;$progressBar.css("width",pcnt+"%")}var svgWidth=0,lineChartHeight=scope.chartHeight,margin={top:0,right:0,bottom:20,left:scope.chartTicksMargin.width},svgHeight=lineChartHeight+margin.top+margin.bottom,vizWidth=svgWidth-margin.left-margin.right,chartLimits={max:0,min:0},TimeBuckets=Private(_time_buckets.TimeBucketsProvider),lineChartXScale=null,lineChartYScale=null,lineChartGroup=void 0,swimlaneGroup=void 0,lineChartValuesLine=null,$progressBar=void 0;scope.$on("render",function(){init(),createSVGGroups(),drawLineChart()}),scope.$on("render-results",function(){drawResults()}),element.on("$destroy",function(){scope.$destroy()})}return{scope:{chartData:"=",chartHeight:"=",chartTicksMargin:"="},link:link}})},3414:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _jquery=__webpack_require__(12),_jquery2=_interopRequireDefault(_jquery),_d=__webpack_require__(15),_d2=_interopRequireDefault(_d),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment);__webpack_require__(181);var _time_buckets=__webpack_require__(168),_chart_utils=__webpack_require__(133);__webpack_require__(2).uiModules.get("apps/ml").directive("mlEventRateChart",function(Private){function link(scope,element){function init(){var $el=_angular2.default.element(".event-rate-container");margin.left=scope.chartTicksMargin.width,svgWidth=$el.width(),vizWidth=svgWidth-margin.left-margin.right,barChartXScale=_d2.default.scale.linear().rangeRound([0,vizWidth],.05),swimlaneXScale=_d2.default.time.scale().range([0,vizWidth]),barChartYScale=_d2.default.scale.linear().range([barChartHeight,0])}function createSVGGroups(){if(void 0!==scope.chartData.bars){var chartElement=_d2.default.select(element.get(0));if(chartElement.select("svg").remove(),chartElement.select(".progress").remove(),null===chartElement.select(".progress-bar")[0][0]){var style="width: "+(+vizWidth+2)+"px;\n          margin-bottom: -"+(+barChartHeight-15)+"px;\n          margin-left: "+(+margin.left-1)+"px;'";chartElement.append("div").attr("class","progress").attr("style",style).append("div").attr("class","progress-bar")}$progressBar=(0,_jquery2.default)(".progress-bar");var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);barChartGroup=svg.append("g").attr("class","bar-chart").attr("transform","translate("+margin.left+","+margin.top+")"),swimlaneGroup=svg.append("g").attr("class","swimlane").attr("transform","translate("+margin.left+","+margin.top+")")}}function drawBarChart(){var data=scope.chartData.bars,finerData=scope.chartData.bars;scope.chartData.line.length>0&&(finerData=scope.chartData.line),swimlaneXScale.domain(_d2.default.extent(finerData,function(d){return d.date})),barChartXScale=_d2.default.time.scale().range([0,vizWidth]).domain(_d2.default.extent(data,function(d){return d.date})),chartLimits.max=_d2.default.max(data,function(d){return d.value}),chartLimits.min=0;var padding=.05*(chartLimits.max-chartLimits.min);chartLimits.max+=padding,barChartYScale=barChartYScale.domain([chartLimits.min,chartLimits.max]);var timeBuckets=new TimeBuckets;if(timeBuckets.setInterval("auto"),data.length>0){var xDomain=barChartXScale.domain(),bounds={min:(0,_moment2.default)(xDomain[0]),max:(0,_moment2.default)(xDomain[1])};timeBuckets.setBounds(bounds)}var xAxisTickFormat=timeBuckets.getScaledDateFormat(),xAxis=_d2.default.svg.axis().scale(swimlaneXScale).orient("bottom").innerTickSize(-barChartHeight).outerTickSize(0).tickPadding(10).ticks((0,_chart_utils.numTicksForDateFormat)(vizWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)}),yAxis=_d2.default.svg.axis().scale(barChartYScale).orient("left").innerTickSize(-vizWidth).outerTickSize(0).tickPadding(10);barChartGroup.append("rect").attr("x",0).attr("y",0).attr("height",barChartHeight).attr("width",vizWidth).style("fill","#FFFFFF"),barChartGroup.append("rect").attr("x",0).attr("y",0).attr("height",barChartHeight).attr("width",vizWidth).style("stroke","#cccccc").style("fill","none").style("stroke-width",1),drawBarChartAxes(xAxis,yAxis),drawBarChartPaths(data)}function drawBarChartAxes(xAxis,yAxis){var axes=barChartGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0,"+barChartHeight+")").call(xAxis),axes.append("g").attr("class","y axis").call(yAxis)}function drawBarChartPaths(data){var earliestTime=scope.chartData.earliestTime,cellWidth=0;data.length>0&&(cellWidth=barChartXScale(earliestTime+scope.chartData.barsInterval)-barChartXScale(earliestTime)),barChartGroup.selectAll("bar").data(data).enter().append("rect").style("fill","#32a7c2").attr("class","bar").attr("x",function(d){return barChartXScale(d.time)}).attr("width",cellWidth).attr("y",function(d){return barChartYScale(d.value)}).attr("height",function(d){return barChartHeight-barChartYScale(d.value)})}function drawResults(){updateProgressBar(),drawSwimlane(vizWidth,barChartHeight)}function drawSwimlane(swlWidth,swlHeight){var lineData=scope.chartData.line,data=scope.chartData.swimlane,earliestTime=scope.chartData.earliestTime,cellWidth=0;data.length>0&&(cellWidth=barChartXScale(earliestTime+scope.chartData.swimlaneInterval)-barChartXScale(earliestTime)),_d2.default.time.scale().range([0,swlWidth]).domain(_d2.default.extent(lineData,function(d){return d.date})),_d2.default.scale.linear().range([swlHeight,0]).domain([0,swlHeight]);var color=_d2.default.scale.threshold().domain([3,25,50,75,100]).range(["#d2e9f7","#8bc8fb","#ffdd00","#ff7e00","#fe5050"]);swimlaneGroup.select(".swimlane-cells").remove(),swimlaneGroup.append("g").attr("class","swimlane-cells").selectAll("cells").data(data).enter().append("rect").attr("x",function(d){return swimlaneXScale(d.date)}).attr("y",0).attr("rx",0).attr("ry",0).attr("class",function(d){return d.value>0?"swimlane-cell":"swimlane-cell-hidden"}).attr("width",cellWidth-0).attr("height",swlHeight-0).style("fill",function(d){return color(d.value)})}function updateProgressBar(){var pcnt=scope.chartData.percentComplete;$progressBar.css("width",pcnt+"%")}var svgWidth=0,barChartHeight=scope.eventRateChartHeight,margin={top:0,right:0,bottom:20,left:scope.chartTicksMargin.width},svgHeight=barChartHeight+margin.top+margin.bottom,vizWidth=svgWidth-margin.left-margin.right,chartLimits={max:0,min:0},TimeBuckets=Private(_time_buckets.TimeBucketsProvider),barChartXScale=null,swimlaneXScale=null,barChartYScale=null,barChartGroup=void 0,swimlaneGroup=void 0,$progressBar=void 0;scope.$on("render",function(){init(),createSVGGroups(),drawBarChart()}),scope.$on("render-results",function(){drawResults()}),element.on("$destroy",function(){scope.$destroy()})}return{scope:{chartData:"=",eventRateChartHeight:"=",chartTicksMargin:"="},link:link}})},3415:function(module,exports){},3416:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3417),__webpack_require__(3419)},3417:function(module,exports,__webpack_require__){"use strict";var _states=__webpack_require__(373),_fields_selection=__webpack_require__(3418),_fields_selection2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_fields_selection);__webpack_require__(2).uiModules.get("apps/ml").directive("mlFieldsSelection",function(){return{restrict:"E",replace:!0,template:_fields_selection2.default,controller:function($scope){$scope.toggleFields=function(field){var key=field.id;void 0===$scope.formConfig.fields[key]?($scope.formConfig.fields[key]=field,$scope.chartStates.fields[key]=_states.CHART_STATE.LOADING):(delete $scope.formConfig.fields[key],delete $scope.chartStates.fields[key]),void 0!==$scope.formConfig.splitField&&$scope.setModelMemoryLimit()}}}})},3418:function(module,exports){module.exports='<div class=\'fields-selection\'>\n  <h4 class="euiTitle euiTitle--small">Fields</h4>\n  <div class="euiSpacer euiSpacer--s"></div>\n  <div class="row">\n    <div class="col-md-12">\n      <div class="form-group">\n\n        <div class=\'selection-list-container fields-list\'>\n          <div class="checkbox field-row" ng-repeat="field in ui.fields" >\n            <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n              <input type="checkbox"\n                class=\'kuiCheckBox\'\n                ng-checked="formConfig.fields[field.id] !== undefined"\n                ng-click="toggleFields(field); formChange()"\n                ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                />\n              <span\n                class=\'kuiCheckBoxLabel__text\'\n                tooltip=\'{{field.tooltip}}\'\n                tooltip-append-to-body="true">\n                {{field.name}}\n              </span>\n            </label>\n            <div>\n              <select\n                ng-model="field.agg.type"\n                ng-options="agg as agg.title for agg in ui.aggTypeOptions | filterAggTypes:field"\n                ng-change="formChange()"\n                ng-disabled="formConfig.fields[field.id] === undefined || jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                class="form-control agg-type">\n              </select>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="row form-controls" ng-show=\'ui.isCountOrSum\'>\n    <span class="col-md-12">\n      <label class=\'kuiCheckBoxLabel kuiVerticalRhythm sparse-data\'>\n        <input type="checkbox"\n          class=\'kuiCheckBox\'\n          ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n          ng-model  ="formConfig.isSparseData" />\n          <span class=\'kuiCheckBoxLabel__text\'>\n            Sparse data <i ml-info-icon="new_job_sparsedata" tooltip-append-to-body="true"></i>\n          </span>\n      </label>\n    </span>\n  </div>\n</div>\n'},3419:function(module,exports){},3420:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _influencers_selection=__webpack_require__(3421),_influencers_selection2=_interopRequireDefault(_influencers_selection),_lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash);__webpack_require__(2).uiModules.get("apps/ml").directive("mlInfluencersSelection",function(){return{restrict:"E",replace:!0,template:_influencers_selection2.default,controller:function($scope){function getDefaultFields(){var defaultFields=getSplitFields();return!0===$scope.formConfig.hasOwnProperty("overField")&&void 0===defaultFields.find(function(f){return f.name===$scope.formConfig.overField.name})&&defaultFields.push($scope.formConfig.overField),defaultFields}function getNonDefaultFields(defaultFields){return $scope.formConfig.influencerFields.filter(function(f){return void 0===defaultFields.find(function(sp){return sp===f})})}function getSplitFields(){if(!1===$scope.formConfig.hasOwnProperty("splitField")){var splitFields=$scope.formConfig.fields.map(function(f){return f.splitField}).filter(function(f){return void 0!==f&&""!==f});return splitFields=_lodash2.default.uniq(splitFields,"name")}return void 0===$scope.formConfig.splitField?[]:[$scope.formConfig.splitField]}$scope.isDefaultInfluencer=function(field){return void 0!==getDefaultFields().find(function(f){return f.name===field.name})},$scope.toggleInfluencerChange=function(){$scope.addDefaultFieldsToInfluencerList()},$scope.addDefaultFieldsToInfluencerList=function(){var defaultFields=getDefaultFields(),nonDefaultFields=getNonDefaultFields(defaultFields);$scope.formConfig.influencerFields=defaultFields.concat(nonDefaultFields)}}}})},3421:function(module,exports){module.exports='<div class="influencers-selection">\n  <div>\n    <h4 class="euiTitle euiTitle--small">Key Fields (Influencers)</h4>\n    <div class="euiSpacer euiSpacer--s"></div>\n  </div>\n  <div class="row">\n    <div class="col-md-12">\n      <div class="form-group">\n        <div class=\'selection-list-container\'>\n          <ui-select\n            ng-model="formConfig.influencerFields"\n            ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n            on-select="toggleInfluencerChange()"\n            on-remove="toggleInfluencerChange()"\n            multiple\n            append-to-body=true\n          >\n            <ui-select-match placeholder="Key fields">\n              <span ng-class="{\'default-influencer\': isDefaultInfluencer($item)}">\n                <ml-field-type-icon type="$item.mlType"></ml-field-type-icon>{{$item.name}}\n              </span>\n            </ui-select-match>\n            <ui-select-choices repeat="field in ui.splitFields | filter: { name: $select.search }" group-by="\'mlType\'">\n              <ml-field-type-icon type="field.mlType"></ml-field-type-icon>\n              <span class="select-item" ng-bind-html="(field.name | highlight: $select.search)"></span>\n            </ui-select-choices>\n          </ui-select>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'},3422:function(module,exports){},3423:function(module,exports,__webpack_require__){"use strict";var _bucket_span_selection=__webpack_require__(3424),_bucket_span_selection2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_bucket_span_selection);__webpack_require__(2).uiModules.get("apps/ml").directive("mlBucketSpanSelection",function(){return{restrict:"E",replace:!0,template:_bucket_span_selection2.default,controller:function($scope){$scope.bucketSpanFieldChange=function(){$scope.ui.bucketSpanEstimator.status=0,$scope.ui.bucketSpanEstimator.message="",$scope.formChange()},$scope.bucketSpanEstimatorExportedFunctions={}}}})},3424:function(module,exports){module.exports='<div class=\'bucket-span-selection\'>\n  <h4 class="euiTitle euiTitle--small" id="ml_aria_label_new_job_bucketspan">Bucket span</h4><i ml-info-icon="new_job_bucketspan" />\n  <div class="euiSpacer euiSpacer--s"></div>\n  <div class="row">\n    <div class="col-md-12">\n      <div class="form-group">\n        <div>\n          <input\n            aria-labelledby="ml_aria_label_new_job_bucketspan"\n            aria-describedby="ml_aria_description_new_job_bucketspan"\n            ng-model="formConfig.bucketSpan"\n            required\n            placeholder={{formConfig-bucketSpan}}\n            ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED || ui.bucketSpanEstimator.status===1"\n            ng-change="bucketSpanFieldChange()"\n            ng-class=\'{"ng-invalid": (!ui.bucketSpanValid)}\'\n            class="form-control lowercase bucket-span-input" />\n\n          <ml-bucket-span-estimator\n            bucket-span-field-change="bucketSpanFieldChange"\n            form-config=\'formConfig\'\n            job-state-wrapper=\'{jobState:jobState}\'\n            job-state=\'JOB_STATE\'\n            ui=\'ui\'\n            exported-functions=\'bucketSpanEstimatorExportedFunctions\'>\n          </ml-bucket-span-estimator>\n\n        </div>\n        <div ng-hide="ui.bucketSpanValid" class="validation-error">Invalid interval format</div>\n        <div ng-show="ui.bucketSpanEstimator.status===-1" class="validation-error">{{ui.bucketSpanEstimator.message}}</div>\n      </div>\n    </div>\n\n    <div class="col-md-0">\n    </div>\n  </div>\n</div>\n'},3425:function(module,exports){},3426:function(module,exports,__webpack_require__){"use strict";var _general_job_details=__webpack_require__(3427),_general_job_details2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_general_job_details),_change_job_id_case=__webpack_require__(1178);__webpack_require__(2).uiModules.get("apps/ml").directive("mlGeneralJobDetails",function(){return{restrict:"E",replace:!0,template:_general_job_details2.default,controller:function($scope){$scope.changeJobIDCase=_change_job_id_case.changeJobIDCase}}})},3427:function(module,exports){module.exports='<div class="general-job-details">\n  <div class="form-group">\n    <ml-form-label label-id="new_job_id" tooltip-append-to-body="true">Name</ml-form-label>\n    <input\n      aria-labelledby="ml_aria_label_new_job_id"\n      aria-describedby="ml_aria_description_new_job_id"\n      id="job-id-input"\n      ng-model="formConfig.jobId"\n      required\n      placeholder="Job ID"\n      ng-change="changeJobIDCase(formConfig)"\n      ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n      class="form-control lowercase" />\n    <div ng-hide="ui.validation.checks.jobId.valid" class="validation-error">{{ ( ui.validation.checks.jobId.message || "Enter a name for the job" ) }}</div>\n  </div>\n\n  <div class="form-group">\n    <ml-form-label label-id="new_job_description">Description</ml-form-label>\n    <input\n      aria-labelledby="ml_aria_label_new_job_description"\n      aria-describedby="ml_aria_description_new_job_description"\n      ng-model="formConfig.description"\n      placeholder="Job description"\n      ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n      class="form-control" />\n  </div>\n  <div class="form-group">\n    <ml-form-label label-id="new_job_group">Job Groups</ml-form-label>\n    <ml-job-group-select\n      aria-labelledby="ml_aria_label_new_job_group"\n      aria-describedby="ml_aria_description_new_job_group"\n      job-groups=\'formConfig.jobGroups\'\n      disabled=\'(jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)\' />\n    <div ng-hide="ui.validation.checks.groupIds.valid" class="validation-error">{{ ui.validation.checks.groupIds.message }}</div>\n  </div>\n\n  <div class="form-group">\n    <div ng-click="ui.showAdvanced = (!ui.showAdvanced || formConfig.useDedicatedIndex)" class="advanced-button-container">\n      <button\n        aria-label="{{ ui.showAdvanced ? \'Hide Advanced\' : \'Show Advanced\' }}"\n        ng-disabled="formConfig.useDedicatedIndex"\n        type="button"\n        class="kuiButton kuiButton--small kuiButton--hollow advanced-button">\n        <i aria-hidden="true" ng-class="{ \'fa-caret-down\': ui.showAdvanced, \'fa-caret-right\': !ui.showAdvanced }" class="fa"></i>\n      </button>\n      <label class="kuiFormLabel" aria-describedby="ml_aria_description_new_job_advanced_settings">Advanced</label>\n      <i ml-info-icon="new_job_advanced_settings" ></i>\n    </div>\n    <div class=\'advanced-group\' ng-show="ui.showAdvanced">\n      <div class="form-group">\n      <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n        <input type="checkbox"\n          aria-labelledby="ml_aria_label_new_job_dedicated_index"\n          aria-describedby="ml_aria_description_new_job_dedicated_index"\n          class=\'kuiCheckBox\'\n          ng-model  ="formConfig.useDedicatedIndex" />\n        <span class=\'kuiCheckBoxLabel__text\'>\n          <span id="ml_aria_label_new_job_dedicated_index">Use dedicated index</span>\n          <i ml-info-icon="new_job_dedicated_index" ></i>\n        </span>\n      </label>\n      </div>\n      <div class="form-group">\n        <label class=\'kuiFormLabel kuiVerticalRhythm\'>\n          <span id="ml_aria_label_new_job_model_memory_limit">\n            Model memory limit\n          </span>\n          <i ml-info-icon="new_job_model_memory_limit"></i>\n        </label>\n        <div></div>\n        <input\n          aria-labelledby="ml_aria_label_new_job_model_memory_limit"\n          aria-describedby="ml_aria_description_new_job_model_memory_limit"\n          type="text"\n          ng-model=\'formConfig.modelMemoryLimit\'\n          class="kuiTextInput kuiTextInput--large" />\n        <div ng-hide="ui.validation.checks.modelMemoryLimit.valid" class="validation-error">{{ ui.validation.checks.modelMemoryLimit.message }}</div>\n      </div>\n    </div>\n  </div>\n  <div class="form-group"></div>\n</div>\n'},3428:function(module,exports){},3429:function(module,exports,__webpack_require__){"use strict";var _field_types=__webpack_require__(208),_general=__webpack_require__(305);__webpack_require__(2).uiModules.get("apps/ml").filter("filterAggTypes",function(){return function(aggTypes,field){return aggTypes.filter(function(type){if(field.id===_general.EVENT_RATE_COUNT_FIELD){if(type.isCountType)return!0}else if(!type.isCountType){if(field.mlType!==_field_types.ML_JOB_FIELD_TYPES.KEYWORD&&field.mlType!==_field_types.ML_JOB_FIELD_TYPES.IP)return!0;if(type.isAggregatableStringType)return!0}return!1})}})},3430:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3431)},3431:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3432),__webpack_require__(3433),__webpack_require__(3435),__webpack_require__(3436),__webpack_require__(374),__webpack_require__(306),__webpack_require__(687),__webpack_require__(688),__webpack_require__(1180),__webpack_require__(3437),__webpack_require__(1181),__webpack_require__(1182),__webpack_require__(1183),__webpack_require__(1184),__webpack_require__(302),__webpack_require__(480),__webpack_require__(307),__webpack_require__(482)},3432:function(module,exports){},3433:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash);__webpack_require__(303);var _index=__webpack_require__(259),_validation_utils=__webpack_require__(476),_parse_interval=__webpack_require__(166),_datemath=__webpack_require__(81),_datemath2=_interopRequireDefault(_datemath),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular),_routes=__webpack_require__(11),_routes2=_interopRequireDefault(_routes),_check_license=__webpack_require__(101),_check_privilege=__webpack_require__(93),_ml_time_buckets=__webpack_require__(169),_filter_agg_types=__webpack_require__(682),_validate_job=__webpack_require__(683),_adjust_interval=__webpack_require__(684),_new_job_utils=__webpack_require__(192),_app_state_settings=__webpack_require__(685),_states=__webpack_require__(373),_create_fields=__webpack_require__(686),_index_utils=__webpack_require__(132),_chart_data_utils=__webpack_require__(1179),_check_ml_nodes=__webpack_require__(108),_new_job_defaults=__webpack_require__(258),_string_utils=__webpack_require__(43),_create_job=__webpack_require__(3434),_create_job2=_interopRequireDefault(_create_job),_modules=__webpack_require__(2);_routes2.default.when("/jobs/new_job/simple/population",{template:_create_job2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.getIndexPatternWithRoute,savedSearch:_index_utils.getSavedSearchWithRoute,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults}}),_modules.uiModules.get("apps/ml").controller("MlCreatePopulationJob",function($scope,$route,$timeout,$q,timefilter,Private,mlJobService,mlPopulationJobService,mlMessageBarService,mlFullTimeRangeSelectorService,AppState){function setTime(){$scope.ui.bucketSpanValid=!0,$scope.formConfig.start=_datemath2.default.parse(timefilter.time.from).valueOf(),$scope.formConfig.end=_datemath2.default.parse(timefilter.time.to).valueOf(),$scope.formConfig.format="epoch_millis";var bucketSpanInterval=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan);null!==bucketSpanInterval&&0!==bucketSpanInterval.asMilliseconds()||($scope.ui.bucketSpanValid=!1);var bounds=timefilter.getActiveBounds();$scope.formConfig.chartInterval=new MlTimeBuckets,$scope.formConfig.chartInterval.setBarTarget(BAR_TARGET),$scope.formConfig.chartInterval.setMaxBars(MAX_BARS),$scope.formConfig.chartInterval.setInterval("auto"),$scope.formConfig.chartInterval.setBounds(bounds),(0,_adjust_interval.adjustIntervalDisplayed)($scope.formConfig),$scope.ui.isFormValid(),$scope.ui.dirty=!0}function setFieldsChartStates(state){_lodash2.default.each($scope.chartStates.fields,function(chart,key){$scope.chartStates.fields[key]=state})}function drawCards(fieldIndex){function fadeCard(callTime){if(i<cardsBehind.length){var now=callTime,elapsed=now-then;elapsed>fpsInterval&&(cardsBehind[i].style.opacity=1,i++,then=now-elapsed%fpsInterval),window.requestAnimationFrame(fadeCard)}}var animate=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],labels=$scope.formConfig.fields[fieldIndex].cardLabels,$frontCard=_angular2.default.element(".population-job-container .detector-container.card-"+fieldIndex+" .card-front");$frontCard.addClass("card"),$frontCard.find(".card-title").text(labels[0]);var w=$frontCard.width(),marginTop=labels.length>1?54:0;$frontCard.css("margin-top",marginTop);var backCardTitle="";2===labels.length&&(backCardTitle=$scope.formConfig.fields[Object.keys($scope.formConfig.fields)[0]].agg.type.title,backCardTitle+=" ",backCardTitle+=Object.keys($scope.formConfig.fields)[0]),_angular2.default.element(".detector-container.card-"+fieldIndex+" .card-behind").remove();for(var _i=0;_i<labels.length;_i++){var el='<div class="card card-behind"><div class="card-title">';el+=(0,_string_utils.mlEscape)(labels[_i]),el+='</div><label class="kuiFormLabel">',el+=(0,_string_utils.mlEscape)(backCardTitle),el+="</label></div>";var $backCard=_angular2.default.element(el);$backCard.css("width",w),$backCard.css("height",100),$backCard.css("display","auto"),$backCard.css("z-index",9-_i),$backCard.insertBefore($frontCard)}for(var cardsBehind=_angular2.default.element(".detector-container.card-"+fieldIndex+" .card-behind"),marginLeft=0,backWidth=w,_i2=0;_i2<cardsBehind.length;_i2++)cardsBehind[_i2].style.marginTop=marginTop+"px",cardsBehind[_i2].style.marginLeft=marginLeft+"px",cardsBehind[_i2].style.width=backWidth+"px",marginTop-=(10-_i2*(10/labels.length))*(10/labels.length),marginLeft+=5-_i2/2,backWidth-=2*(5-_i2/2);var i=0,then=window.performance.now(),fpsInterval=50;if(animate)fadeCard();else for(var j=0;j<cardsBehind.length;j++)cardsBehind[j].style.opacity=1}function destroyCards(fieldIndex){_angular2.default.element(".detector-container.card-"+fieldIndex+" .card-behind").remove();var $frontCard=_angular2.default.element(".population-job-container .detector-container.card-"+fieldIndex+" .card-front");$frontCard.removeClass("card"),$frontCard.find(".card-title").text(""),$frontCard.css("margin-top",0)}function sortSplitCards(){$timeout(function(){$scope.formConfig.fields.forEach(function(f,i){void 0===f.splitField?destroyCards(i):drawCards(i,!1)})},0)}function loadCharts(){function run(){refreshCounter++,reloadJobSwimlaneData().then(function(){reloadDetectorSwimlane().then(function(){!1===forceStop&&$scope.chartData.percentComplete<100?$scope.jobState===_states.JOB_STATE.STOPPING?$scope.jobState=_states.JOB_STATE.STOPPING:$scope.jobState=_states.JOB_STATE.RUNNING:$scope.jobState=_states.JOB_STATE.FINISHED,jobCheck()})})}var forceStop=globalForceStop;refreshCounter>=20-refreshInterval/REFRESH_INTERVAL_MS?(refreshCounter=0,mlJobService.updateSingleJobDatafeedState($scope.formConfig.jobId).then(function(state){"stopped"===state&&(console.log("Stopping poll because datafeed state is: "+state),$scope.$broadcast("render-results"),forceStop=!0),run()})):run()}function jobCheck(){$scope.jobState===_states.JOB_STATE.RUNNING||$scope.jobState===_states.JOB_STATE.STOPPING?(refreshInterval=adjustRefreshInterval($scope.chartData.loadingDifference,refreshInterval),_lodash2.default.delay(loadCharts,refreshInterval)):_lodash2.default.each($scope.chartData.detectors,function(chart){chart.percentComplete=100}),$scope.chartData.percentComplete>0&&toggleSwimlaneVisibility(),$scope.$broadcast("render-results")}function reloadJobSwimlaneData(){return chartDataUtils.loadJobSwimlaneData($scope.formConfig,$scope.chartData)}function reloadDetectorSwimlane(){return chartDataUtils.loadDetectorSwimlaneData($scope.formConfig,$scope.chartData)}function adjustRefreshInterval(loadingDifference,currentInterval){var interval=currentInterval;return interval<1e4&&(loadingDifference<MAX_BUCKET_DIFF?interval+=100:interval-100>=REFRESH_INTERVAL_MS&&(interval-=100)),interval}function toggleSwimlaneVisibility(){$scope.jobState===_states.JOB_STATE.NOT_STARTED?(_angular2.default.element(".swimlane-cells").css("opacity",0),_angular2.default.element(".bar").css("opacity",1)):_angular2.default.element(".bar").css("opacity",.1)}function resize(){if(void 0!==$scope.formConfig.splitField)for(var width=_angular2.default.element(".card-front").width(),cardsBehind=_angular2.default.element(".card-behind"),i=0;i<cardsBehind.length;i++)cardsBehind[i].style.width=width+"px",width-=2*(5-i/2)}timefilter.enableTimeRangeSelector(),timefilter.disableAutoRefreshSelector();var msgs=mlMessageBarService,MlTimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider),chartDataUtils=Private(_chart_data_utils.ChartDataUtilsProvider);$scope.addNewJobToRecentlyAccessed=_new_job_utils.addNewJobToRecentlyAccessed;var stateDefaults={mlJobSettings:{}},appState=new AppState(stateDefaults),aggTypes=Private(_index.AggTypesIndexProvider);mlPopulationJobService.clearChartData(),$scope.chartData=mlPopulationJobService.chartData;var jobDefaults=(0,_new_job_defaults.newJobDefaults)(),PAGE_WIDTH=_angular2.default.element(".population-job-container").width(),BAR_TARGET=PAGE_WIDTH>1600?800:PAGE_WIDTH/2,MAX_BARS=BAR_TARGET+BAR_TARGET/100*100,REFRESH_INTERVAL_MS=100,MAX_BUCKET_DIFF=3,DEFAULT_MODEL_MEMORY_LIMIT=jobDefaults.anomaly_detectors.model_memory_limit,refreshCounter=0;$scope.JOB_STATE=_states.JOB_STATE,$scope.jobState=$scope.JOB_STATE.NOT_STARTED,$scope.CHART_STATE=_states.CHART_STATE,$scope.chartStates={eventRate:_states.CHART_STATE.LOADING,fields:{}};var globalForceStop=!1,_createSearchItems=(0,_new_job_utils.createSearchItems)($route),indexPattern=_createSearchItems.indexPattern,savedSearch=_createSearchItems.savedSearch,query=_createSearchItems.query,filters=_createSearchItems.filters,combinedQuery=_createSearchItems.combinedQuery;(0,_index_utils.timeBasedIndexCheck)(indexPattern,!0);var pageTitle=void 0!==savedSearch.id?"saved search "+savedSearch.title:"index pattern "+indexPattern.title;$scope.ui={indexPattern:indexPattern,pageTitle:pageTitle,showJobInput:!0,showJobFinished:!1,dirty:!1,formValid:!1,bucketSpanValid:!0,bucketSpanEstimator:{status:0,message:""},aggTypeOptions:(0,_filter_agg_types.filterAggTypes)(aggTypes.byType.metrics),fields:[],overFields:[],splitFields:[],timeFields:[],splitText:"",intervals:[{title:"Auto",value:"auto"},{title:"Millisecond",value:"ms"},{title:"Second",value:"s"},{title:"Minute",value:"m"},{title:"Hourly",value:"h"},{title:"Daily",value:"d"},{title:"Weekly",value:"w"},{title:"Monthly",value:"M"},{title:"Yearly",value:"y"},{title:"Custom",value:"custom"}],eventRateChartHeight:100,chartHeight:150,showFieldCharts:!1,showAdvanced:!1,validation:{checks:{jobId:{valid:!0},groupIds:{valid:!0},modelMemoryLimit:{valid:!0},duplicateDetectors:{valid:!0}}},isOverField:function(field){return field.name===$scope.formConfig.overField.name?null:field}},$scope.formConfig={agg:{type:void 0},fields:[],bucketSpan:"15m",chartInterval:void 0,resultsIntervalSeconds:void 0,start:0,end:0,overField:void 0,timeField:indexPattern.timeFieldName,influencerFields:[],firstSplitFieldName:void 0,indexPattern:indexPattern,query:query,filters:filters,combinedQuery:combinedQuery,jobId:void 0,description:void 0,jobGroups:[],useDedicatedIndex:!1,modelMemoryLimit:DEFAULT_MODEL_MEMORY_LIMIT},$scope.formChange=function(refreshCardLayout){$scope.ui.isFormValid(),$scope.ui.dirty=!0,$scope.loadVis(),refreshCardLayout&&sortSplitCards()},$scope.overChange=function(){$scope.addDefaultFieldsToInfluencerList(),$scope.formChange()},$scope.splitChange=function(fieldIndex,splitField){return $q(function(resolve){$scope.formConfig.fields[fieldIndex].firstSplitFieldName=void 0,void 0!==splitField?($scope.formConfig.fields[fieldIndex].splitField=splitField,$scope.addDefaultFieldsToInfluencerList(),chartDataUtils.getSplitFields($scope.formConfig,splitField.name,10).then(function(resp){resp.results.values&&resp.results.values.length&&($scope.formConfig.fields[fieldIndex].firstSplitFieldName=resp.results.values[0],$scope.formConfig.fields[fieldIndex].cardLabels=resp.results.values),drawCards(fieldIndex,!0),$scope.formChange(),resolve()})):($scope.formConfig.fields[fieldIndex].splitField=void 0,$scope.formConfig.fields[fieldIndex].cardLabels=void 0,setFieldsChartStates(_states.CHART_STATE.LOADING),$scope.toggleInfluencerChange(),$scope.ui.splitText="",destroyCards(fieldIndex),$scope.formChange(),resolve())})},$scope.splitReset=function(fieldIndex){$scope.splitChange(fieldIndex,void 0)},$scope.ui.isFormValid=function(){return void 0===$scope.formConfig.agg.type||void 0===$scope.formConfig.timeField||0===$scope.formConfig.fields.length?$scope.ui.formValid=!1:$scope.ui.formValid=!0,$scope.ui.formValid},$scope.loadVis=function(){function loadDocCountData(dtrs){chartDataUtils.loadDocCountData($scope.formConfig,$scope.chartData).then(function(resp){thisLoadTimestamp===$scope.chartData.lastLoadTimestamp&&(_lodash2.default.each(dtrs,function(dtr,id){var state=resp.totalResults?_states.CHART_STATE.LOADED:_states.CHART_STATE.NO_RESULTS;$scope.chartStates.fields[id]=state}),$scope.chartData.lastLoadTimestamp=null,chartDataUtils.updateChartMargin($scope.chartData),$scope.$broadcast("render"),$scope.chartStates.eventRate=resp.totalResults?_states.CHART_STATE.LOADED:_states.CHART_STATE.NO_RESULTS)}).catch(function(resp){$scope.chartStates.eventRate=_states.CHART_STATE.NO_RESULTS,msgs.error(resp.message)})}var thisLoadTimestamp=Date.now();$scope.chartData.lastLoadTimestamp=thisLoadTimestamp,setTime(),$scope.ui.isFormValid(),$scope.ui.showJobInput=!0,$scope.ui.showJobFinished=!1,$scope.ui.dirty=!1,mlPopulationJobService.clearChartData(),setFieldsChartStates(_states.CHART_STATE.LOADING),$scope.formConfig.fields.length?($scope.ui.showFieldCharts=!0,mlPopulationJobService.getLineChartResults($scope.formConfig,thisLoadTimestamp).then(function(resp){loadDocCountData(resp.detectors)}).catch(function(resp){msgs.error(resp.message),$scope.formConfig.fields.forEach(function(field){var id=field.id;$scope.chartStates.fields[id]=_states.CHART_STATE.NO_RESULTS})})):($scope.ui.showFieldCharts=!1,loadDocCountData([]))};var refreshInterval=REFRESH_INTERVAL_MS;$scope.createJob=function(){function saveNewDatafeed(job,startDatafeedAfterSave){mlJobService.saveNewDatafeed(job.datafeed_config,job.job_id).then(function(){startDatafeedAfterSave&&mlPopulationJobService.startDatafeed($scope.formConfig).then(function(){$scope.jobState=_states.JOB_STATE.RUNNING,refreshCounter=0,refreshInterval=REFRESH_INTERVAL_MS,$scope.formConfig.resultsIntervalSeconds=$scope.formConfig.chartInterval.getInterval().asSeconds();var bucketSpanSeconds=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan).asSeconds();$scope.formConfig.resultsIntervalSeconds<bucketSpanSeconds&&($scope.formConfig.resultsIntervalSeconds=bucketSpanSeconds),$scope.resultsUrl=(0,_new_job_utils.createResultsUrl)([$scope.formConfig.jobId],$scope.formConfig.start,$scope.formConfig.end,"explorer"),loadCharts()}).catch(function(resp){msgs.error("Could not start datafeed: ",resp)})}).catch(function(resp){msgs.error("Save datafeed failed: ",resp)})}var tempJob=mlPopulationJobService.getJobFromConfig($scope.formConfig);(0,_validate_job.validateJob)(tempJob,$scope.ui.validation.checks)?(msgs.clear(),mlPopulationJobService.createJob($scope.formConfig).then(function(job){mlJobService.openJob(job.job_id).then(function(){saveNewDatafeed(job,!0)}).catch(function(resp){msgs.error("Could not open job: ",resp),msgs.error("Job created, creating datafeed anyway"),saveNewDatafeed(job,!1)})}).catch(function(resp){msgs.error("Save failed: ",resp.resp)})):!1===$scope.ui.validation.checks.modelMemoryLimit.valid&&($scope.ui.showAdvanced=!0)},(0,_validation_utils.addJobValidationMethods)($scope,mlPopulationJobService),$scope.resetJob=function(){$scope.jobState=_states.JOB_STATE.NOT_STARTED,toggleSwimlaneVisibility(),window.setTimeout(function(){$scope.ui.showJobInput=!0,$scope.loadVis()},500)},$scope.stopJob=function(){$scope.jobState=_states.JOB_STATE.STOPPING,mlPopulationJobService.stopDatafeed($scope.formConfig)},$scope.setFullTimeRange=function(){mlFullTimeRangeSelectorService.setFullTimeRange($scope.ui.indexPattern,$scope.formConfig.combinedQuery)},function(){_lodash2.default.each($scope.ui.aggTypeOptions,function(agg){"Mean"===agg.title&&($scope.formConfig.agg.type=agg)})}(),(0,_create_fields.createFields)($scope,indexPattern),$scope.loadVis(),$scope.$evalAsync(function(){(0,_app_state_settings.populateAppStateSettings)(appState,$scope)}),$scope.$listen(timefilter,"fetch",$scope.loadVis),_angular2.default.element(window).resize(function(){resize()}),$scope.$on("$destroy",function(){globalForceStop=!0,_angular2.default.element(window).off("resize")})})},3434:function(module,exports){module.exports='<ml-nav-menu name="new_job_population"></ml-nav-menu>\n<ml-chart-tooltip></ml-chart-tooltip>\n<ml-new-job-population>\n  <ml-message-bar></ml-message-bar>\n  <div ng-controller="MlCreatePopulationJob" class="population-job-container">\n    <div class="row">\n      <div class="col-md-6">\n        <h3 class="euiTitle euiTitle--large">New job from {{ui.pageTitle}}</h3>\n      </div>\n      <div class="col-md-6">\n        <div class="pull-right">\n          <span style="font-size:10px;" ng-show="formConfig.chartInterval !== undefined">Chart interval: {{formConfig.chartInterval.getInterval().expression}}</span>\n          <ml-full-time-range-selector\n            disabled=\'(jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)\'\n            index-pattern=\'ui.indexPattern\'\n            query=\'formConfig.combinedQuery\'\n          ></ml-full-time-range-selector>\n        </div>\n      </div>\n    </div>\n\n    <div class="euiSpacer euiSpacer--s"></div>\n\n    <div class="row">\n      <div class="col-md-4">\n        <div class="row form-controls">\n          <h4 class="euiTitle euiTitle--small">Job settings</h4>\n          <div>\n            <div class=\'form-section form-section-overflow\' >\n              <h4 class="euiTitle euiTitle--small">Population</h4>\n              <div class="euiSpacer euiSpacer--s"></div>\n              <div class="row">\n                <div class="col-md-12">\n                  <div class="form-group">\n                    <ui-select\n                      ng-model="formConfig.overField"\n                      on-select="overChange()"\n                      ng-disabled="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                      append-to-body=true>\n                      <ui-select-match placeholder="Select population field">\n                        <ml-field-type-icon type="$select.selected.mlType"></ml-field-type-icon>{{$select.selected.name}}\n                      </ui-select-match>\n                      <ui-select-choices repeat="field in ui.overFields | filter: { name: $select.search }" group-by="\'mlType\'">\n                        <div>\n                          <ml-field-type-icon type="field.mlType"></ml-field-type-icon>\n                          <span\n                            class="select-item"\n                            ng-bind-html="field.name | highlight: $select.search">\n                          </span>\n                        </div>\n                      </ui-select-choices>\n                    </ui-select>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div class=\'form-section form-section-overflow\'>\n              <ml-fields-selection-population></ml-fields-selection-population>\n              <div ng-hide="ui.validation.checks.duplicateDetectors.valid" class="validation-error">{{ ui.validation.checks.duplicateDetectors.message }}</div>\n            </div>\n\n            \x3c!-- <div class=\'form-section\' >\n              <h4 class="euiTitle euiTitle--small">Split Data</h4>\n              <div class="row">\n                <div class="col-md-12">\n                  <div class="form-group">\n                    <select\n                      ng-model="formConfig.splitField"\n                      ng-change="splitChange()"\n                      ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                      class="form-control">\n                        <option value=\'{{undefined}}\'>--No split--</option>\n                        <option ng-repeat="field in ui.splitFields" value=\'{{field}}\'>{{field}}</option>\n                    </select>\n                  </div>\n                </div>\n              </div>\n            </div> --\x3e\n\n            <div class=\'form-section\' >\n              <ml-influencers-selection></ml-influencers-selection>\n            </div>\n\n            <div class=\'form-section\' >\n              <ml-bucket-span-selection></ml-bucket-span-selection>\n            </div>\n\n            <div class=\'form-section\' >\n              <div ng-show="jobState !== JOB_STATE.FINISHED">\n                <h4 class="euiTitle euiTitle--small">Job Details</h4>\n                <div class="euiSpacer euiSpacer--s"></div>\n              </div>\n\n              <div class="form-group">\n                <div ng-show="ui.showJobInput && (jobState === JOB_STATE.NOT_STARTED || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING)">\n                  <ml-general-job-details></ml-general-job-details>\n\n                  <div class="euiFlexGroup euiFlexGroup--gutterSmall euiFlexGroup--alignItemsCenter euiFlexGroup--responsive">\n                    <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                      <ml-validate-job\n                        get-duration="getDuration"\n                        get-job-config="getJobConfig"\n                        fill="false"\n                        is-current-job-config="isCurrentJobConfig"\n                        is-disabled="!ui.formValid"\n                        ng-show="jobState === JOB_STATE.NOT_STARTED"\n                      />\n                    </div>\n                    <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                      <button\n                        aria-label="Create Job"\n                        ng-click="createJob()"\n                        type="button"\n                        ng-show="jobState === JOB_STATE.NOT_STARTED"\n                        ng-disabled="!ui.formValid"\n                        class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                        <span class="euiButton__content">\n                          Create Job\n                        </span>\n                      </button>\n                    </div>\n                  </div>\n\n                  <div class=\'job-state-info\' ng-show="jobState === JOB_STATE.RUNNING">Analysis running <i class=\'fa fa-spinner fa-spin\'></i></div>\n                  <div class=\'job-state-info\' ng-show="jobState === JOB_STATE.STOPPING">Analysis stopping <i class=\'fa fa-spinner fa-spin\'></i></div>\n\n                  <div class="euiSpacer euiSpacer--s"></div>\n\n                  <button\n                    aria-label="Stop Job"\n                    ng-click="stopJob()"\n                    type="button"\n                    ng-show="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING"\n                    ng-disabled="jobState === JOB_STATE.STOPPING"\n                    class="euiButton euiButton--danger euiButton--small">\n                    <span class="euiButton__content">\n                      {{(jobState === JOB_STATE.STOPPING) ? \'Analysis stopping\' : \'Stop analysis\' }}\n                    </span>\n                  </button>\n\n                  <a\n                    href=\'{{resultsUrl}}\'\n                    ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n                    aria-label="View Results"\n                    ng-show="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      View Results\n                    </span>\n                  </a>\n                </div>\n                <div ng-show="jobState === JOB_STATE.FINISHED">\n                  <h3 class="euiTitle euiTitle--large">Job {{formConfig.jobId }} created\n                    <i style="color:green;" class="fa fa-check" aria-label="Saved"></i>\n                  </h3>\n                  <div class="euiSpacer euiSpacer--m"></div>\n\n                  <button\n                    aria-label="Reset"\n                    ng-click="resetJob()"\n                    type="button"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      Reset\n                    </span>\n                  </button>\n                  <a\n                    href=\'{{resultsUrl}}\'\n                    ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n                    aria-label="View Results"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      View Results\n                    </span>\n                  </a>\n                </div>\n\n                <div ng-if=\'jobState === JOB_STATE.FINISHED\'>\n                  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n                  <ml-post-save-options\n                    job-id=\'formConfig.jobId\'\n                    bucket-span=\'formConfig.bucketSpan\'\n                    include-influencers=\'true\'\n                    ></ml-post-save-options>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="col-md-8">\n        <div class="row charts-container">\n          <h4 class="euiTitle euiTitle--small">Results</h4>\n          <div>\n            <div class=\'chart-list-panel event-rate-container\' style=\'height: {{ui.eventRateChartHeight + 70}}px;\'>\n              <label class="kuiFormLabel">Document count</label>\n\n              <div class=\'chart-container\'>\n                <div style=\'height: {{ui.eventRateChartHeight + 25}}px;\'>\n                  <ml-event-rate-chart\n                    chart-data="chartData.job"\n                    event-rate-chart-height=\'ui.eventRateChartHeight\'\n                    chart-ticks-margin="chartData.chartTicksMargin">\n                  </ml-event-rate-chart>\n                </div>\n\n                <div ng-show="chartStates.eventRate === CHART_STATE.NOT_STARTED || chartStates.eventRate === CHART_STATE.LOADING || chartStates.eventRate === CHART_STATE.NO_RESULTS"\n                  class=\'chart-loader event-rate-chart-loader\'\n                  style=\'height: {{ui.eventRateChartHeight}}px; margin-top: -{{ui.eventRateChartHeight + 30}}px;\'>\n                    <div class=\'status-label\' ng-if="chartStates.eventRate === CHART_STATE.NOT_STARTED"></div>\n                    <div class=\'status-label\' ng-if="chartStates.eventRate === CHART_STATE.LOADING">\n                      <h2 class="euiTitle euiTitle"><i class=\'fa fa-spinner fa-spin\'></i></h2>\n                    </div>\n                    <div class=\'status-label\' ng-if="chartStates.eventRate === CHART_STATE.NO_RESULTS">\n                      <div class=\'no-results\'>\n                        <h4 class="euiTitle euiTitle--small"><i class="fa fa-info-circle"></i> No results found</h4>\n                        <span>Consider using the <a ng-click="setFullTimeRange()">full {{ui.indexPattern.title}} data</a></span>\n                      </div>\n                    </div>\n                </div>\n\n              </div>\n\n            </div>\n            <div ng-repeat=\'(id, chart) in chartData.detectors track by id\'>\n              <div class=\'chart-list-panel detector-container card-{{id}}\' ng-show=\'ui.showFieldCharts\'>\n                <div class=\'card-front\'>\n                  <div class="card-title"></div>\n                  <div class=\'chart\' style=\'height: {{ui.chartHeight + 90}}px;\'>\n                    <label class="kuiFormLabel">{{formConfig.fields[id].agg.type.title}} {{formConfig.fields[id].name}} over {{formConfig.overField.name}} <span ng-if="formConfig.fields[id].splitField!==undefined"> split by {{formConfig.fields[id].splitField.name}}</span></label>\n                    <div class="split-controls">\n                      <div class="split-align">Split data: </div>\n                      <div class="split-field-container">\n                        <ui-select\n                          class="split-field-select"\n                          ng-model="formConfig.fields[id].splitField"\n                          ng-change="splitChange(id, $select.selected)"\n                          append-to-body="true"\n                          ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                        >\n                            <ui-select-match placeholder="Select a field">\n                              <ml-field-type-icon type="$select.selected.mlType"></ml-field-type-icon>{{$select.selected.name}}\n                            </ui-select-match>\n                            <ui-select-choices repeat="field in ui.splitFields | filter: { name: $select.search } | filter: ui.isOverField" group-by="\'mlType\'">\n                              <div>\n                                <ml-field-type-icon type="field.mlType"></ml-field-type-icon>\n                                <span\n                                  class="select-item"\n                                  ng-bind-html="field.name | highlight: $select.search">\n                                </span>\n                              </div>\n                            </ui-select-choices>\n                        </ui-select>\n                      </div>\n                      <button\n                        ng-if="formConfig.fields[id].splitField !== undefined && (!ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)"\n                        ng-click="splitReset(id)"\n                        aria-label="Remove split"\n                        ng-disabled="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                        class="euiButton euiButton--primary euiButton--small split-align remove-split"\n                      >\n                        Remove split\n                      </button>\n                    </div>\n\n                    <div class=\'chart-container\'>\n                      <div style=\'height: {{ui.chartHeight + 25}}px;\'>\n                        <ml-population-job-chart\n                          chart-data="chart"\n                          chart-height=\'ui.chartHeight\'\n                          chart-ticks-margin="chartData.chartTicksMargin"\n                          over-field-name="formConfig.overField.name">\n                        </ml-population-job-chart>\n                      </div>\n\n                      <div ng-show="chartStates.fields[id] === CHART_STATE.NOT_STARTED || chartStates.fields[id] === CHART_STATE.LOADING || chartStates.fields[id] === CHART_STATE.NO_RESULTS"\n                        class=\'chart-loader fields-chart-loader\'\n                        style=\'height: {{ui.chartHeight}}px; margin-top: -{{ui.chartHeight + 30}}px; margin-left: {{chartData.chartTicksMargin.width - 1}}px;\'>\n                          <div class=\'status-label\' ng-show="chartStates.fields[id] === CHART_STATE.NOT_STARTED"></div>\n                          <div class=\'status-label\' ng-show="chartStates.fields[id] === CHART_STATE.LOADING">\n                            <h2 class="euiTitle euiTitle"><i class=\'fa fa-spinner fa-spin\'></i></h2>\n                          </div>\n                          <div class=\'status-label\' ng-show="chartStates.fields[id] === CHART_STATE.NO_RESULTS">\n                            <div class=\'no-results\'>\n                              <h4 class="euiTitle euiTitle--small"><i class="fa fa-info-circle"></i> No results found</h4>\n                            </div>\n                          </div>\n                      </div>\n\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</ml-new-job-population>\n'},3435:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular),_general=__webpack_require__(305),_job_utils=__webpack_require__(57),_ml_time_buckets=__webpack_require__(169);__webpack_require__(2).uiModules.get("apps/ml").service("mlPopulationJobService",function($q,es,timefilter,Private,mlFieldFormatService,mlJobService){function getSearchJsonFromConfig(formConfig){var bounds=timefilter.getActiveBounds(),buckets=new TimeBuckets;buckets.setInterval("auto"),buckets.setBounds(bounds);var interval=buckets.getInterval().asMilliseconds(),query=_lodash2.default.cloneDeep(formConfig.combinedQuery),json={index:formConfig.indexPattern.title,size:0,body:{query:{},aggs:{times:{date_histogram:{field:formConfig.timeField,interval:interval,min_doc_count:0,extended_bounds:{min:formConfig.start,max:formConfig.end}}}}}};if(query.bool.must.push({range:_defineProperty({},formConfig.timeField,{gte:formConfig.start,lte:formConfig.end,format:formConfig.format})}),json.body.query=query,formConfig.fields.length){var aggs={};formConfig.fields.forEach(function(field,i){field.id===_general.EVENT_RATE_COUNT_FIELD?void 0!==field.splitField&&(aggs[i]={filter:{term:_defineProperty({},field.splitField.name,field.firstSplitFieldName)}}):void 0!==field.splitField?(aggs[i]={filter:{term:_defineProperty({},field.splitField.name,field.firstSplitFieldName)},aggs:{splitValue:_defineProperty({},field.agg.type.dslName,{field:field.name})}},"percentiles"===field.agg.type.dslName&&(aggs[i].aggs.splitValue[field.agg.type.dslName].percents=[_job_utils.ML_MEDIAN_PERCENTS])):(aggs[i]=_defineProperty({},field.agg.type.dslName,{field:field.name}),"percentiles"===field.agg.type.dslName&&(aggs[i][field.agg.type.dslName].percents=[_job_utils.ML_MEDIAN_PERCENTS]))}),void 0!==formConfig.overField?json.body.aggs.times.aggs={population:{terms:{field:formConfig.overField.name,size:OVER_FIELD_EXAMPLES_COUNT},aggs:aggs}}:json.body.aggs.times.aggs=aggs}return json}function createJobForSaving(job){var newJob=_angular2.default.copy(job);return delete newJob.datafeed_config,newJob}var TimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider),OVER_FIELD_EXAMPLES_COUNT=40;this.chartData={job:{swimlane:[],line:[],bars:[],earliestTime:Number.MAX_SAFE_INTEGER},detectors:{},percentComplete:0,loadingDifference:0,lastLoadTimestamp:null,eventRateHighestValue:0,chartTicksMargin:{width:30},totalResults:0},this.job={},this.clearChartData=function(){this.chartData.job.swimlane=[],this.chartData.job.line=[],this.chartData.job.bars=[],this.chartData.detectors={},this.chartData.percentComplete=0,this.chartData.loadingDifference=0,this.chartData.eventRateHighestValue=0,this.chartData.totalResults=0,this.job={}},this.getLineChartResults=function(formConfig,thisLoadTimestamp){var _this=this,deferred=$q.defer(),fieldIds=formConfig.fields.map(function(f){return f.id});this.chartData.job.earliestTime=formConfig.start;var idx=_lodash2.default.findIndex(fieldIds,function(id){return id===_general.EVENT_RATE_COUNT_FIELD});-1!==idx&&(fieldIds.splice(idx,1),fieldIds.splice(0,0,_general.EVENT_RATE_COUNT_FIELD)),fieldIds.forEach(function(fieldId,i){_this.chartData.detectors[i]={line:[],swimlane:[],highestValue:0}});var searchJson=getSearchJsonFromConfig(formConfig);return es.search(searchJson).then(function(resp){thisLoadTimestamp===_this.chartData.lastLoadTimestamp?fieldIds.forEach(function(fieldId,i){if(_this.chartData.detectors[i]={line:[],swimlane:[],highestValue:0},fieldId!==_general.EVENT_RATE_COUNT_FIELD){var field=formConfig.fields[i],aggType=field.agg.type.dslName;_this.chartData.detectors[i].fieldFormat=mlFieldFormatService.getFieldFormatFromIndexPattern(formConfig.indexPattern,fieldId,aggType)}}):deferred.resolve(_this.chartData);var aggregationsByTime=_lodash2.default.get(resp,["aggregations","times","buckets"],[]);_lodash2.default.each(aggregationsByTime,function(dataForTime){var time=+dataForTime.key,date=new Date(time);_this.chartData.job.swimlane.push({date:date,time:time,value:0,color:"",percentComplete:0}),_this.chartData.job.earliestTime=time<_this.chartData.job.earliestTime?time:_this.chartData.job.earliestTime,_this.chartData.job.line.push({date:date,time:time,value:null}),fieldIds.forEach(function(fieldId,i){var populationBuckets=_lodash2.default.get(dataForTime,["population","buckets"],[]),values=[];fieldId===_general.EVENT_RATE_COUNT_FIELD?populationBuckets.forEach(function(b){void 0===b[i]?values.push({label:b.key,value:b.doc_count}):values.push({label:b.key,value:b[i].doc_count})}):void 0!==dataForTime.population&&populationBuckets.forEach(function(b){var tempBucket=b[i],value=null,tempValue=void 0===tempBucket.value&&void 0!==tempBucket.splitValue?tempBucket.splitValue:tempBucket;value=void 0===tempValue.value&&void 0!==tempValue.values?tempValue.values[_job_utils.ML_MEDIAN_PERCENTS]:tempValue.value,values.push({label:b.key,value:isFinite(value)?value:null})});var highestValueField=_lodash2.default.reduce(values,function(p,c){return c.value>p.value?c:p},{value:0});_this.chartData.detectors[i]&&(_this.chartData.detectors[i].line.push({date:date,time:time,values:values}),_this.chartData.detectors[i].swimlane.push({date:date,time:time,value:0,color:"",percentComplete:0}),_this.chartData.detectors[i].highestValue=Math.ceil(Math.max(_this.chartData.detectors[i].highestValue,Math.abs(highestValueField.value))))})}),deferred.resolve(_this.chartData)}).catch(function(resp){deferred.reject(resp)}),deferred.promise},this.getJobFromConfig=function(formConfig){var job=mlJobService.getBlankJob();job.data_description.time_field=formConfig.timeField,formConfig.fields.forEach(function(field){var func=field.agg.type.mlName;formConfig.isSparseData&&("count"===field.agg.type.dslName?func=func.replace(/count/,"non_zero_count"):"sum"===field.agg.type.dslName&&(func=func.replace(/sum/,"non_null_sum")));var dtr={function:func};dtr.detector_description=func,field.id!==_general.EVENT_RATE_COUNT_FIELD&&(dtr.field_name=field.name,dtr.detector_description+="("+field.name+")"),void 0!==field.splitField&&(dtr.by_field_name=field.splitField.name,dtr.detector_description+=" by "+dtr.by_field_name),void 0!==formConfig.overField&&(dtr.over_field_name=formConfig.overField.name,dtr.detector_description+=" over "+dtr.over_field_name),job.analysis_config.detectors.push(dtr)});var influencerFields=formConfig.influencerFields.map(function(f){return f.name});influencerFields&&influencerFields.length&&(job.analysis_config.influencers=influencerFields);var query={match_all:{}};("*"!==formConfig.query.query_string.query||formConfig.filters.length)&&(query=formConfig.combinedQuery),job.analysis_config.bucket_span=formConfig.bucketSpan,job.analysis_limits={model_memory_limit:formConfig.modelMemoryLimit},delete job.data_description.field_delimiter,delete job.data_description.quote_character,delete job.data_description.time_format,delete job.data_description.format;var indices=formConfig.indexPattern.title.split(",").map(function(i){return i.trim()});return job.datafeed_config={query:query,indices:indices},job.job_id=formConfig.jobId,job.description=formConfig.description,job.groups=formConfig.jobGroups,formConfig.useDedicatedIndex&&(job.results_index_name=job.job_id),job},this.createJob=function(formConfig){var _this2=this,deferred=$q.defer();this.job=this.getJobFromConfig(formConfig);var job=createJobForSaving(this.job);return mlJobService.saveNewJob(job).then(function(resp){resp.success?deferred.resolve(_this2.job):deferred.reject(resp)}),deferred.promise},this.startDatafeed=function(formConfig){var datafeedId=mlJobService.getDatafeedId(formConfig.jobId);return mlJobService.startDatafeed(datafeedId,formConfig.jobId,formConfig.start,formConfig.end)},this.stopDatafeed=function(formConfig){var datafeedId=mlJobService.getDatafeedId(formConfig.jobId);return mlJobService.stopDatafeed(datafeedId,formConfig.jobId)}})},3436:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _jquery=__webpack_require__(12),_jquery2=_interopRequireDefault(_jquery),_d=__webpack_require__(15),_d2=_interopRequireDefault(_d),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment),_time_buckets=__webpack_require__(168),_chart_utils=__webpack_require__(133),_string_utils=__webpack_require__(43);__webpack_require__(2).uiModules.get("apps/ml").directive("mlPopulationJobChart",function(Private,mlChartTooltipService){function link(scope,element){function init(){var $el=_angular2.default.element(".population-job-container .card-front"),offset=$el.hasClass("card")?30:0;margin.left=scope.chartTicksMargin.width,svgWidth=$el.width()-offset,vizWidth=svgWidth-margin.left-margin.right,chartXScale=_d2.default.time.scale().range([0,vizWidth]),chartYScale=_d2.default.scale.linear().range([chartHeight,0])}function createSVGGroups(){if(void 0!==scope.chartData.line){var chartElement=_d2.default.select(element.get(0));if(chartElement.select("svg").remove(),chartElement.select(".progress").remove(),null===chartElement.select(".progress-bar")[0][0]){var style="width: "+(+vizWidth+2)+"px;\n          margin-bottom: -"+(+chartHeight-15)+"px;\n          margin-left: "+(+margin.left-1)+"px;'";chartElement.append("div").attr("class","progress").attr("style",style).append("div").attr("class","progress-bar")}$progressBar=(0,_jquery2.default)(".progress-bar");var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);swimlaneGroup=svg.append("g").attr("class","swimlane").attr("transform","translate("+margin.left+", "+margin.top+")"),chartGroup=svg.append("g").attr("class","line-chart").attr("transform","translate("+margin.left+", "+margin.top+")")}}function drawChart(){if(0!==scope.chartData.line.length){var data=scope.chartData.line.reduce(function(p,c){return c.values.length?c.values.forEach(function(v){p.push({date:c.date,value:v.value,label:v.label})}):p.push({date:c.date,value:null,label:null}),p},[]);chartXScale=chartXScale.domain(_d2.default.extent(data,function(d){return d.date})),chartLimits.max=_d2.default.max(data,function(d){return d.value}),chartLimits.min=_d2.default.min(data,function(d){return d.value});var padding=.05*(chartLimits.max-chartLimits.min);chartLimits.max+=padding,chartLimits.min-=padding,chartYScale=chartYScale.domain([chartLimits.min,chartLimits.max]);var timeBuckets=new TimeBuckets;if(timeBuckets.setInterval("auto"),data.length>0){var xDomain=chartXScale.domain(),bounds={min:(0,_moment2.default)(xDomain[0]),max:(0,_moment2.default)(xDomain[1])};timeBuckets.setBounds(bounds)}var xAxisTickFormat=timeBuckets.getScaledDateFormat(),xAxis=_d2.default.svg.axis().scale(chartXScale).orient("bottom").innerTickSize(-chartHeight).outerTickSize(0).tickPadding(10).ticks((0,_chart_utils.numTicksForDateFormat)(vizWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)}),yAxis=_d2.default.svg.axis().scale(chartYScale).orient("left").innerTickSize(-vizWidth).outerTickSize(0).tickPadding(10);void 0!==scope.chartData.fieldFormat&&yAxis.tickFormat(function(d){return scope.chartData.fieldFormat.convert(d,"text")}),swimlaneGroup.append("rect").attr("x",0).attr("y",0).attr("height",chartHeight).attr("width",vizWidth).style("fill","#FFFFFF"),chartGroup.append("rect").attr("x",0).attr("y",0).attr("height",chartHeight).attr("width",vizWidth).style("stroke","#cccccc").style("fill","none").style("stroke-width",1),drawChartAxes(xAxis,yAxis),drawChartDots(data)}}function drawChartAxes(xAxis,yAxis){var axes=chartGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0, "+chartHeight+")").call(xAxis),axes.append("g").attr("class","y axis").call(yAxis)}function drawChartDots(data){chartGroup.append("g").classed("values-dots",!0).selectAll("circle").data(data).enter().append("circle").attr("cx",function(d){return chartXScale(d.date)}).attr("cy",function(d){return chartYScale(d.value)}).attr("r",3).style("display",function(d){return null===d.value?"none":"auto"}).on("mouseover",function(d){showTooltip(d,this)}).on("mouseout",function(){return mlChartTooltipService.hide()})}function showTooltip(data,el){var contents="";contents+=(0,_moment2.default)(data.date).format("MMMM Do YYYY, HH:mm")+"<br/><hr/>",contents+=(0,_string_utils.mlEscape)(scope.overFieldName)+": "+(0,_string_utils.mlEscape)(data.label)+"<br/>",void 0!==scope.chartData.fieldFormat?contents+="Value: "+scope.chartData.fieldFormat.convert(data.value,"text"):contents+="Value: "+parseInt(data.value),mlChartTooltipService.show(contents,el,{x:5,y:10})}function drawResults(){drawSwimlane(vizWidth,chartHeight),updateProgressBar()}function drawSwimlane(swlWidth,swlHeight){var data=scope.chartData.swimlane,cellWidth=0;data.length>0&&(cellWidth=chartXScale(data[0].time+scope.chartData.swimlaneInterval)-chartXScale(data[0].time)),_d2.default.time.scale().range([0,swlWidth]).domain(_d2.default.extent(data,function(d){return d.date})),_d2.default.scale.linear().range([swlHeight,0]).domain([0,swlHeight]);var color=_d2.default.scale.threshold().domain([3,25,50,75,100]).range(["#d2e9f7","#8bc8fb","#ffdd00","#ff7e00","#fe5050"]);swimlaneGroup.select(".swimlane-cells").remove(),swimlaneGroup.append("g").attr("class","swimlane-cells").selectAll("cells").data(data).enter().append("rect").attr("x",function(d){return chartXScale(d.date)}).attr("y",0).attr("rx",0).attr("ry",0).attr("class",function(d){return d.value>0?"swimlane-cell":"swimlane-cell-hidden"}).attr("width",cellWidth-0).attr("height",swlHeight-0).style("fill",function(d){return color(d.value)})}function updateProgressBar(){var pcnt=scope.chartData.percentComplete<100?scope.chartData.percentComplete:0;$progressBar.css("width",pcnt+"%")}var svgWidth=0,chartHeight=scope.chartHeight,margin={top:0,right:0,bottom:20,left:scope.chartTicksMargin.width},svgHeight=chartHeight+margin.top+margin.bottom,vizWidth=svgWidth-margin.left-margin.right,chartLimits={max:0,min:0},TimeBuckets=Private(_time_buckets.TimeBucketsProvider),chartXScale=null,chartYScale=null,chartGroup=void 0,swimlaneGroup=void 0,$progressBar=void 0;scope.$on("render",function(){init(),createSVGGroups(),drawChart()}),scope.$on("render-results",function(){drawResults()}),element.on("$destroy",function(){scope.$destroy()})}return{scope:{chartData:"=",chartHeight:"=",chartTicksMargin:"=",overFieldName:"="},link:link}})},3437:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3438),__webpack_require__(3440),__webpack_require__(307)},3438:function(module,exports,__webpack_require__){"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_states=__webpack_require__(373),_general=__webpack_require__(305),_fields_selection=__webpack_require__(3439),_fields_selection2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_fields_selection);__webpack_require__(2).uiModules.get("apps/ml").directive("mlFieldsSelectionPopulation",function(){return{restrict:"E",replace:!0,template:_fields_selection2.default,controller:function($scope){$scope.eventRateSelected=!1,$scope.tempSelectedField={field:void 0},$scope.selectField=function(){$scope.addField()},$scope.addField=function(){if(!1===$scope.eventRateSelected||!0===$scope.eventRateSelected&&$scope.tempSelectedField.field.id!==_general.EVENT_RATE_COUNT_FIELD){var field=_extends({},$scope.tempSelectedField.field,{agg:{type:$scope.tempSelectedField.field.agg.type}});$scope.formConfig.fields.push(field),$scope.chartStates.fields[field.id]=_states.CHART_STATE.LOADING,$scope.sortFields(),$scope.formChange(!0)}$scope.tempSelectedField.field=void 0},$scope.removeField=function(index,field){$scope.formConfig.fields.splice(index,1),delete $scope.chartStates.fields[field.id],$scope.sortFields(),$scope.formChange(!0)},$scope.sortFields=function(){$scope.eventRateSelected=!1;var eventRateIndex=-1;$scope.formConfig.fields.forEach(function(f,i){f.id===_general.EVENT_RATE_COUNT_FIELD&&(eventRateIndex=i,$scope.eventRateSelected=!0)}),eventRateIndex>=0&&$scope.formConfig.fields.splice(0,0,$scope.formConfig.fields.splice(eventRateIndex,1)[0])}}}})},3439:function(module,exports){module.exports='<div class=\'fields-selection-population\'>\n  <h4 class="euiTitle euiTitle--small">Fields</h4>\n  <div class="euiSpacer euiSpacer--s"></div>\n  <div class="row">\n    <div class="col-md-12">\n      <div class="form-group">\n        <div class="field-select-container">\n          <ui-select\n            ng-model="tempSelectedField.field"\n            on-select="selectField()"\n            ng-disabled="formConfig.overField === undefined || jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n            append-to-body=true>\n            <ui-select-match placeholder="Add field">\n                <ml-field-type-icon type="$select.selected.mlType"></ml-field-type-icon>{{$select.selected.name}}\n            </ui-select-match>\n            <ui-select-choices repeat="field in ui.fields | filter: { name: $select.search }" group-by="\'mlType\'">\n              <ml-field-type-icon type="field.mlType"></ml-field-type-icon>\n              <span class="select-item" ng-bind-html="field.name | highlight: $select.search"></span>\n            </ui-select-choices>\n          </ui-select>\n\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="row" ng-show="formConfig.fields.length > 0">\n    <div class="col-md-12">\n      <div class="form-group">\n\n        <div class=\'selection-list-container fields-list\'>\n          <div class="checkbox field-row" ng-repeat="field in formConfig.fields track by $index">\n            <div class=\'field kuiCheckBoxLabel kuiVerticalRhythm\'>\n              <span\n                class=\'kuiCheckBoxLabel__text\'\n                tooltip=\'{{field.tooltip}}\'\n                tooltip-append-to-body="true">\n                {{field.name}}\n              </span>\n            </div>\n            <div>\n              <div class="agg-type">\n                <select\n                  class="form-control"\n                  ng-model="field.agg.type"\n                  ng-options="agg as agg.title for agg in ui.aggTypeOptions | filterAggTypes:field"\n                  ng-change="formChange()"\n                  ng-disabled="formConfig.fields[$index] === undefined || jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED">\n                </select>\n                <button\n                  aria-label="Remove Detector"\n                  ng-click="removeField($index, field)"\n                  tooltip-append-to-body="true"\n                  ng-disabled="formConfig.fields[$index] === undefined || jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                  type="button"\n                  class="euiButton euiButton--danger euiButton--small remove-button">\n                    <i aria-hidden="true" class="fa fa-trash"></i>\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'},3440:function(module,exports){},3441:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _jquery=__webpack_require__(12),_jquery2=_interopRequireDefault(_jquery),_chart_tooltip=__webpack_require__(3442),_chart_tooltip2=_interopRequireDefault(_chart_tooltip);__webpack_require__(2).uiModules.get("apps/ml").directive("mlChartTooltip",function(mlChartTooltipService){return{restrict:"E",replace:!0,template:_chart_tooltip2.default,link:function(scope,element){mlChartTooltipService.element=element}}}).service("mlChartTooltipService",function($timeout){this.element=null,this.fadeTimeout=null;var doc=document.documentElement;this.show=function(contents,target){var offset=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0};if(null!==this.element){null!==this.fadeTimeout&&$timeout.cancel(this.fadeTimeout),this.element.html(contents);var navOffset=(0,_jquery2.default)(".global-nav").width(),contentWidth=(0,_jquery2.default)("body").width()-navOffset-10,tooltipWidth=this.element.width(),scrollTop=(window.pageYOffset||doc.scrollTop)-(doc.clientTop||0),pos=target.getBoundingClientRect(),x=pos.left+offset.x+4-navOffset,y=pos.top+offset.y+scrollTop;x+tooltipWidth>contentWidth?this.element.css({left:x-(tooltipWidth+offset.x+22),top:y-28}):this.element.css({left:x,top:y-28}),this.element.css({opacity:"0.9",display:"block"})}this.hide=function(){var _this=this;null!==this.element&&(this.element.css({opacity:"0"}),this.fadeTimeout=$timeout(function(){_this.element.css("display","none"),_this.fadeTimeout=null},200))}}})},3442:function(module,exports){module.exports='<div class="ml-chart-tooltip euiText"></div>\n'},3443:function(module,exports){},3444:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3445)},3445:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3446),__webpack_require__(3447),__webpack_require__(3449),__webpack_require__(306),__webpack_require__(302)},3446:function(module,exports){},3447:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular),_datemath=__webpack_require__(81),_datemath2=_interopRequireDefault(_datemath),_job_utils=__webpack_require__(57),_new_job_utils=__webpack_require__(192);__webpack_require__(303);var _routes=__webpack_require__(11),_routes2=_interopRequireDefault(_routes),_check_license=__webpack_require__(101),_check_privilege=__webpack_require__(93),_index_utils=__webpack_require__(132),_check_ml_nodes=__webpack_require__(108),_create_job=__webpack_require__(3448),_create_job2=_interopRequireDefault(_create_job),_modules=__webpack_require__(2);_routes2.default.when("/jobs/new_job/simple/recognize",{template:_create_job2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.getIndexPatternWithRoute,savedSearch:_index_utils.getSavedSearchWithRoute,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable}}),_modules.uiModules.get("apps/ml").controller("MlCreateRecognizerJobs",function($scope,$window,$route,$q,ml,timefilter,Private,mlCreateRecognizerJobsService,mlJobService,mlMessageBarService){function loadJobConfigs(){ml.getDataRecognizerModule({moduleId:moduleId}).then(function(resp){if(resp.jobs&&resp.jobs.length){var tempGroups={};resp.jobs.forEach(function(job){$scope.formConfig.jobs.push({id:job.id,jobConfig:job.config,jobState:SAVE_STATE.NOT_SAVED,datafeedId:null,datafeedConfig:{},datafeedState:SAVE_STATE.NOT_SAVED,runningState:DATAFEED_STATE.NOT_STARTED,errors:[]}),$scope.ui.numberOfJobs++,job.config.groups&&job.config.groups.length&&job.config.groups.forEach(function(group){tempGroups[group]=null})}),$scope.formConfig.jobGroups=Object.keys(tempGroups),resp.datafeeds.forEach(function(datafeed){var job=_lodash2.default.find($scope.formConfig.jobs,{id:datafeed.config.job_id});if(void 0!==job){var datafeedId=mlJobService.getDatafeedId(job.id);job.datafeedId=datafeedId,job.datafeedConfig=datafeed.config}})}resp.kibana&&(_lodash2.default.each(resp.kibana,function(obj,key){obj.forEach(function(o){$scope.formConfig.kibanaObjects[key].push({id:o.id,title:o.title,saveState:SAVE_STATE.NOT_SAVED,config:o.config,exists:!1})})}),checkIfKibanaObjectsExist($scope.formConfig.kibanaObjects))})}function saveDataRecognizerItems(){return $q(function(resolve){setAllToSaving();var prefix=$scope.formConfig.jobLabel,indexPatternName=$scope.formConfig.indexPattern.title,groups=$scope.formConfig.jobGroups;ml.setupDataRecognizerConfig({moduleId:moduleId,prefix:prefix,groups:groups,indexPatternName:indexPatternName}).then(function(resp){resp.jobs&&$scope.formConfig.jobs.forEach(function(job){var jobId=""+prefix+job.id,jobResult=resp.jobs.find(function(j){return j.id===jobId});void 0!==jobResult?jobResult.success?job.jobState=SAVE_STATE.SAVED:(job.jobState=SAVE_STATE.FAILED,jobResult.error&&jobResult.error.msg&&job.errors.push(jobResult.error.msg)):(job.jobState=SAVE_STATE.FAILED,job.errors.push("Could not save job "+jobId));var datafeedId=(0,_job_utils.prefixDatafeedId)(job.datafeedId,prefix),datafeedResult=resp.datafeeds.find(function(d){return d.id===datafeedId});void 0!==datafeedResult?datafeedResult.success?job.datafeedState=SAVE_STATE.SAVED:(job.datafeedState=SAVE_STATE.FAILED,datafeedResult.error&&datafeedResult.error.msg&&job.errors.push(datafeedResult.error.msg)):(job.datafeedState=SAVE_STATE.FAILED,job.errors.push("Could not save datafeed "+datafeedId))}),resp.kibana&&_lodash2.default.each($scope.formConfig.kibanaObjects,function(kibanaObject,objName){kibanaObject.forEach(function(obj){var kibanaObjectResult=resp.kibana[objName].find(function(o){return o.id===obj.id});void 0!==kibanaObjectResult?kibanaObjectResult.success||!1===kibanaObjectResult.success&&!0===kibanaObjectResult.exists?obj.saveState=SAVE_STATE.SAVED:obj.saveState=SAVE_STATE.FAILED:(obj.saveState=SAVE_STATE.FAILED,obj.errors.push("Could not save "+objName+" "+obj.id))})}),resolve()})})}function setAllToSaving(){$scope.formConfig.jobs.forEach(function(j){j.jobState=SAVE_STATE.SAVING,j.datafeedState=SAVE_STATE.SAVING}),_lodash2.default.each($scope.formConfig.kibanaObjects,function(kibanaObject){kibanaObject.forEach(function(obj){obj.saveState=SAVE_STATE.SAVING})})}function startDatafeeds(){return $q(function(resolve,reject){var jobs=$scope.formConfig.jobs,numberOfJobs=jobs.length;mlCreateRecognizerJobsService.indexTimeRange($scope.formConfig.indexPattern,$scope.formConfig).then(function(resp){function incrementAndOpen(job){jobsCounter++,jobsCounter<numberOfJobs?open(jobs[jobsCounter]):job.runningState===DATAFEED_STATE.FAILED&&reject()}function open(job){if(job.jobState===SAVE_STATE.FAILED)return job.runningState=DATAFEED_STATE.FAILED,void incrementAndOpen(job);job.runningState=DATAFEED_STATE.STARTING;var jobId=$scope.formConfig.jobLabel+job.id;mlJobService.openJob(jobId).then(function(){incrementAndOpen(job),start(job)}).catch(function(err){console.log("Opening job failed",err),start(job),job.errors.push(err.message),incrementAndOpen(job)})}function start(job){var jobId=$scope.formConfig.jobLabel+job.id,datafeedId=(0,_job_utils.prefixDatafeedId)(job.datafeedId,$scope.formConfig.jobLabel);mlCreateRecognizerJobsService.startDatafeed(datafeedId,jobId,$scope.formConfig.start,$scope.formConfig.end).then(function(){job.runningState=DATAFEED_STATE.STARTED,++datafeedCounter===numberOfJobs&&resolve()}).catch(function(err){console.log("Starting datafeed failed",err),job.errors.push(err.message),job.runningState=DATAFEED_STATE.FAILED,reject(err)})}$scope.formConfig.useFullIndexData?($scope.formConfig.start=resp.start.epoch,$scope.formConfig.end=resp.end.epoch):($scope.formConfig.start=_datemath2.default.parse(timefilter.time.from).valueOf(),$scope.formConfig.end=_datemath2.default.parse(timefilter.time.to).valueOf());var jobsCounter=0,datafeedCounter=0;open(jobs[jobsCounter])})})}function checkIfKibanaObjectsExist(kibanaObjects){_lodash2.default.each(kibanaObjects,function(objects,type){objects.forEach(function(obj){checkForSavedObject(type,obj).then(function(result){result&&(obj.saveState=SAVE_STATE.SAVED,obj.exists=!0)})})})}function checkForSavedObject(type,savedObject){return $q(function(resolve,reject){var exists=!1;mlCreateRecognizerJobsService.loadExistingSavedObjects(type).then(function(resp){resp.savedObjects.forEach(function(obj){savedObject.title===obj.attributes.title&&(exists=!0,savedObject.id=obj.id)}),resolve(exists)}).catch(function(resp){console.log("Could not load saved objects",resp),reject(resp)})})}function validateJobs(){var valid=!0,checks=$scope.ui.validation.checks;_lodash2.default.each(checks,function(item){item.valid=!0});var label=$scope.formConfig.jobLabel+"extra";if(!1===(0,_job_utils.isJobIdValid)(label)){valid=!1,checks.jobLabel.valid=!1;var msg="Job label can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";msg+="must start and end with an alphanumeric character",checks.jobLabel.message=msg}return $scope.formConfig.jobGroups.forEach(function(group){if(!1===(0,_job_utils.isJobIdValid)(group)){valid=!1,checks.groupIds.valid=!1;var _msg="Job group names can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";_msg+="must start and end with an alphanumeric character",checks.groupIds.message=_msg}}),valid}timefilter.disableTimeRangeSelector(),timefilter.disableAutoRefreshSelector(),$scope.tt=timefilter;var msgs=mlMessageBarService,SAVE_STATE={NOT_SAVED:0,SAVING:1,SAVED:2,FAILED:3},DATAFEED_STATE={NOT_STARTED:0,STARTING:1,STARTED:2,FINISHED:3,STOPPING:4,FAILED:5};$scope.addNewJobToRecentlyAccessed=_new_job_utils.addNewJobToRecentlyAccessed,$scope.SAVE_STATE=SAVE_STATE,$scope.DATAFEED_STATE=DATAFEED_STATE,$scope.overallState=SAVE_STATE.NOT_SAVED;var _createSearchItems=(0,_new_job_utils.createSearchItems)($route),indexPattern=_createSearchItems.indexPattern,query=_createSearchItems.query,pageTitle="index pattern "+indexPattern.title;$scope.ui={formValid:!0,indexPattern:indexPattern,pageTitle:pageTitle,showJobInput:!0,numberOfJobs:0,kibanaLabels:{dashboard:"Dashboards",search:"Searches",visualization:"Visualizations"},validation:{checks:{jobLabel:{valid:!0},groupIds:{valid:!0}}}},$scope.formConfig={indexPattern:indexPattern,jobLabel:"",jobGroups:[],jobs:[],kibanaObjects:{dashboard:[],search:[],visualization:[]},start:0,end:0,query:query,filters:[],useFullIndexData:!0,startDatafeedAfterSave:!0},$scope.resultsUrl="";var moduleId=$route.current.params.id;$scope.resetJob=function(){$scope.overallState=SAVE_STATE.NOT_SAVED,$scope.formConfig.jobs=[],$scope.formConfig.filters=[],$scope.formConfig.kibanaObjects.dashboard=[],$scope.formConfig.kibanaObjects.search=[],$scope.formConfig.kibanaObjects.visualization=[],loadJobConfigs()},$scope.changeUseFullIndexData=function(){$scope.formConfig.useFullIndexData?timefilter.disableTimeRangeSelector():timefilter.enableTimeRangeSelector(),$scope.$applyAsync()},$scope.changeJobLabelCase=function(){$scope.formConfig.jobLabel=$scope.formConfig.jobLabel.toLowerCase()},$scope.save=function(){validateJobs()&&(msgs.clear(),$scope.overallState=SAVE_STATE.SAVING,_angular2.default.element(".results").css("opacity",1),window.setTimeout(function(){saveDataRecognizerItems().then(function(){var jobIds=$scope.formConfig.jobs.map(function(job){return""+$scope.formConfig.jobLabel+job.id});$scope.formConfig.startDatafeedAfterSave?startDatafeeds().then(function(){$scope.overallState=SAVE_STATE.SAVED,$scope.resultsUrl=(0,_new_job_utils.createResultsUrl)(jobIds,$scope.formConfig.start,$scope.formConfig.end,"explorer")}).catch(function(){$scope.overallState=SAVE_STATE.FAILED}):($scope.overallState=SAVE_STATE.SAVED,$scope.resultsUrl=(0,_new_job_utils.createResultsUrl)(jobIds,$scope.formConfig.start,$scope.formConfig.end,"explorer"))})},500))},loadJobConfigs()})},3448:function(module,exports){module.exports='<ml-nav-menu name="new_job_multi_metric"></ml-nav-menu>\n<ml-new-job-recognizer>\n  <ml-message-bar></ml-message-bar>\n  <div ng-controller="MlCreateRecognizerJobs" class="recognizer-job-container">\n    <div class="row">\n      <div class="col-md-6">\n        <h3 class="euiTitle euiTitle--large">New job from {{ui.pageTitle}}</h3>\n      </div>\n    </div>\n\n    <div class="euiSpacer euiSpacer--s"></div>\n\n    <div class="row">\n      <div class="col-md-4">\n        <div class="row form-controls">\n          <h4 class="euiTitle euiTitle--small">Job settings</h4>\n          <div>\n\n            <div class=\'form-section\' >\n              <div ng-show="jobState !== SAVE_STATE.FINISHED">\n                <h4 class="euiTitle euiTitle--small">Job Details</h4>\n                <div class="euiSpacer euiSpacer--s"></div>\n              </div>\n\n              <div class="form-group">\n                <div ng-show="ui.showJobInput && (overallState === SAVE_STATE.NOT_SAVED || overallState === SAVE_STATE.SAVING)">\n                  <div class="form-group">\n                    <ml-form-label label-id="new_job_recognizer_job_prefix">Job ID prefix</ml-form-label>\n                    <input\n                      aria-labelledby="ml_aria_label_new_job_recognizer_job_prefix"\n                      aria-describedby="ml_aria_description_new_job_recognizer_job_prefix"\n                      ng-model="formConfig.jobLabel"\n                      placeholder="Job ID prefix"\n                      ng-change="changeJobLabelCase()"\n                      ng-disabled="overallState === SAVE_STATE.SAVING"\n                      class="form-control lowercase" />\n                      <div ng-hide="ui.validation.checks.jobLabel.valid" class="validation-error">{{ ui.validation.checks.jobLabel.message }}</div>\n                  </div>\n                  <div class="form-group">\n                    <ml-form-label label-id="new_job_group">Job groups</ml-form-label>\n                    <ml-job-group-select\n                      aria-labelledby="ml_aria_label_new_job_group"\n                      aria-describedby="ml_aria_description_new_job_group"\n                      job-groups=\'formConfig.jobGroups\'\n                      disabled=\'(overallState === SAVE_STATE.SAVING)\' />\n                    <div ng-hide="ui.validation.checks.groupIds.valid" class="validation-error">{{ ui.validation.checks.groupIds.message }}</div>\n                  </div>\n                  <div class="form-group">\n                    <div ng-click="ui.showAdvanced = (!ui.showAdvanced || formConfig.useDedicatedIndex)" class="advanced-button-container">\n                      <button\n                        aria-label="{{ ui.showAdvanced ? \'Hide Advanced\' : \'Show Advanced\' }}"\n                        ng-disabled="formConfig.useDedicatedIndex"\n                        type="button"\n                        class="kuiButton kuiButton--small kuiButton--hollow advanced-button">\n                        <i ng-class="{ \'fa-caret-down\': ui.showAdvanced, \'fa-caret-right\': !ui.showAdvanced }" class="fa" aria-label="Show advanced" ></i>\n                      </button>\n                      <label class="kuiFormLabel" aria-describedby="ml_aria_description_new_job_advanced_settings">Advanced</label>\n                      <i ml-info-icon="new_job_advanced_settings" aria-label="Advanced settings" />\n                    </div>\n                    <div class=\'advanced-group\' ng-show="ui.showAdvanced">\n                      <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n                        <input type="checkbox"\n                          aria-labelledby="ml_aria_label_new_job_dedicated_index"\n                          aria-describedby="ml_aria_description_new_job_dedicated_index"\n                          class=\'kuiCheckBox\'\n                          ng-model="formConfig.useDedicatedIndex" />\n                        <span class=\'kuiCheckBoxLabel__text\'>\n                          <span id="ml_aria_label_new_job_dedicated_index">Use dedicated index</span>\n                          <i ml-info-icon="new_job_dedicated_index" aria-label="Use dedicated index" />\n                        </span>\n                      </label>\n                    </div>\n                  </div>\n\n                  <div class="form-group">\n                    <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n                      <input type="checkbox"\n                        class=\'kuiCheckBox\'\n                        ng-model="formConfig.startDatafeedAfterSave" />\n                        <span class=\'kuiCheckBoxLabel__text\'>\n                          Start datafeed after save\n                        </span>\n                    </label>\n                  </div>\n                  <div class="form-group">\n                    <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n                      <input type="checkbox"\n                        class=\'kuiCheckBox\'\n                        ng-change="changeUseFullIndexData()"\n                        ng-model="formConfig.useFullIndexData" />\n                        <span class=\'kuiCheckBoxLabel__text\'>\n                          Use full {{formConfig.indexPattern.title}} data\n                        </span>\n                    </label>\n                  </div>\n\n                  <button\n                    aria-label="Create Job"\n                    ng-click="save()"\n                    type="button"\n                    ng-show="overallState === SAVE_STATE.NOT_SAVED"\n                    ng-disabled="!ui.formValid"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      Create Job{{((ui.numberOfJobs > 1)?\'s\':\'\')}}\n                    </span>\n                  </button>\n\n                  <div class=\'job-state-info\' ng-show="overallState === SAVE_STATE.SAVING">Analysis running <i class=\'fa fa-spinner fa-spin\' aria-label="Analysis running" ></i></div>\n                </div>\n                <div ng-show="overallState === SAVE_STATE.SAVED">\n                  <h3 class="euiTitle euiTitle--large">Jobs created\n                    <i style="color:green;" class="fa fa-check" aria-label="Saved"></i>\n                  </h3>\n                  <div class="euiSpacer euiSpacer--m"></div>\n\n                  <button\n                    aria-label="Reset"\n                    ng-click="resetJob()"\n                    type="button"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      Reset\n                    </span>\n                  </button>\n                  <a\n                    href=\'{{resultsUrl}}\'\n                    ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n                    aria-label="View Results"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      View Results\n                    </span>\n                  </a>\n                </div>\n\n                <div ng-show="overallState === SAVE_STATE.FAILED">\n                  <h3 class="euiTitle euiTitle--large">Jobs creation failed</h3>\n                  <div class="euiSpacer euiSpacer--m"></div>\n\n                  <button\n                    aria-label="Reset"\n                    ng-click="resetJob()"\n                    type="button"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      Reset\n                    </span>\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="col-md-8">\n        <div class="row charts-container">\n          <h4 class="euiTitle euiTitle--small">Jobs</h4>\n          <div class=\'jobs-list\'>\n            <div ng-repeat=\'job in formConfig.jobs\' class=\'job-container\'>\n              <div class=\'labels\'>\n                <div class=\'title\'>{{formConfig.jobLabel}}{{job.id}}</div>\n                <div class=\'sub-title\'>{{job.jobConfig.description}}</div>\n                <div class=\'validation-error\' ng-repeat="error in job.errors">{{error}}</div>\n              </div>\n              <div class=\'results\'>\n                <div class=\'result-box\'>\n                  <div class=\'result-box-title\'>Job</div>\n                  <div class=\'result-box-inner\'>\n                    <i ng-show="job.jobState === SAVE_STATE.NOT_SAVED" aria-label="Not saved" ></i>\n                    <i ng-show="job.jobState === SAVE_STATE.FAILED" style="color:red;" class="fa fa-remove"aria-label="Save failed" ></i>\n                    <i ng-show="job.jobState === SAVE_STATE.SAVING" class="fa fa-spinner fa-spin"aria-label="Saving" ></i>\n                    <i ng-show="job.jobState === SAVE_STATE.SAVED" style="color:green;" class="fa fa-check"aria-label="Saved" ></i>\n                  </div>\n                </div>\n                <div class=\'result-box\'>\n                  <div class=\'result-box-title\'>Datafeed</div>\n                  <div class=\'result-box-inner\'>\n                    <i ng-show="job.datafeedState === SAVE_STATE.NOT_SAVED" aria-label="Not saved" ></i>\n                    <i ng-show="job.datafeedState === SAVE_STATE.FAILED" style="color:red;" class="fa fa-remove"aria-label="Save failed" ></i>\n                    <i ng-show="job.datafeedState === SAVE_STATE.SAVING" class="fa fa-spinner fa-spin"aria-label="Saving" ></i>\n                    <i ng-show="job.datafeedState === SAVE_STATE.SAVED" style="color:green;" class="fa fa-check"aria-label="Saved" ></i>\n                  </div>\n                </div>\n                <div class=\'result-box\' ng-if="formConfig.startDatafeedAfterSave">\n                  <div class=\'result-box-title\'>Running</div>\n                  <div class=\'result-box-inner\'>\n                    <i ng-show="job.runningState === DATAFEED_STATE.NOT_STARTED" aria-label="Not started" ></i>\n                    <i ng-show="job.runningState === DATAFEED_STATE.FAILED" style="color:red;" class="fa fa-remove"aria-label="Start failed" ></i>\n                    <i ng-show="job.runningState === DATAFEED_STATE.STARTING" class="fa fa-spinner fa-spin"aria-label="Starting" ></i>\n                    <i ng-show="job.runningState === DATAFEED_STATE.STARTED" style="color:green;" class="fa fa-check"aria-label="Started" ></i>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="row charts-container" ng-repeat=\'(key, value) in formConfig.kibanaObjects\'>\n          <h4 class="euiTitle euiTitle--small">{{ui.kibanaLabels[key]}}</h4>\n          <div class=\'save-objects-list\'>\n            <div ng-repeat=\'obj in value\' class=\'job-container\'>\n              <div class=\'labels\'>\n                <div class=\'title\' ng-class="{exists: obj.exists}">\n                  {{obj.title}}\n                  <span ng-if="obj.exists">(already exists)</span>\n                </div>\n              </div>\n              <div class=\'results\'>\n                <div class=\'result-box\'>\n                  <div class=\'result-box-inner\'>\n                    <i ng-show="obj.saveState === SAVE_STATE.NOT_SAVED" aria-label="Not saved" ></i>\n                    <i ng-show="obj.saveState === SAVE_STATE.FAILED" style="color:red;" class="fa fa-remove"aria-label="Save failed" ></i>\n                    <i ng-show="obj.saveState === SAVE_STATE.SAVING" class="fa fa-spinner fa-spin"aria-label="Saving" ></i>\n                    <i ng-show="obj.saveState === SAVE_STATE.SAVED  && !obj.exists" style="color:green;" class="fa fa-check"aria-label="Saved" ></i>\n                    <i ng-show="obj.saveState === SAVE_STATE.SAVED && obj.exists" style="color:#BBBBBB;" class="fa fa-check"aria-label="Already saved" ></i>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</ml-new-job-recognizer>\n'},3449:function(module,exports,__webpack_require__){"use strict";var _angular=__webpack_require__(13),_angular2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_angular),_new_job_utils=__webpack_require__(192),_saved_objects=__webpack_require__(67);__webpack_require__(2).uiModules.get("apps/ml").service("mlCreateRecognizerJobsService",function(es,Private,$http,$q,chrome,mlJobService){var savedObjectsClient=Private(_saved_objects.SavedObjectsClientProvider);this.createJob=function(job,formConfig){return $q(function(resolve,reject){var newJob=_angular2.default.copy(job.jobConfig),jobId=formConfig.jobLabel+job.id;newJob.job_id=jobId,newJob.groups=formConfig.jobGroups,mlJobService.saveNewJob(newJob).then(function(resp){resp.success?resolve(resp):reject(resp)})})},this.createDatafeed=function(job,formConfig){return $q(function(resolve,reject){var jobId=formConfig.jobLabel+job.id;mlJobService.saveNewDatafeed(job.datafeedConfig,jobId).then(function(resp){resolve(resp)}).catch(function(resp){reject(resp)})})},this.startDatafeed=function(datafeedId,jobId,start,end){return mlJobService.startDatafeed(datafeedId,jobId,start,end)},this.stopDatafeed=function(formConfig){var datafeedId=mlJobService.getDatafeedId(formConfig.jobId);return mlJobService.stopDatafeed(datafeedId,formConfig.jobId)},this.checkDatafeedStatus=function(formConfig){return mlJobService.updateSingleJobDatafeedState(formConfig.jobId)},this.loadExistingSavedObjects=function(type){return savedObjectsClient.find({type:type,perPage:1e3})},this.createSavedObject=function(type,obj){return savedObjectsClient.create(type,obj)},this.createSavedObjectWithId=function(type,id,obj){var basePath=chrome.addBasePath("/api/saved_objects"),url=basePath+"/"+type+"/"+id;return $http.post(url,{attributes:obj}).catch(function(e){throw e.data.message})},this.indexTimeRange=function(indexPattern,formConfig){return $q(function(resolve,reject){var obj={success:!0,start:{epoch:0,string:""},end:{epoch:0,string:""}},query=(0,_new_job_utils.getQueryFromSavedSearch)(formConfig);es.search({index:indexPattern.title,size:0,body:{query:query,aggs:{earliest:{min:{field:indexPattern.timeFieldName}},latest:{max:{field:indexPattern.timeFieldName}}}}}).then(function(resp){resp.aggregations&&resp.aggregations.earliest&&resp.aggregations.latest&&(obj.start.epoch=resp.aggregations.earliest.value,obj.start.string=resp.aggregations.earliest.value_as_string,obj.end.epoch=resp.aggregations.latest.value,obj.end.string=resp.aggregations.latest.value_as_string),resolve(obj)}).catch(function(resp){reject(resp)})})}})},3450:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3451),__webpack_require__(1185),__webpack_require__(3452),__webpack_require__(3456),__webpack_require__(1186)},3451:function(module,exports){},3452:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3453)},3453:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _routes=__webpack_require__(11),_routes2=_interopRequireDefault(_routes),_check_license=__webpack_require__(101),_preconfigured_job_redirect=__webpack_require__(3454),_check_privilege=__webpack_require__(93),_index_utils=__webpack_require__(132),_check_ml_nodes=__webpack_require__(108),_index_or_search=__webpack_require__(3455),_index_or_search2=_interopRequireDefault(_index_or_search),_modules=__webpack_require__(2);_routes2.default.when("/jobs/new_job",{redirectTo:"/jobs/new_job/step/index_or_search"}),_routes2.default.when("/jobs/new_job/step/index_or_search",{template:_index_or_search2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkCreateJobsPrivilege,indexPatterns:_index_utils.getIndexPatterns,preConfiguredJobRedirect:_preconfigured_job_redirect.preConfiguredJobRedirect,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable}}),_modules.uiModules.get("apps/ml").controller("MlNewJobStepIndexOrSearch",function($scope,$route,timefilter){timefilter.disableTimeRangeSelector(),timefilter.disableAutoRefreshSelector(),$scope.indexPatterns=$route.current.locals.indexPatterns,$scope.withIndexPatternUrl=function(pattern){if(pattern)return"#/jobs/new_job/step/job_type?index="+encodeURIComponent(pattern.id)},$scope.withSavedSearchUrl=function(savedSearch){if(savedSearch)return"#/jobs/new_job/step/job_type?savedSearchId="+encodeURIComponent(savedSearch.id)}})},3454:function(module,exports,__webpack_require__){"use strict";function preConfiguredJobRedirect(Promise,$location,AppState){return new Promise(function(resolve,reject){var stateDefaults={mlJobSettings:{}},appState=new AppState(stateDefaults),redirectUrl=getRedirectUrl(appState);return null===redirectUrl?resolve():($location.path(redirectUrl),reject())})}function getRedirectUrl(appState){if(void 0!==appState.mlJobSettings&&Object.keys(appState.mlJobSettings).length){var page="",jobSettings=appState.mlJobSettings;return jobSettings.fields&&jobSettings.fields.length&&(page=jobSettings.fields.length>1||void 0!==jobSettings.split?void 0!==jobSettings.population?"population":"multi_metric":"single_metric"),"jobs/new_job/simple/"+page}return null}Object.defineProperty(exports,"__esModule",{value:!0}),exports.preConfiguredJobRedirect=preConfiguredJobRedirect},3455:function(module,exports){module.exports='<ml-nav-menu name="new_job"></ml-nav-menu>\n<ml-new-job class="index-or-saved-search-selection">\n  <ml-message-bar></ml-message-bar>\n  <div class=\'kuiViewContent kuiViewContent--constrainedWidth kuiViewContentItem\' >\n    <div ng-controller="MlNewJobStepIndexOrSearch" class="wizard">\n      <div class="wizard-column wizard-column--small">\n        <h3 class="kuiTitle kuiVerticalRhythm">From a New Search, Select Index</h3>\n        <paginated-selectable-list\n          per-page="20"\n          list="indexPatterns"\n          list-property="attributes.title"\n          user-make-url="withIndexPatternUrl"\n          class="wizard-row visualizeWizardPaginatedSelectableList kuiVerticalRhythm"\n        ></paginated-selectable-list>\n      </div>\n      <div class="wizard-column wizard-column--large">\n\n        <h3 class="kuiTitle kuiVerticalRhythm">Or, From a Saved Search</h3>\n        <saved-object-finder\n          title="Saved Searches"\n          type="searches"\n          class="wizard-row visualizeWizardSavedObjectFinder kuiVerticalRhythm"\n          make-url="withSavedSearchUrl"\n        ></saved-object-finder>\n       </div>\n    </div>\n    </div>\n</ml-new-job>\n'},3456:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3457)},3457:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _chrome=__webpack_require__(8),_chrome2=_interopRequireDefault(_chrome),_routes=__webpack_require__(11),_routes2=_interopRequireDefault(_routes),_check_license=__webpack_require__(101),_check_privilege=__webpack_require__(93),_new_job_utils=__webpack_require__(192),_index_utils=__webpack_require__(132),_recently_accessed=__webpack_require__(474),_check_ml_nodes=__webpack_require__(108),_job_type=__webpack_require__(3458),_job_type2=_interopRequireDefault(_job_type),_modules=__webpack_require__(2);_routes2.default.when("/jobs/new_job/step/job_type",{template:_job_type2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.getIndexPatternWithRoute,savedSearch:_index_utils.getSavedSearchWithRoute,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable}}),_modules.uiModules.get("apps/ml").controller("MlNewJobStepJobType",function($scope,$route,timefilter){timefilter.disableTimeRangeSelector(),timefilter.disableAutoRefreshSelector();var _createSearchItems=(0,_new_job_utils.createSearchItems)($route),indexPattern=_createSearchItems.indexPattern,savedSearch=_createSearchItems.savedSearch;$scope.indexWarningTitle="",$scope.isTimeBasedIndex=(0,_index_utils.timeBasedIndexCheck)(indexPattern),!1===$scope.isTimeBasedIndex&&($scope.indexWarningTitle=void 0===savedSearch.id?"Index pattern "+indexPattern.title+" is not time based":savedSearch.title+" uses index pattern "+indexPattern.title+" which is not time based"),$scope.indexPattern=indexPattern,$scope.recognizerResults={count:0},$scope.pageTitleLabel=void 0!==savedSearch.id?"saved search "+savedSearch.title:"index pattern "+indexPattern.title,$scope.getUrl=function(basePath){return void 0===savedSearch.id?basePath+"?index="+indexPattern.id:basePath+"?savedSearchId="+savedSearch.id},$scope.addSelectionToRecentlyAccessed=function(){var title=void 0===savedSearch.id?indexPattern.title:savedSearch.title,url=$scope.getUrl("");(0,_recently_accessed.addItemToRecentlyAccessed)("jobs/new_job/datavisualizer",title,url)},$scope.assetsPath=_chrome2.default.getBasePath()+"/plugins/ml/assets"})},3458:function(module,exports){module.exports='<ml-nav-menu name="new_job"></ml-nav-menu>\n<ml-new-job class="job-type-gallery">\n  <ml-message-bar></ml-message-bar>\n  <div ng-controller="MlNewJobStepJobType">\n    \x3c!-- Presents the various options for creating a job --\x3e\n    <div class="job-types-content">\n      <h1 class="euiTitle euiTitle--large">Create a job from the {{pageTitleLabel}}</h1>\n      <div class="euiSpacer euiSpacer--l"></div>\n\n      <div ng-if="isTimeBasedIndex===false">\n        <div class="index-warning">\n          <div class="euiCallOut euiCallOut--warning">\n            <div class="euiCallOutHeader">\n              <svg class="euiIcon euiCallOutHeader__icon euiIcon--medium" xmlns="http://www.w3.org/2000/svg"\n              width="16" height="16" viewBox="0 0 16 16">\n                <g fill-rule="evenodd">\n                  <path d="M7.5 2.236L1.618 14h11.764L7.5 2.236zm.894-.447l5.882 11.764A1 1 0 0 1 13.382 15H1.618a1 1 0 0 1-.894-1.447L6.606 1.789a1 1 0 0 1 1.788 0z"\n                  />\n                  <path d="M7 6h1v5H7zM7 12h1v1H7z" />\n                </g>\n              </svg>\n              <span class="euiCallOutHeader__title">{{indexWarningTitle}}</span>\n            </div>\n            <div class="euiText euiText--small">\n              <p>Anomaly detection can only be run over indices which are time based.<br/>\n                <a class="euiLink euiLink--primary" href="#jobs/new_job">Select a different index</a>\n              </p>\n            </div>\n          </div>\n        </div>\n        <div class="euiSpacer euiSpacer--xxl"></div>\n      </div>\n\n      <div ng-show="recognizerResults.count!==0" class="recognizer-section">\n        <div class="euiText">\n          <h3 class="euiTitle euiTitle--small">Use a supplied configuration</h3>\n          <p>\n            The fields in your data have been recognized as matching known configurations.\n            Select to create a set of machine learning jobs and associated dashboards.\n          </p>\n        </div>\n        <div class="euiSpacer euiSpacer--m"></div>\n        <ml-data-recognizer\n          class-name=\'"euiFlexGrid euiFlexGrid--gutterLarge euiFlexGrid--fourths"\'\n          item-class-name=\'""\'\n          index-pattern=\'indexPattern\'\n          results=recognizerResults/>\n        <div class="euiSpacer euiSpacer--xxl"></div>\n      </div>\n\n      <div class="euiText">\n        <h3 class="euiTitle euiTitle--small">Use a wizard</h3>\n        <p>\n          Use one of the wizards to create a machine learning job to find anomalies in your data.\n        </p>\n      </div>\n\n      <div class="euiSpacer euiSpacer--m"></div>\n\n      <div class="euiFlexGrid euiFlexGrid--gutterLarge euiFlexGrid--fourths">\n        <div class="euiFlexItem" ng-class=\'{disabled: isTimeBasedIndex===false}\'>\n          <a ng-href="{{getUrl(\'#jobs/new_job/simple/single_metric\')}}" ng-class=\'{disabled: isTimeBasedIndex===false}\' class="euiLink synopsis">\n            <div class="euiPanel euiPanel--paddingMedium synopsisPanel">\n              <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n                <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                  <img class="synopsisIcon" src="{{assetsPath}}/ml_create_single_metric_job.svg" alt="Single metric job">\n                </div>\n                <div class="euiFlexItem synopsisContent">\n                  <h4 class="euiTitle euiTitle--small synopsisTitle">Single metric</h4>\n                  <div class="euiText synopsisBody">\n                    <p>\n                      <span class="euiTextColor euiTextColor--subdued">\n                      Detect anomalies in a single time series.\n                      </span>\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </a>\n        </div>\n        <div class="euiFlexItem" ng-class=\'{disabled: isTimeBasedIndex===false}\'>\n          <a ng-href="{{getUrl(\'#jobs/new_job/simple/multi_metric\')}}" ng-class=\'{disabled: isTimeBasedIndex===false}\' class="euiLink synopsis">\n            <div class="euiPanel euiPanel--paddingMedium synopsisPanel">\n              <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n                <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                  <img class="synopsisIcon" src="{{assetsPath}}/ml_create_multi_metric_job.svg" alt="Multi metric job">\n                </div>\n                <div class="euiFlexItem synopsisContent">\n                  <h4 class="euiTitle euiTitle--small synopsisTitle">Multi metric</h4>\n                  <div class="euiText synopsisBody">\n                    <p>\n                      <span class="euiTextColor euiTextColor--subdued">\n                      Detect anomalies in multiple metrics by splitting a time series by a categorical field.\n                      </span>\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </a>\n        </div>\n        <div class="euiFlexItem" ng-class=\'{disabled: isTimeBasedIndex===false}\'>\n          <a ng-href="{{getUrl(\'#jobs/new_job/simple/population\')}}" ng-class=\'{disabled: isTimeBasedIndex===false}\' class="euiLink synopsis">\n            <div class="euiPanel euiPanel--paddingMedium synopsisPanel">\n              <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n                <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                  <img class="synopsisIcon" src="{{assetsPath}}/ml_create_population_job.svg" alt="Population job">\n                </div>\n                <div class="euiFlexItem synopsisContent">\n                  <h4 class="euiTitle euiTitle--small synopsisTitle">Population</h4>\n                  <div class="euiText synopsisBody">\n                    <p>\n                      <span class="euiTextColor euiTextColor--subdued">\n                      Detect activity that is unusual compared to the behavior of the population.\n                      </span>\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </a>\n        </div>\n        <div class="euiFlexItem" ng-class=\'{disabled: isTimeBasedIndex===false}\'>\n          <a ng-href="{{getUrl(\'#jobs/new_job/advanced\')}}" ng-class=\'{disabled: isTimeBasedIndex===false}\' class="euiLink synopsis">\n            <div class="euiPanel euiPanel--paddingMedium synopsisPanel">\n              <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n                <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                  <img class="synopsisIcon" src="{{assetsPath}}/ml_create_advanced_job.svg" alt="Advanced job">\n                </div>\n                <div class="euiFlexItem synopsisContent">\n                  <h4 class="euiTitle euiTitle--small synopsisTitle">Advanced</h4>\n                  <div class="euiText synopsisBody">\n                    <p>\n                      <span class="euiTextColor euiTextColor--subdued">\n                      Use the full range of options to create a job for more advanced use cases.\n                      </span>\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </a>\n        </div>\n      </div>\n\n      <div class="euiSpacer euiSpacer--xxl"></div>\n\n      <div class="euiText">\n        <h3 class="euiTitle euiTitle--small">Learn more about your data</h3>\n        <p>\n          If you\'re not sure what type of job to create, first explore the fields and metrics in your data.\n        </p>\n      </div>\n      <div class="euiSpacer euiSpacer--m"></div>\n\n      <div class="euiFlexGrid euiFlexGrid--gutterLarge euiFlexGrid--fourths">\n        <div class="euiFlexItem" ng-class=\'{disabled: isTimeBasedIndex===false}\'>\n          <a\n            ng-href="{{getUrl(\'#jobs/new_job/datavisualizer\')}}"\n            ng-click="addSelectionToRecentlyAccessed()"\n            ng-class=\'{disabled: isTimeBasedIndex===false}\'\n            class="euiLink synopsis">\n            <div class="euiPanel euiPanel--paddingMedium synopsisPanel">\n              <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n                <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                  <img class="synopsisIcon" src="{{assetsPath}}/ml_data_visualizer.svg" alt="Single metric job">\n                </div>\n                <div class="euiFlexItem synopsisContent">\n                  <h4 class="euiTitle euiTitle--small synopsisTitle">Data Visualizer</h4>\n                  <div class="euiText synopsisBody">\n                    <p>\n                      <span class="euiTextColor euiTextColor--subdued">\n                      Learn more about the characteristics of your data and identify the fields for analysis with machine learning.\n                      </span>\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </a>\n        </div>\n      </div>\n\n    </div>\n\n  </div>\n</ml-new-job>\n'},3459:function(module,exports,__webpack_require__){"use strict";__webpack_require__(183);var _data_recognizer=__webpack_require__(1187);__webpack_require__(2).uiModules.get("apps/ml",["react"]).directive("mlDataRecognizer",function(reactDirective,Private){return reactDirective(Private(_data_recognizer.dataRecognizerProvider),void 0,{restrict:"AE"})})},3460:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.RecognizedResult=void 0;var _react=__webpack_require__(0),_react2=_interopRequireDefault(_react),_propTypes=__webpack_require__(20),_propTypes2=_interopRequireDefault(_propTypes);(exports.RecognizedResult=function(_ref){var config=_ref.config,indexPattern=_ref.indexPattern,href="#/jobs/new_job/simple/recognize?id="+config.id+"&index="+indexPattern.id,logo=null;return logo=config.logo&&config.logo.src?_react2.default.createElement("div",null,_react2.default.createElement("img",{className:"synopsisIcon",src:config.logo.src})):_react2.default.createElement("h3",{className:"euiTitle euiTitle--small"},config.id),_react2.default.createElement("div",{className:"euiFlexItem"},_react2.default.createElement("a",{href:href,className:"euiLink synopsis"},_react2.default.createElement("div",{className:"euiPanel euiPanel--paddingMedium synopsisPanel"},_react2.default.createElement("div",{className:"euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive"},_react2.default.createElement("div",{className:"euiFlexItem euiFlexItem--flexGrowZero ml-data-recognizer-logo"},logo),_react2.default.createElement("div",{className:"euiFlexItem synopsisContent"},_react2.default.createElement("h4",{className:"euiTitle euiTitle--small synopsisTitle"},config.title),_react2.default.createElement("div",{className:"euiText synopsisBody"},_react2.default.createElement("p",null,_react2.default.createElement("span",{className:"euiTextColor euiTextColor--subdued"},config.description))))))))}).propTypes={config:_propTypes2.default.object,indexPattern:_propTypes2.default.object}},3461:function(module,exports){},3462:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2).uiModules.get("apps/ml").service("mlClipboardService",function(){function copyTextToClipboard(text){var textArea=document.createElement("textarea");textArea.style.position="fixed",textArea.style.top=0,textArea.style.left=0,textArea.style.width="2em",textArea.style.height="2em",textArea.style.padding=0,textArea.style.border="none",textArea.style.outline="none",textArea.style.boxShadow="none",textArea.style.background="transparent",textArea.value=text,document.body.appendChild(textArea),textArea.select();var successful=!1;try{successful=document.execCommand("copy");var msg=successful?"successful":"unsuccessful";console.log("Copying text command was "+msg)}catch(err){console.log("Oops, unable to copy")}return document.body.removeChild(textArea),successful}this.copy=copyTextToClipboard})},3463:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1),_lodash2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_lodash);__webpack_require__(2).uiModules.get("apps/ml").service("mlCalendarService",function($q,ml,mlJobService,mlMessageBarService){var msgs=mlMessageBarService;this.calendars=[],this.jobCalendars={},this.groupCalendars={},this.loadCalendars=function(jobs){var _this=this;return $q(function(resolve,reject){var calendars=[];jobs.forEach(function(j){_this.jobCalendars[j.job_id]=[]});var groups={};mlJobService.getJobGroups().forEach(function(g){groups[g.id]=g}),ml.calendars().then(function(resp){calendars=resp,calendars.forEach(function(cal){cal.job_ids.forEach(function(id){var isGroup=!1;void 0!==_this.jobCalendars[id]?_this.jobCalendars[id].push(cal.calendar_id):void 0!==groups[id]?(isGroup=!0,groups[id].jobs.forEach(function(j){_this.jobCalendars[j.job_id].push(cal.calendar_id)})):isGroup=!0,isGroup&&(void 0===_this.groupCalendars[id]?_this.groupCalendars[id]=[cal.calendar_id]:_this.groupCalendars[id].push(cal.calendar_id))})}),_lodash2.default.each(_this.jobCalendars,function(cal,id){_this.jobCalendars[id]=_lodash2.default.uniq(cal)}),_this.calendars=calendars,resolve({calendars:calendars})}).catch(function(err){msgs.error("Calendars list could not be retrieved"),msgs.error("",err),reject({calendars:calendars,err:err})})})},this.getCalendarGroups=function(){return Object.keys(this.groupCalendars).map(function(gId){return{id:gId}})}})},3464:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);__webpack_require__(3465);var _chrome=__webpack_require__(8),_chrome2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_chrome);__webpack_require__(2).uiModules.get("apps/ml").service("ml",function(prlHttpService){var http=prlHttpService,basePath=_chrome2.default.addBasePath("/api/ml");this.jobs=function(obj){var jobId=obj&&obj.jobId?"/"+obj.jobId:"";return http.request({url:basePath+"/anomaly_detectors"+jobId})},this.jobStats=function(obj){var jobId=obj&&obj.jobId?"/"+obj.jobId:"";return http.request({url:basePath+"/anomaly_detectors"+jobId+"/_stats"})},this.addJob=function(obj){return http.request({url:basePath+"/anomaly_detectors/"+obj.jobId,method:"PUT",data:obj.job})},this.openJob=function(obj){return http.request({url:basePath+"/anomaly_detectors/"+obj.jobId+"/_open",method:"POST"})},this.closeJob=function(obj){return http.request({url:basePath+"/anomaly_detectors/"+obj.jobId+"/_close",method:"POST"})},this.forceCloseJob=function(obj){return http.request({url:basePath+"/anomaly_detectors/"+obj.jobId+"/_close?force=true",method:"POST"})},this.deleteJob=function(obj){return http.request({url:basePath+"/anomaly_detectors/"+obj.jobId,method:"DELETE"})},this.forceDeleteJob=function(obj){return http.request({url:basePath+"/anomaly_detectors/"+obj.jobId+"?force=true",method:"DELETE"})},this.updateJob=function(obj){return http.request({url:basePath+"/anomaly_detectors/"+obj.jobId+"/_update",method:"POST",data:obj.job})},this.estimateBucketSpan=function(obj){return http.request({url:basePath+"/validate/estimate_bucket_span",method:"POST",data:obj})},this.validateJob=function(obj){return http.request({url:basePath+"/validate/job",method:"POST",data:obj})},this.datafeeds=function(obj){var datafeedId=obj&&obj.datafeedId?"/"+obj.datafeedId:"";return http.request({url:basePath+"/datafeeds"+datafeedId})},this.datafeedStats=function(obj){var datafeedId=obj&&obj.datafeedId?"/"+obj.datafeedId:"";return http.request({url:basePath+"/datafeeds"+datafeedId+"/_stats"})},this.addDatafeed=function(obj){return http.request({url:basePath+"/datafeeds/"+obj.datafeedId,method:"PUT",data:obj.datafeedConfig})},this.updateDatafeed=function(obj){return http.request({url:basePath+"/datafeeds/"+obj.datafeedId+"/_update",method:"POST",data:obj.datafeedConfig})},this.deleteDatafeed=function(obj){return http.request({url:basePath+"/datafeeds/"+obj.datafeedId,method:"DELETE"})},this.forceDeleteDatafeed=function(obj){return http.request({url:basePath+"/datafeeds/"+obj.datafeedId+"?force=true",method:"DELETE"})},this.startDatafeed=function(obj){var data={};return void 0!==obj.start&&(data.start=obj.start),void 0!==obj.end&&(data.end=obj.end),http.request({url:basePath+"/datafeeds/"+obj.datafeedId+"/_start",method:"POST",data:data})},this.stopDatafeed=function(obj){return http.request({url:basePath+"/datafeeds/"+obj.datafeedId+"/_stop",method:"POST"})},this.datafeedPreview=function(obj){return http.request({url:basePath+"/datafeeds/"+obj.datafeedId+"/_preview",method:"GET"})},this.validateDetector=function(obj){return http.request({url:basePath+"/anomaly_detectors/_validate/detector",method:"POST",data:obj.detector})},this.forecast=function(obj){var data={};return void 0!==obj.duration&&(data.duration=obj.duration),http.request({url:basePath+"/anomaly_detectors/"+obj.jobId+"/_forecast",method:"POST",data:data})},this.overallBuckets=function(obj){var data=(0,_lodash.pick)(obj,["topN","bucketSpan","start","end"]);return http.request({url:basePath+"/anomaly_detectors/"+obj.jobId+"/results/overall_buckets",method:"POST",data:data})},this.checkPrivilege=function(obj){return http.request({url:basePath+"/_has_privileges",method:"POST",data:obj})},this.getNotificationSettings=function(){return http.request({url:basePath+"/notification_settings",method:"GET"})},this.getFieldCaps=function(obj){var data={};return void 0!==obj.index&&(data.index=obj.index),void 0!==obj.fields&&(data.fields=obj.fields),http.request({url:basePath+"/indices/field_caps",method:"POST",data:data})},this.recognizeIndex=function(obj){return http.request({url:basePath+"/modules/recognize/"+obj.indexPatternTitle,method:"GET"})},this.getDataRecognizerModule=function(obj){return http.request({url:basePath+"/modules/get_module/"+obj.moduleId,method:"GET"})},this.setupDataRecognizerConfig=function(obj){var data=(0,_lodash.pick)(obj,["prefix","groups","indexPatternName"]);return http.request({url:basePath+"/modules/setup/"+obj.moduleId,method:"POST",data:data})},this.getVisualizerFieldStats=function(obj){var data=(0,_lodash.pick)(obj,["query","timeFieldName","earliest","latest","samplerShardSize","interval","fields","maxExamples"]);return http.request({url:basePath+"/data_visualizer/get_field_stats/"+obj.indexPatternTitle,method:"POST",data:data})},this.getVisualizerOverallStats=function(obj){var data=(0,_lodash.pick)(obj,["query","timeFieldName","earliest","latest","samplerShardSize","aggregatableFields","nonAggregatableFields"]);return http.request({url:basePath+"/data_visualizer/get_overall_stats/"+obj.indexPatternTitle,method:"POST",data:data})},this.calendars=function(obj){var calendarId=obj&&obj.calendarId?"/"+obj.calendarId:"";return http.request({url:basePath+"/calendars"+calendarId,method:"GET"})},this.addCalendar=function(obj){return http.request({url:basePath+"/calendars",method:"PUT",data:obj})},this.updateCalendar=function(obj){var calendarId=obj&&obj.calendarId?"/"+obj.calendarId:"";return http.request({url:basePath+"/calendars"+calendarId,method:"PUT",data:obj})},this.deleteCalendar=function(obj){return http.request({url:basePath+"/calendars/"+obj.calendarId,method:"DELETE"})},this.mlNodeCount=function(){return http.request({url:basePath+"/ml_node_count",method:"GET"})},this.mlInfo=function(){return http.request({url:basePath+"/info",method:"GET"})},this.calculateModelMemoryLimit=function(obj){var data=(0,_lodash.pick)(obj,["indexPattern","splitFieldName","query","fieldNames","influencerNames","timeFieldName","earliestMs","latestMs"]);return http.request({url:basePath+"/validate/calculate_model_memory_limit",method:"POST",data:data})},this.getCardinalityOfFields=function(obj){var data=(0,_lodash.pick)(obj,["index","types","fieldNames","query","timeFieldName","earliestMs","latestMs"]);return http.request({url:basePath+"/fields_service/field_cardinality",method:"POST",data:data})},this.getTimeFieldRange=function(obj){var data=(0,_lodash.pick)(obj,["index","timeFieldName","query"]);return http.request({url:basePath+"/fields_service/time_field_range",method:"POST",data:data})}})},3465:function(module,exports,__webpack_require__){"use strict";var _modules=__webpack_require__(2),_system_api=__webpack_require__(357);_modules.uiModules.get("apps/ml").service("prlHttpService",function($http,$q){this.request=function(options){if(options&&options.url){var url="";url+=options.url||"";var headers=(0,_system_api.addSystemApiHeader)({}),allHeaders=void 0===options.headers?headers:Object.assign(options.headers,headers),deferred=$q.defer();return $http({url:url,method:options.method||"GET",headers:allHeaders,params:options.params||{},data:options.data||null}).then(function(response){deferred.resolve(response.data)},function(response){deferred.reject(response.data)}),deferred.promise}}})},3466:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3467)},3467:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash);__webpack_require__(3468);var _messagebar=__webpack_require__(3469),_messagebar2=_interopRequireDefault(_messagebar);__webpack_require__(2).uiModules.get("apps/ml").service("mlMessageBarService",function(){function expandErrorMessageObj(resp){var txt="";if(void 0!==resp&&"object"===(void 0===resp?"undefined":_typeof(resp)))try{var respObj=JSON.parse(resp.response);"object"===(void 0===respObj?"undefined":_typeof(respObj))&&void 0!==respObj.error&&(txt=respObj.error.reason)}catch(e){txt=resp.message}return txt}var MSG_STYLE={INFO:"ml-message-info",WARNING:"ml-message-warning",ERROR:"ml-message-error"};this.messages=[],this.addMessage=function(msg){_lodash2.default.findWhere(this.messages,msg)||this.messages.push(msg)},this.removeMessage=function(index){this.messages.splice(index,1)},this.clear=function(){this.messages.length=0},this.info=function(text){this.addMessage({text:text,style:MSG_STYLE.INFO})},this.warning=function(text){this.addMessage({text:text,style:MSG_STYLE.WARNING})},this.error=function(text,resp){var txt=text+" "+expandErrorMessageObj(resp);this.addMessage({text:txt,style:MSG_STYLE.ERROR})}}).controller("MlMessageBarController",function($scope,mlMessageBarService){$scope.messages=mlMessageBarService.messages,$scope.removeMessage=mlMessageBarService.removeMessage}).directive("mlMessageBar",function(){return{restrict:"AE",template:_messagebar2.default}})},3468:function(module,exports){},3469:function(module,exports){module.exports='<div ng-controller="MlMessageBarController">\n  <div\n    ng-repeat="msg in messages"\n    class=\'ml-message {{msg.style}}\'>\n      {{msg.text}} <a ng-click="removeMessage($index)">x</a>\n  </div>\n</div>'},3470:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3471),__webpack_require__(3472),__webpack_require__(1186),__webpack_require__(3474),__webpack_require__(306),__webpack_require__(480)},3471:function(module,exports){},3472:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_risonNode=__webpack_require__(191),_risonNode2=_interopRequireDefault(_risonNode);__webpack_require__(303),__webpack_require__(1149),__webpack_require__(251);var _chrome=__webpack_require__(8),_chrome2=_interopRequireDefault(_chrome),_routes=__webpack_require__(11),_routes2=_interopRequireDefault(_routes),_notify=__webpack_require__(10),_lucene_string_to_dsl=__webpack_require__(456),_decorate_query=__webpack_require__(639),_field_types=__webpack_require__(208),_field_types_utils=__webpack_require__(1177),_ml_time_buckets=__webpack_require__(169),_check_license=__webpack_require__(101),_check_privilege=__webpack_require__(93),_new_job_utils=__webpack_require__(192),_index_utils=__webpack_require__(132),_check_ml_nodes=__webpack_require__(108),_datavisualizer=__webpack_require__(3473),_datavisualizer2=_interopRequireDefault(_datavisualizer),_modules=__webpack_require__(2);_routes2.default.when("/jobs/new_job/datavisualizer",{template:_datavisualizer2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkGetJobsPrivilege,indexPattern:_index_utils.getIndexPatternWithRoute,savedSearch:_index_utils.getSavedSearchWithRoute,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable}}),_modules.uiModules.get("apps/ml").controller("MlDataVisualizerViewFields",function($scope,$route,$timeout,$window,Private,timefilter,AppState,ml){function buildSearchQuery(){var searchQuery=(0,_lucene_string_to_dsl.luceneStringToDsl)($scope.searchQueryText);return decorateQuery(searchQuery),searchQuery}function saveAppState(){$scope.appState.query={language:"lucene",query:$scope.searchQueryText},$scope.appState.samplerShardSize=$scope.samplerShardSize,$scope.appState.save()}function createMetricCards(){$scope.metricCards.length=0;var aggregatableExistsFields=$scope.overallStats.aggregatableExistsFields||[],allMetricFields=[];allMetricFields=void 0===metricFieldRegexp?_lodash2.default.filter(indexPattern.fields,function(f){return f.type===_field_types.KBN_FIELD_TYPES.NUMBER&&!_lodash2.default.contains(OMIT_FIELDS,f.displayName)}):_lodash2.default.filter(indexPattern.fields,function(f){return f.type===_field_types.KBN_FIELD_TYPES.NUMBER&&!_lodash2.default.contains(OMIT_FIELDS,f.displayName)&&f.displayName.match(metricFieldRegexp)});var metricExistsFields=_lodash2.default.filter(allMetricFields,function(f){return _lodash2.default.find(aggregatableExistsFields,{fieldName:f.displayName})}),metricCards=[];metricCards.push({type:_field_types.ML_JOB_FIELD_TYPES.NUMBER,existsInDocs:!0,loading:!0}),$scope.totalMetricFieldCount=allMetricFields.length+1,$scope.populatedMetricFieldCount=metricExistsFields.length+1,$scope.totalMetricFieldCount===$scope.populatedMetricFieldCount&&($scope.showAllMetrics=!0);var aggregatableFields=$scope.overallStats.aggregatableExistsFields;!0===$scope.showAllMetrics&&(aggregatableFields=aggregatableFields.concat($scope.overallStats.aggregatableNotExistsFields));var metricFields=$scope.showAllMetrics?allMetricFields:metricExistsFields;_lodash2.default.each(metricFields,function(field){var fieldData=_lodash2.default.find(aggregatableFields,{fieldName:field.displayName}),card=_extends({},fieldData,{fieldFormat:field.format,type:_field_types.ML_JOB_FIELD_TYPES.NUMBER,loading:!0});metricCards.push(card)}),$scope.metricCards=metricCards,loadMetricFieldStats()}function createNonMetricCards(){$scope.fieldCards.length=0;var allNonMetricFields=[];if("*"===$scope.filterFieldType)allNonMetricFields=_lodash2.default.filter(indexPattern.fields,function(f){return f.type!==_field_types.KBN_FIELD_TYPES.NUMBER&&!_lodash2.default.contains(OMIT_FIELDS,f.displayName)});else if($scope.filterFieldType===_field_types.ML_JOB_FIELD_TYPES.TEXT||$scope.filterFieldType===_field_types.ML_JOB_FIELD_TYPES.KEYWORD){var aggregatableCheck=$scope.filterFieldType===_field_types.ML_JOB_FIELD_TYPES.KEYWORD;allNonMetricFields=_lodash2.default.filter(indexPattern.fields,function(f){return!_lodash2.default.contains(OMIT_FIELDS,f.displayName)&&f.type===_field_types.KBN_FIELD_TYPES.STRING&&f.aggregatable===aggregatableCheck})}else allNonMetricFields=_lodash2.default.filter(indexPattern.fields,function(f){return!_lodash2.default.contains(OMIT_FIELDS,f.displayName)&&f.type===$scope.filterFieldType});void 0!==fieldRegexp&&(allNonMetricFields=_lodash2.default.filter(allNonMetricFields,function(f){return f.displayName.match(fieldRegexp)})),$scope.totalNonMetricFieldCount=allNonMetricFields.length;var populatedNonMetricFields=[],nonMetricFieldData=[],populatedNonMetricFieldCount=0;_lodash2.default.each(allNonMetricFields,function(f){var checkAggregatableField=_lodash2.default.find($scope.overallStats.aggregatableExistsFields,{fieldName:f.displayName});if(void 0!==checkAggregatableField)populatedNonMetricFields.push(f),nonMetricFieldData.push(checkAggregatableField),populatedNonMetricFieldCount++;else{var checkNonAggregatableField=_lodash2.default.find($scope.overallStats.nonAggregatableExistsFields,{fieldName:f.displayName});void 0!==checkNonAggregatableField&&(populatedNonMetricFields.push(f),nonMetricFieldData.push(checkNonAggregatableField),populatedNonMetricFieldCount++)}}),$scope.populatedNonMetricFieldCount=populatedNonMetricFieldCount,$scope.totalNonMetricFieldCount===$scope.populatedNonMetricFieldCount&&($scope.showAllFields=!0);var nonMetricFieldsToShow=!0===$scope.showAllFields?allNonMetricFields:populatedNonMetricFields;!0===$scope.showAllFields&&(nonMetricFieldData=nonMetricFieldData.concat($scope.overallStats.aggregatableNotExistsFields,$scope.overallStats.nonAggregatableNotExistsFields));var fieldCards=[];_lodash2.default.each(nonMetricFieldsToShow,function(field){var fieldData=_lodash2.default.find(nonMetricFieldData,{fieldName:field.displayName}),card=_extends({},fieldData,{fieldFormat:field.format,aggregatable:field.aggregatable,scripted:field.scripted,loading:fieldData.existsInDocs}),dataVisualizerType=(0,_field_types_utils.kbnTypeToMLJobType)(field);void 0!==dataVisualizerType?card.type=dataVisualizerType:(card.type=field.type,card.isUnsupportedType=!0),fieldCards.push(card)}),$scope.fieldCards=_lodash2.default.sortBy(fieldCards,"fieldName"),loadNonMetricFieldStats()}function loadMetricFieldStats(){var numberFields=_lodash2.default.filter($scope.metricCards,{existsInDocs:!0});numberFields=_lodash2.default.map(numberFields,function(card){var props={fieldName:card.fieldName,type:card.type};return _lodash2.default.has(card,["stats","cardinality"])&&(props.cardinality=card.stats.cardinality),props});var buckets=new MlTimeBuckets,bounds=timefilter.getActiveBounds();buckets.setInterval("auto"),buckets.setBounds(bounds),buckets.setBarTarget(75);var aggInterval=buckets.getInterval();ml.getVisualizerFieldStats({indexPatternTitle:indexPattern.title,query:$scope.searchQuery,timeFieldName:indexPattern.timeFieldName,earliest:$scope.earliest,latest:$scope.latest,samplerShardSize:$scope.samplerShardSize,interval:aggInterval.expression,fields:numberFields}).then(function(resp){_lodash2.default.each($scope.metricCards,function(card){void 0!==card.fieldName?card.stats=_extends({},card.stats,_lodash2.default.find(resp,{fieldName:card.fieldName})):card.stats=_lodash2.default.find(resp,function(stats){return void 0===stats.fieldName}),card.loading=!1}),$scope.metricFilterIcon=0}).catch(function(err){console.log("DataVisualizer - error getting stats for metric cards from elasticsearch:",err),500===err.statusCode?_notify.notify.error("Error loading data for metrics in index "+indexPattern.title+". "+err.message+". The request may have timed out. Try using a smaller sample size or narrowing the time range.",{lifetime:3e4}):_notify.notify.error("Error loading data for metrics in index "+indexPattern.title+". "+err.message,{lifetime:3e4})})}function loadNonMetricFieldStats(){var fields=_lodash2.default.filter($scope.fieldCards,{existsInDocs:!0});fields=_lodash2.default.map(fields,function(card){var props={fieldName:card.fieldName,type:card.type};return _lodash2.default.has(card,["stats","cardinality"])&&(props.cardinality=card.stats.cardinality),props}),fields.length>0?ml.getVisualizerFieldStats({indexPatternTitle:indexPattern.title,query:$scope.searchQuery,fields:fields,timeFieldName:indexPattern.timeFieldName,earliest:$scope.earliest,latest:$scope.latest,samplerShardSize:$scope.samplerShardSize,maxExamples:10}).then(function(resp){_lodash2.default.each($scope.fieldCards,function(card){card.stats=_extends({},card.stats,_lodash2.default.find(resp,{fieldName:card.fieldName})),card.loading=!1}),$scope.fieldFilterIcon=0}).catch(function(err){console.log("DataVisualizer - error getting non metric field stats from elasticsearch:",err),500===err.statusCode?_notify.notify.error("Error loading data for fields in index "+indexPattern.title+". "+err.message+". The request may have timed out. Try using a smaller sample size or narrowing the time range.",{lifetime:3e4}):_notify.notify.error("Error loading data for fields in index "+indexPattern.title+". "+err.message,{lifetime:3e4})}):$scope.fieldFilterIcon=0}function loadOverallStats(){var aggregatableFields=[],nonAggregatableFields=[];_lodash2.default.each(indexPattern.fields,function(field){-1===OMIT_FIELDS.indexOf(field.displayName)&&(!0===field.aggregatable?aggregatableFields.push(field.displayName):nonAggregatableFields.push(field.displayName))}),ml.getVisualizerOverallStats({indexPatternTitle:indexPattern.title,query:$scope.searchQuery,timeFieldName:indexPattern.timeFieldName,samplerShardSize:$scope.samplerShardSize,earliest:$scope.earliest,latest:$scope.latest,aggregatableFields:aggregatableFields,nonAggregatableFields:nonAggregatableFields}).then(function(resp){$scope.overallStats=resp,createMetricCards(),createNonMetricCards()}).catch(function(err){console.log("DataVisualizer - error getting overall stats from elasticsearch:",err),500===err.statusCode?_notify.notify.error("Error loading data for fields in index "+indexPattern.title+". "+err.message+". The request may have timed out. Try using a smaller sample size or narrowing the time range.",{lifetime:3e4}):_notify.notify.error("Error loading data for fields in index "+indexPattern.title+". "+err.message,{lifetime:3e4})})}timefilter.enableTimeRangeSelector(),timefilter.enableAutoRefreshSelector();var _createSearchItems=(0,_new_job_utils.createSearchItems)($route),indexPattern=_createSearchItems.indexPattern,query=_createSearchItems.query;(0,_index_utils.timeBasedIndexCheck)(indexPattern,!0);var OMIT_FIELDS=["_source","_type","_index","_id","_version","_score"];if($scope.metricCards=[],$scope.totalMetricFieldCount=0,$scope.populatedMetricFieldCount=0,$scope.showAllMetrics=!1,$scope.fieldCards=[],$scope.totalNonMetricFieldCount=0,$scope.populatedNonMetricFieldCount=0,$scope.ML_JOB_FIELD_TYPES=_field_types.ML_JOB_FIELD_TYPES,$scope.showAllFields=!1,$scope.filterFieldType="*",$scope.urlBasePath=_chrome2.default.getBasePath(),$scope.appState=new AppState,$scope.indexPattern=indexPattern,$scope.earliest=timefilter.getActiveBounds().min.valueOf(),$scope.latest=timefilter.getActiveBounds().max.valueOf(),$scope.metricFilterIcon=0,$scope.metricFieldFilter="",$scope.fieldFilterIcon=0,$scope.fieldFilter="",$scope.recognizerResults={count:0},$scope.searchQueryText="",_lodash2.default.has($scope.appState,"query"))"lucene"===_lodash2.default.get($scope.appState,"query.language")&&($scope.searchQueryText=_lodash2.default.get($scope.appState,"query.query",""));else{var queryString=_lodash2.default.get(query,"query_string.query","");"*"!==queryString&&($scope.searchQueryText=queryString)}var decorateQuery=Private(_decorate_query.DecorateQueryProvider);$scope.searchQuery=buildSearchQuery(),$scope.samplerShardSize=$scope.appState.samplerShardSize?$scope.appState.samplerShardSize:5e3;var MlTimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider),metricFieldRegexp=void 0,metricFieldFilterTimeout=void 0,fieldRegexp=void 0,fieldFilterTimeout=void 0,indexedFieldTypes=[];_lodash2.default.each(indexPattern.fields,function(field){if(!field.scripted){var dataVisualizerType=(0,_field_types_utils.kbnTypeToMLJobType)(field);void 0!==dataVisualizerType&&indexedFieldTypes.push(dataVisualizerType)}}),indexedFieldTypes=_lodash2.default.chain(indexedFieldTypes).unique().without(_field_types.ML_JOB_FIELD_TYPES.NUMBER).value(),$scope.indexedFieldTypes=indexedFieldTypes.sort(),$scope.$listen(timefilter,"fetch",function(){$scope.earliest=timefilter.getActiveBounds().min.valueOf(),$scope.latest=timefilter.getActiveBounds().max.valueOf(),loadOverallStats()}),$scope.submitSearchQuery=function(){$scope.searchQuery=buildSearchQuery(),saveAppState(),loadOverallStats()},$scope.samplerShardSizeChanged=function(){saveAppState(),loadOverallStats()},$scope.toggleAllMetrics=function(){$scope.showAllMetrics=!$scope.showAllMetrics,createMetricCards()},$scope.toggleAllFields=function(){$scope.showAllFields=!$scope.showAllFields,createNonMetricCards()},$scope.filterFieldTypeChanged=function(fieldType){$scope.filterFieldType=fieldType,createNonMetricCards()},$scope.metricFieldFilterChanged=function(){void 0!==metricFieldFilterTimeout&&$timeout.cancel(metricFieldFilterTimeout),metricFieldFilterTimeout=$timeout(function(){metricFieldRegexp=$scope.metricFieldFilter&&""!==$scope.metricFieldFilter?new RegExp("("+$scope.metricFieldFilter+")","gi"):void 0,createMetricCards(),metricFieldFilterTimeout=void 0},1500),$timeout(function(){$scope.metricFilterIcon=1},250)},$scope.clearMetricFilter=function(){$scope.metricFieldFilter="",metricFieldRegexp=void 0,createMetricCards()},$scope.fieldFilterChanged=function(){void 0!==fieldFilterTimeout&&$timeout.cancel(fieldFilterTimeout),fieldFilterTimeout=$timeout(function(){fieldRegexp=$scope.fieldFilter&&""!==$scope.fieldFilter?new RegExp("("+$scope.fieldFilter+")","gi"):void 0,createNonMetricCards(),fieldFilterTimeout=void 0},1500),$timeout(function(){$scope.fieldFilterIcon=1},250)},$scope.clearFieldFilter=function(){$scope.fieldFilter="",fieldRegexp=void 0,createNonMetricCards()},$scope.createJob=function(){var _a=_risonNode2.default.encode({query:{language:"lucene",query:$scope.searchQueryText}}),path=$scope.urlBasePath+"/app/ml#/jobs/new_job/advanced?index="+$scope.indexPattern+"&_a="+_a;$window.open(path,"_self")},loadOverallStats()})},3473:function(module,exports){module.exports='<ml-nav-menu name="datavisualizer"></ml-nav-menu>\n<ml-chart-tooltip></ml-chart-tooltip>\n<ml-datavisualizer class="data-visualizer-container">\n  <div ng-controller="MlDataVisualizerViewFields" >\n    <div class="title-container euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--justifyContentSpaceBetween euiFlexGroup--alignItemsCenter euiFlexGroup--responsive">\n      <div class="euiFlexItem euiFlexItem--flexGrowZero euiText">\n        <h1>{{indexPattern.title}}</h1>\n      </div>\n      <div class="euiFlexItem euiFlexItem--flexGrowZero">\n          <ml-full-time-range-selector index-pattern=\'indexPattern\' query=\'searchQuery\' />\n      </div>\n    </div>\n\n    <div class="main-container">\n\n      <div class="kuiPanel kuiVerticalRhythm datavisualizer-panel">\n\n        <form\n          ng-submit="submitSearchQuery()"\n          name="querybarform"\n          class="flexGroup__filler query-bar-form"\n          style="width: 100%"\n        >\n          <div class="kuiLocalSearch">\n            <input\n              type="text"\n              class="kuiLocalSearchInput"\n              ng-model="searchQueryText"\n              placeholder="Search... (e.g. status:200 AND extension:PHP)"\n              aria-label="Search input"\n              autocomplete="off"\n            >\n            <button\n              class="kuiLocalSearchButton"\n              type="submit"\n              aria-label="Search"\n            >\n              <span aria-hidden="true" class="kuiIcon fa-search"></span>\n            </button>\n          </div>\n        </form>\n\n        <div class="document-count-container">\n          <label for="sampleShardSize">Sample</label>\n          <select id="sampleShardSize" class="kuiSelect type-input" ng-model="samplerShardSize" ng-change="samplerShardSizeChanged(samplerShardSize)">\n            <option ng-value="1000">1000</option>\n            <option ng-value="5000">5000</option>\n            <option ng-value="10000">10000</option>\n            <option ng-value="100000">100000</option>\n            <option ng-value="-1">all</option>\n          </select>\n          <span>documents per shard from a total of</span>\n          <span class="field-emphasis">{{ overallStats.totalCount }}</span>\n          <ng-pluralize count="overallStats.totalCount" when="{\'1\':\'document\', \'other\':\'documents\'}">documents</ng-pluralize>\n          <i aria-hidden="true" class="fa fa-info-circle" tooltip-placement="right"\n            tooltip="Selecting a smaller sample size will reduce query run times and the load on the cluster."></i>\n        </div>\n\n      </div>\n\n      <div class="kuiPanel kuiVerticalRhythm datavisualizer-panel card-panel">\n      \t<div class="euiText">\n          <h2 class="kuiSubTitle kuiVerticalRhythm">Metrics</h2>\n        </div>\n\n        <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--justifyContentSpaceBetween euiFlexGroup--responsive euiFlexGroup--wrap">\n          <div class="field-sort-controls euiFlexItem euiFlexItem--flexGrowZero">\n            <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n              <div ng-if="showAllMetrics === false" class="field-count-label euiFlexItem euiFlexItem--flexGrowZero">\n                <span class="field-emphasis">{{ metricCards.length }}</span>\n                <ng-pluralize count="metricCards.length" when="{\'1\':\'field exists\', \'other\':\'fields exist\'}">fields exist</ng-pluralize> in documents (\n                <span class="field-emphasis">{{ totalMetricFieldCount }}</span> in total)\n              </div>\n              \n              <div ng-if="showAllMetrics === true" class="field-count-label euiFlexItem euiFlexItem--flexGrowZero">\n                <span class="field-emphasis">{{ metricCards.length }}</span>\n                <ng-pluralize count="metricCards.length" when="{\'1\':\'field\', \'other\':\'fields\'}">fields</ng-pluralize>\n                (\n                <span class="field-emphasis">{{ populatedMetricFieldCount }}</span>\n                <ng-pluralize count="populatedMetricFieldCount" when="{\'1\':\'exists\', \'other\':\'exist\'}">exist</ng-pluralize> in documents)\n              </div>\n              \n              <div ng-hide="populatedMetricFieldCount === totalMetricFieldCount" class="field-group-input euiFlexItem euiFlexItem--flexGrowZero">\n                <input id="toggleAllMetricsCheckbox" type="checkbox" class="kuiCheckBox" ng-click="toggleAllMetrics()" ng-checked="showAllMetrics === true">\n                <label for="toggleAllMetricsCheckbox">show empty fields</label>\n              </div>\n            </div>\n          </div>\n          <div class="field-filter-controls euiFlexItem euiFlexItem--flexGrowZero">\n            <ml-form-filter-input\n              filter="metricFieldFilter"\n              filter-icon="metricFilterIcon"\n              filter-changed="metricFieldFilterChanged"\n              clear-filter="clearMetricFilter" />\n          </div>\n        </div>\n\n        <div class="card-container" ng-repeat="card in metricCards">\n          <ml-field-data-card\n            index-pattern="indexPattern"\n            query="searchQuery"\n            earliest="earliest"\n            latest="latest"\n            card="card">\n          </ml-field-data-card>\n        </div>\n\n      </div>\n\n      <div class="kuiPanel kuiVerticalRhythm datavisualizer-panel card-panel">\n        <div class="euiText">\n          <h2 class="kuiSubTitle kuiVerticalRhythm">Fields</h2>\n        </div>\n\n        <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--justifyContentSpaceBetween euiFlexGroup--responsive euiFlexGroup--wrap">\n          <div class="field-sort-controls euiFlexItem euiFlexItem--flexGrowZero">\n            <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n              <div ng-if="showAllFields === false" class="field-count-label euiFlexItem euiFlexItem--flexGrowZero">\n                <span class="field-emphasis">{{ fieldCards.length }}</span>\n                <ng-pluralize count="fieldCards.length" when="{\'1\':\'field exists\', \'other\':\'fields exist\'}">fields exist</ng-pluralize> in documents\n                (<span class="field-emphasis">{{ totalNonMetricFieldCount }}</span> in total)\n              </div>\n\n              <div ng-if="showAllFields === true" class="field-count-label euiFlexItem euiFlexItem--flexGrowZero">\n                <span class="field-emphasis">{{ fieldCards.length }}</span>\n                <ng-pluralize count="fieldCards.length" when="{\'1\':\'field\', \'other\':\'fields\'}">fields</ng-pluralize>\n                (<span class="field-emphasis">{{ populatedNonMetricFieldCount }}</span>\n                <ng-pluralize count="populatedNonMetricFieldCount" when="{\'1\':\'exists\', \'other\':\'exist\'}">exist</ng-pluralize> in documents)\n              </div>\n\n              <div ng-hide="populatedNonMetricFieldCount === totalNonMetricFieldCount" class="field-group-input euiFlexItem euiFlexItem--flexGrowZero">\n                <input id="toggleAllFieldsCheckbox" type="checkbox" class="kuiCheckBox" ng-click="toggleAllFields()" ng-checked="showAllFields === true">\n                <label for="toggleAllFieldsCheckbox">show empty fields</label>\n              </div>\n            </div>\n          </div>\n          <div class="field-filter-controls euiFlexItem euiFlexItem--flexGrowZero">\n            <div class="euiFlexGroup euiFlexGroup--gutterSmall euiFlexGroup--responsive">\n              <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                <select class="kuiSelect type-input" ng-model="filterFieldType" ng-change="filterFieldTypeChanged(filterFieldType)">\n                  <option value="*">All field types</option>\n                  <option ng-repeat="type in indexedFieldTypes" value="{{type}}">{{type}} types</option>\n                </select>\n              </div>\n              <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                <ml-form-filter-input\n                  filter="fieldFilter"\n                  filter-icon="fieldFilterIcon"\n                  filter-changed="fieldFilterChanged"\n                  clear-filter="clearFieldFilter" />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="card-container" ng-repeat="card in fieldCards">\n          <ml-field-data-card\n            index-pattern="indexPattern"\n            query="searchQuery"\n            earliest="earliest"\n            latest="latest"\n            card="card">\n          </ml-field-data-card>\n        </div>\n\n      </div>\n\n    </div>\n\n    <div class="datavisualizer-sidebar">\n      <ng-include src="urlBasePath+\'/plugins/ml/datavisualizer/datavisualizer_sidebar.html\'"></ng-include>\n    </div>\n\n  </div>\n</ml-datavisualizer>\n'},3474:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3475),__webpack_require__(3476),__webpack_require__(3478),__webpack_require__(3479),__webpack_require__(3481),__webpack_require__(307),__webpack_require__(482)},3475:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_d=__webpack_require__(15),_d2=_interopRequireDefault(_d),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment);__webpack_require__(375);var _parse_interval=__webpack_require__(107),_chart_utils=__webpack_require__(133),_string_utils=__webpack_require__(43),_ml_time_buckets=__webpack_require__(169);__webpack_require__(2).uiModules.get("apps/ml").directive("mlDocumentCountChart",function(timefilter,Private,mlChartTooltipService){function link(scope,element,attrs){function drawBarChartAxes(xAxis,yAxis){var axes=barChartGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0, "+chartHeight+")").call(xAxis),axes.append("g").attr("class","y axis").call(yAxis)}function drawBarChartPaths(){function showChartTooltip(data,rect){var formattedDate=(0,_moment2.default)(data.time).format("MMMM Do YYYY, HH:mm"),contents=formattedDate+"<br/><hr/>count: "+data.value,rectY=_d2.default.select(rect).attr("y"),mouseY=+_d2.default.mouse(rect)[1];mlChartTooltipService.show(contents,rect,{x:5,y:mouseY-rectY})}barChartGroup.selectAll("bar").data(scope.chartData).enter().append("rect").attr("class","bar").attr("x",function(d){return xScale(d.time)}).attr("width",barWidth).attr("y",function(d){return yScale(d.value)}).attr("height",function(d){return chartHeight-yScale(d.value)}).on("mouseover",function(d){showChartTooltip(d,this)}).on("mousemove",function(d){showChartTooltip(d,this)}).on("mouseout",function(){return mlChartTooltipService.hide()})}var svgWidth=attrs.width?+attrs.width:400,svgHeight=scope.height=attrs.height?+attrs.height:400,margin={top:0,right:5,bottom:20,left:15},chartWidth=svgWidth-(margin.left+margin.right),chartHeight=svgHeight-(margin.top+margin.bottom),xScale=null,yScale=_d2.default.scale.linear().range([chartHeight,0]),xAxisTickFormat="YYYY-MM-DD HH:mm",barChartGroup=void 0,barWidth=5,MlTimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);scope.chartData=[],element.on("$destroy",function(){scope.$destroy()}),function(){var bucketsData=_lodash2.default.get(scope,["card","stats","documentCounts","buckets"],{}),chartData=[];_lodash2.default.each(bucketsData,function(value,time){chartData.push({date:new Date(+time),time:+time,value:value})}),scope.chartData=chartData}(),function(){var chartElement=_d2.default.select(element.get(0)).select(".content-wrapper");if(chartElement.selectAll("*").remove(),void 0!==scope.chartData){var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight),maxYVal=_d2.default.max(scope.chartData,function(d){return d.value});yScale=yScale.domain([0,maxYVal]);var yAxis=_d2.default.svg.axis().scale(yScale).orient("left").outerTickSize(0),maxYAxisLabelWidth=(0,_string_utils.calculateTextWidth)(maxYVal,!0,svg);margin.left=Math.max(maxYAxisLabelWidth+yAxis.tickPadding()+5,25),chartWidth=Math.max(svgWidth-margin.left-margin.right,0);var bounds=timefilter.getActiveBounds();if(xScale=_d2.default.time.scale().domain([new Date(bounds.min.valueOf()),new Date(bounds.max.valueOf())]).range([0,chartWidth]),scope.chartData.length>0){var buckets=new MlTimeBuckets,aggInterval=_lodash2.default.get(scope,["card","stats","documentCounts","interval"]);buckets.setInterval(aggInterval),buckets.setBounds(bounds),xAxisTickFormat=buckets.getScaledDateFormat();var intervalMs=(0,_parse_interval.parseInterval)(aggInterval).asMilliseconds();barWidth=xScale(scope.chartData[0].time+intervalMs)-xScale(scope.chartData[0].time)}var xAxis=_d2.default.svg.axis().scale(xScale).orient("bottom").outerTickSize(0).ticks((0,_chart_utils.numTicksForDateFormat)(chartWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)});barChartGroup=svg.append("g").attr("class","bar-chart").attr("transform","translate("+margin.left+", "+margin.top+")"),drawBarChartAxes(xAxis,yAxis),drawBarChartPaths()}}()}return{scope:!1,link:link}})},3476:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_jquery=__webpack_require__(12),_jquery2=_interopRequireDefault(_jquery),_chrome=__webpack_require__(8),_chrome2=_interopRequireDefault(_chrome);__webpack_require__(257);var _field_data_card=__webpack_require__(3477),_field_data_card2=_interopRequireDefault(_field_data_card),_field_types=__webpack_require__(208),_string_utils=__webpack_require__(43);__webpack_require__(2).uiModules.get("apps/ml").directive("mlFieldDataCard",function(){function link(scope,element){if(scope.ML_JOB_FIELD_TYPES=_field_types.ML_JOB_FIELD_TYPES,scope.mlEscape=_string_utils.mlEscape,scope.card.type===_field_types.ML_JOB_FIELD_TYPES.NUMBER){if(scope.card.fieldName){scope.$watch("card.stats",function(){var cardinality=_lodash2.default.get(scope,["card","stats","cardinality"],0);scope.detailsMode=cardinality>100?"distribution":"top"});var cardinality=_lodash2.default.get(scope,["card","stats","cardinality"],0);scope.detailsMode=cardinality>100?"distribution":"top"}(0,_jquery2.default)(".ml-field-data-card-tooltip").remove(),(0,_jquery2.default)("body").append('<div class="ml-field-data-card-tooltip" style="opacity:0; display: none;">')}scope.card.type===_field_types.ML_JOB_FIELD_TYPES.DATE&&scope.$watch("card.stats",function(){_lodash2.default.has(scope,"card.stats.earliest")&&(scope.card.stats.earliest=new Date(scope.card.stats.earliest)),_lodash2.default.has(scope,"card.stats.latest")&&(scope.card.stats.latest=new Date(scope.card.stats.latest))},!0),scope.getCardUrl=function(){var urlBasePath=_chrome2.default.getBasePath(),baseCardPath=urlBasePath+"/plugins/ml/components/field_data_card/content_types";switch(scope.card.type){case _field_types.ML_JOB_FIELD_TYPES.BOOLEAN:return baseCardPath+"/card_boolean.html";case _field_types.ML_JOB_FIELD_TYPES.DATE:return baseCardPath+"/card_date.html";case _field_types.ML_JOB_FIELD_TYPES.GEO_POINT:return baseCardPath+"/card_geo_point.html";case _field_types.ML_JOB_FIELD_TYPES.IP:return baseCardPath+"/card_ip.html";case _field_types.ML_JOB_FIELD_TYPES.KEYWORD:return baseCardPath+"/card_keyword.html";case _field_types.ML_JOB_FIELD_TYPES.NUMBER:return scope.card.fieldName?baseCardPath+"/card_number.html":baseCardPath+"/card_document_count.html";case _field_types.ML_JOB_FIELD_TYPES.TEXT:return baseCardPath+"/card_text.html";default:return baseCardPath+"/card_other.html"}},element.on("$destroy",function(){scope.$destroy()})}return{scope:{card:"=",indexPattern:"=",query:"=",earliest:"=",latest:"="},template:_field_data_card2.default,link:link}}).filter("formatField",function(){return function(value,fieldFormat){return fieldFormat.convert(value,"text")}})},3477:function(module,exports){module.exports='<div class="ml-field-data-card">\n  <div class="euiText title-bar" ng-class="card.fieldName===undefined ? \'document_count\': card.isUnsupportedType===true ? \'type-other\' : card.type">\n    <ml-field-type-icon\n        type="card.type"\n        tooltip="{{ card.type }}"\n        tooltip-placement="left"\n        tooltip-append-to-body="true">\n    </ml-field-type-icon>\n    <div\n      class="field-name"\n      tooltip="{{ mlEscape(card.fieldName) || \'document count\' }}"\n      tooltip-append-to-body="true">\n      {{ card.fieldName || \'document count\' }}\n    </div>\n  </div>\n\n  <div ng-if="card.loading === true" class="card-contents">\n    <ml-loading-indicator\n      label="Loading"\n      is-loading="card.loading"\n      height="200"\n    />\n  </div>\n\n  <div ng-if="card.existsInDocs === false" class="card-contents">\n    <div class="not-exist-message">\n      <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>\n      This field does not appear in any documents for the selected time range\n    </div>\n  </div>\n\n  <ng-include ng-if="card.loading === false" src="getCardUrl()"></ng-include>\n</div>\n'},3478:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_d=__webpack_require__(15),_d2=_interopRequireDefault(_d),_chart_utils=__webpack_require__(133),_ordinal_suffix=__webpack_require__(1167);__webpack_require__(2).uiModules.get("apps/ml").directive("mlMetricDistributionChart",function(mlChartTooltipService){function link(scope,element,attrs){function processDistributionData(){var distributionData=_lodash2.default.get(scope,["card","stats","distribution","percentiles"],[]),chartData=[];if(0===distributionData.length)return chartData;var minX=distributionData[0].minValue,maxX=distributionData[distributionData.length-1].maxValue;xAxisMin=minX,xAxisMax=maxX,maxX===minX&&(0!==minX?(xAxisMin=0,xAxisMax=2*minX):xAxisMax=1);var minBarWidth=MIN_BAR_WIDTH/chartWidth*(xAxisMax-xAxisMin),processedData=[],lastBar=void 0;_lodash2.default.each(distributionData,function(data,index){if(0===index){var bar={x0:data.minValue,x1:Math.max(data.minValue+minBarWidth,data.maxValue),dataMin:data.minValue,dataMax:data.maxValue,percent:data.percent};bar.y=data.percent/(bar.x1-bar.x0)*Math.max(1,minBarWidth/Math.max(data.maxValue-data.minValue,.5*minBarWidth)),bar.isMinWidth=data.maxValue<=data.minValue+minBarWidth,processedData.push(bar),lastBar=bar}else if(!1===lastBar.isMinWidth||data.maxValue>lastBar.x1){var _bar={x0:lastBar.x1,x1:Math.max(lastBar.x1+minBarWidth,data.maxValue),dataMin:data.minValue,dataMax:data.maxValue,percent:data.percent};_bar.y=data.percent/(_bar.x1-_bar.x0)*Math.max(1,minBarWidth/Math.max(data.maxValue-data.minValue,.5*minBarWidth)),_bar.isMinWidth=data.maxValue<=lastBar.x1+minBarWidth,processedData.push(_bar),lastBar=_bar}else lastBar.percent=lastBar.percent+data.percent,lastBar.y=lastBar.percent/(lastBar.x1-lastBar.x0),lastBar.dataMax=data.maxValue}),maxX!==minX&&(xAxisMax=_lodash2.default.last(processedData).x1);var barHeights=_lodash2.default.pluck(processedData,"y");barHeights=barHeights.sort(function(a,b){return a-b});var maxBarHeight=0,processedDataLength=processedData.length;return maxBarHeight=1===Math.abs(processedDataLength%2)?20*barHeights[Math.floor(processedDataLength/2)]:20*(barHeights[Math.floor(processedDataLength/2)-1]+barHeights[Math.floor(processedDataLength/2)])/2,_lodash2.default.each(processedData,function(data){data.y=Math.min(data.y,maxBarHeight)}),scope.processedData=processedData,chartData.push({x:minX,y:0}),_lodash2.default.each(processedData,function(data){chartData.push({x:data.x0,y:data.y}),chartData.push({x:data.x1,y:data.y})}),chartData.push({x:processedData[processedData.length-1].x1,y:0}),chartData}var svgWidth=attrs.width?+attrs.width:400,svgHeight=scope.height=attrs.height?+attrs.height:400,margin={top:0,right:15,bottom:20,left:15},infoLabelHeight=15,chartWidth=svgWidth-(margin.left+margin.right),chartHeight=svgHeight-(margin.top+margin.bottom+infoLabelHeight),xScale=_d2.default.scale.linear().range([0,chartWidth]),yScale=_d2.default.scale.linear().range([chartHeight,0]),xAxisMin=0,xAxisMax=1,chartGroup=void 0,distributionArea=_d2.default.svg.area().x(function(d){return xScale(d.x)}).y0(function(){return yScale(0)}).y1(function(d){return yScale(d.y)}),MIN_BAR_WIDTH=3;element.on("$destroy",function(){scope.$destroy()}),function(){scope.chartData=processDistributionData();var chartElement=_d2.default.select(element.get(0)).select(".content-wrapper");chartElement.select("svg").remove();var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight),minPercentile=_lodash2.default.get(scope,["card","stats","distribution","minPercentile"]),maxPercentile=_lodash2.default.get(scope,["card","stats","distribution","maxPercentile"]),minPercent=(0,_ordinal_suffix.ordinalSuffix)(minPercentile),maxPercent=(0,_ordinal_suffix.ordinalSuffix)(maxPercentile);svg.append("text").attr("x",chartWidth/2).attr("y",10).attr("class","info-text").attr("transform","translate("+margin.left+", "+margin.top+")").text("Displaying "+minPercent+" - "+maxPercent+" percentiles");var translateTop=margin.top+infoLabelHeight;if(chartGroup=svg.append("g").attr("class","distribution-chart").attr("transform","translate("+margin.left+", "+translateTop+")"),scope.chartData.length>0){xScale=xScale.domain([xAxisMin,xAxisMax]);var yMax=_d2.default.max(scope.chartData,function(d){return d.y});yScale=yScale.domain([0,yMax])}}(),function(){var axes=chartGroup.append("g").attr("class","axes"),xAxis=_d2.default.svg.axis().scale(xScale).orient("bottom").outerTickSize(0).ticks((0,_chart_utils.numTicks)(chartWidth)).tickFormat(function(d){return scope.card.fieldFormat.convert(d,"text")}),yAxis=_d2.default.svg.axis().scale(yScale).orient("left").outerTickSize(0).ticks(0);axes.append("g").attr("class","x axis").attr("transform","translate(0, "+chartHeight+")").call(xAxis),axes.append("g").attr("class","y axis").call(yAxis)}(),function(){function showChartTooltip(){for(var xPos=_d2.default.mouse(this)[0],yPos=_d2.default.mouse(this)[1],xVal=xScale.invert(xPos),processedDataIdx=0,i=0;i<scope.processedData.length;i++)if(xVal<scope.processedData[i].x1){processedDataIdx=i;break}var contents="value:"+xVal,bar=scope.processedData[processedDataIdx],minValFormatted=scope.card.fieldFormat.convert(bar.dataMin,"text");if(bar.dataMax>bar.dataMin){var maxValFormatted=scope.card.fieldFormat.convert(bar.dataMax,"text");contents=bar.percent+"% of documents have<br>values between "+minValFormatted+" and "+maxValFormatted}else contents=bar.percent+"% of documents have<br>a value of "+minValFormatted;contents="<div class='centered-text'>"+contents+"</div>",path.length&&path[0].length&&mlChartTooltipService.show(contents,path[0][0],{x:xPos+5,y:yPos+10})}var path=chartGroup.append("path");path.datum(scope.chartData).attr("class","area").attr("d",distributionArea).on("mouseover",showChartTooltip).on("mouseout",function(){return mlChartTooltipService.hide()}).on("mousemove",showChartTooltip)}()}return{scope:!1,link:link}})},3479:function(module,exports,__webpack_require__){"use strict";var _top_values=__webpack_require__(3480),_top_values2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_top_values),_string_utils=__webpack_require__(43);__webpack_require__(2).uiModules.get("apps/ml").directive("mlTopValues",function(){return{restrict:"E",template:_top_values2.default,link:function(scope){scope.mlEscape=_string_utils.mlEscape}}})},3480:function(module,exports){module.exports='<div ng-repeat="value in card.stats.topValues" class="top-value">\n  <div class="field-label"\n    tooltip-html-unsafe="{{mlEscape(value.key) | formatField:card.fieldFormat}}"\n    tooltip-append-to-body="true"\n    tooltip-placement="right">\n    {{value.key | formatField:card.fieldFormat}}\n  </div>\n  <div class="top-value-bar-holder">\n    <div ng-if="card.stats.isTopValuesSampled === false"\n      class="top-value-bar {{card.type}}"\n      ng-attr-style="width: {{ 100 * value.doc_count/card.stats.count }}%;"\n      tooltip-html-unsafe="{{ 100 * value.doc_count/card.stats.count >= 0.1 ? (100 * value.doc_count/card.stats.count | number:1): \'< 0.1\' }}%"\n      tooltip-append-to-body="true"\n      tooltip-placement="right">\n    </div>\n    <div ng-if="card.stats.isTopValuesSampled === true"\n      class="top-value-bar {{card.type}}"\n      ng-attr-style="width: {{ 100 * value.doc_count/card.stats.topValuesSampleSize }}%;"\n      tooltip-html-unsafe="{{ 100 * value.doc_count/card.stats.topValuesSampleSize >= 0.1 ? (100 * value.doc_count/card.stats.topValuesSampleSize | number:1): \'< 0.1\' }}%"\n      tooltip-append-to-body="true"\n      tooltip-placement="right">\n    </div>\n  </div>\n  <div ng-if="card.stats.isTopValuesSampled === false" class="count-label">{{value.doc_count}}</div>\n  <div ng-if="card.stats.isTopValuesSampled === true" class="count-label">\n    {{ 100 * value.doc_count/card.stats.topValuesSampleSize >= 0.1 ? (100 * value.doc_count/card.stats.topValuesSampleSize | number:1): \'< 0.1\' }}%\n  </div>\n</div>\n<div ng-if="card.stats.isTopValuesSampled === true" class="sampled-message euiText">\n  Calculated from sample of {{ card.stats.topValuesSamplerShardSize }} documents per shard\n</div>\n'},3481:function(module,exports){},3482:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3483),__webpack_require__(3521),__webpack_require__(3522),__webpack_require__(3523),__webpack_require__(3524),__webpack_require__(3533),__webpack_require__(689)},3483:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_jquery=__webpack_require__(12),_jquery2=_interopRequireDefault(_jquery),_dragselect=__webpack_require__(3484),_dragselect2=_interopRequireDefault(_dragselect),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment);__webpack_require__(1188),__webpack_require__(3509),__webpack_require__(689),__webpack_require__(374),__webpack_require__(483),__webpack_require__(375);var _query_filter=__webpack_require__(164),_parse_interval=__webpack_require__(107),_explorer=__webpack_require__(3520),_explorer2=_interopRequireDefault(_explorer),_routes=__webpack_require__(11),_routes2=_interopRequireDefault(_routes),_check_license=__webpack_require__(101),_check_privilege=__webpack_require__(93),_index_utils=__webpack_require__(132),_refresh_interval_watcher=__webpack_require__(1189),_ml_time_buckets=__webpack_require__(169),_modules=__webpack_require__(2);_routes2.default.when("/explorer/?",{template:_explorer2.default,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkGetJobsPrivilege,indexPatterns:_index_utils.getIndexPatterns}}),_modules.uiModules.get("apps/ml").controller("MlExplorerController",function($scope,$route,$timeout,AppState,Private,timefilter,mlCheckboxShowChartsService,mlFieldFormatService,mlJobService,mlResultsService,mlJobSelectService,mlExplorerDashboardService,mlSelectLimitService,mlSelectSeverityService){function createJobs(jobs){return jobs.map(function(job){var bucketSpan=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span);return{id:job.job_id,selected:!1,bucketSpanSeconds:bucketSpan.asSeconds()}})}function redrawOnResize(){$scope.swimlaneWidth=getSwimlaneContainerWidth(),$scope.$apply(),mlExplorerDashboardService.swimlaneDataChange.changed("overall"),mlExplorerDashboardService.swimlaneDataChange.changed("viewBy")}function loadViewBySwimlaneOptions(){$scope.swimlaneViewByFieldName=null;var viewByOptions=[],selectedJobIds=$scope.getSelectedJobIds(),fieldsByJob={"*":[]};if(_lodash2.default.each(mlJobService.jobs,function(job){var fieldsForJob=[],analysisConfig=job.analysis_config,detectors=analysisConfig.detectors||[];_lodash2.default.each(detectors,function(detector){_lodash2.default.has(detector,"partition_field_name")&&fieldsForJob.push(detector.partition_field_name),_lodash2.default.has(detector,"over_field_name")&&fieldsForJob.push(detector.over_field_name),_lodash2.default.has(detector,"by_field_name")&&!_lodash2.default.has(detector,"over_field_name")&&fieldsForJob.push(detector.by_field_name)});var influencers=analysisConfig.influencers||[];fieldsForJob=fieldsForJob.concat(influencers),-1!==selectedJobIds.indexOf(job.job_id)&&(viewByOptions=viewByOptions.concat(influencers)),fieldsByJob[job.job_id]=_lodash2.default.uniq(fieldsForJob),fieldsByJob["*"]=_lodash2.default.union(fieldsByJob["*"],fieldsByJob[job.job_id])}),$scope.fieldsByJob=fieldsByJob,viewByOptions=_lodash2.default.chain(viewByOptions).uniq().sortBy(function(fieldName){return fieldName.toLowerCase()}).value(),viewByOptions.push(VIEW_BY_JOB_LABEL),$scope.viewBySwimlaneOptions=viewByOptions,void 0!==$scope.appState.mlExplorerSwimlane.viewBy&&-1!==$scope.viewBySwimlaneOptions.indexOf($scope.appState.mlExplorerSwimlane.viewBy))$scope.swimlaneViewByFieldName=$scope.appState.mlExplorerSwimlane.viewBy;else{if(selectedJobIds.length>1)$scope.swimlaneViewByFieldName=VIEW_BY_JOB_LABEL;else{var firstSelectedJob=_lodash2.default.find(mlJobService.jobs,function(job){return job.job_id===selectedJobIds[0]}),firstJobInfluencers=firstSelectedJob.analysis_config.influencers||[];_lodash2.default.each(firstSelectedJob.analysis_config.detectors,function(detector){return _lodash2.default.has(detector,"partition_field_name")&&-1!==firstJobInfluencers.indexOf(detector.partition_field_name)?($scope.swimlaneViewByFieldName=detector.partition_field_name,!1):_lodash2.default.has(detector,"over_field_name")&&-1!==firstJobInfluencers.indexOf(detector.over_field_name)?($scope.swimlaneViewByFieldName=detector.over_field_name,!1):_lodash2.default.has(detector,"by_field_name")&&!_lodash2.default.has(detector,"over_field_name")&&-1!==firstJobInfluencers.indexOf(detector.by_field_name)?($scope.swimlaneViewByFieldName=detector.by_field_name,!1):void 0}),null===$scope.swimlaneViewByFieldName&&(firstJobInfluencers.length>0?$scope.swimlaneViewByFieldName=firstJobInfluencers[0]:$scope.swimlaneViewByFieldName=$scope.viewBySwimlaneOptions.length>0?$scope.viewBySwimlaneOptions[0]:null)}$scope.appState.mlExplorerSwimlane.viewBy=$scope.swimlaneViewByFieldName,$scope.appState.save()}loadViewBySwimlane([])}function loadOverallData(){function finish(counterVar){0==--awaitingCount&&counterVar===$scope.loadCounter&&($scope.overallSwimlaneData.points&&$scope.overallSwimlaneData.points.length>0?($scope.hasResults=!0,loadViewBySwimlaneOptions()):$scope.hasResults=!1,$scope.loading=!1,$timeout(function(){$scope.$broadcast("render"),mlExplorerDashboardService.swimlaneDataChange.changed("overall")},0))}if(null!==$scope.selectedJobs){$scope.loading=!0,$scope.hasResults=!1,$scope.loadCounter++;var awaitingCount=2;$scope.swimlaneBucketInterval=calculateSwimlaneBucketInterval(),console.log("Explorer swimlane bucketInterval:",$scope.swimlaneBucketInterval);var bounds=timefilter.getActiveBounds(),searchBounds=(0,_ml_time_buckets.getBoundsRoundedToInterval)(bounds,$scope.swimlaneBucketInterval,!1),selectedJobIds=$scope.getSelectedJobIds(),counter=$scope.loadCounter;mlResultsService.getTopInfluencers(selectedJobIds,searchBounds.min.valueOf(),searchBounds.max.valueOf(),MAX_INFLUENCER_FIELD_NAMES,MAX_INFLUENCER_FIELD_VALUES).then(function(resp){$scope.influencersData=resp.influencers,console.log("Explorer top influencers data set:",$scope.influencersData),finish(counter)});var overallBucketsBounds=(0,_ml_time_buckets.getBoundsRoundedToInterval)(bounds,$scope.swimlaneBucketInterval,!0);mlResultsService.getOverallBucketScores(selectedJobIds,1,overallBucketsBounds.min.valueOf(),overallBucketsBounds.max.valueOf(),$scope.swimlaneBucketInterval.asSeconds()+"s").then(function(resp){processOverallResults(resp.results,searchBounds),console.log("Explorer overall swimlane data set:",$scope.overallSwimlaneData),finish(counter)})}}function loadViewBySwimlane(fieldValues){function finish(){console.log("Explorer view by swimlane data set:",$scope.viewBySwimlaneData),$timeout(function(){mlExplorerDashboardService.swimlaneDataChange.changed("viewBy")},0)}if(void 0===$scope.selectedJobs||void 0===$scope.swimlaneViewByFieldName||null===$scope.swimlaneViewByFieldName)$scope.viewBySwimlaneData={fieldName:"",laneLabels:[],points:[],interval:3600},finish();else{var bounds=timefilter.getActiveBounds(),searchBounds=(0,_ml_time_buckets.getBoundsRoundedToInterval)(bounds,$scope.swimlaneBucketInterval,!1),selectedJobIds=$scope.getSelectedJobIds(),limit=mlSelectLimitService.state.get("limit"),swimlaneLimit=void 0===limit?10:limit.val,interval=$scope.swimlaneBucketInterval.asSeconds()+"s";if($scope.swimlaneViewByFieldName!==VIEW_BY_JOB_LABEL)mlResultsService.getInfluencerValueMaxScoreByTime(selectedJobIds,$scope.swimlaneViewByFieldName,fieldValues,searchBounds.min.valueOf(),searchBounds.max.valueOf(),interval,swimlaneLimit).then(function(resp){processViewByResults(resp.results),finish()});else{var jobIds=void 0!==fieldValues&&fieldValues.length>0?fieldValues:selectedJobIds;mlResultsService.getScoresByBucket(jobIds,searchBounds.min.valueOf(),searchBounds.max.valueOf(),interval,swimlaneLimit).then(function(resp){processViewByResults(resp.results),finish()})}}}function loadViewBySwimlaneForSelectedTime(earliestMs,latestMs){var selectedJobIds=$scope.getSelectedJobIds(),limit=mlSelectLimitService.state.get("limit"),swimlaneLimit=void 0===limit?10:limit.val;$scope.swimlaneViewByFieldName!==VIEW_BY_JOB_LABEL?mlResultsService.getTopInfluencers(selectedJobIds,earliestMs,latestMs,MAX_INFLUENCER_FIELD_NAMES,swimlaneLimit).then(function(resp){var topFieldValues=[],topInfluencers=resp.influencers[$scope.swimlaneViewByFieldName];_lodash2.default.each(topInfluencers,function(influencerData){influencerData.maxAnomalyScore>0&&topFieldValues.push(influencerData.influencerFieldValue)}),loadViewBySwimlane(topFieldValues)}):mlResultsService.getScoresByBucket(selectedJobIds,earliestMs,latestMs,$scope.swimlaneBucketInterval.asSeconds()+"s",swimlaneLimit).then(function(resp){loadViewBySwimlane(_lodash2.default.keys(resp.results))})}function clearSelectedAnomalies(){$scope.anomalyChartRecords=[],$scope.anomalyRecords=[],$scope.viewByLoadedForTimeFormatted=null;var jobIds=$scope.getSelectedJobIds(),bounds=timefilter.getActiveBounds(),earliestMs=bounds.min.valueOf(),latestMs=bounds.max.valueOf();mlExplorerDashboardService.anomalyDataChange.changed($scope.anomalyChartRecords,earliestMs,latestMs),$scope.loadAnomaliesTable(jobIds,[],earliestMs,latestMs)}function calculateSwimlaneBucketInterval(){var bounds=timefilter.getActiveBounds(),buckets=new TimeBuckets;buckets.setInterval("auto"),buckets.setBounds(bounds);var intervalSeconds=buckets.getInterval().asSeconds(),numBuckets=parseInt((bounds.max.valueOf()-bounds.min.valueOf())/1e3/intervalSeconds),swimlaneWidth=getSwimlaneContainerWidth(),cellWidth=Math.floor(swimlaneWidth/numBuckets);$scope.swimlaneWidth=swimlaneWidth,cellWidth<8&&buckets.setInterval(2*intervalSeconds+"s");var selectedJobs=_lodash2.default.filter($scope.jobs,function(job){return job.selected}),maxBucketSpanSeconds=_lodash2.default.reduce(selectedJobs,function(memo,job){return Math.max(memo,job.bucketSpanSeconds)},0);return maxBucketSpanSeconds>intervalSeconds&&(buckets.setInterval(maxBucketSpanSeconds+"s"),buckets.setBounds(bounds)),buckets.getInterval()}function getSwimlaneContainerWidth(){return $mlExplorer.width()/6*5-170-50}function processOverallResults(scoresByTime,searchBounds){var dataset={laneLabels:["Overall"],points:[],interval:$scope.swimlaneBucketInterval.asSeconds(),earliest:searchBounds.min.valueOf()/1e3,latest:searchBounds.max.valueOf()/1e3};_lodash2.default.keys(scoresByTime).length>0&&_lodash2.default.each(scoresByTime,function(score,timeMs){var time=timeMs/1e3;dataset.points.push({laneLabel:"Overall",time:time,value:score}),dataset.earliest=Math.min(time,dataset.earliest),dataset.latest=Math.max(time+dataset.interval,dataset.latest)}),$scope.overallSwimlaneData=dataset}function processViewByResults(scoresByInfluencerAndTime){var dataset={fieldName:$scope.swimlaneViewByFieldName,points:[],interval:$scope.swimlaneBucketInterval.asSeconds()};dataset.earliest=$scope.overallSwimlaneData.earliest,dataset.latest=$scope.overallSwimlaneData.latest;var laneLabels=[],maxScoreByLaneLabel={};_lodash2.default.each(scoresByInfluencerAndTime,function(influencerData,influencerFieldValue){laneLabels.push(influencerFieldValue),maxScoreByLaneLabel[influencerFieldValue]=0,_lodash2.default.each(influencerData,function(anomalyScore,timeMs){var time=timeMs/1e3;dataset.points.push({laneLabel:influencerFieldValue,time:time,value:anomalyScore}),maxScoreByLaneLabel[influencerFieldValue]=Math.max(maxScoreByLaneLabel[influencerFieldValue],anomalyScore)})}),dataset.laneLabels=laneLabels.sort(function(a,b){return maxScoreByLaneLabel[b]-maxScoreByLaneLabel[a]}),$scope.viewBySwimlaneData=dataset}$scope.timeFieldName="timestamp",$scope.loading=!0,$scope.loadCounter=0,timefilter.enableTimeRangeSelector(),timefilter.enableAutoRefreshSelector();var TimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider),queryFilter=Private(_query_filter.FilterBarQueryFilterProvider),resizeTimeout=null,$mlExplorer=(0,_jquery2.default)(".ml-explorer"),MAX_INFLUENCER_FIELD_NAMES=10,MAX_INFLUENCER_FIELD_VALUES=10,VIEW_BY_JOB_LABEL="job ID",ALLOW_CELL_RANGE_SELECTION=mlExplorerDashboardService.allowCellRangeSelection,disableDragSelectOnMouseLeave=!0;$scope.queryFilters=[],$scope.anomalyRecords=[];var dragSelect=new _dragselect2.default({selectables:document.querySelectorAll(".sl-cell"),callback:function(elements){elements.length>1&&!ALLOW_CELL_RANGE_SELECTION&&(elements=[elements[0]]),elements.length>0&&mlExplorerDashboardService.dragSelect.changed({action:"newSelection",elements:elements}),disableDragSelectOnMouseLeave=!0},onDragStart:function(){ALLOW_CELL_RANGE_SELECTION&&(mlExplorerDashboardService.dragSelect.changed({action:"dragStart"}),disableDragSelectOnMouseLeave=!1)},onElementSelect:function(){ALLOW_CELL_RANGE_SELECTION&&mlExplorerDashboardService.dragSelect.changed({action:"elementSelect"})}});$scope.selectedJobs=null,$scope.getSelectedJobIds=function(){var selectedJobs=_lodash2.default.filter($scope.jobs,function(job){return job.selected});return _lodash2.default.map(selectedJobs,function(job){return job.id})},$scope.viewBySwimlaneOptions=[],$scope.viewBySwimlaneData={fieldName:"",laneLabels:[],points:[],interval:3600},$scope.initializeVis=function(){var stateDefaults={filters:[],mlExplorerSwimlane:{}};$scope.appState=new AppState(stateDefaults),$scope.jobs=[],mlJobService.loadJobs().then(function(resp){if(resp.jobs.length>0){$scope.jobs=createJobs(resp.jobs);var selectedJobIds=mlJobSelectService.getSelectedJobIds(!0);$scope.setSelectedJobs(selectedJobIds)}else $scope.loading=!1}).catch(function(resp){console.log("Explorer - error getting job info from elasticsearch:",resp)}),mlExplorerDashboardService.init()},$scope.loadAnomaliesTable=function(jobIds,influencers,earliestMs,latestMs){mlResultsService.getRecordsForInfluencer(jobIds,influencers,0,earliestMs,latestMs,500).then(function(resp){$scope.$evalAsync(function(){$scope.anomalyRecords=_lodash2.default.chain(resp.records).sortBy(function(record){return record[$scope.timeFieldName]}).reverse().value(),console.log("Explorer anomalies table data set:",$scope.anomalyRecords)})})},$scope.setSelectedJobs=function(selectedIds){var previousSelected=0;null!==$scope.selectedJobs&&(previousSelected=$scope.selectedJobs.length);for(var i=0;i<selectedIds.length;i++)if(void 0===_lodash2.default.find($scope.jobs,{id:selectedIds[i]})){$scope.jobs=createJobs(mlJobService.jobs);break}$scope.selectedJobs=[],_lodash2.default.each($scope.jobs,function(job){job.selected=-1!==_lodash2.default.indexOf(selectedIds,job.id),job.selected&&$scope.selectedJobs.push(job)}),(previousSelected<=1&&$scope.selectedJobs.length>1||1===$scope.selectedJobs.length&&previousSelected>1)&&delete $scope.appState.mlExplorerSwimlane.viewBy,$scope.appState.save(),mlFieldFormatService.populateFormats(selectedIds,$route.current.locals.indexPatterns).finally(function(){clearSelectedAnomalies(),loadOverallData()})},$scope.setSwimlaneSelectActive=function(active){if(!active&&disableDragSelectOnMouseLeave)return dragSelect.clearSelection(),void dragSelect.stop();dragSelect.start()},$scope.setSwimlaneViewBy=function(viewByFieldName){$scope.swimlaneViewByFieldName=viewByFieldName,$scope.appState.mlExplorerSwimlane.viewBy=viewByFieldName,$scope.appState.save(),loadViewBySwimlane([]),clearSelectedAnomalies()},$scope.$listen(timefilter,"fetch",function(){loadOverallData(),clearSelectedAnomalies()});var refreshWatcher=Private(_refresh_interval_watcher.refreshIntervalWatcher);refreshWatcher.init(function(){loadOverallData(),clearSelectedAnomalies()}),mlJobSelectService.listenJobSelectionChange($scope,function(event,selections){delete $scope.appState.mlExplorerSwimlane.selectedType,delete $scope.appState.mlExplorerSwimlane.selectedLane,delete $scope.appState.mlExplorerSwimlane.selectedTime,delete $scope.appState.mlExplorerSwimlane.selectedInterval,$scope.setSelectedJobs(selections)}),(0,_jquery2.default)(window).resize(function(){null!==resizeTimeout&&$timeout.cancel(resizeTimeout),resizeTimeout=$timeout(redrawOnResize,500)});var navListener=$scope.$on("globalNav:update",function(){$timeout(function(){redrawOnResize()},300)});$scope.$listen(queryFilter,"update",function(){$scope.queryFilters=queryFilter.getFilters(),console.log("explorer_controller queryFilter update, filters:",$scope.queryFilters)}),$scope.initializeVis(),$scope.showViewBySwimlane=function(){return null!==$scope.viewBySwimlaneData&&$scope.viewBySwimlaneData.laneLabels&&$scope.viewBySwimlaneData.laneLabels.length>0};var getTimeRange=function(cellData){var bounds=timefilter.getActiveBounds(),earliestMs=void 0!==cellData.time[0]?1e3*cellData.time[0]:bounds.min.valueOf(),latestMs=void 0!==cellData.time[1]?1e3*cellData.time[1]:bounds.max.valueOf();return earliestMs===latestMs&&(latestMs+=1e3*cellData.interval),{earliestMs:earliestMs,latestMs:latestMs}},swimlaneCellClickListener=function(cellData){if(0===_lodash2.default.keys(cellData).length)$scope.viewByLoadedForTimeFormatted&&loadViewBySwimlane([]),clearSelectedAnomalies();else{var jobIds=[],influencers=[],timerange=getTimeRange(cellData);void 0===cellData.fieldName&&(loadViewBySwimlaneForSelectedTime(timerange.earliestMs,timerange.latestMs),$scope.viewByLoadedForTimeFormatted=(0,_moment2.default)(timerange.earliestMs).format("MMMM Do YYYY, HH:mm")),cellData.fieldName===VIEW_BY_JOB_LABEL?jobIds=cellData.laneLabels:(jobIds=$scope.getSelectedJobIds(),void 0!==cellData.fieldName&&cellData.laneLabels.forEach(function(laneLabel){influencers.push({fieldName:$scope.swimlaneViewByFieldName,fieldValue:laneLabel})})),$scope.cellData=cellData;var args=[jobIds,influencers,timerange.earliestMs,timerange.latestMs];$scope.loadAnomaliesTable.apply($scope,args),$scope.loadAnomaliesForCharts.apply($scope,args)}};mlExplorerDashboardService.swimlaneCellClick.watch(swimlaneCellClickListener);var checkboxShowChartsListener=function(){if(mlCheckboxShowChartsService.state.get("showCharts")&&void 0!==$scope.cellData)swimlaneCellClickListener($scope.cellData);else{var timerange=getTimeRange($scope.cellData);mlExplorerDashboardService.anomalyDataChange.changed([],timerange.earliestMs,timerange.latestMs)}};mlCheckboxShowChartsService.state.watch(checkboxShowChartsListener);var anomalyChartsSeverityListener=function(){if(mlCheckboxShowChartsService.state.get("showCharts")&&void 0!==$scope.cellData){var timerange=getTimeRange($scope.cellData);mlExplorerDashboardService.anomalyDataChange.changed($scope.anomalyChartRecords,timerange.earliestMs,timerange.latestMs)}};mlSelectSeverityService.state.watch(anomalyChartsSeverityListener);var swimlaneLimitListener=function(){loadViewBySwimlane([]),clearSelectedAnomalies()};mlSelectLimitService.state.watch(swimlaneLimitListener);var swimlaneRenderDoneListener=function(){dragSelect.addSelectables(document.querySelectorAll(".sl-cell"))};mlExplorerDashboardService.swimlaneRenderDone.watch(swimlaneRenderDoneListener),$scope.$on("$destroy",function(){dragSelect.stop(),mlCheckboxShowChartsService.state.unwatch(checkboxShowChartsListener),mlExplorerDashboardService.swimlaneCellClick.unwatch(swimlaneCellClickListener),mlExplorerDashboardService.swimlaneRenderDone.unwatch(swimlaneRenderDoneListener),mlSelectSeverityService.state.unwatch(anomalyChartsSeverityListener),mlSelectLimitService.state.unwatch(swimlaneLimitListener),$scope.cellData=void 0,refreshWatcher.cancel(),navListener()}),$scope.loadAnomaliesForCharts=function(jobIds,influencers,earliestMs,latestMs){mlResultsService.getRecordsForInfluencer(jobIds,influencers,0,earliestMs,latestMs,500).then(function(resp){$scope.anomalyChartRecords=resp.records,console.log("Explorer anomaly charts data set:",$scope.anomalyChartRecords),mlCheckboxShowChartsService.state.get("showCharts")&&mlExplorerDashboardService.anomalyDataChange.changed($scope.anomalyChartRecords,earliestMs,latestMs)})}})},3484:function(module,exports,__webpack_require__){(function(module){function DragSelect(e){this.multiSelectKeyPressed,this.initialCursorPos,this.initialScroll,this.selected=[],this._prevSelected=[],this._createBindings(),this._setupOptions(e),this.start()}var __WEBPACK_AMD_DEFINE_RESULT__;DragSelect.prototype._createBindings=function(){this._startUp=this._startUp.bind(this),this._handleMove=this._handleMove.bind(this),this.reset=this.reset.bind(this),this._onClick=this._onClick.bind(this)},DragSelect.prototype._setupOptions=function(e){if(this.selectables=[],this._handleSelectables(this.toArray(e.selectables)),this.multiSelectKeys=e.multiSelectKeys||["ctrlKey","shiftKey","metaKey"],this.autoScrollSpeed=e.autoScrollSpeed||1,this.selectCallback=e.onElementSelect||function(){},this.unselectCallback=e.onElementUnselect||function(){},this.moveStartCallback=e.onDragStart||function(){},this.moveCallback=e.onDragMove||function(){},this.callback=e.callback||function(){},this.area=e.area||document,this.customStyles=e.customStyles,this.area!==document){var t=getComputedStyle(this.area);"absolute"===t.position||"relative"===t.position||"fixed"===t.position||(this.area.style.position="relative")}this.selector=e.selector||this._createSelector(),this.addClass(this.selector,"ds-selector")},DragSelect.prototype._handleSelectables=function(e,t,s){for(var i=0;i<e.length;i++){var o=e[i],r=this.selectables.indexOf(o);r<0&&!t?(this.addClass(o,"ds-selectable"),o.addEventListener("click",this._onClick),this.selectables.push(o),s&&this.selected.indexOf(o)<0&&(this.addClass(o,"ds-selected"),this.selected.push(o))):r>-1&&t&&(this.removeClass(o,"ds-hover"),this.removeClass(o,"ds-selectable"),o.removeEventListener("click",this._onClick),this.selectables.splice(r,1),s&&this.selected.indexOf(o)>-1&&(this.removeClass(o,"ds-selected"),this.selected.splice(this.selected.indexOf(o),1)))}},DragSelect.prototype._onClick=function(e){if(!this.mouseInteraction){var t=e.target;this.isMultiSelectKeyPressed(e)?this._prevSelected=this.selected.slice():this._prevSelected=[],this.checkIfInsideSelection(!0),this.selectables.indexOf(t)>-1&&(this.toggle(t),this.reset())}},DragSelect.prototype._createSelector=function(){var e=document.createElement("div");return e.style.position="absolute",this.customStyles||(e.style.background="rgba(0, 0, 255, 0.1)",e.style.border="1px solid rgba(0, 0, 255, 0.45)",e.style.display="none",e.style.pointerEvents="none"),(this.area===document?document.body:this.area).appendChild(e),e},DragSelect.prototype.start=function(){this.area.addEventListener("mousedown",this._startUp)},DragSelect.prototype._startUp=function(e){if(this.mouseInteraction=!0,this.selector.style.display="block",this.isMultiSelectKeyPressed(e)?this._prevSelected=this.selected.slice():this._prevSelected=[],this._getStartingPositions(e),this.checkIfInsideSelection(!0),this.selector.style.display="none",this.moveStartCallback(e),this._breaked)return!1;this.area.removeEventListener("mousedown",this._startUp),this.area.addEventListener("mousemove",this._handleMove),this.area.addEventListener("mouseup",this.reset)},DragSelect.prototype.isMultiSelectKeyPressed=function(e){this.multiSelectKeyPressed=!1;for(var t=0;t<this.multiSelectKeys.length;t++)e[this.multiSelectKeys[t]]&&(this.multiSelectKeyPressed=!0);return this.multiSelectKeyPressed},DragSelect.prototype._getStartingPositions=function(e){this.initialCursorPos=this.getCursorPos(e,this.area),this.initialScroll=this.getScroll(this.area);var t={};t.x=this.initialCursorPos.x+this.initialScroll.x,t.y=this.initialCursorPos.y+this.initialScroll.y,t.w=0,t.h=0,this.updatePos(this.selector,t)},DragSelect.prototype._handleMove=function(e){var t=this.getPosition(e);if(this.moveCallback(e),this._breaked)return!1;this.selector.style.display="block",this.updatePos(this.selector,t),this.checkIfInsideSelection(),this._autoScroll(e)},DragSelect.prototype.getPosition=function(e){var t=this.getCursorPos(e,this.area),s=this.getScroll(this.area);this.newCursorPos=t;var i={x:s.x-this.initialScroll.x,y:s.y-this.initialScroll.y},o={};return t.x>this.initialCursorPos.x-i.x?(o.x=this.initialCursorPos.x+this.initialScroll.x,o.w=t.x-this.initialCursorPos.x+i.x):(o.x=t.x+s.x,o.w=this.initialCursorPos.x-t.x-i.x),t.y>this.initialCursorPos.y-i.y?(o.y=this.initialCursorPos.y+this.initialScroll.y,o.h=t.y-this.initialCursorPos.y+i.y):(o.y=t.y+s.y,o.h=this.initialCursorPos.y-t.y-i.y),o},DragSelect.prototype.checkIfInsideSelection=function(e){for(var t=!1,s=0,i=this.selectables.length;s<i;s++){var o=this.selectables[s];this.isElementTouching(o,this.selector,this.area)?(this._handleSelection(o,e),t=!0):this._handleUnselection(o,e)}return t},DragSelect.prototype._handleSelection=function(e,t){if(this.hasClass(e,"ds-hover")&&!t)return!1;var s=this.selected.indexOf(e);s<0?this.select(e):s>-1&&this.multiSelectKeyPressed&&this.unselect(e),this.addClass(e,"ds-hover")},DragSelect.prototype._handleUnselection=function(e,t){if(!this.hasClass(e,"ds-hover")&&!t)return!1;var s=this.selected.indexOf(e),i=this._prevSelected.indexOf(e);s>-1&&i<0?this.unselect(e):s<0&&i>-1&&this.select(e),this.removeClass(e,"ds-hover")},DragSelect.prototype.select=function(e){return!(this.selected.indexOf(e)>-1)&&(this.selected.push(e),this.addClass(e,"ds-selected"),this.selectCallback(e),!this._breaked&&e)},DragSelect.prototype.unselect=function(e){return!(this.selected.indexOf(e)<0)&&(this.selected.splice(this.selected.indexOf(e),1),this.removeClass(e,"ds-selected"),this.unselectCallback(e),!this._breaked&&e)},DragSelect.prototype.toggle=function(e){return this.selected.indexOf(e)>-1?this.unselect(e):this.select(e),e},DragSelect.prototype.isElementTouching=function(e,t,s){var i=this.getScroll(s),o={y:t.getBoundingClientRect().top+i.y,x:t.getBoundingClientRect().left+i.x,h:t.offsetHeight||e.getBoundingClientRect().height,w:t.offsetWidth||e.getBoundingClientRect().width},r={y:e.getBoundingClientRect().top+i.y,x:e.getBoundingClientRect().left+i.x,h:e.offsetHeight||e.getBoundingClientRect().height,w:e.offsetWidth||e.getBoundingClientRect().width};return o.x<r.x+r.w&&o.x+o.w>r.x&&o.y<r.y+r.h&&o.h+o.y>r.y},DragSelect.prototype._autoScroll=function(e){var t=this.isCursorNearEdge(e,this.area),s=this.area===document?this.area.body:this.area;"top"===t&&s.scrollTop>0?s.scrollTop-=1*this.autoScrollSpeed:"bottom"===t?s.scrollTop+=1*this.autoScrollSpeed:"left"===t&&s.scrollLeft>0?s.scrollLeft-=1*this.autoScrollSpeed:"right"===t&&(s.scrollLeft+=1*this.autoScrollSpeed)},DragSelect.prototype.isCursorNearEdge=function(e,t){var s=this.getCursorPos(e,t),i=this.getAreaRect(t),o={x:Math.max(i.width/10,30),y:Math.max(i.height/10,30)};return s.y<o.y?"top":i.height-s.y<o.y?"bottom":i.width-s.x<o.x?"right":s.x<o.x&&"left"},DragSelect.prototype.reset=function(e){if(this.area.removeEventListener("mousemove",this._handleMove),this.area.addEventListener("mousedown",this._startUp),this.callback(this.selected,e),this._breaked)return!1;this.selector.style.width="0",this.selector.style.height="0",this.selector.style.display="none",setTimeout(function(){this.mouseInteraction=!1}.bind(this),100)},DragSelect.prototype.break=function(){this._breaked=!0,setTimeout(function(){this._breaked=!1}.bind(this),100)},DragSelect.prototype.stop=function(){this.reset(),this.area.removeEventListener("mousedown",this._startUp),this.area.removeEventListener("mouseup",this.reset)},DragSelect.prototype.getSelection=function(){return this.selected},DragSelect.prototype.addSelection=function(e,t,s){for(var i=this.toArray(e),o=0,r=i.length;o<r;o++){var l=i[o];this.select(l)}return s||this.addSelectables(i),t&&this.callback(this.selected,!1),this.selected},DragSelect.prototype.removeSelection=function(e,t,s){for(var i=this.toArray(e),o=0,r=i.length;o<r;o++){var l=i[o];this.unselect(l)}return s&&this.removeSelectables(i),t&&this.callback(this.selected,!1),this.selected},DragSelect.prototype.setSelection=function(e,t,s){return this.clearSelection(),this.addSelection(e,t,s),this.selected},DragSelect.prototype.clearSelection=function(e){for(var t=this.selected.slice(),s=0,i=t.length;s<i;s++){var o=t[s];this.unselect(o)}return e&&this.callback(this.selected,!1),this.selected},DragSelect.prototype.addSelectables=function(e,t){var s=this.toArray(e);return this._handleSelectables(s,!1,t),e},DragSelect.prototype.getSelectables=function(){return this.selectables},DragSelect.prototype.removeSelectables=function(e,t){var s=this.toArray(e);return this._handleSelectables(s,!0,t),e},DragSelect.prototype.addClass=function(e,t){if(e.classList)return e.classList.add(t);var s=e.getAttribute("class")||"";return-1!==s.indexOf(t)?e:(""!==s&&(t=" "+t),e.setAttribute("class",s+t),e)},DragSelect.prototype.removeClass=function(e,t){if(e.classList)return e.classList.remove(t);var s=e.getAttribute("class")||"",i=new RegExp(t+"\\b","g");return s=s.replace(i,""),e.setAttribute("class",s),e},DragSelect.prototype.hasClass=function(e,t){return e.classList?e.classList.contains(t):(e.getAttribute("class")||"").indexOf(t)>-1},DragSelect.prototype.toArray=function(e){if(!e)return!1;if(!e.length&&this.isElement(e))return[e];for(var t=[],s=e.length-1;s>=0;s--)t[s]=e[s];return t},DragSelect.prototype.isElement=function(e){try{return e instanceof HTMLElement||e instanceof SVGElement}catch(t){return"object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument}},DragSelect.prototype.getCursorPos=function(e,t){var s={x:e.pageX||e.clientX,y:e.pageY||e.clientY},i=this.getAreaRect(t||document),o=this.getScroll();return{x:s.x-i.left-o.x,y:s.y-i.top-o.y}},DragSelect.prototype.getInitialCursorPosition=function(){return this.initialCursorPos},DragSelect.prototype.getCurrentCursorPosition=function(){return this.newCursorPos},DragSelect.prototype.getCursorPositionDifference=function(){var e=this.getInitialCursorPosition(),t=this.getCurrentCursorPosition();return{x:e.x-t.x,y:e.y-t.y}},DragSelect.prototype.getScroll=function(e){var t={top:document.body.scrollTop>0?document.body.scrollTop:document.documentElement.scrollTop,left:document.body.scrollLeft>0?document.body.scrollLeft:document.documentElement.scrollLeft};return{y:e&&e.scrollTop>=0?e.scrollTop:t.top,x:e&&e.scrollLeft>=0?e.scrollLeft:t.left}},DragSelect.prototype.getAreaRect=function(e){if(e===document){var t={y:e.documentElement.clientHeight>0?e.documentElement.clientHeight:window.innerHeight,x:e.documentElement.clientWidth>0?e.documentElement.clientWidth:window.innerWidth};return{top:0,left:0,bottom:0,right:0,width:t.x,height:t.y}}return{top:e.getBoundingClientRect().top,left:e.getBoundingClientRect().left,bottom:e.getBoundingClientRect().bottom,right:e.getBoundingClientRect().right,width:e.offsetWidth,height:e.offsetHeight}},DragSelect.prototype.updatePos=function(e,t){return e.style.left=t.x+"px",e.style.top=t.y+"px",e.style.width=t.w+"px",e.style.height=t.h+"px",e},void 0!==module&&null!==module?module.exports=DragSelect:__webpack_require__(288)?void 0!==(__WEBPACK_AMD_DEFINE_RESULT__=function(){return DragSelect}.call(exports,__webpack_require__,exports,module))&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__):window.DragSelect=DragSelect}).call(exports,__webpack_require__(80)(module))},3485:function(module,exports){},3486:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment),_lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_risonNode=__webpack_require__(191),_risonNode2=_interopRequireDefault(_risonNode),_notify=__webpack_require__(10),_field_types=__webpack_require__(208),_parse_interval=__webpack_require__(166),_custom_url_utils=__webpack_require__(1153),_string_utils=__webpack_require__(43),_job_utils=__webpack_require__(57),_anomaly_utils=__webpack_require__(260),_anomalies_table=__webpack_require__(3487),_anomalies_table2=_interopRequireDefault(_anomalies_table);__webpack_require__(3488),__webpack_require__(1156),__webpack_require__(484),__webpack_require__(3502),__webpack_require__(483),__webpack_require__(306),__webpack_require__(3503),__webpack_require__(3505);var _anomalies_table_links=__webpack_require__(3507),_anomalies_table_links2=_interopRequireDefault(_anomalies_table_links),_chrome=__webpack_require__(8),_chrome2=_interopRequireDefault(_chrome),_open=__webpack_require__(1150),_open2=_interopRequireDefault(_open);__webpack_require__(2).uiModules.get("apps/ml").directive("mlAnomaliesTable",function($window,$route,timefilter,mlJobService,mlESMappingService,mlResultsService,mlAnomaliesTableService,mlSelectIntervalService,mlSelectSeverityService,mlFieldFormatService,formatValueFilter){return{restrict:"E",scope:{anomalyRecords:"=",timeFieldName:"=",showViewSeriesLink:"=",filteringEnabled:"="},template:_anomalies_table2.default,link:function(scope,element){function updateTableData(){var summaryRecords=[];if(scope.isShowingAggregatedData())summaryRecords=aggregateAnomalies();else{var interval=mlSelectIntervalService.state.get("interval");scope.momentInterval=interval.val;var threshold=mlSelectSeverityService.state.get("threshold"),filteredRecords=_lodash2.default.filter(scope.anomalyRecords,function(record){return Number(record.record_score)>=threshold.val});_lodash2.default.each(filteredRecords,function(record){var detectorIndex=record.detector_index,jobId=record.job_id,detector=record.function_description;_lodash2.default.has(mlJobService.detectorsByJob,jobId)&&detectorIndex<mlJobService.detectorsByJob[jobId].length&&(detector=mlJobService.detectorsByJob[jobId][detectorIndex].detector_description);var displayRecord={time:record[scope.timeFieldName],"max severity":record.record_score,detector:detector,jobId:jobId,source:record},entityName=(0,_anomaly_utils.getEntityFieldName)(record);if(void 0!==entityName&&(displayRecord.entityName=entityName,displayRecord.entityValue=(0,_anomaly_utils.getEntityFieldValue)(record)),_lodash2.default.has(record,"partition_field_name")&&(displayRecord.partitionFieldName=record.partition_field_name,displayRecord.partitionFieldValue=record.partition_field_value),_lodash2.default.has(record,"influencers")){var influencers=[],sourceInfluencers=_lodash2.default.sortBy(record.influencers,"influencer_field_name");_lodash2.default.each(sourceInfluencers,function(influencer){var influencerFieldName=influencer.influencer_field_name;_lodash2.default.each(influencer.influencer_field_values,function(influencerFieldValue){var influencerToAdd={};influencerToAdd[influencerFieldName]=influencerFieldValue,influencers.push(influencerToAdd)})}),displayRecord.influencers=influencers}var functionDescription=_lodash2.default.get(record,"function_description","");if(!0===(0,_anomaly_utils.showActualForFunction)(functionDescription))if(_lodash2.default.has(record,"actual"))displayRecord.actual=record.actual;else if(1===_lodash2.default.get(record,"causes",[]).length){var cause=_lodash2.default.first(record.causes);displayRecord.actual=cause.actual}if(!0===(0,_anomaly_utils.showTypicalForFunction)(functionDescription))if(_lodash2.default.has(record,"typical"))displayRecord.typical=record.typical;else if(1===_lodash2.default.get(record,"causes",[]).length){var _cause=_lodash2.default.first(record.causes);displayRecord.typical=_cause.typical}_lodash2.default.has(mlJobService.customUrlsByJob,jobId)&&(displayRecord.customUrls=mlJobService.customUrlsByJob[jobId]),summaryRecords.push(displayRecord)})}if(_lodash2.default.invoke(scope.rowScopes,"$destroy"),scope.rowScopes.length=0,_lodash2.default.some(summaryRecords,{entityName:"mlcategory"})){var categoryRecords=_lodash2.default.where(summaryRecords,{entityName:"mlcategory"}),categoryIdsByJobId={};_lodash2.default.each(categoryRecords,function(record){_lodash2.default.has(categoryIdsByJobId,record.jobId)||(categoryIdsByJobId[record.jobId]=[]),categoryIdsByJobId[record.jobId].push(record.entityValue)}),loadCategoryExamples(categoryIdsByJobId)}else scope.categoryExamplesByJob={};scope.table.columns=getPaginatedTableColumns(summaryRecords),summaryRecords=_lodash2.default.sortBy(summaryRecords,"max severity").reverse(),scope.table.rows=summaryRecords.map(function(record){return createTableRow(record)})}function aggregateAnomalies(){if(console.log("aggregateAnomalies(): number of anomalies to aggregate:",scope.anomalyRecords.length),0===scope.anomalyRecords.length)return[];var interval=mlSelectIntervalService.state.get("interval");if("auto"===interval.val){var earliest=(0,_moment2.default)(_lodash2.default.last(scope.anomalyRecords)[scope.timeFieldName]),latest=(0,_moment2.default)(_lodash2.default.first(scope.anomalyRecords)[scope.timeFieldName]),daysDiff=latest.diff(earliest,"days");scope.momentInterval=daysDiff<2?"hour":"day"}else scope.momentInterval=interval.val;var threshold=mlSelectSeverityService.state.get("threshold"),filteredRecords=_lodash2.default.filter(scope.anomalyRecords,function(record){return Number(record.record_score)>=threshold.val}),aggregatedData={};_lodash2.default.each(filteredRecords,function(record){var roundedTime=(0,_moment2.default)(record[scope.timeFieldName]).startOf(scope.momentInterval).valueOf();_lodash2.default.has(aggregatedData,roundedTime)||(aggregatedData[roundedTime]={});var detectorIndex=record.detector_index,jobId=record.job_id,detector=record.function_description;_lodash2.default.has(mlJobService.detectorsByJob,jobId)&&detectorIndex<mlJobService.detectorsByJob[jobId].length&&(detector=mlJobService.detectorsByJob[jobId][detectorIndex].detector_description);var detectorsAtTime=aggregatedData[roundedTime];_lodash2.default.has(detectorsAtTime,detector)||(detectorsAtTime[detector]={});var entitiesForDetector=detectorsAtTime[detector],entity=(0,_anomaly_utils.getEntityFieldValue)(record);void 0===entity&&(entity=""),_lodash2.default.has(entitiesForDetector,entity)?record.record_score>entitiesForDetector[entity].record_score&&(entitiesForDetector[entity]=record):entitiesForDetector[entity]=record}),console.log("aggregateAnomalies() aggregatedData is:",aggregatedData);var summaryRecords=[];return _lodash2.default.each(aggregatedData,function(timeDetectors,roundedTime){_lodash2.default.each(timeDetectors,function(entityDetectors,detector){_lodash2.default.each(entityDetectors,function(record,entity){var displayRecord={time:+roundedTime,"max severity":record.record_score,detector:detector,jobId:record.job_id,source:record},entityName=(0,_anomaly_utils.getEntityFieldName)(record);if(void 0!==entityName&&(displayRecord.entityName=entityName,displayRecord.entityValue=entity),_lodash2.default.has(record,"partition_field_name")&&(displayRecord.partitionFieldName=record.partition_field_name,displayRecord.partitionFieldValue=record.partition_field_value),_lodash2.default.has(record,"influencers")){var influencers=[],sourceInfluencers=_lodash2.default.sortBy(record.influencers,"influencer_field_name");_lodash2.default.each(sourceInfluencers,function(influencer){var influencerFieldName=influencer.influencer_field_name;_lodash2.default.each(influencer.influencer_field_values,function(influencerFieldValue){var influencerToAdd={};influencerToAdd[influencerFieldName]=influencerFieldValue,influencers.push(influencerToAdd)})}),displayRecord.influencers=influencers}var functionDescription=_lodash2.default.get(record,"function_description","");if(!0===(0,_anomaly_utils.showActualForFunction)(functionDescription))if(_lodash2.default.has(record,"actual"))displayRecord.actual=record.actual;else if(1===_lodash2.default.get(record,"causes",[]).length){var cause=_lodash2.default.first(record.causes);displayRecord.actual=cause.actual}if(!0===(0,_anomaly_utils.showTypicalForFunction)(functionDescription))if(_lodash2.default.has(record,"typical"))displayRecord.typical=record.typical;else if(1===_lodash2.default.get(record,"causes",[]).length){var _cause2=_lodash2.default.first(record.causes);displayRecord.typical=_cause2.typical}_lodash2.default.has(mlJobService.customUrlsByJob,record.job_id)&&(displayRecord.customUrls=mlJobService.customUrlsByJob[record.job_id]),summaryRecords.push(displayRecord)})})}),summaryRecords}function getPaginatedTableColumns(summaryRecords){var paginatedTableColumns=[{title:"",sortable:!1,class:"col-expand-arrow"},{title:"time",sortable:!0}];scope.isShowingAggregatedData()?paginatedTableColumns.push({title:"max severity",sortable:!0}):paginatedTableColumns.push({title:"severity",sortable:!0}),paginatedTableColumns.push({title:"detector",sortable:!0});var showEntity=_lodash2.default.some(summaryRecords,"entityValue"),showInfluencers=_lodash2.default.some(summaryRecords,"influencers"),showActual=_lodash2.default.some(summaryRecords,"actual"),showTypical=_lodash2.default.some(summaryRecords,"typical"),showExamples=_lodash2.default.some(summaryRecords,{entityName:"mlcategory"}),showLinks=!0===scope.showViewSeriesLink&&_lodash2.default.some(summaryRecords,function(record){var job=mlJobService.getJob(record.jobId);return(0,_job_utils.isTimeSeriesViewDetector)(job,record.source.detector_index)})||!0===showExamples||_lodash2.default.some(summaryRecords,"customUrls");return!0===showEntity&&paginatedTableColumns.push({title:"found for",sortable:!0}),!0===showInfluencers&&paginatedTableColumns.push({title:"influenced by",sortable:!0}),!0===showActual&&paginatedTableColumns.push({title:"actual",sortable:!0}),!0===showTypical&&(paginatedTableColumns.push({title:"typical",sortable:!0}),!0===_lodash2.default.some(summaryRecords,function(record){var summaryRecFunc=record.source.function;return"time_of_day"!==summaryRecFunc&&"time_of_week"!==summaryRecFunc})&&paginatedTableColumns.push({title:"description",sortable:!0})),paginatedTableColumns.push({title:"job ID",sortable:!0}),!0===showLinks&&paginatedTableColumns.push({title:"links",sortable:!1}),!0===showExamples&&paginatedTableColumns.push({title:"category examples",sortable:!1}),paginatedTableColumns}function createTableRow(record){var rowScope=scope.$new();rowScope.expandable=!0,rowScope.expandElement="ml-anomalies-table-expanded-row",rowScope.record=record,rowScope.isShowingAggregatedData=scope.isShowingAggregatedData(),rowScope.initRow=function(){_lodash2.default.has(record,"entityValue")&&"mlcategory"===record.entityName&&mlResultsService.getCategoryDefinition(record.jobId,record.entityValue).then(function(resp){rowScope.categoryDefinition={examples:_lodash2.default.slice(resp.examples,0,Math.min(resp.examples.length,MAX_NUMBER_CATEGORY_EXAMPLES))}}).catch(function(resp){console.log("Anomalies table createTableRow(): error loading categoryDefinition:",resp)}),rowScope.$broadcast("initRow",record)},rowScope.mouseenterRow=function(){mlAnomaliesTableService.anomalyRecordMouseenter.changed(record)},rowScope.mouseleaveRow=function(){mlAnomaliesTableService.anomalyRecordMouseleave.changed(record)};var addEntity=_lodash2.default.findWhere(scope.table.columns,{title:"found for"}),addInfluencers=_lodash2.default.findWhere(scope.table.columns,{title:"influenced by"}),addActual=_lodash2.default.findWhere(scope.table.columns,{title:"actual"}),addTypical=_lodash2.default.findWhere(scope.table.columns,{title:"typical"}),addDescription=_lodash2.default.findWhere(scope.table.columns,{title:"description"}),addExamples=_lodash2.default.findWhere(scope.table.columns,{title:"category examples"}),addLinks=_lodash2.default.findWhere(scope.table.columns,{title:"links"}),fieldFormat=mlFieldFormatService.getFieldFormat(record.jobId,record.source.detector_index),tableRow=[{markup:_open2.default,scope:rowScope},{markup:formatTimestamp(record.time),value:record.time},{markup:parseInt(record["max severity"])>=1?'<i class="fa fa-exclamation-triangle ml-icon-severity-'+(0,_anomaly_utils.getSeverity)(record["max severity"])+'" aria-hidden="true"></i> '+Math.floor(record["max severity"]):'<i class="fa fa-exclamation-triangle ml-icon-severity-'+(0,_anomaly_utils.getSeverity)(record["max severity"])+'" aria-hidden="true"></i> &lt; 1',value:record["max severity"]},{markup:(0,_string_utils.mlEscape)(record.detector),value:record.detector}];if(void 0!==addEntity)if(_lodash2.default.has(record,"entityValue"))if("mlcategory"!==record.entityName){var safeEntityName=(0,_string_utils.mlEscape)(record.entityName.replace(/(['\\])/g,"\\$1")),safeEntityValue=(0,_string_utils.mlEscape)(record.entityValue.replace(/(['\\])/g,"\\$1"));tableRow.push({markup:(0,_string_utils.mlEscape)(record.entityValue)+' <button ng-if="filteringEnabled"ng-click="filter(\''+safeEntityName+"', '"+safeEntityValue+'\', \'+\')" tooltip="Add filter" tooltip-append-to-body="1" aria-label="Filter for value"><i class="fa fa-search-plus" aria-hidden="true"></i></button> <button ng-if="filteringEnabled"ng-click="filter(\''+safeEntityName+"', '"+safeEntityValue+'\', \'-\')" tooltip="Remove filter" tooltip-append-to-body="1" aria-label="Remove filter"><i class="fa fa-search-minus" aria-hidden="true"></i></button>',value:record.entityValue,scope:rowScope})}else tableRow.push({markup:"mlcategory "+record.entityValue,value:record.entityValue});else tableRow.push({markup:"",value:""});if(void 0!==addInfluencers)if(_lodash2.default.has(record,"influencers")){var cellMarkup='<ml-influencers-cell influencers="record.influencers" limit="'+scope.influencersLimit+'"></ml-influencers-cell>';tableRow.push({markup:cellMarkup,value:cellMarkup,scope:rowScope})}else tableRow.push({markup:"",value:""});if(void 0!==addActual&&(_lodash2.default.has(record,"actual")?tableRow.push({markup:formatValueFilter(record.actual,record.source.function,fieldFormat),value:Number(record.actual),scope:rowScope}):tableRow.push({markup:"",value:""})),void 0!==addTypical)if(_lodash2.default.has(record,"typical")){var typicalVal=Number(record.typical);if(tableRow.push({markup:formatValueFilter(record.typical,record.source.function,fieldFormat),value:typicalVal,scope:rowScope}),void 0!==addDescription){var detectorFunc=record.source.function;if("time_of_week"!==detectorFunc&&"time_of_day"!==detectorFunc){var actualVal=Number(record.actual),factor=actualVal>typicalVal?actualVal/typicalVal:typicalVal/actualVal;tableRow.push({markup:'<span ng-bind-html="'+actualVal+" | metricChangeDescription:"+typicalVal+'"></span>',value:Math.abs(factor),scope:rowScope})}else tableRow.push({markup:"",value:""})}}else tableRow.push({markup:"",value:""}),void 0!==addDescription&&tableRow.push({markup:"",value:""});if(tableRow.push({markup:record.jobId,value:record.jobId}),void 0!==addLinks){var job=mlJobService.getJob(record.jobId);rowScope.showViewSeriesLink=!0===scope.showViewSeriesLink&&(0,_job_utils.isTimeSeriesViewDetector)(job,record.source.detector_index),rowScope.showViewExamplesLink="mlcategory"===_lodash2.default.get(record,"entityName"),_lodash2.default.has(record,"customUrls")||!0===rowScope.showViewSeriesLink||rowScope.showViewExamplesLink?(rowScope.customUrls=record.customUrls,rowScope.source=record.source,tableRow.push({markup:_anomalies_table_links2.default,scope:rowScope})):tableRow.push({markup:"",value:""})}return void 0!==addExamples&&("mlcategory"===record.entityName?tableRow.push({markup:'<span style="display: block; white-space:nowrap;" ng-repeat="item in getExamplesForCategory(record.jobId, record.entityValue)">{{item}}</span>',scope:rowScope}):tableRow.push({markup:"",value:""})),scope.rowScopes.push(rowScope),tableRow}function loadCategoryExamples(categoryIdsByJobId){scope.categoryExamplesByJob={},_lodash2.default.each(categoryIdsByJobId,function(categoryIds,jobId){mlResultsService.getCategoryExamples(jobId,categoryIds,MAX_NUMBER_CATEGORY_EXAMPLES).then(function(resp){scope.categoryExamplesByJob[jobId]=resp.examplesByCategoryId}).catch(function(resp){console.log("Anomalies table - error getting category examples:",resp)})})}function formatTimestamp(epochMs){var time=(0,_moment2.default)(epochMs);return"hour"===scope.momentInterval?time.format("MMMM Do YYYY, HH:mm"):"second"===scope.momentInterval?time.format("MMMM Do YYYY, HH:mm:ss"):time.format("MMMM Do YYYY")}mlSelectIntervalService.state.reset().changed(),mlSelectSeverityService.state.reset().changed(),scope.momentInterval="second",scope.table={},scope.table.perPage=25,scope.table.columns=[],scope.table.rows=[],scope.rowScopes=[],scope.influencersLimit=5,scope.categoryExamplesByJob={};var MAX_NUMBER_CATEGORY_EXAMPLES=10;mlSelectIntervalService.state.watch(updateTableData),mlSelectSeverityService.state.watch(updateTableData),scope.$watchCollection("anomalyRecords",updateTableData),element.on("$destroy",function(){mlSelectIntervalService.state.unwatch(updateTableData),mlSelectSeverityService.state.unwatch(updateTableData),scope.$destroy()}),scope.isShowingAggregatedData=function(){return"Show all"!==mlSelectIntervalService.state.get("interval").display},scope.getExamplesForCategory=function(jobId,categoryId){return _lodash2.default.get(scope.categoryExamplesByJob,[jobId,categoryId],[])},scope.viewSeries=function(record){var bounds=timefilter.getActiveBounds(),from=bounds.min.toISOString(),to=bounds.max.toISOString(),recordTime=(0,_moment2.default)(record[scope.timeFieldName]),zoomFrom=recordTime.subtract(50*record.bucket_span,"s").toISOString(),zoomTo=recordTime.add(100*record.bucket_span,"s").toISOString(),entityCondition={};_lodash2.default.has(record,"partition_field_value")&&(entityCondition[record.partition_field_name]=record.partition_field_value),_lodash2.default.has(record,"over_field_value")&&(entityCondition[record.over_field_name]=record.over_field_value),_lodash2.default.has(record,"by_field_value")&&(entityCondition[record.by_field_name]=record.by_field_value);var _g=_risonNode2.default.encode({ml:{jobIds:[record.job_id]},refreshInterval:{display:"Off",pause:!1,value:0},time:{from:from,to:to,mode:"absolute"}}),_a=_risonNode2.default.encode({mlTimeSeriesExplorer:{zoom:{from:zoomFrom,to:zoomTo},detectorIndex:record.detector_index,entities:entityCondition},filters:[],query:{query_string:{analyze_wildcard:!0,query:"*"}}}),path=_chrome2.default.getBasePath();path+="/app/ml#/timeseriesexplorer",path+="?_g="+_g,path+="&_a="+encodeURIComponent(_a),$window.open(path,"_blank")},scope.viewExamples=function(record){function findFieldType(index){mlESMappingService.getFieldTypeFromMapping(index,categorizationFieldName).then(function(resp){""!==resp?createAndOpenUrl(index,resp):(i++,i<datafeedIndices.length?findFieldType(datafeedIndices[i]):error())}).catch(function(){error()})}function createAndOpenUrl(index,categorizationFieldType){for(var indexPatterns=$route.current.locals.indexPatterns,indexPatternId=index,j=0;j<indexPatterns.length;j++)if(indexPatterns[j].get("title")===index){indexPatternId=indexPatterns[j].id;break}mlResultsService.getCategoryDefinition(record.job_id,categoryId).then(function(resp){var query=null;categorizationFieldType===_field_types.ES_FIELD_TYPES.KEYWORD?resp.regex&&(query=categorizationFieldName+":/"+resp.regex+"/"):resp.terms&&(query=categorizationFieldName+":"+resp.terms.split(" ").join(" AND "+categorizationFieldName+":"));var recordTime=(0,_moment2.default)(record[scope.timeFieldName]),from=recordTime.toISOString(),to=recordTime.add(record.bucket_span,"s").toISOString(),_g=_risonNode2.default.encode({refreshInterval:{display:"Off",pause:!1,value:0},time:{from:from,to:to,mode:"absolute"}}),appStateProps={index:indexPatternId,filters:[]};null!==query&&(appStateProps.query={query_string:{analyze_wildcard:!0,query:query}});var _a=_risonNode2.default.encode(appStateProps),path=_chrome2.default.getBasePath();path+="/app/kibana#/discover",path+="?_g="+_g,path+="&_a="+encodeURIComponent(_a),$window.open(path,"_blank")}).catch(function(resp){console.log("viewExamples(): error loading categoryDefinition:",resp)})}function error(){console.log("viewExamples(): error finding type of field "+categorizationFieldName+" in indices:",datafeedIndices),_notify.notify.error("Unable to view examples of documents with mlcategory "+categoryId+" as no mapping could be found for the categorization field "+categorizationFieldName,{lifetime:3e4})}var categoryId=(0,_anomaly_utils.getEntityFieldValue)(record),job=mlJobService.getJob(record.job_id),categorizationFieldName=job.analysis_config.categorization_field_name,datafeedIndices=job.datafeed_config.indices,i=0;findFieldType(datafeedIndices[i])},scope.openCustomUrl=function(customUrl,record){console.log("Anomalies Table - open customUrl for record:",customUrl,record);var timestamp=record[scope.timeFieldName],configuredUrlValue=customUrl.url_value,timeRangeInterval=(0,_parse_interval.parseInterval)(customUrl.time_range);if(configuredUrlValue.includes("$earliest$")){var earliestMoment=(0,_moment2.default)(timestamp);null!==timeRangeInterval?earliestMoment.subtract(timeRangeInterval):(earliestMoment=(0,_moment2.default)(timestamp).startOf(scope.momentInterval),"hour"===scope.momentInterval&&earliestMoment.subtract(1,"h")),record.earliest=earliestMoment.toISOString()}if(configuredUrlValue.includes("$latest$")){var latestMoment=(0,_moment2.default)(timestamp).add(record.bucket_span,"s");null!==timeRangeInterval?latestMoment.add(timeRangeInterval):scope.isShowingAggregatedData()&&(latestMoment=(0,_moment2.default)(timestamp).endOf(scope.momentInterval),"hour"===scope.momentInterval&&latestMoment.add(1,"h")),record.latest=latestMoment.toISOString()}if((configuredUrlValue.includes("$mlcategoryterms$")||configuredUrlValue.includes("$mlcategoryregex$"))&&_lodash2.default.has(record,"mlcategory")){var jobId=record.job_id,categoryId=record.mlcategory[0];mlResultsService.getCategoryDefinition(jobId,categoryId).then(function(resp){var termsArray=_lodash2.default.map(resp.terms.split(" "),function(term){return"+"+term});record.mlcategoryterms=termsArray.join(" "),record.mlcategoryregex=resp.regex;var urlPath=(0,_string_utils.replaceStringTokens)(customUrl.url_value,record,!0);$window.open(urlPath,"_blank")}).catch(function(resp){console.log("openCustomUrl(): error loading categoryDefinition:",resp)})}else{var urlPath=(0,_custom_url_utils.getUrlForRecord)(customUrl,record);$window.open(urlPath,"_blank")}},scope.filter=function(field,value,operator){mlAnomaliesTableService.filterChange.changed(field,value,operator)}}}})},3487:function(module,exports){module.exports='<div class="anomalies-table">\n  <div class="no-results-item" ng-if="table.rows.length === 0">\n    <h4 class="euiTitle euiTitle--small">No matching results found</h4>\n  </div>\n\n  <ml-paginated-table ng-hide="table.rows.length === 0"\n    columns="table.columns"\n    rows="table.rows"\n    per-page="table.perPage">\n  </ml-paginated-table>\n\n</div>\n'},3488:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3489),__webpack_require__(3490),__webpack_require__(376),__webpack_require__(3496),__webpack_require__(3499)},3489:function(module,exports){},3490:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3491)},3491:function(module,exports,__webpack_require__){"use strict";var _state_factory=__webpack_require__(372),_checkbox_showcharts=__webpack_require__(3492),_checkbox_showcharts2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_checkbox_showcharts);__webpack_require__(376),__webpack_require__(2).uiModules.get("apps/ml").service("mlCheckboxShowChartsService",function(Private){var stateFactory=Private(_state_factory.stateFactoryProvider);this.state=stateFactory("mlCheckboxShowCharts",{showCharts:!0})}).directive("mlCheckboxShowCharts",function(mlCheckboxShowChartsService){return{restrict:"E",template:_checkbox_showcharts2.default,scope:{visible:"="},link:function(scope){scope.showCharts=mlCheckboxShowChartsService.state.get("showCharts"),scope.toggleChartsVisibility=function(){mlCheckboxShowChartsService.state.set("showCharts",scope.showCharts),mlCheckboxShowChartsService.state.changed()}}}})},3492:function(module,exports){module.exports='<div ng-show="visible" class="ml-table-controls-element">\n  <input id="ml-anomalies-controls-show-charts" type="checkbox" ng-model="showCharts" ng-change="toggleChartsVisibility()" />\n  <label for="ml-anomalies-controls-show-charts" class="kuiLabel">Show Charts</label>\n</div>\n'},3493:function(module,exports){},3494:function(module,exports,__webpack_require__){"use strict";var _controls_select=__webpack_require__(3495),_controls_select2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_controls_select);__webpack_require__(2).uiModules.get("apps/ml").directive("mlControlsSelect",function(){return{restrict:"E",scope:{identifier:"@",label:"@",narrowStyle:"=",options:"=",showIcons:"=",selected:"=",updateFn:"="},template:_controls_select2.default,link:function(scope){scope.setOption=function(d){"function"==typeof scope.updateFn&&scope.updateFn(d)}}}})},3495:function(module,exports){module.exports='<label for="select{{identifier}}" class="kuiLabel">{{label}}:</label>\n<div class="dropdown-group" dropdown>\n  <button id="select{{identifier}}" type="button" class="form-control dropdown-toggle" ng-class="{ \'dropdown-toggle-narrow\': narrowStyle }" dropdown-toggle ng-disabled="disabled">\n    <span><i ng-if="showIcons" class="fa fa-exclamation-triangle ml-icon-severity-{{selected.display}}"></i> {{selected.display}}</span> <span class="caret"></span>\n  </button>\n  <ul class="dropdown-menu" role="menu">\n    <li ng-repeat="option in options">\n      <a href="" ng-click="setOption(option)"><i ng-if="showIcons" class="fa fa-exclamation-triangle ml-icon-severity-{{option.display}}"></i> {{option.display}}</a>\n    </li>\n  </ul>\n</div>\n'},3496:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3497)},3497:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_state_factory=__webpack_require__(372),_select_interval=__webpack_require__(3498),_select_interval2=_interopRequireDefault(_select_interval);__webpack_require__(376),__webpack_require__(2).uiModules.get("apps/ml").service("mlSelectIntervalService",function(Private){var stateFactory=Private(_state_factory.stateFactoryProvider);this.state=stateFactory("mlSelectInterval",{interval:{display:"Auto",val:"auto"}})}).directive("mlSelectInterval",function(mlSelectIntervalService){return{restrict:"E",template:_select_interval2.default,link:function(scope,element){function setScopeInterval(){scope.setInterval(mlSelectIntervalService.state.get("interval"))}scope.intervalOptions=[{display:"Auto",val:"auto"},{display:"1 hour",val:"hour"},{display:"1 day",val:"day"},{display:"Show all",val:"second"}];var intervalState=mlSelectIntervalService.state.get("interval"),intervalValue=_lodash2.default.get(intervalState,"val","auto"),intervalOption=scope.intervalOptions.find(function(d){return d.val===intervalValue});void 0===intervalOption&&(intervalOption=scope.intervalOptions.find(function(d){return"auto"===d.val})),scope.interval=intervalOption,mlSelectIntervalService.state.set("interval",scope.interval),scope.setInterval=function(interval){_lodash2.default.isEqual(scope.interval,interval)||(scope.interval=interval,mlSelectIntervalService.state.set("interval",scope.interval).changed())},mlSelectIntervalService.state.watch(setScopeInterval),element.on("$destroy",function(){mlSelectIntervalService.state.unwatch(setScopeInterval),scope.$destroy()})}}})},3498:function(module,exports){module.exports='<ml-controls-select\n  identifier="Interval"\n  label="Interval"\n  options="intervalOptions"\n  selected="interval"\n  show-icons="false"\n  update-fn="setInterval"\n/>\n'},3499:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3500)},3500:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_state_factory=__webpack_require__(372),_select_severity=__webpack_require__(3501),_select_severity2=_interopRequireDefault(_select_severity);__webpack_require__(376),__webpack_require__(2).uiModules.get("apps/ml").service("mlSelectSeverityService",function(Private){var stateFactory=Private(_state_factory.stateFactoryProvider);this.state=stateFactory("mlSelectSeverity",{threshold:{display:"warning",val:0}})}).directive("mlSelectSeverity",function(mlSelectSeverityService){return{restrict:"E",template:_select_severity2.default,link:function(scope,element){function setThreshold(){scope.setThreshold(mlSelectSeverityService.state.get("threshold"))}scope.thresholdOptions=[{display:"critical",val:75},{display:"major",val:50},{display:"minor",val:25},{display:"warning",val:0}];var thresholdState=mlSelectSeverityService.state.get("threshold"),thresholdValue=_lodash2.default.get(thresholdState,"val",0),thresholdOption=scope.thresholdOptions.find(function(d){return d.val===thresholdValue});void 0===thresholdOption&&(thresholdOption=scope.thresholdOptions.find(function(d){return 0===d.val})),scope.threshold=thresholdOption,mlSelectSeverityService.state.set("threshold",scope.threshold),scope.setThreshold=function(threshold){_lodash2.default.isEqual(scope.threshold,threshold)||(scope.threshold=threshold,mlSelectSeverityService.state.set("threshold",scope.threshold).changed())},mlSelectSeverityService.state.watch(setThreshold),element.on("$destroy",function(){mlSelectSeverityService.state.unwatch(setThreshold),scope.$destroy()})}}})},3501:function(module,exports){module.exports='<ml-controls-select\n  identifier="Severity"\n  label="Severity threshold"\n  options="thresholdOptions"\n  selected="threshold"\n  show-icons="true"\n  update-fn="setThreshold"\n/>\n'},3502:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2).uiModules.get("apps/ml").filter("metricChangeDescription",function(){return function(actual,typical){if(actual===typical)return"actual same as typical";var isHigher=actual>typical,iconClass=isHigher?"fa-arrow-up":"fa-arrow-down";if(0!==typical&&0!==actual){var factor=isHigher?actual/typical:typical/actual,direction=isHigher?"higher":"lower";return factor>1.5?factor<=100?'<i class="fa '+iconClass+'" aria-hidden="true"></i> '+Math.round(factor)+"x "+direction:'<i class="fa '+iconClass+'" aria-hidden="true"></i> More than 100x '+direction:factor>=1.05?'<i class="fa '+iconClass+'" aria-hidden="true"></i> '+factor.toPrecision(2)+"x "+direction:'<i class="fa '+iconClass+'" aria-hidden="true"></i> Unusually '+(isHigher?"high":"low")}return 0===actual?'<i class="fa '+iconClass+'" aria-hidden="true"></i> Unexpected zero value':'<i class="fa '+iconClass+'" aria-hidden="true"></i> Unexpected non-zero value'}})},3503:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment),_expanded_row=__webpack_require__(3504),_expanded_row2=_interopRequireDefault(_expanded_row),_anomaly_utils=__webpack_require__(260);__webpack_require__(484),__webpack_require__(2).uiModules.get("apps/ml").directive("mlAnomaliesTableExpandedRow",function(){function link(scope){function buildContent(){buildDescription(),buildMetrics(),buildCauses(),buildInfluencers()}function buildDescription(){var record=scope.record,rowDescription=(0,_anomaly_utils.getSeverity)(record.source.record_score)+" anomaly in "+record.detector;if(_lodash2.default.has(record,"entityName")&&(rowDescription+=" found for "+record.entityName,rowDescription+=" ",rowDescription+=record.entityValue),_lodash2.default.has(record.source,"partition_field_name")&&record.source.partition_field_name!==record.entityName&&(rowDescription+=" detected in "+record.source.partition_field_name,rowDescription+=" ",rowDescription+=record.source.partition_field_value),scope.description=rowDescription,_lodash2.default.has(record.source,"correlated_by_field_value")){var mvDescription="multivariate correlations found in ";mvDescription+=record.source.by_field_name,mvDescription+="; ",mvDescription+=record.source.by_field_value,mvDescription+=" is considered anomalous given ",mvDescription+=record.source.correlated_by_field_value,scope.multiVariateDescription=mvDescription}scope.isInterim=_lodash2.default.get(record,"source.is_interim",!1)}function buildMetrics(){var record=scope.record,functionDescription=_lodash2.default.get(record,"source.function_description","");if(!0===(0,_anomaly_utils.showActualForFunction)(functionDescription))if(_lodash2.default.has(scope.record.source,"causes")){var causes=scope.record.source.causes;if(1===causes.length){var cause=_lodash2.default.first(causes);scope.actual=cause.actual}}else scope.actual=record.source.actual;if(!0===(0,_anomaly_utils.showTypicalForFunction)(functionDescription))if(_lodash2.default.has(scope.record.source,"causes")){var _causes=scope.record.source.causes;if(1===_causes.length){var _cause=_lodash2.default.first(_causes);scope.typical=_cause.typical}}else scope.typical=record.source.typical}function buildCauses(){if(_lodash2.default.has(scope.record.source,"causes")){var causes=scope.record.source.causes;if(1===causes.length){var cause=_lodash2.default.first(causes);_lodash2.default.has(cause,"by_field_name")&&(scope.singleCauseByFieldName=cause.by_field_name,scope.singleCauseByFieldValue=cause.by_field_value)}else scope.causes=_lodash2.default.map(causes,function(cause){var simplified=_lodash2.default.pick(cause,"typical","actual","probability");return simplified.entityName=_lodash2.default.has(cause,"by_field_name")?cause.by_field_name:cause.over_field_name,simplified.entityValue=_lodash2.default.has(cause,"by_field_value")?cause.by_field_value:cause.over_field_value,simplified})}}function buildInfluencers(){_lodash2.default.has(scope.record,"influencers")&&function(){var recordInfluencers=scope.record.influencers;scope.influencersNumToDislay=Math.min(scope.influencersNumToDislay,recordInfluencers.length);var othersCount=Math.max(recordInfluencers.length-scope.influencersNumToDislay,0);1===othersCount&&(scope.influencersNumToDislay++,othersCount=0);for(var influencers=[],i=0;i<scope.influencersNumToDislay;i++)_lodash2.default.each(recordInfluencers[i],function(influencerFieldValue,influencerFieldName){influencers.push({name:influencerFieldName,value:influencerFieldValue})});scope.influencers=influencers,scope.otherInfluencersCount=othersCount}()}scope.record=scope.$parent.record,scope.filter=scope.$parent.filter,scope.filteringEnabled=scope.$parent.filteringEnabled,scope.isShowingAggregatedData=scope.$parent.isShowingAggregatedData,scope.influencersLimit=scope.$parent.influencersLimit,scope.influencersNumToDislay=scope.influencersLimit;var momentTime=(0,_moment2.default)(scope.record.source.timestamp);if(scope.anomalyTime=momentTime.format("MMMM Do YYYY, HH:mm:ss"),_lodash2.default.has(scope.record.source,"bucket_span")&&(scope.anomalyEndTime=momentTime.add(scope.record.source.bucket_span,"s").format("MMMM Do YYYY, HH:mm:ss")),scope.$on("initRow",function(){buildContent()}),scope.toggleAllInfluencers=function(){if(_lodash2.default.has(scope.record,"influencers")){var recordInfluencers=scope.record.influencers;scope.influencers.length===recordInfluencers.length?scope.influencersNumToDislay=scope.influencersLimit:scope.influencersNumToDislay=recordInfluencers.length,buildInfluencers()}},!0===scope.$parent.open&&buildContent(),_lodash2.default.has(scope.record,"entityValue")&&"mlcategory"===scope.record.entityName)var unbindWatch=scope.$parent.$watch("categoryDefinition",function(categoryDefinition){void 0!==categoryDefinition&&(scope.examples=categoryDefinition.examples,unbindWatch())})}return{restrict:"AE",replace:!1,scope:{},template:_expanded_row2.default,link:link}})},3504:function(module,exports){module.exports='<div class="ml-tablerow-expanded">\n  <span class="ml-tablerow-expanded-heading">Description:</span>\n  {{description}}\n  <span ng-if="multiVariateDescription" class="ml-tablerow-expanded-mv-description">{{multiVariateDescription}}</span>\n\n  <span ng-if="isShowingAggregatedData === true" class="ml-tablerow-expanded-heading">Details on highest severity anomaly:</span>\n  <span ng-if="isShowingAggregatedData === false" class="ml-tablerow-expanded-heading">Anomaly Details:</span>\n  <div ng-if="isInterim === true" class="ml-anomaly-interim-result"><i class="fa fa-exclamation-triangle"></i> Interim result</div>\n  <table>\n    <tr ng-if="record.source.partition_field_value">\n      <td>{{record.source.partition_field_name}}:</td>\n      <td>{{record.source.partition_field_value}}\n        <button ng-if="filteringEnabled" ng-click="filter(record.source.partition_field_name, record.source.partition_field_value, \'+\')"\n          tooltip="Add filter" tooltip-append-to-body="1" aria-label="Filter for value">\n          <i class="fa fa-search-plus" aria-hidden="true"></i>\n        </button>\n        <button ng-if="filteringEnabled" ng-click="filter(record.source.partition_field_name, record.source.partition_field_value, \'-\')"\n          tooltip="Remove filter" tooltip-append-to-body="1" aria-label="Remove filter">\n          <i class="fa fa-search-minus" aria-hidden="true"></i>\n        </button>\n      </td>\n    </tr>\n    <tr ng-if="record.source.by_field_value">\n      <td>{{record.source.by_field_name}}:</td>\n      <td>{{record.source.by_field_value}}\n        <button ng-if="filteringEnabled" ng-click="filter(record.source.by_field_name, record.source.by_field_value, \'+\')"\n          tooltip="Add filter" tooltip-append-to-body="1" aria-label="Filter for value">\n          <i class="fa fa-search-plus" aria-hidden="true"></i>\n        </button>\n        <button ng-if="filteringEnabled" ng-click="filter(record.source.by_field_name, record.source.by_field_value, \'-\')"\n          tooltip="Remove filter" tooltip-append-to-body="1" aria-label="Remove filter">\n          <i class="fa fa-search-minus" aria-hidden="true"></i>\n        </button>\n      </td>\n    </tr>\n    <tr ng-if="singleCauseByFieldValue">\n      <td>{{singleCauseByFieldName}}:</td>\n      <td>{{singleCauseByFieldValue}}\n        <button ng-if="filteringEnabled" ng-click="filter(singleCauseByFieldName, singleCauseByFieldValue, \'+\')"\n          tooltip="Add filter" tooltip-append-to-body="1" aria-label="Filter for value">\n          <i class="fa fa-search-plus" aria-hidden="true"></i>\n        </button>\n        <button ng-if="filteringEnabled" ng-click="filter(singleCauseByFieldName, singleCauseByFieldValue, \'-\')"\n          tooltip="Remove filter" tooltip-append-to-body="1" aria-label="Remove filter">\n          <i class="fa fa-search-minus" aria-hidden="true"></i>\n        </button>\n      </td>\n    </tr>\n    <tr ng-if="record.source.over_field_value">\n      <td>{{record.source.over_field_name}}:</td>\n      <td>{{record.source.over_field_value}}\n        <button ng-if="filteringEnabled" ng-click="filter(record.source.over_field_name, record.source.over_field_value, \'+\')"\n          tooltip="Add filter" tooltip-append-to-body="1" aria-label="Filter for value">\n          <i class="fa fa-search-plus" aria-hidden="true"></i>\n        </button>\n        <button ng-if="filteringEnabled" ng-click="filter(record.source.over_field_name, record.source.over_field_value, \'-\')"\n          tooltip="Remove filter" tooltip-append-to-body="1" aria-label="Remove filter">\n          <i class="fa fa-search-minus" aria-hidden="true"></i>\n        </button>\n      </td>\n    </tr>\n    <tr ng-if="anomalyEndTime"><td>time:</td><td>{{anomalyTime}} to {{anomalyEndTime}}</td></tr>\n    <tr ng-if="!anomalyEndTime"><td>time:</td><td>{{anomalyTime}}</td></tr>\n    <tr ng-if="examples" ng-repeat="example in examples track by $index">\n      <td ng-if="$index === 0">category examples:</td><td ng-if="$index > 0">&nbsp;</td>\n      <td>{{example}}</td>\n    </tr>\n    <tr>\n      <td>function:</td>\n      <td ng-if="record.source.function !== \'metric\'">{{record.source.function}}</td>\n      <td ng-if="record.source.function === \'metric\'">{{record.source.function_description}}</td>\n    </tr>\n    <tr ng-if="record.source.field_name"><td>fieldName:</td><td>{{record.source.field_name}}</td></tr>\n    <tr ng-if="actual !== undefined"><td>actual:</td><td>{{actual | formatValue:record.source.function}}</td></tr>\n    <tr ng-if="typical !== undefined"><td>typical:</td><td>{{typical | formatValue:record.source.function}}</td></tr>\n    <tr>\n      <td>job ID:</td>\n      <td>{{record.jobId}}\n      </td>\n\n    </tr>\n    </tr>\n    <tr><td>probability:</td><td>{{record.source.probability}}</td></tr>\n    <tr ng-if="causes" ng-repeat="cause in causes track by $index">\n      <td ng-if="$index === 0">{{cause.entityName}} values:</td><td ng-if="$index > 0">&nbsp;</td>\n      <td>{{cause.entityValue}} (actual {{cause.actual | formatValue:record.source.function}}, typical {{cause.typical | formatValue:record.source.function}}, probability {{cause.probability}})</td>\n    </tr>\n  </table>\n\n  <span ng-if="influencers" class="ml-tablerow-expanded-heading">Influenced by:</span>\n  <table ng-if="influencers">\n    <tr ng-repeat="influencer in influencers">\n      <td>{{influencer.name}}</td>\n      <td>{{influencer.value}}</td>\n    </tr>\n    <tr ng-if="otherInfluencersCount > 0">\n      <td colspan="2">\n        <button class="euiLink euiLink--primary" type="button" ng-click="toggleAllInfluencers()">and {{otherInfluencersCount}} more</button>\n      </td>\n    </tr>\n    <tr ng-if="influencersNumToDislay > (influencersLimit + 1)">\n      <td colspan="2">\n        <button class="euiLink euiLink--primary" type="button" ng-click="toggleAllInfluencers()">show less</button>\n      </td>\n    </tr>\n  </table>\n\n</div>\n'},3505:function(module,exports,__webpack_require__){"use strict";__webpack_require__(183);var _influencers_cell=__webpack_require__(3506);__webpack_require__(2).uiModules.get("apps/ml",["react"]).directive("mlInfluencersCell",function(reactDirective){return reactDirective(_influencers_cell.InfluencersCell,void 0,{restrict:"E"})})},3506:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.InfluencersCell=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_propTypes=__webpack_require__(20),_propTypes2=_interopRequireDefault(_propTypes),_react=__webpack_require__(0),_react2=_interopRequireDefault(_react),_eui=__webpack_require__(5);(exports.InfluencersCell=function(_Component){function InfluencersCell(props){_classCallCheck(this,InfluencersCell);var _this=_possibleConstructorReturn(this,(InfluencersCell.__proto__||Object.getPrototypeOf(InfluencersCell)).call(this,props));_this.limit=props.limit;var recordInfluencers=props.influencers||[];_this.influencers=[],_lodash2.default.each(recordInfluencers,function(influencer){_lodash2.default.each(influencer,function(influencerFieldValue,influencerFieldName){_this.influencers.push({influencerFieldName:influencerFieldName,influencerFieldValue:influencerFieldValue})})});var showAll=_this.influencers.length<=_this.limit+1;return _this.state={showAll:showAll},_this}return _inherits(InfluencersCell,_Component),_createClass(InfluencersCell,[{key:"toggleAllInfluencers",value:function(){this.setState({showAll:!this.state.showAll})}},{key:"renderInfluencers",value:function(){var numberToDisplay=!1===this.state.showAll?this.limit:this.influencers.length,displayInfluencers=this.influencers.slice(0,numberToDisplay);return this.othersCount=Math.max(this.influencers.length-numberToDisplay,0),1===this.othersCount&&(displayInfluencers.push(this.influencers[this.limit]),this.othersCount=0),displayInfluencers.map(function(influencer,index){return _react2.default.createElement("div",{key:index},influencer.influencerFieldName,": ",influencer.influencerFieldValue)})}},{key:"renderOthers",value:function(){var _this2=this;return this.othersCount>0?_react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiLink,{onClick:function(){return _this2.toggleAllInfluencers()}},"and ",this.othersCount," more")):this.influencers.length>this.limit+1?_react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiLink,{onClick:function(){return _this2.toggleAllInfluencers()}},"show less")):void 0}},{key:"render",value:function(){return _react2.default.createElement("div",null,this.renderInfluencers(),this.renderOthers())}}]),InfluencersCell}(_react.Component)).propTypes={influencers:_propTypes2.default.array,limit:_propTypes2.default.number}},3507:function(module,exports){module.exports='<div class="dropdown-group" dropdown dropdown-append-to-body>\n  <a href=\'\' class="dropdown-toggle" dropdown-toggle>\n    Open link  <span class="caret"></span>\n  </a>\n  <ul class="ml-anomalies-table dropdown-menu dropdown-menu-right" role="menu">\n    <li ng-repeat="customUrl in customUrls"><a href="" ng-click="openCustomUrl(customUrl, source)">\n    \t{{customUrl.url_name}}\n    \t<i class="fa fa-external-link" aria-hidden="true"></i></a>\n    </li>\n    <li ng-if="showViewSeriesLink"><a href="" ng-click="viewSeries(source)">\n    \tView series\n    \t<i class="fa fa-external-link" aria-hidden="true"></i></a>\n    </li>\n    <li ng-if="showViewExamplesLink"><a href="" ng-click="viewExamples(source)">\n      View examples\n      <i class="fa fa-external-link" aria-hidden="true"></i></a>\n    </li>\n  </ul>\n</div>\n\n'},3508:function(module,exports,__webpack_require__){"use strict";var _modules=__webpack_require__(2),_listener_factory=__webpack_require__(473);_modules.uiModules.get("apps/ml").service("mlAnomaliesTableService",function(){var listenerFactory=(0,_listener_factory.listenerFactoryProvider)();this.anomalyRecordMouseenter=listenerFactory(),this.anomalyRecordMouseleave=listenerFactory(),this.filterChange=listenerFactory()})},3509:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3510),__webpack_require__(3513)},3510:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash);__webpack_require__(1148),__webpack_require__(3511);var _influencers_list=__webpack_require__(3512),_influencers_list2=_interopRequireDefault(_influencers_list),_anomaly_utils=__webpack_require__(260),_string_utils=__webpack_require__(43),_filter_manager=__webpack_require__(365);__webpack_require__(2).uiModules.get("apps/ml").directive("mlInfluencersList",function(Private){function link(scope,element){function render(){if(void 0!==scope.influencersData){var dataByViewBy={},compiledTooltip=_lodash2.default.template('<div class="ml-influencers-list-tooltip"><%= influencerFieldName %>: <%= influencerFieldValue %><hr/>Max anomaly score: <%= maxScoreLabel %><hr/>Total anomaly score: <%= totalScoreLabel %></div>');_lodash2.default.each(scope.influencersData,function(fieldValues,influencerFieldName){var valuesForViewBy=[];_lodash2.default.each(fieldValues,function(valueData){var influencerFieldValue=valueData.influencerFieldValue,maxScorePrecise=valueData.maxAnomalyScore,maxScore=parseInt(maxScorePrecise),totalScore=parseInt(valueData.sumAnomalyScore),barScore=0!==maxScore?maxScore:1,maxScoreLabel=0!==maxScore?maxScore:"< 1",totalScoreLabel=0!==totalScore?totalScore:"< 1",severity=(0,_anomaly_utils.getSeverity)(maxScore);valuesForViewBy.push({influencerFieldValue:influencerFieldValue,maxScorePrecise:maxScorePrecise,barScore:barScore,maxScoreLabel:maxScoreLabel,totalScore:totalScore,severity:severity,tooltip:compiledTooltip({influencerFieldName:(0,_string_utils.mlEscape)(influencerFieldName),influencerFieldValue:(0,_string_utils.mlEscape)(influencerFieldValue),maxScoreLabel:maxScoreLabel,totalScoreLabel:totalScoreLabel})})}),dataByViewBy[influencerFieldName]=_lodash2.default.sortBy(valuesForViewBy,"maxScorePrecise").reverse()}),scope.influencers=dataByViewBy}}scope.$on("render",function(){render()}),element.on("$destroy",function(){scope.$destroy()}),scope.tooltipPlacement=void 0===scope.tooltipPlacement?"top":scope.tooltipPlacement,scope.filter=function(field,value,operator){filterManager.add(field,value,operator,scope.indexPatternId)},scope.showNoResultsMessage=function(){return void 0===scope.influencersData||0===_lodash2.default.keys(scope.influencersData).length}}var filterManager=Private(_filter_manager.FilterManagerProvider);return{scope:{influencersData:"=",indexPatternId:"=",tooltipPlacement:"@"},template:_influencers_list2.default,link:link}})},3511:function(module,exports,__webpack_require__){"use strict";var _numeral=__webpack_require__(82),_numeral2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_numeral);__webpack_require__(2).uiModules.get("apps/ml").filter("abbreviateWholeNumber",function(){return function(value,maxDigits){var maxNumDigits=void 0!==maxDigits?maxDigits:3;return Math.abs(value)<Math.pow(10,maxNumDigits)?value:(0,_numeral2.default)(value).format("0a")}})},3512:function(module,exports){module.exports='<div class="ml-influencers-list">\n\n  <div ng-if="showNoResultsMessage()" class="text-center visualize-error">\n    <div class="item top"></div>\n    <div class="item">\n      <h4 class="euiTitle euiTitle--small">No influencers found</h4>\n    </div>\n    <div class="item bottom"></div>\n  </div>\n\n  <div ng-repeat="(influencerfieldname, groupData) in influencers">\n\n    <div class="section-label">{{influencerfieldname}}</div>\n\n    <div ng-repeat="influencer in groupData" class="influencer-content">\n\n      <div class="field-label">\n        <div ng-if="influencerfieldname !== \'mlcategory\'" class="influencerfieldvalue">{{influencer.influencerFieldValue}}</div>\n        <div ng-if="influencerfieldname === \'mlcategory\'" class="influencerfieldvalue">mlcategory {{influencer.influencerFieldValue}}</div>\n        <div class="filter-buttons" style="display: none;">\n          <i ng-click="filter(influencerfieldname, influencer.influencerFieldValue, \'+\')"\n            tooltip="Filter for value" tooltip-append-to-body="1" class="fa fa-search-plus"></i>\n          <i ng-click="filter(influencerfieldname, influencer.influencerFieldValue, \'-\')"\n            tooltip="Filter out value" tooltip-append-to-body="1" class="fa fa-search-minus"></i>\n        </div>\n\n      </div>\n\n      <div class="progress" value="{{influencer.barScore}}" max="100">\n        <div class="progress-bar-holder">\n          <div class="progress-bar {{influencer.severity}}" ng-attr-style="width: {{influencer.barScore}}%;"\n            tooltip-placement="{{tooltipPlacement}}" tooltip-html-unsafe="{{influencer.tooltip}}" tooltip-append-to-body="true">\n          </div>\n        </div>\n        <span class="score-label">{{influencer.maxScoreLabel}}</span>\n\n      </div>\n\n      <div ng-if="influencer.totalScore > 0" class="score-label total-score-label" tooltip-placement="{{tooltipPlacement}}" tooltip-html-unsafe="{{influencer.tooltip}}" tooltip-append-to-body="true">\n        {{influencer.totalScore | abbreviateWholeNumber:4}}\n      </div>\n      <div ng-if="influencer.totalScore === 0" class="score-label total-score-label" tooltip-placement="{{tooltipPlacement}}" tooltip-html-unsafe="{{influencer.tooltip}}" tooltip-append-to-body="true">\n        &lt;&nbsp;1\n      </div>\n\n    </div>\n\n  </div>\n\n</div>\n\n'},3513:function(module,exports){},3514:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_jquery=__webpack_require__(12),_jquery2=_interopRequireDefault(_jquery),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment),_d=__webpack_require__(15),_d2=_interopRequireDefault(_d),_job_select_list=__webpack_require__(3515),_job_select_list2=_interopRequireDefault(_job_select_list),_job_utils=__webpack_require__(57);__webpack_require__(2).uiModules.get("apps/ml").directive("mlJobSelectList",function(mlJobService,mlJobSelectService,timefilter){return{restrict:"AE",replace:!0,transclude:!0,template:_job_select_list2.default,controller:function($scope){function createJob(jobId,groupId,job){return{id:jobId,name:job.job_id,group:groupId,isGroup:!1,selected:_lodash2.default.includes($scope.urlSelectedIds.jobs,job.job_id),disabled:!(!1===$scope.timeSeriesOnly||!0===(0,_job_utils.isTimeSeriesViewJob)(job)),running:job.datafeed_config&&"started"===job.datafeed_config.state,timeRange:{to:job.data_counts.latest_record_timestamp,from:job.data_counts.earliest_record_timestamp,fromPx:0,toPx:0,widthPx:0,label:""}}}function createGroups(jobsIn){var jobGroups={},homeless=[];return jobsIn.forEach(function(job){null!==job.group?void 0===jobGroups[job.group]?jobGroups[job.group]=[job]:jobGroups[job.group].push(job):homeless.push(job)}),{groups:_lodash2.default.map(jobGroups,function(jobs,id){var group={id:id,selected:!1,selectable:!0,expanded:!1,isGroup:!0,jobs:jobs};!1===$scope.singleSelection&&(group.selected=_lodash2.default.includes($scope.urlSelectedIds.groups,id));var timeRange={to:null,toMoment:null,from:null,fromMoment:null,fromPx:null,toPx:null,widthPx:null};jobs.forEach(function(job){job.group=group,(null===timeRange.to||job.timeRange.to>timeRange.to)&&(timeRange.to=job.timeRange.to,timeRange.toMoment=job.timeRange.toMoment),(null===timeRange.from||job.timeRange.from<timeRange.from)&&(timeRange.from=job.timeRange.from,timeRange.fromMoment=job.timeRange.fromMoment),(null===timeRange.toPx||job.timeRange.toPx>timeRange.toPx)&&(timeRange.toPx=job.timeRange.toPx),(null===timeRange.fromPx||job.timeRange.fromPx<timeRange.fromPx)&&(timeRange.fromPx=job.timeRange.fromPx)}),timeRange.widthPx=timeRange.toPx-timeRange.fromPx,timeRange.toMoment=(0,_moment2.default)(timeRange.to),timeRange.fromMoment=(0,_moment2.default)(timeRange.from);var fromString=timeRange.fromMoment.format("MMM Do YYYY, HH:mm"),toString=timeRange.toMoment.format("MMM Do YYYY, HH:mm");return timeRange.label=fromString+" to "+toString,group.timeRange=timeRange,group}),homeless:homeless}}function areAllJobsSelected(){var allSelected=!0;return $scope.selected.jobs.forEach(function(job){!1===job.selected&&(allSelected=!1)}),allSelected}function areAllGroupsSelected(){var allSelected=!0;return $scope.selected.groups.forEach(function(group){!1===group.selected&&(allSelected=!1)}),allSelected}function createSelectedCount(){$scope.selectedCount=0,$scope.selected.jobs.forEach(function(job){job.selected&&$scope.selectedCount++}),$scope.selected.groups.forEach(function(group){group.selected&&$scope.selectedCount++})}function normalizeTimes(jobs){var min=_lodash2.default.min(jobs,function(job){return+job.timeRange.from}),max=_lodash2.default.max(jobs,function(job){return+job.timeRange.to}),gantScale=_d2.default.scale.linear().domain([min.timeRange.from,max.timeRange.to]).range([1,299]);jobs.forEach(function(job){if(void 0!==job.timeRange.to&&void 0!==job.timeRange.from){job.timeRange.fromPx=gantScale(job.timeRange.from),job.timeRange.toPx=gantScale(job.timeRange.to),job.timeRange.widthPx=job.timeRange.toPx-job.timeRange.fromPx,job.timeRange.toMoment=(0,_moment2.default)(job.timeRange.to),job.timeRange.fromMoment=(0,_moment2.default)(job.timeRange.from);var fromString=job.timeRange.fromMoment.format("MMM Do YYYY, HH:mm"),_toString=job.timeRange.toMoment.format("MMM Do YYYY, HH:mm");job.timeRange.label=fromString+" to "+_toString}})}$scope.jobs=[],$scope.groups=[],$scope.homelessJobs=[],$scope.singleSelection=!1,$scope.timeSeriesOnly=!1,$scope.noJobsCreated=void 0,$scope.applyTimeRange=mlJobSelectService.jobSelectListState.applyTimeRange,$scope.urlSelectedIds={},$scope.selected={},$scope.allGroupsSelected=!1,$scope.allJobsSelected=!1,$scope.selectedJobRadio="",$scope.selectedCount=0,mlJobService.loadJobs().then(function(resp){if(resp.jobs.length>0){$scope.noJobsCreated=!1;var jobs=[];resp.jobs.forEach(function(job){job.groups&&job.groups.length?job.groups.forEach(function(group){jobs.push(createJob(group+"."+job.job_id,group,job))}):jobs.push(createJob(job.job_id,null,job))}),normalizeTimes(jobs),$scope.jobs=jobs;var _createGroups=createGroups($scope.jobs),groups=_createGroups.groups,homeless=_createGroups.homeless;$scope.groups=groups,$scope.homelessJobs=homeless,$scope.selected={groups:[],jobs:[]};var jobCount=resp.jobs.reduce(function(sum,job){return sum+(void 0===job.groups?1:job.groups.length)},0),selectAll=jobCount===$scope.urlSelectedIds.jobs.length;groups.forEach(function(group){$scope.selected.groups.push({id:group.id,selected:group.selected,selectable:group.selectable,timeRange:group.timeRange,isGroup:!0})}),jobs.forEach(function(job){void 0===$scope.selected.jobs.find(function(j){return j.id===job.name})&&$scope.selected.jobs.push({id:job.name,selected:selectAll||job.selected,disabled:job.disabled,timeRange:job.timeRange,running:job.running,isGroup:!1})}),$scope.allJobsSelected=areAllJobsSelected(),$scope.allGroupsSelected=areAllGroupsSelected(),createSelectedCount(),!0===$scope.singleSelection&&$scope.jobs.forEach(function(j){j.selected&&($scope.selectedJobRadio=j.name)})}else $scope.noJobsCreated=!0}).catch(function(resp){console.log("mlJobSelectList controller - error getting job info from ES:",resp)}),$scope.apply=function(){var selectedJobs=[];if($scope.singleSelection?selectedJobs.push.apply(selectedJobs,_toConsumableArray($scope.selected.jobs.filter(function(j){return j.id===$scope.selectedJobRadio}))):(selectedJobs.push.apply(selectedJobs,_toConsumableArray($scope.selected.jobs.filter(function(j){return j.selected}))),selectedJobs.push.apply(selectedJobs,_toConsumableArray($scope.selected.groups.filter(function(g){return g.selected})))),areAllJobsSelected())mlJobSelectService.setJobIds(["*"]);else{var jobIds=selectedJobs.map(function(j){return j.isGroup?j.id+".*":j.id});mlJobSelectService.setJobIds(jobIds)}if($scope.applyTimeRange){var times=[];if(selectedJobs.forEach(function(job){void 0!==job.timeRange.from&&times.push(job.timeRange.from),void 0!==job.timeRange.to&&times.push(job.timeRange.to)}),times.length){var min=_lodash2.default.min(times),max=_lodash2.default.max(times);timefilter.time.from=(0,_moment2.default)(min).toISOString(),timefilter.time.to=(0,_moment2.default)(max).toISOString()}}mlJobSelectService.jobSelectListState.applyTimeRange=$scope.applyTimeRange,$scope.closePopover()},$scope.toggleSelection=function(){$scope.allJobsSelected=areAllJobsSelected(),$scope.allGroupsSelected=areAllGroupsSelected(),createSelectedCount()},$scope.toggleAllJobsSelection=function(){var allJobsSelected=areAllJobsSelected();$scope.allJobsSelected=!allJobsSelected,$scope.selected.jobs.forEach(function(job){job.selected=$scope.allJobsSelected}),createSelectedCount()},$scope.toggleGroupSelection=function(){$scope.allGroupsSelected=areAllGroupsSelected(),createSelectedCount()},$scope.toggleAllGroupsSelection=function(){var allGroupsSelected=areAllGroupsSelected();$scope.allGroupsSelected=!allGroupsSelected,$scope.selected.groups.forEach(function(group){group.selected=$scope.allGroupsSelected}),createSelectedCount()},$scope.useTimeRange=function(job){timefilter.time.from=job.timeRange.fromMoment.toISOString(),timefilter.time.to=job.timeRange.toMoment.toISOString()}},link:function(scope,element,attrs){scope.timeSeriesOnly=!1,"true"===attrs.timeseriesonly&&(scope.timeSeriesOnly=!0),"true"===attrs.singleSelection&&(scope.singleSelection=!0),scope.urlSelectedIds={groups:[].concat(_toConsumableArray(mlJobSelectService.groupIds)),jobs:[].concat(_toConsumableArray(mlJobSelectService.jobIdsWithGroup))},(0,_jquery2.default)(".ml-select-list",element).focus()}}})},3515:function(module,exports){module.exports='<div class=\'ml-job-selector\'>\n  <div class="header">\n    Job Selection\n  </div>\n\n  <ml-loading-indicator\n    label="Loading jobs"\n    is-loading="noJobsCreated===undefined"\n  />\n  <div class="select-list" ng-show=\'noJobsCreated!==undefined\'>\n    <div ng-if="groups.length && singleSelection !== true">\n      <div class="list-section-title">\n        <input\n          ng-if="singleSelection !== true"\n          type="checkbox"\n          ng-checked="allGroupsSelected"\n          aria-label="Select all groups checkbox"\n          ng-click="toggleAllGroupsSelection()" />\n        Groups\n      </div>\n      <div class="list-section">\n        <div class=\'group\' ng-repeat="group in selected.groups">\n          <div class=\'group-title job-row\'>\n            <div class="job-row-inner">\n              <label class="kuiFormLabel">\n                <div >\n                  <input\n                    ng-if="singleSelection !== true && group.selectable === true" type="checkbox"\n                    ng-model="group.selected"\n                    ng-click="toggleGroupSelection()" />\n                  {{group.id}}\n                </div>\n                <div ng-if="group.selectable !== false">\n                  <div class=\'gant-back-edge\'>\n                    <div></div>\n                  </div>\n                  <div\n                    class=\'gant-bar\'\n                    ng-class="{\'disabled-job\': job.disabled, \'gant-bar-running\': job.running}"\n                    tooltip=\'{{group.timeRange.label}}\'\n                    tooltip-placement="bottom"\n                    tooltip-append-to-body="true"\n                    ng-attr-style=\'margin-left:{{group.timeRange.fromPx}}px; width: {{group.timeRange.widthPx}}px;\'>\n                  </div>\n                </div>\n              </label>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class="list-section-title" ng-if="singleSelection !== true">\n      <input type="checkbox"\n        ng-checked="allJobsSelected"\n        aria-label="Select all jobs checkbox"\n        ng-click="toggleAllJobsSelection()" />\n      Jobs\n    </div>\n    <div class="list-section" ng-class="{\'list-section-single\': singleSelection}">\n      <div class=\'job-row\' ng-repeat="job in selected.jobs">\n        <div class=\'job-row-inner\'>\n          <label class="kuiFormLabel">\n            <div>\n              <span>\n                <input ng-if="singleSelection !== true" type="checkbox"\n                  ng-model="job.selected"\n                  ng-disabled=\'job.disabled\'\n                  ng-click="toggleSelection()" />\n                <input ng-if="singleSelection === true" type="radio"\n                  name="job-group"\n                  value="{{job.id}}"\n                  ng-model="$parent.$parent.selectedJobRadio"\n                  ng-disabled=\'job.disabled\' />\n                <span ng-class="{\'disabled-job\': job.disabled}">{{job.id}}</span>\n              </span>\n            </div>\n            <div>\n              <div class=\'gant-back-edge\' >\n                <div ></div>\n              </div>\n              <div\n                class=\'gant-bar\'\n                ng-class="{\'disabled-job\': job.disabled, \'gant-bar-running\': job.running}"\n                tooltip=\'{{job.timeRange.label}}\'\n                tooltip-placement="bottom"\n                tooltip-append-to-body="true"\n                ng-attr-style=\'margin-left:{{job.timeRange.fromPx}}px; width: {{job.timeRange.widthPx}}px;\'>\n\n              </div>\n            </div>\n          </label>\n        </div>\n      </div>\n    </div>\n  </div>\n\n\n  <div class=\'footer\'>\n    <button\n      ng-click="apply()"\n      class="kuiButton kuiButton--primary"\n      aria-label="Apply"\n      ng-disabled="selectedCount===0"\n      >\n      Apply\n    </button>\n    <button ng-click="closePopover()" class="kuiButton kuiButton--primary" aria-label="Cancel">Cancel</button>\n  </div>\n\n  <div class=\'apply-time-range\'>\n    <label class="kuiFormLabel">\n    <input type="checkbox"\n      ng-model="applyTimeRange"/>\n      Also apply time range\n  </label>\n  </div>\n\n</div>\n'},3516:function(module,exports,__webpack_require__){"use strict";var _job_select_button=__webpack_require__(3517),_job_select_button2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_job_select_button);__webpack_require__(1060),__webpack_require__(2).uiModules.get("apps/ml").directive("jobSelectButton",function(mlJobSelectService){function link(scope){scope.selectJobBtnJobIdLabel="",scope.unsafeHtml="",scope.description=scope.singleSelection?mlJobSelectService.singleJobDescription:mlJobSelectService.description,scope.createMenu=function(){var txt="<ml-job-select-list ";scope.timeseriesonly&&(txt+='timeseriesonly="true" '),scope.singleSelection&&(txt+='single-selection="true" '),txt+="></ml-job-select-list>",scope.unsafeHtml=txt}}return{scope:{timeseriesonly:"=",singleSelection:"="},link:link,replace:!0,template:_job_select_button2.default}})},3517:function(module,exports){module.exports='<div style=\'display: flex;\' class="ml-job-select-btn-container">\n  <div class="ml-job-select-btn-label">Job</div>\n  <div style="flex:0 0 auto;">\n    <div  popover-placement="bottom"\n          popover-placement="bottom"\n          popover-html-unsafe="{{unsafeHtml}}"\n          popover-append-to-body="false"\n          popover-trigger="click"\n          class="ml-job-select-btn"\n          tooltip="{{description.txt}} selected"\n          aria-label="Job selection menu"\n          ng-click=\'createMenu()\'\n          kbn-accessible-click>\n    <span class="ml-job-select-btn-text">{{description.txt}}</span>\n    <span class="caret"></span>\n  </div>\n  </div>\n</div>\n'},3518:function(module,exports,__webpack_require__){"use strict";function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}var _lodash=__webpack_require__(1),_lodash2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_lodash),_notify=__webpack_require__(10);__webpack_require__(2).uiModules.get("apps/ml").service("mlJobSelectService",function($rootScope,mlJobService,globalState){function checkGlobalState(){void 0===globalState.ml&&(globalState.ml={},globalState.save())}function loadJobIdsFromGlobalState(){var jobIds=[];if(globalState.ml&&globalState.ml.jobIds){var tempJobIds=[];"string"==typeof globalState.ml.jobIds?tempJobIds.push(globalState.ml.jobIds):tempJobIds=globalState.ml.jobIds,tempJobIds=tempJobIds.map(function(id){return String(id)});var invalidIds=getInvalidJobIds(removeGroupIds(tempJobIds));warnAboutInvalidJobIds(invalidIds);var validIds=_lodash2.default.difference(tempJobIds,invalidIds);0===validIds.length&&(_notify.notify.warning("No jobs selected, auto selecting first job",{lifetime:3e4}),mlJobService.jobs.length&&(validIds=[mlJobService.jobs[0].job_id])),jobIds.push.apply(jobIds,_toConsumableArray(validIds)),storeJobIdsInGlobalState(jobIds)}else checkGlobalState(),mlJobService.jobs.length&&jobIds.push(mlJobService.jobs[0].job_id),storeJobIdsInGlobalState(jobIds);return jobIds}function storeJobIdsInGlobalState(jobIds){globalState.ml.jobIds=jobIds,globalState.save()}function getInvalidJobIds(ids){return ids.filter(function(id){return void 0===_lodash2.default.find(mlJobService.jobs,{job_id:id})&&"*"!==id})}function removeGroupIds(jobIds){return jobIds.map(function(id){var splitId=id.split(".");return splitId.length>1?splitId[1]:splitId[0]})}function warnAboutInvalidJobIds(invalidIds){if(invalidIds.length>0){var warningText=1===invalidIds.length?"Requested job "+invalidIds+" does not exist":"Requested jobs "+invalidIds+" do not exist";_notify.notify.warning(warningText,{lifetime:3e4})}}function createDescription(jobs){var txt="",count=mlJobService.jobs.reduce(function(sum,job){return sum+(void 0===job.groups?1:job.groups.length)},0);if(jobs.length===count)txt="All jobs";else{var groupCounts={},groupLessJobs=0;jobs.forEach(function(job){var obj=splitJobId(job);obj.group?groupCounts[obj.group]=(groupCounts[obj.group]||0)+1:groupLessJobs++});var wholeGroups=[];if(mlJobService.getJobGroups().forEach(function(group){var groupCount=groupCounts[group.id];void 0!==groupCount&&groupCount===group.jobs.length?wholeGroups.push(group.id):void 0!==groupCount&&(groupLessJobs+=groupCount)}),wholeGroups.length){if(txt=wholeGroups[0],wholeGroups.length>1||groupLessJobs>0){var total=wholeGroups.length-1+groupLessJobs;txt+=" and "+total+" other"+(total>1?"s":"")}}else txt=splitJobId(jobs[0]).job,jobs.length>1&&(txt+=" and "+(jobs.length-1)+" other"+(jobs.length>2?"s":""))}return txt}function splitJobId(jobId){var splitId=jobId.split(".");return 2===splitId.length?{group:splitId[0],job:splitId[1]}:{job:jobId}}function expandGroups(jobIds){var newJobIds=[],groups=mlJobService.getJobGroups();return jobIds.forEach(function(jobId){if("*"===jobId)mlJobService.jobs.forEach(function(job){void 0===job.groups?newJobIds.push(job.job_id):newJobIds.push.apply(newJobIds,_toConsumableArray(job.groups.map(function(g){return g+"."+job.job_id})))});else{var splitId=splitJobId(jobId);if(void 0!==splitId.group&&"*"===splitId.job){var groupId=splitId.group;groups.find(function(g){return g.id===groupId}).jobs.forEach(function(j){newJobIds.push(groupId+"."+j.job_id)})}else newJobIds.push(jobId)}}),newJobIds}function getGroupIds(jobIds){var groupIds=[];return jobIds.forEach(function(jobId){var splitId=splitJobId(jobId);void 0!==splitId.group&&"*"===splitId.job&&groupIds.push(splitId.group)}),groupIds}function processIds(ids){var _self$jobIdsWithGroup,_self$jobIds,expandedJobIds=expandGroups(ids);self.jobIdsWithGroup.length=0,(_self$jobIdsWithGroup=self.jobIdsWithGroup).push.apply(_self$jobIdsWithGroup,_toConsumableArray(expandedJobIds)),self.groupIds=getGroupIds(ids),self.jobIds.length=0,(_self$jobIds=self.jobIds).push.apply(_self$jobIds,_toConsumableArray(removeGroupIds(expandedJobIds))),self.description.txt=createDescription(self.jobIdsWithGroup),self.singleJobDescription.txt=ids[0],setBrowserTitle(self.description.txt)}function setBrowserTitle(title){document.title=title+" - Kibana"}var self=this;checkGlobalState(),this.jobIdsWithGroup=[],this.jobIds=[],this.groupIds=[],this.description={txt:""},this.singleJobDescription={txt:""},this.jobSelectListState={applyTimeRange:!0},this.broadcastJobSelectionChange=function(){$rootScope.$broadcast("jobSelectionChange",this.getSelectedJobIds())},this.listenJobSelectionChange=function(scope,callback){var handler=$rootScope.$on("jobSelectionChange",callback);scope.$on("$destroy",handler)},this.splitJobId=splitJobId,this.getSelectedJobIds=function(loadFromURL){return loadFromURL&&processIds(loadJobIdsFromGlobalState()),this.jobIds},this.setJobIds=function(jobIds){processIds(jobIds),storeJobIdsInGlobalState(jobIds),this.broadcastJobSelectionChange()}})},3519:function(module,exports){},3520:function(module,exports){module.exports='<ml-nav-menu name="explorer"></ml-nav-menu>\n<ml-chart-tooltip></ml-chart-tooltip>\n<div class="ml-explorer" ng-controller="MlExplorerController">\n  <navbar ng-show="jobs.length > 0 && chrome.getVisible()">\n    <job-select-button></job-select-button>\n  </navbar>\n\n  <filter-bar\n    ng-show="queryFilters.length"\n    state="appState">\n  </filter-bar>\n\n  <ml-loading-indicator\n    label="Loading"\n    is-loading="loading === true"\n  />\n\n  <div class="no-results-container" ng-if="jobs.length === 0 && loading === false">\n    <div class="no-results euiText">\n      <div><i class="fa fa-exclamation-triangle" ></i>No jobs found</div>\n      <div><a href="ml#/jobs">Create new job</a></div>\n    </div>\n  </div>\n\n  <div class="no-results-container" ng-show="jobs.length > 0 && loading === false && hasResults === false">\n    <div class="no-results euiText">\n      <div><i class="fa fa-info-circle" ></i>No results found</div>\n      <div>Try widening the time selection or moving further back in time</div>\n    </div>\n  </div>\n\n  <div ng-if="jobs.length > 0 && loading === false && hasResults === true">\n    <div class="results-container">\n\n      <div class="influencers-list-container column col-xs-2 euiText">\n        <span class="panel-title">\n          Top Influencers\n        </span>\n        <ml-influencers-list\n          influencers-data="influencersData"\n          index-pattern-id="indexPatternId"\n          tooltip-placement="right">\n        </ml-influencers-list>\n      </div>\n\n      <div class="column col-xs-10">\n        <span class="panel-title euiText">\n          Anomaly timeline\n        </span>\n        <div\n          class="ml-explorer-swimlane euiText"\n          ng-mouseenter="setSwimlaneSelectActive(true)"\n          ng-mouseleave="setSwimlaneSelectActive(false)"\n        >\n          <ml-explorer-swimlane\n            swimlane-type="overall"\n            swimlane-data="overallSwimlaneData"\n            selected-job-ids="selectedJobIds"\n            chart-width="swimlaneWidth"\n            app-state="appState"\n            style="width: 100%; height: 250px;">\n          </ml-explorer-swimlane>\n        </div>\n\n        <div ng-if="viewBySwimlaneOptions.length > 0">\n          <div class="ml-controls">\n            <label for="selectViewBy" class="kuiLabel">View by:</label>\n            <div class="kuiButtonGroup" dropdown>\n              <button id="selectViewBy" type="button" class="form-control dropdown-toggle" dropdown-toggle ng-disabled="disabled">\n                <span>{{swimlaneViewByFieldName}}</span> <span class="caret"></span>\n              </button>\n              <ul class="dropdown-menu" role="menu">\n                <li ng-repeat="swimlaneOption in viewBySwimlaneOptions">\n                  <a href="" ng-click="setSwimlaneViewBy(swimlaneOption)">{{swimlaneOption}}</a>\n                </li>\n              </ul>\n            </div>\n\n            <ml-select-limit />\n\n            <span ng-if="viewByLoadedForTimeFormatted" class="panel-sub-title">\n              (Sorted by max anomaly score for {{viewByLoadedForTimeFormatted}})\n            </span>\n            <span ng-if="!viewByLoadedForTimeFormatted" class="panel-sub-title">\n              (Sorted by max anomaly score)\n            </span>\n          </div>\n\n          <div\n            class="ml-explorer-swimlane euiText"\n            ng-if="showViewBySwimlane()"\n            ng-mouseenter="setSwimlaneSelectActive(true)"\n            ng-mouseleave="setSwimlaneSelectActive(false)"\n          >\n            <ml-explorer-swimlane\n              swimlane-type="viewBy"\n              swimlane-data="viewBySwimlaneData"\n              selected-job-ids="selectedJobIds"\n              chart-width="swimlaneWidth"\n              app-state="appState"\n              style="width: 100%; height: 250px;">\n            </ml-explorer-swimlane>\n          </div>\n\n          <div ng-if="!showViewBySwimlane()" class="text-center visualize-error euiText">\n            <div class="item top"></div>\n            <div class="item">\n              <h4 class="euiTitle euiTitle--small">No {{swimlaneViewByFieldName}} influencers found</h4>\n            </div>\n            <div class="item bottom"></div>\n          </div>\n\n        </div>\n\n        <span class="panel-title euiText">\n          Anomalies\n        </span>\n\n        <div class="ml-table-controls">\n          <ml-select-severity />\n          <ml-select-interval />\n          <ml-checkbox-show-charts\n            visible="anomalyChartRecords.length > 0"\n          />\n        </div>\n\n        <div ng-controller="MlExplorerChartsContainerController" class="euiText">\n          <ml-explorer-charts-container\n            series-to-plot="seriesToPlot"\n            time-field-name="timeFieldName"\n            plot-earliest="plotEarliest"\n            plot-latest="plotLatest"\n            selected-earliest="selectedEarliest"\n            selected-latest="selectedLatest"\n            charts-per-row="chartsPerRow"\n            layout-cells-per-chart="layoutCellsPerChart"\n            too-many-buckets="tooManyBuckets">\n          </ml-explorer-charts-container>\n        </div>\n\n        <div class="euiText">\n          <ml-anomalies-table\n            anomaly-records="anomalyRecords"\n            time-field-name="timeFieldName"\n            show-view-series-link="true">\n          </ml-anomalies-table>\n        </div>\n\n      </div>\n\n    </div>\n  </div>\n\n</div>\n'},3521:function(module,exports,__webpack_require__){"use strict";var _modules=__webpack_require__(2),_listener_factory=__webpack_require__(473);_modules.uiModules.get("apps/ml").service("mlExplorerDashboardService",function(){this.allowCellRangeSelection=!1;var listenerFactory=(0,_listener_factory.listenerFactoryProvider)(),dragSelect=this.dragSelect=listenerFactory(),swimlaneCellClick=this.swimlaneCellClick=listenerFactory(),swimlaneDataChange=this.swimlaneDataChange=listenerFactory(),swimlaneRenderDone=this.swimlaneRenderDone=listenerFactory();this.anomalyDataChange=listenerFactory(),this.init=function(){dragSelect.unwatchAll(),swimlaneCellClick.unwatchAll(),swimlaneDataChange.unwatchAll(),swimlaneRenderDone.unwatchAll()}})},3522:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_jquery=__webpack_require__(12),_jquery2=_interopRequireDefault(_jquery),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment),_d=__webpack_require__(15),_d2=_interopRequireDefault(_d),_anomaly_utils=__webpack_require__(260),_chart_utils=__webpack_require__(133),_ml_time_buckets=__webpack_require__(169),_string_utils=__webpack_require__(43);__webpack_require__(2).uiModules.get("apps/ml").directive("mlExplorerSwimlane",function($compile,Private,mlExplorerDashboardService,mlChartTooltipService){function link(scope,element){function dragSelectListener(_ref){var action=_ref.action,_ref$elements=_ref.elements,elements=void 0===_ref$elements?[]:_ref$elements;if("newSelection"===action&&elements.length>0){var firstCellData=(0,_jquery2.default)(elements[0]).data("click");if(void 0!==firstCellData&&scope.swimlaneType===firstCellData.swimlaneType){var selectedData=elements.reduce(function(d,e){var cellData=(0,_jquery2.default)(e).data("click");return d.bucketScore=Math.max(d.bucketScore,cellData.bucketScore),d.laneLabels.push(cellData.laneLabel),d.times.push(cellData.time),d},{bucketScore:0,laneLabels:[],times:[]});selectedData.laneLabels=_lodash2.default.uniq(selectedData.laneLabels),selectedData.times=_lodash2.default.uniq(selectedData.times),cellClick(elements,selectedData)}cellMouseoverActive=!0}else{if("elementSelect"===action)return void element.addClass("ml-dragselect-dragging");if("dragStart"===action)return void(cellMouseoverActive=!1)}element.removeClass("ml-dragselect-dragging"),elements.map(function(e){return(0,_jquery2.default)(e).removeClass("ds-selected")})}function swimlaneDataChangeListener(swimlaneType){swimlaneType===scope.swimlaneType&&(render(),checkForSelection())}function cellClick(cellsToSelect,_ref2){var laneLabels=_ref2.laneLabels,bucketScore=_ref2.bucketScore,times=_ref2.times;cellsToSelect.length>1||bucketScore>0?selectCell(cellsToSelect,laneLabels,times,bucketScore,!0):clearSelection()}function render(){function colorScore(value){return(0,_anomaly_utils.getSeverityColor)(value)}function cellMouseover($event,laneLabel,bucketScore,index,time){if(void 0!==bucketScore&&!1!==cellMouseoverActive){var displayScore=bucketScore>1?parseInt(bucketScore):"< 1",formattedDate=(0,_moment2.default)(1e3*time).format("MMMM Do YYYY, HH:mm"),contents=formattedDate+"<br/><hr/>";void 0!==scope.swimlaneData.fieldName&&(contents+=(0,_string_utils.mlEscape)(scope.swimlaneData.fieldName)+": "+(0,_string_utils.mlEscape)(laneLabel)+"<br/><hr/>"),contents+="Max anomaly score: "+displayScore;var offsets="sl-cell-inner"===$event.target.className?{x:0,y:0}:{x:2,y:1};mlChartTooltipService.show(contents,$event.target,{x:$event.target.offsetWidth-offsets.x,y:10+offsets.y})}}function cellMouseleave(){mlChartTooltipService.hide()}if(void 0!==scope.swimlaneData){var lanes=scope.swimlaneData.laneLabels,startTime=scope.swimlaneData.earliest,endTime=scope.swimlaneData.latest,stepSecs=scope.swimlaneData.interval,points=scope.swimlaneData.points,numBuckets=parseInt((endTime-startTime)/stepSecs),height=30*(lanes.length+1)-10;element.css("height",height+20+"px");var $swimlanes=element.find(".ml-swimlanes").first();$swimlanes.empty();var cellWidth=Math.floor(scope.chartWidth/numBuckets),xAxisWidth=cellWidth*numBuckets,xAxisScale=_d2.default.time.scale().domain([new Date(1e3*startTime),new Date(1e3*endTime)]).range([0,xAxisWidth]),timeBuckets=new MlTimeBuckets;timeBuckets.setInterval(stepSecs+"s");var xAxisTickFormat=timeBuckets.getScaledDateFormat(),xAxisTicks=xAxisScale.ticks((0,_chart_utils.numTicksForDateFormat)(scope.chartWidth,xAxisTickFormat));_lodash2.default.each(lanes,function(lane){var rowScope=scope.$new();rowScope.cellMouseover=cellMouseover,rowScope.cellMouseleave=cellMouseleave;var $lane=(0,_jquery2.default)("<div>",{class:"lane"}),label=(0,_string_utils.mlEscape)(lane),fieldName=(0,_string_utils.mlEscape)(scope.swimlaneData.fieldName),laneDivProps={class:"lane-label",css:{width:"170px"},html:label};void 0!==scope.swimlaneData.fieldName&&(laneDivProps["tooltip-html-unsafe"]=fieldName+": "+label,laneDivProps["tooltip-placement"]="right",laneDivProps["aria-label"]=fieldName+": "+label);var $label=(0,_jquery2.default)("<div>",laneDivProps);$label.on("click",function(){void 0!==scope.appState.mlExplorerSwimlane.selectedLanes&&clearSelection()}),$lane.append($label);var $cellsContainer=(0,_jquery2.default)("<div>",{class:"cells-container"});$lane.append($cellsContainer);for(var time=startTime,i=0;i<numBuckets;i++){for(var $cell=(0,_jquery2.default)("<div>",{class:"sl-cell ",css:{width:cellWidth+"px"},"data-lane-label":label,"data-time":time}),color="none",bucketScore=0,j=0;j<points.length;j++)points[j].value>0&&points[j].laneLabel===lane&&points[j].time===time?(bucketScore=points[j].value,color=colorScore(bucketScore),$cell.append((0,_jquery2.default)("<div>",{class:"sl-cell-inner",css:{"background-color":color}})),$cell.attr({"data-score":bucketScore}),$cell.find(".sl-cell-inner-dragselect").remove()):0===$cell.find(".sl-cell-inner-dragselect").length&&0===$cell.find(".sl-cell-inner").length&&$cell.append((0,_jquery2.default)("<div>",{class:"sl-cell-inner-dragselect"}));if($cell.data({click:{bucketScore:bucketScore,laneLabel:lane,swimlaneType:scope.swimlaneType,time:time}}),bucketScore>0){var safeLaneTxt=lane.replace(/(['\\])/g,"\\$1"),cellMouseoverTxt="cellMouseover($event, '"+safeLaneTxt+"', "+bucketScore+", "+i+", "+time+")";$cell.attr({"ng-mouseover":cellMouseoverTxt,"ng-mouseleave":"cellMouseleave()"})}$cellsContainer.append($cell),time+=stepSecs}$swimlanes.append($lane),$compile($lane)(rowScope)});var $laneTimes=(0,_jquery2.default)("<div>",{class:"time-tick-labels"});_lodash2.default.each(xAxisTicks,function(tick){var $tickLabel=(0,_jquery2.default)("<div>",{class:"tick-label",text:(0,_moment2.default)(tick).format(xAxisTickFormat)}),$tickLabelWrapper=(0,_jquery2.default)("<div>",{class:"tick-label-wrapper",css:{"margin-left":xAxisScale(tick)+"px"}});$tickLabelWrapper.append($tickLabel),$laneTimes.append($tickLabelWrapper)}),$swimlanes.append($laneTimes),mlExplorerDashboardService.swimlaneRenderDone.changed()}}function checkForSelection(){var selectionState=scope.appState.mlExplorerSwimlane,selectedType=_lodash2.default.get(selectionState,"selectedType",void 0),viewBy=_lodash2.default.get(selectionState,"viewBy","");if(scope.swimlaneType!==selectedType&&void 0!==selectedType&&((0,_jquery2.default)(".lane-label",element).addClass("lane-label-masked"),(0,_jquery2.default)(".sl-cell-inner",element).addClass("sl-cell-inner-masked")),scope.swimlaneType===selectedType&&(void 0===scope.swimlaneData.fieldName||scope.swimlaneData.fieldName===viewBy)){var cellsToSelect=[],selectedLanes=_lodash2.default.get(selectionState,"selectedLanes",[]),selectedTimes=_lodash2.default.get(selectionState,"selectedTimes",[]),selectedTimeExtent=_d2.default.extent(selectedTimes),lanes=scope.swimlaneData.laneLabels,startTime=scope.swimlaneData.earliest,endTime=scope.swimlaneData.latest;selectedLanes.forEach(function(selectedLane){if(lanes.indexOf(selectedLane)>-1&&selectedTimeExtent[0]>=startTime&&selectedTimeExtent[1]<=endTime){var $swimlanes=element.find(".ml-swimlanes").first(),laneCells=(0,_jquery2.default)('div[data-lane-label="'+(0,_string_utils.mlEscape)(selectedLane)+'"]',$swimlanes);if(0===laneCells.length)return;for(var i=0;i<laneCells.length;i++){var cell=laneCells[i],cellTime=(0,_jquery2.default)(cell).attr("data-time");cellTime>=selectedTimeExtent[0]&&cellTime<=selectedTimeExtent[1]&&cellsToSelect.push(cell)}}});var selectedMaxBucketScore=cellsToSelect.reduce(function(maxBucketScore,cell){return Math.max(maxBucketScore,+(0,_jquery2.default)(cell).attr("data-score")||0)},0);cellsToSelect.length>1||selectedMaxBucketScore>0?selectCell(cellsToSelect,selectedLanes,selectedTimes,selectedMaxBucketScore):clearSelection()}}function selectCell(cellsToSelect,laneLabels,times,bucketScore){var checkEqualSelection=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if((0,_jquery2.default)(".lane-label",".ml-explorer-swimlane").addClass("lane-label-masked"),(0,_jquery2.default)(".sl-cell-inner,.sl-cell-inner-dragselect",".ml-explorer-swimlane").addClass("sl-cell-inner-masked"),(0,_jquery2.default)(".sl-cell-inner.sl-cell-inner-selected,.sl-cell-inner-dragselect.sl-cell-inner-selected",".ml-explorer-swimlane").removeClass("sl-cell-inner-selected"),(0,_jquery2.default)(cellsToSelect).find(".sl-cell-inner,.sl-cell-inner-dragselect").removeClass("sl-cell-inner-masked").addClass("sl-cell-inner-selected"),(0,_jquery2.default)(".lane-label").filter(function(){return laneLabels.indexOf((0,_jquery2.default)(this).text())>-1}).removeClass("lane-label-masked"),"viewBy"===scope.swimlaneType){var overallSwimlane=(0,_jquery2.default)('ml-explorer-swimlane[swimlane-type="overall"]');times.forEach(function(time){(0,_jquery2.default)('div[data-time="'+time+'"]',overallSwimlane).find(".sl-cell-inner,.sl-cell-inner-dragselect").addClass("sl-cell-inner-selected")})}checkEqualSelection&&_lodash2.default.isEqual({selectedType:scope.appState.mlExplorerSwimlane.selectedType,selectedLanes:scope.appState.mlExplorerSwimlane.selectedLanes,selectedTimes:scope.appState.mlExplorerSwimlane.selectedTimes},{selectedType:scope.swimlaneType,selectedLanes:laneLabels,selectedTimes:times})?clearSelection():(scope.appState.mlExplorerSwimlane.selectedType=scope.swimlaneType,scope.appState.mlExplorerSwimlane.selectedLanes=laneLabels,scope.appState.mlExplorerSwimlane.selectedTimes=times,scope.appState.save(),mlExplorerDashboardService.swimlaneCellClick.changed({fieldName:scope.swimlaneData.fieldName,laneLabels:laneLabels,time:_d2.default.extent(times),interval:scope.swimlaneData.interval,score:bucketScore}))}function clearSelection(){(0,_jquery2.default)(".lane-label",".ml-explorer-swimlane").removeClass("lane-label-masked"),(0,_jquery2.default)(".sl-cell-inner",".ml-explorer-swimlane").removeClass("sl-cell-inner-masked"),(0,_jquery2.default)(".sl-cell-inner.sl-cell-inner-selected",".ml-explorer-swimlane").removeClass("sl-cell-inner-selected"),(0,_jquery2.default)(".sl-cell-inner-dragselect.sl-cell-inner-selected",".ml-explorer-swimlane").removeClass("sl-cell-inner-selected"),(0,_jquery2.default)(".ds-selected",".ml-exlporer-swimlane").removeClass("ds-selected"),delete scope.appState.mlExplorerSwimlane.selectedType,delete scope.appState.mlExplorerSwimlane.selectedLanes,delete scope.appState.mlExplorerSwimlane.selectedTimes,scope.appState.save(),mlExplorerDashboardService.swimlaneCellClick.changed({})}mlExplorerDashboardService.allowCellRangeSelection||element.addClass("ml-hide-range-selection");var cellMouseoverActive=!0;mlExplorerDashboardService.dragSelect.watch(dragSelectListener),mlExplorerDashboardService.swimlaneDataChange.watch(swimlaneDataChangeListener),element.on("$destroy",function(){mlExplorerDashboardService.dragSelect.unwatch(dragSelectListener),mlExplorerDashboardService.swimlaneDataChange.unwatch(swimlaneDataChangeListener),scope.$destroy()});var MlTimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider)}return{scope:{swimlaneType:"@",swimlaneData:"=",selectedJobIds:"=",chartWidth:"=",appState:"="},link:link,template:'<div class="ml-swimlanes"></div>'}})},3523:function(module,exports){},3524:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3525),__webpack_require__(3527),__webpack_require__(3530),__webpack_require__(482)},3525:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_jquery=__webpack_require__(12),_jquery2=_interopRequireDefault(_jquery),_modules=__webpack_require__(2),_explorer_chart_config_builder=__webpack_require__(3526),_chart_utils=__webpack_require__(133),_job_utils=__webpack_require__(57);__webpack_require__(375),_modules.uiModules.get("apps/ml").controller("MlExplorerChartsContainerController",function($scope,$injector){function processRecordsForDisplay(anomalyRecords){if(0===anomalyRecords.length)return[];var aggregatedData={};_lodash2.default.each(anomalyRecords,function(record){var job=mlJobService.getJob(record.job_id);if(!1!==(0,_job_utils.isTimeSeriesViewDetector)(job,record.detector_index)&&-1!==_lodash2.default.indexOf(FUNCTION_DESCRIPTIONS_TO_PLOT,record.function_description)){var jobId=record.job_id;_lodash2.default.has(aggregatedData,jobId)||(aggregatedData[jobId]={});var detectorsForJob=aggregatedData[jobId],detectorIndex=record.detector_index;_lodash2.default.has(detectorsForJob,detectorIndex)||(detectorsForJob[detectorIndex]={});var firstFieldName=record.partition_field_name||record.by_field_name||record.over_field_name,firstFieldValue=record.partition_field_value||record.by_field_value||record.over_field_value;if(void 0!==firstFieldName){var groupsForDetector=detectorsForJob[detectorIndex];_lodash2.default.has(groupsForDetector,firstFieldName)||(groupsForDetector[firstFieldName]={});var valuesForGroup=groupsForDetector[firstFieldName];_lodash2.default.has(valuesForGroup,firstFieldValue)||(valuesForGroup[firstFieldValue]={});var dataForGroupValue=valuesForGroup[firstFieldValue],isSecondSplit=!1;if(void 0!==record.partition_field_name&&void 0!==(record.over_field_name||record.by_field_name)&&(isSecondSplit=!0),!1===isSecondSplit)_lodash2.default.has(dataForGroupValue,"maxScoreRecord")?record.record_score>dataForGroupValue.maxScore&&(dataForGroupValue.maxScore=record.record_score,dataForGroupValue.maxScoreRecord=record):(dataForGroupValue.maxScore=record.record_score,dataForGroupValue.maxScoreRecord=record);else{var secondFieldName=record.over_field_name||record.by_field_name,secondFieldValue=record.over_field_value||record.by_field_value;_lodash2.default.has(dataForGroupValue,secondFieldName)||(dataForGroupValue[secondFieldName]={});var splitsForGroup=dataForGroupValue[secondFieldName];_lodash2.default.has(splitsForGroup,secondFieldValue)||(splitsForGroup[secondFieldValue]={});var dataForSplitValue=splitsForGroup[secondFieldValue];_lodash2.default.has(dataForSplitValue,"maxScoreRecord")?record.record_score>dataForSplitValue.maxScore&&(dataForSplitValue.maxScore=record.record_score,dataForSplitValue.maxScoreRecord=record):(dataForSplitValue.maxScore=record.record_score,dataForSplitValue.maxScoreRecord=record)}}else{var dataForDetector=detectorsForJob[detectorIndex];_lodash2.default.has(dataForDetector,"maxScoreRecord")?record.record_score>dataForDetector.maxScore&&(dataForDetector.maxScore=record.record_score,dataForDetector.maxScoreRecord=record):(dataForDetector.maxScore=record.record_score,dataForDetector.maxScoreRecord=record)}}}),console.log("explorer charts aggregatedData is:",aggregatedData);var recordsForSeries=[];return _lodash2.default.each(aggregatedData,function(detectorsForJob){_lodash2.default.each(detectorsForJob,function(groupsForDetector){_lodash2.default.has(groupsForDetector,"maxScoreRecord")?recordsForSeries.push(groupsForDetector.maxScoreRecord):_lodash2.default.each(groupsForDetector,function(valuesForGroup){_lodash2.default.each(valuesForGroup,function(dataForGroupValue){_lodash2.default.has(dataForGroupValue,"maxScoreRecord")?recordsForSeries.push(dataForGroupValue.maxScoreRecord):_lodash2.default.each(dataForGroupValue,function(splitsForGroup){_lodash2.default.each(splitsForGroup,function(dataForSplitValue){recordsForSeries.push(dataForSplitValue.maxScoreRecord)})})})})})}),recordsForSeries=_lodash2.default.sortBy(recordsForSeries,"record_score").reverse()}function buildDataConfigs(anomalyRecords){var configBuilder=Private(_explorer_chart_config_builder.explorerChartConfigBuilder);return anomalyRecords.map(configBuilder.buildConfig)}function calculateChartRange(seriesConfigs,earliestMs,latestMs,chartWidth,recordsToPlot){var midpointMs=Math.ceil((earliestMs+latestMs)/2),maxBucketSpanMs=1e3*Math.max.apply(null,_lodash2.default.pluck(seriesConfigs,"bucketSpanSeconds")),pointsToPlotFullSelection=Math.ceil((latestMs-earliestMs)/maxBucketSpanMs),optimumNumPoints=chartWidth/5,plotPoints=Math.max(optimumNumPoints,pointsToPlotFullSelection),halfPoints=Math.ceil(plotPoints/2),chartRange={min:midpointMs-halfPoints*maxBucketSpanMs,max:midpointMs+halfPoints*maxBucketSpanMs};if(plotPoints>CHART_MAX_POINTS){$scope.tooManyBuckets=!0;var maxTimeSpan=maxBucketSpanMs*CHART_MAX_POINTS,minMs=recordsToPlot[0][$scope.timeFieldName],maxMs=recordsToPlot[0][$scope.timeFieldName];_lodash2.default.each(recordsToPlot,function(record){if(maxMs-minMs<maxTimeSpan){var recordTime=record[$scope.timeFieldName];recordTime<minMs&&maxMs-recordTime<=maxTimeSpan&&(minMs=recordTime),recordTime>maxMs&&recordTime-minMs<=maxTimeSpan&&(maxMs=recordTime)}}),maxMs-minMs<maxTimeSpan&&(minMs=Math.max(earliestMs,maxMs-maxTimeSpan),maxMs=Math.min(latestMs,minMs+maxTimeSpan)),chartRange={min:minMs,max:maxMs}}return chartRange}var Private=$injector.get("Private"),mlJobService=$injector.get("mlJobService"),mlExplorerDashboardService=$injector.get("mlExplorerDashboardService"),mlResultsService=$injector.get("mlResultsService"),mlSelectSeverityService=$injector.get("mlSelectSeverityService"),$q=$injector.get("$q");$scope.seriesToPlot=[];var $chartContainer=(0,_jquery2.default)(".explorer-charts"),FUNCTION_DESCRIPTIONS_TO_PLOT=["mean","min","max","sum","count","distinct_count","median"],CHART_MAX_POINTS=500,ANOMALIES_MAX_RESULTS=500,MAX_SCHEDULED_EVENTS=10,ML_TIME_FIELD_NAME="timestamp",anomalyDataChangeListener=function(anomalyRecords,earliestMs,latestMs){function getMetricData(config,range){var datafeedQuery=_lodash2.default.get(config,"datafeedConfig.query",null);return mlResultsService.getMetricData(config.datafeedConfig.indices,config.datafeedConfig.types,config.entityFields,datafeedQuery,config.metricFunction,config.metricFieldName,config.timeField,range.min,range.max,config.interval)}function getRecordsForCriteria(config,range){var criteria=[];return criteria.push({fieldName:"detector_index",fieldValue:config.detectorIndex}),criteria=criteria.concat(config.entityFields),mlResultsService.getRecordsForCriteria([config.jobId],criteria,0,range.min,range.max,ANOMALIES_MAX_RESULTS)}function getScheduledEvents(config,range){return mlResultsService.getScheduledEventsByBucket([config.jobId],range.min,range.max,config.interval,1,MAX_SCHEDULED_EVENTS)}function processChartData(response,seriesIndex){var metricData=response[0].results,records=response[1].records,jobId=seriesConfigs[seriesIndex].jobId,scheduledEvents=response[2].events[jobId];if(void 0===metricData||0===_lodash2.default.keys(metricData).length)return[];var chartData=_lodash2.default.map(metricData,function(value,time){return{date:+time,value:value}});return _lodash2.default.each(records,function(record){var recordTime=record[ML_TIME_FIELD_NAME],chartPoint=findNearestChartPointToTime(chartData,recordTime);if(void 0===chartPoint){var lastChartPoint=chartData[chartData.length-1],lastChartPointScore=lastChartPoint.anomalyScore||0;record.record_score>lastChartPointScore&&(chartPoint=lastChartPoint)}if(void 0!==chartPoint)if(chartPoint.anomalyScore=record.record_score,_lodash2.default.has(record,"actual"))chartPoint.actual=record.actual,chartPoint.typical=record.typical;else{var causes=_lodash2.default.get(record,"causes",[]);if(causes.length>0&&(chartPoint.byFieldName=record.by_field_name,chartPoint.numberOfCauses=causes.length,1===causes.length)){var cause=_lodash2.default.first(record.causes);chartPoint.actual=cause.actual,chartPoint.typical=cause.typical}}}),void 0!==scheduledEvents&&_lodash2.default.each(scheduledEvents,function(events,time){var chartPoint=findNearestChartPointToTime(chartData,time);void 0!==chartPoint&&(chartPoint.scheduledEvents=events)}),chartData}function findNearestChartPointToTime(chartData,time){for(var chartPoint=void 0,i=0;i<chartData.length;i++)if(chartData[i].date===time){chartPoint=chartData[i];break}if(void 0===chartPoint){for(var foundItem=void 0,_i=0;_i<chartData.length;_i++){var itemTime=chartData[_i].date;if(itemTime>time&&_i>0){var item=chartData[_i],previousItem=_i>0?chartData[_i-1]:null,diff1=Math.abs(time-previousItem.date),diff2=Math.abs(time-itemTime);foundItem=null===previousItem||diff1>diff2?item:previousItem;break}}chartPoint=foundItem}return chartPoint}var threshold=mlSelectSeverityService.state.get("threshold"),filteredRecords=_lodash2.default.filter(anomalyRecords,function(record){return Number(record.record_score)>=threshold.val}),allSeriesRecords=processRecordsForDisplay(filteredRecords),chartsContainerWidth=$chartContainer.width(),chartsPerRow=Math.min(Math.max(Math.floor(chartsContainerWidth/550),1),4);$scope.chartsPerRow=chartsPerRow,$scope.layoutCellsPerChart=12/$scope.chartsPerRow;var maxSeriesToPlot=Math.max(2*chartsPerRow,6),recordsToPlot=allSeriesRecords.slice(0,maxSeriesToPlot),seriesConfigs=buildDataConfigs(recordsToPlot);$scope.tooManyBuckets=!1;var chartRange=calculateChartRange(seriesConfigs,earliestMs,latestMs,Math.floor(chartsContainerWidth/chartsPerRow),recordsToPlot);$scope.seriesToPlot=seriesConfigs.map(function(config){return _extends({},config,{loading:!0,chartData:null})});var seriesPromises=seriesConfigs.map(function(seriesConfig){return $q.all([getMetricData(seriesConfig,chartRange),getRecordsForCriteria(seriesConfig,chartRange),getScheduledEvents(seriesConfig,chartRange)])});$q.all(seriesPromises).then(function(response){var processedData=response.map(processChartData),allDataPoints=_lodash2.default.reduce(processedData,function(datapoints,series){return _lodash2.default.each(series,function(d){return datapoints.push(d)}),datapoints},[]);(0,_chart_utils.chartLimits)(allDataPoints),$scope.seriesToPlot=response.map(function(d,i){return _extends({},seriesConfigs[i],{loading:!1,chartData:processedData[i],plotEarliest:chartRange.min,plotLatest:chartRange.max,selectedEarliest:earliestMs,selectedLatest:latestMs,chartLimits:(0,_chart_utils.chartLimits)(processedData[i])})})}).catch(function(error){console.error(error)})};mlExplorerDashboardService.anomalyDataChange.watch(anomalyDataChangeListener),$scope.$on("$destroy",function(){mlExplorerDashboardService.anomalyDataChange.unwatch(anomalyDataChangeListener)})})},3526:function(module,exports,__webpack_require__){"use strict";function explorerChartConfigBuilder(mlJobService){function buildConfig(record){var job=mlJobService.getJob(record.job_id),detectorIndex=record.detector_index,config=(0,_chart_config_builder.buildConfigFromDetector)(job,detectorIndex);config.functionDescription=record.function_description,config.bucketSpanSeconds=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span).asSeconds(),config.detectorLabel=record.function,_lodash2.default.has(mlJobService.detectorsByJob,record.job_id)&&detectorIndex<mlJobService.detectorsByJob[record.job_id].length?config.detectorLabel=mlJobService.detectorsByJob[record.job_id][detectorIndex].detector_description:void 0!==record.field_name&&(config.detectorLabel+=" "+config.fieldName),void 0!==record.field_name&&(config.fieldName=record.field_name,config.metricFieldName=record.field_name),config.entityFields=[],_lodash2.default.has(record,"partition_field_name")&&config.entityFields.push({fieldName:record.partition_field_name,fieldValue:record.partition_field_value}),_lodash2.default.has(record,"over_field_name")&&config.entityFields.push({fieldName:record.over_field_name,fieldValue:record.over_field_value}),_lodash2.default.has(record,"by_field_name")&&!_lodash2.default.has(record,"over_field_name")&&config.entityFields.push({fieldName:record.by_field_name,fieldValue:record.by_field_value});var functionLabel=config.metricFunction;return void 0!==config.metricFieldName&&(functionLabel+=" "+(0,_string_utils.mlEscape)(config.metricFieldName)),config.infoTooltip=compiledTooltip({jobId:record.job_id,aggregationInterval:config.interval,chartFunction:functionLabel,entityFields:config.entityFields.map(function(f){return{fieldName:(0,_string_utils.mlEscape)(f.fieldName),fieldValue:(0,_string_utils.mlEscape)(f.fieldValue)}})}),config}var compiledTooltip=_lodash2.default.template('<div class="explorer-chart-info-tooltip">job ID: <%= jobId %><br/>aggregation interval: <%= aggregationInterval %><br/>chart function: <%= chartFunction %><% for(let i = 0; i < entityFields.length; ++i) { %><br/><%= entityFields[i].fieldName %>: <%= entityFields[i].fieldValue %><% } %></div>');return{buildConfig:buildConfig}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.explorerChartConfigBuilder=explorerChartConfigBuilder;var _lodash=__webpack_require__(1),_lodash2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_lodash),_parse_interval=__webpack_require__(107),_chart_config_builder=__webpack_require__(1190),_string_utils=__webpack_require__(43)},3527:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}__webpack_require__(3528);var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_jquery=__webpack_require__(12),_jquery2=_interopRequireDefault(_jquery),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment),_risonNode=__webpack_require__(191),_risonNode2=_interopRequireDefault(_risonNode),_chrome=__webpack_require__(8),_chrome2=_interopRequireDefault(_chrome);__webpack_require__(181);var _explorer_charts_container=__webpack_require__(3529),_explorer_charts_container2=_interopRequireDefault(_explorer_charts_container);__webpack_require__(2).uiModules.get("apps/ml").directive("mlExplorerChartsContainer",function($window,timefilter){function link(scope,element){(0,_jquery2.default)(".ml-explorer-charts-tooltip").remove(),(0,_jquery2.default)("body").append('<div class="ml-explorer-tooltip ml-explorer-charts-tooltip" style="opacity:0; display: none;">'),element.on("$destroy",function(){scope.$destroy()}),scope.exploreSeries=function(series){var bounds=timefilter.getActiveBounds(),from=bounds.min.toISOString(),to=bounds.max.toISOString(),zoomFrom=(0,_moment2.default)(series.plotEarliest).toISOString(),zoomTo=(0,_moment2.default)(series.plotLatest).toISOString(),entityCondition={};_lodash2.default.each(series.entityFields,function(entity){entityCondition[entity.fieldName]=entity.fieldValue});var _g=_risonNode2.default.encode({ml:{jobIds:[series.jobId]},refreshInterval:{display:"Off",pause:!1,value:0},time:{from:from,to:to,mode:"absolute"}}),_a=_risonNode2.default.encode({mlTimeSeriesExplorer:{zoom:{from:zoomFrom,to:zoomTo},detectorIndex:series.detectorIndex,entities:entityCondition},filters:[],query:{query_string:{analyze_wildcard:!0,query:"*"}}}),path=_chrome2.default.getBasePath();path+="/app/ml#/timeseriesexplorer",path+="?_g="+_g,path+="&_a="+encodeURIComponent(_a),$window.open(path,"_blank")}}return{restrict:"E",scope:{seriesToPlot:"=",chartsPerRow:"=",layoutCellsPerChart:"=",tooManyBuckets:"="},link:link,template:_explorer_charts_container2.default}})},3528:function(module,exports){},3529:function(module,exports){module.exports='<div class="explorer-charts">\n  <div class="row" ng-hide="seriesToPlot.length === 0">\n\n    <div ng-repeat="series in seriesToPlot" class="ml-explorer-chart-container col-md-{{layoutCellsPerChart}}">\n      <div class="explorer-chart-label">\n        <div class="explorer-chart-label-fields">\n          <span ng-if="series.entityFields.length > 0">{{series.detectorLabel}} - </span>\n          <span ng-if="series.entityFields.length === 0">{{series.detectorLabel}}</span>\n          <span ng-repeat=\'entity in series.entityFields\'>\n            {{entity.fieldName}} {{entity.fieldValue}} {{entity.fieldValueTest}}\n          </span>\n        </div>\n        <i aria-hidden="true" class="fa fa-info-circle" tooltip-placement="left" tooltip-html-unsafe="{{series.infoTooltip}}" tooltip-append-to-body="false"></i>\n        <i ng-if="tooManyBuckets" aria-hidden="true" class="fa fa-exclamation-triangle text-warning" tooltip-placement="bottom" tooltip-append-to-body="true"\n          tooltip-html-unsafe="This selection contains too many buckets to be displayed. The dashboard is best viewed over a shorter time range." ></i>\n        <a class="kuiLink" ng-click="exploreSeries(series)" data-toggle="tooltip" tooltip="View series in Single Metric Viewer">\n          View <i class="fa fa-external-link" aria-hidden="true"></i>\n        </a>\n      </div>\n      <ml-explorer-chart series-config="series" />\n    </div>\n\n  </div>\n\n</div>\n'},3530:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}__webpack_require__(3531);var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_d=__webpack_require__(15),_d2=_interopRequireDefault(_d),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment),_anomaly_utils=__webpack_require__(260),_chart_utils=__webpack_require__(133),_time_buckets=__webpack_require__(168);__webpack_require__(484);var _loading_indicator_wrapper=__webpack_require__(3532),_loading_indicator_wrapper2=_interopRequireDefault(_loading_indicator_wrapper),_string_utils=__webpack_require__(43);__webpack_require__(2).uiModules.get("apps/ml").directive("mlExplorerChart",function(Private,formatValueFilter,mlChartTooltipService,mlSelectSeverityService,mlFieldFormatService){function link(scope,element){function init(chartLimits){var $el=_angular2.default.element("ml-explorer-chart"),chartElement=_d2.default.select(element.get(0)).select(".content-wrapper");chartElement.select("svg").remove();var svgWidth=$el.width(),svgHeight=chartHeight+margin.top+margin.bottom,svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);lineChartYScale=_d2.default.scale.linear().range([chartHeight,0]).domain([chartLimits.min,chartLimits.max]).nice();var yAxis=_d2.default.svg.axis().scale(lineChartYScale).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10),maxYAxisLabelWidth=0;svg.append("g").attr("class","temp-axis-label tick").selectAll("text.temp.axis").data(lineChartYScale.ticks()).enter().append("text").text(function(d){return void 0!==fieldFormat?fieldFormat.convert(d,"text"):lineChartYScale.tickFormat()(d)}).each(function(){maxYAxisLabelWidth=Math.max(this.getBBox().width+yAxis.tickPadding(),maxYAxisLabelWidth)}).remove(),_d2.default.select(".temp-axis-label").remove(),margin.left=Math.max(maxYAxisLabelWidth,40),vizWidth=svgWidth-margin.left-margin.right,lineChartXScale=_d2.default.time.scale().range([0,vizWidth]).domain([config.plotEarliest,config.plotLatest]),lineChartValuesLine=_d2.default.svg.line().x(function(d){return lineChartXScale(d.date)}).y(function(d){return lineChartYScale(d.value)}).defined(function(d){return null!==d.value}),lineChartGroup=svg.append("g").attr("class","line-chart").attr("transform","translate("+margin.left+","+margin.top+")")}function drawLineChart(data){lineChartGroup.append("rect").attr("x",0).attr("y",0).attr("height",chartHeight).attr("width",vizWidth).style("stroke","#cccccc").style("fill","none").style("stroke-width",1),drawLineChartAxes(),drawLineChartHighlightedSpan(),drawLineChartPaths(data),(0,_chart_utils.drawLineChartDots)(data,lineChartGroup,lineChartValuesLine),drawLineChartMarkers(data)}function drawLineChartAxes(){var timeBuckets=new TimeBuckets,bounds={min:(0,_moment2.default)(config.plotEarliest),max:(0,_moment2.default)(config.plotLatest)};timeBuckets.setBounds(bounds),timeBuckets.setInterval("auto");var xAxisTickFormat=timeBuckets.getScaledDateFormat(),xAxis=_d2.default.svg.axis().scale(lineChartXScale).orient("bottom").innerTickSize(-chartHeight).outerTickSize(0).tickPadding(10).ticks((0,_chart_utils.numTicksForDateFormat)(vizWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)}),yAxis=_d2.default.svg.axis().scale(lineChartYScale).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10);void 0!==fieldFormat&&yAxis.tickFormat(function(d){return fieldFormat.convert(d,"text")});var axes=lineChartGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0,"+chartHeight+")").call(xAxis),axes.append("g").attr("class","y axis").call(yAxis)}function drawLineChartHighlightedSpan(){var rectStart=Math.max(config.selectedEarliest,config.plotEarliest),rectEnd=Math.min(config.selectedLatest,config.plotLatest),rectWidth=lineChartXScale(rectEnd)-lineChartXScale(rectStart);lineChartGroup.append("rect").attr("class","selected-interval").attr("x",lineChartXScale(new Date(rectStart))).attr("y",1).attr("width",rectWidth).attr("height",chartHeight-1)}function drawLineChartPaths(data){lineChartGroup.append("path").attr("class","values-line").attr("d",lineChartValuesLine(data))}function drawLineChartMarkers(data){var dots=lineChartGroup.append("g").attr("class","chart-markers").selectAll(".metric-value").data(data.filter(function(d){return null!==d.value}));dots.exit().remove(),dots.enter().append("circle").attr("r",LINE_CHART_ANOMALY_RADIUS).on("mouseover",function(d){showLineChartTooltip(d,this)}).on("mouseout",function(){return mlChartTooltipService.hide()});var threshold=mlSelectSeverityService.state.get("threshold");dots.attr("cx",function(d){return lineChartXScale(d.date)}).attr("cy",function(d){return lineChartYScale(d.value)}).attr("class",function(d){var markerClass="metric-value";return _lodash2.default.has(d,"anomalyScore")&&Number(d.anomalyScore)>=threshold.val&&(markerClass+=" anomaly-marker ",markerClass+=(0,_anomaly_utils.getSeverityWithLow)(d.anomalyScore)),markerClass});var scheduledEventMarkers=lineChartGroup.select(".chart-markers").selectAll(".scheduled-event-marker").data(data.filter(function(d){return void 0!==d.scheduledEvents}));scheduledEventMarkers.exit().remove(),scheduledEventMarkers.enter().append("rect").attr("width",2*LINE_CHART_ANOMALY_RADIUS).attr("height",SCHEDULED_EVENT_MARKER_HEIGHT).attr("class","scheduled-event-marker").attr("rx",1).attr("ry",1),scheduledEventMarkers.attr("x",function(d){return lineChartXScale(d.date)-LINE_CHART_ANOMALY_RADIUS}).attr("y",function(d){return lineChartYScale(d.value)-SCHEDULED_EVENT_MARKER_HEIGHT/2})}function showLineChartTooltip(marker,circle){var formattedDate=(0,_moment2.default)(marker.date).format("MMMM Do YYYY, HH:mm"),contents=formattedDate+"<br/><hr/>";if(_lodash2.default.has(marker,"anomalyScore")){var score=parseInt(marker.anomalyScore);if(contents+="anomaly score: "+(score>0?score:"< 1"),_lodash2.default.has(marker,"actual"))contents+="<br/>actual: "+formatValueFilter(marker.actual,config.functionDescription,fieldFormat),contents+="<br/>typical: "+formatValueFilter(marker.typical,config.functionDescription,fieldFormat);else if(contents+="<br/>value: "+formatValueFilter(marker.value,config.functionDescription,fieldFormat),_lodash2.default.has(marker,"byFieldName")&&_lodash2.default.has(marker,"numberOfCauses")){var numberOfCauses=marker.numberOfCauses,byFieldName=(0,_string_utils.mlEscape)(marker.byFieldName);contents+=numberOfCauses<10?"<br/> "+numberOfCauses+" unusual "+byFieldName+" values":"<br/> "+numberOfCauses+"+ unusual "+byFieldName+" values"}}else contents+="value: "+formatValueFilter(marker.value,config.functionDescription,fieldFormat);_lodash2.default.has(marker,"scheduledEvents")&&(contents+="<br/><hr/>Scheduled events:<br/>"+marker.scheduledEvents.map(_string_utils.mlEscape).join("<br/>")),mlChartTooltipService.show(contents,circle,{x:2*LINE_CHART_ANOMALY_RADIUS,y:0})}if(console.log("ml-explorer-chart directive link series config:",scope.seriesConfig),void 0!==scope.seriesConfig){var config=scope.seriesConfig,fieldFormat=mlFieldFormatService.getFieldFormat(config.jobId,config.detectorIndex),vizWidth=0,chartHeight=170,LINE_CHART_ANOMALY_RADIUS=7,SCHEDULED_EVENT_MARKER_HEIGHT=5,margin={top:10,right:0,bottom:30,left:60},TimeBuckets=Private(_time_buckets.TimeBucketsProvider),lineChartXScale=null,lineChartYScale=null,lineChartGroup=void 0,lineChartValuesLine=null;scope.isLoading=config.loading,Array.isArray(config.chartData)&&scope.$evalAsync(function(){init(config.chartLimits),drawLineChart(config.chartData)}),element.on("$destroy",function(){scope.$destroy()})}}return{restrict:"E",scope:{seriesConfig:"="},link:link,template:_loading_indicator_wrapper2.default}})},3531:function(module,exports){},3532:function(module,exports){module.exports='<ml-loading-indicator is-loading="isLoading" height="height" />\n<div class="content-wrapper" />\n'},3533:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3534)},3534:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_state_factory=__webpack_require__(372),_select_limit=__webpack_require__(3535),_select_limit2=_interopRequireDefault(_select_limit);__webpack_require__(376),__webpack_require__(2).uiModules.get("apps/ml").service("mlSelectLimitService",function(Private){var stateFactory=Private(_state_factory.stateFactoryProvider);this.state=stateFactory("mlSelectLimit",{limit:{display:"10",val:10}})}).directive("mlSelectLimit",function(mlSelectLimitService){return{restrict:"E",template:_select_limit2.default,link:function(scope,element){function setLimit(){scope.setLimit(mlSelectLimitService.state.get("limit"))}scope.limitOptions=[{display:"5",val:5},{display:"10",val:10},{display:"25",val:25},{display:"50",val:50}];var limitState=mlSelectLimitService.state.get("limit"),limitValue=_lodash2.default.get(limitState,"val",0),limitOption=scope.limitOptions.find(function(d){return d.val===limitValue});void 0===limitOption&&(limitOption=scope.limitOptions.find(function(d){return 10===d.val})),scope.limit=limitOption,mlSelectLimitService.state.set("limit",scope.limit),scope.setLimit=function(limit){_lodash2.default.isEqual(scope.limit,limit)||(scope.limit=limit,mlSelectLimitService.state.set("limit",scope.limit).changed())},mlSelectLimitService.state.watch(setLimit),element.on("$destroy",function(){mlSelectLimitService.state.unwatch(setLimit),scope.$destroy()})}}})},3535:function(module,exports){module.exports='<ml-controls-select\n  identifier="Limit"\n  label="Limit"\n  narrow-style="true"\n  options="limitOptions"\n  selected="limit"\n  show-icons="false"\n  update-fn="setLimit"\n/>\n'},3536:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3537),__webpack_require__(3540),__webpack_require__(3543),__webpack_require__(3544),__webpack_require__(3548),__webpack_require__(689),__webpack_require__(482)},3537:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3538)},3538:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment);__webpack_require__(3539);var _states=__webpack_require__(475),_fields_service=__webpack_require__(481),_parse_interval=__webpack_require__(166);__webpack_require__(2).uiModules.get("apps/ml").controller("MlForecastingModal",function($scope,$timeout,$interval,$modalInstance,$modal,params,Private,mlForecastService,mlJobService,mlMessageBarService){function openJobAndRunForecast(){$scope.runStatus.jobOpening=REQUEST_STATES.WAITING,mlJobService.openJob(job.job_id).then(function(){$scope.runStatus.jobOpening=REQUEST_STATES.DONE,runForecast(!0)}).catch(function(resp){console.log("Time series forecast modal - could not open job:",resp),msgs.error("Error opening job before running forecast.",resp),$scope.isForecastRunning=!1,$scope.runStatus.jobOpening=REQUEST_STATES.ERROR})}function runForecastErrorHandler(resp){$scope.runStatus.forecastProgress=REQUEST_STATES.ERROR,console.log("Time series forecast modal - error running forecast:",resp),resp&&resp.message?msgs.error(resp.message):msgs.error("Unexpected response from running forecast. The request may have failed.")}function runForecast(closeJobAfterRunning){$scope.isForecastRunning=!0,$scope.runStatus.forecastProgress=0;var durationInSeconds=(0,_parse_interval.parseInterval)($scope.newForecastDuration).asSeconds();mlForecastService.runForecast(job.job_id,durationInSeconds+"s").then(function(resp){void 0!==resp.forecast_id?waitForForecastResults(resp.forecast_id,closeJobAfterRunning):runForecastErrorHandler(resp)}).catch(runForecastErrorHandler)}function waitForForecastResults(forecastId,closeJobAfterRunning){var previousProgress=0,noProgressMs=0;forecastChecker=$interval(function(){mlForecastService.getForecastRequestStats(job,forecastId).then(function(resp){var progress=_lodash2.default.get(resp,["stats","forecast_progress"],previousProgress),status=_lodash2.default.get(resp,["stats","forecast_status"]);$scope.runStatus.forecastProgress=Math.round(100*progress);var messages=_lodash2.default.get(resp,["stats","forecast_messages"],previousProgress);_lodash2.default.each(messages,function(message){msgs.warning(message)}),status===_states.FORECAST_REQUEST_STATE.FINISHED?($interval.cancel(forecastChecker),$scope.isForecastRunning=!1,!0===closeJobAfterRunning?($scope.runStatus.jobClosing=REQUEST_STATES.WAITING,mlJobService.closeJob(job.job_id).then(function(){$scope.isForecastRunning=!1,$scope.runStatus.jobClosing=REQUEST_STATES.DONE,loadForForecastId(forecastId),closeAfterRunningForecast()}).catch(function(closeResp){msgs.error("Error closing job after running forecast.",closeResp),$scope.runStatus.jobClosing=REQUEST_STATES.ERROR,loadForForecastId(forecastId),$scope.isForecastRunning=!1})):(loadForForecastId(forecastId),closeAfterRunningForecast())):progress===previousProgress?(noProgressMs+=FORECAST_STATS_POLL_FREQUENCY)>WARN_NO_PROGRESS_MS&&(console.log("Forecast request has not progressed for "+WARN_NO_PROGRESS_MS+"ms. Cancelling check."),msgs.error("No progress reported for the new forecast for "+WARN_NO_PROGRESS_MS+"ms. An error may have occurred whilst running the forecast."),loadForForecastId(forecastId),$scope.runStatus.forecastProgress=REQUEST_STATES.ERROR,$interval.cancel(forecastChecker)):previousProgress=progress}).catch(function(resp){console.log("Time series forecast modal - error loading stats of forecast from elasticsearch:",resp),msgs.error("Error loading stats of running forecast.",resp),$scope.isForecastRunning=!1,$scope.runStatus.forecastProgress=REQUEST_STATES.ERROR,$interval.cancel(forecastChecker)})},FORECAST_STATS_POLL_FREQUENCY)}function closeAfterRunningForecast(){0===msgs.messages.length&&$timeout($scope.close,1e3)}var FORECAST_STATS_POLL_FREQUENCY=250,WARN_NO_PROGRESS_MS=12e4,REQUEST_STATES={WAITING:0,DONE:1,ERROR:-1};$scope.REQUEST_STATES=REQUEST_STATES,$scope.newForecastDuration="1d",$scope.newForecastDurationError=null,$scope.isForecastRunning=!1,$scope.showFrom=params.earliest,$scope.previousForecasts=[],$scope.permissions=params.pscope.permissions,$scope.createPermissionFailureMessage=params.pscope.createPermissionFailureMessage,$scope.mlNodesAvailable=params.mlNodesAvailable,$scope.partitionsWarningNumber=100,$scope.showNumPartitionsWarning=!1,$scope.runStatus={forecastRequested:!1};var job=params.job,entities=params.entities,loadForForecastId=params.pscope.loadForForecastId,forecastChecker=null,msgs=mlMessageBarService;msgs.clear(),job.state!==_states.JOB_STATE.OPENED&&job.state!==_states.JOB_STATE.CLOSED&&($scope.invalidJobState=job.state);var statusFinishedQuery={term:{forecast_status:_states.FORECAST_REQUEST_STATE.FINISHED}};mlForecastService.getForecastsSummary(job,statusFinishedQuery,$scope.showFrom,5).then(function(resp){resp.forecasts.forEach(function(forecast){forecast.runTime=(0,_moment2.default)(forecast.forecast_create_timestamp).format("MMMM Do YYYY, HH:mm"),forecast.earliestTime=(0,_moment2.default)(forecast.forecast_start_timestamp).format("MMMM Do YYYY, HH:mm:ss"),forecast.latestTime=(0,_moment2.default)(forecast.forecast_end_timestamp).format("MMMM Do YYYY, HH:mm:ss")}),$scope.previousForecasts=resp.forecasts}).catch(function(resp){console.log("Time series forecast modal - error obtaining forecasts summary:",resp),msgs.error("Error obtaining list of previous forecasts.",resp)});var entityFieldNames=_lodash2.default.map(entities,"fieldName");entityFieldNames.length>0&&Private(_fields_service.FieldsServiceProvider).getCardinalityOfFields(job.datafeed_config.indices,job.datafeed_config.types,entityFieldNames,job.datafeed_config.query,job.data_description.time_field,job.data_counts.earliest_record_timestamp,job.data_counts.latest_record_timestamp).then(function(results){var numPartitions=1;_lodash2.default.each(results,function(cardinality){numPartitions*=cardinality}),$scope.showNumPartitionsWarning=numPartitions>100,$scope.$apply()}).catch(function(resp){console.log("Time series forecast modal - error obtaining cardinality of fields:",resp)}),$scope.viewForecast=function(forecastId){loadForForecastId(forecastId),$scope.close()},$scope.newForecastDurationChange=function(){$scope.newForecastDurationError=null;var duration=(0,_parse_interval.parseInterval)($scope.newForecastDuration);null===duration?$scope.newForecastDurationError="Invalid duration format":duration.asMilliseconds()>48384e5?$scope.newForecastDurationError="Forecast duration must not be greater than 8 weeks":0===duration.asMilliseconds()&&($scope.newForecastDurationError="Forecast duration must not be zero")},$scope.checkJobStateAndRunForecast=function(){msgs.clear(),$scope.isForecastRunning=!0,$scope.runStatus.forecastRequested=!0,job.state===_states.JOB_STATE.CLOSED?openJobAndRunForecast():runForecast(!1)},$scope.close=function(){msgs.clear(),$modalInstance.close()},$scope.$on("$destroy",function(){null!==forecastChecker&&$interval.cancel(forecastChecker)})})},3539:function(module,exports){},3540:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment);__webpack_require__(1188),__webpack_require__(374),__webpack_require__(1155),__webpack_require__(483),__webpack_require__(375);var _notify=__webpack_require__(10),_routes=__webpack_require__(11),_routes2=_interopRequireDefault(_routes);__webpack_require__(181);var _parse_interval=__webpack_require__(107),_check_license=__webpack_require__(101),_check_privilege=__webpack_require__(93),_job_utils=__webpack_require__(57),_index_utils=__webpack_require__(132),_timeseriesexplorer_utils=__webpack_require__(1191),_refresh_interval_watcher=__webpack_require__(1189),_ml_time_buckets=__webpack_require__(169),_timeseriesexplorer=__webpack_require__(3541),_timeseriesexplorer2=_interopRequireDefault(_timeseriesexplorer),_forecasting_modal=__webpack_require__(3542),_forecasting_modal2=_interopRequireDefault(_forecasting_modal),_check_ml_nodes=__webpack_require__(108),_modules=__webpack_require__(2);_routes2.default.when("/timeseriesexplorer/?",{template:_timeseriesexplorer2.default,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkGetJobsPrivilege,indexPatterns:_index_utils.getIndexPatterns,mlNodeCount:_check_ml_nodes.getMlNodeCount}}),_modules.uiModules.get("apps/ml").controller("MlTimeSeriesExplorerController",function($scope,$route,$timeout,$compile,$modal,Private,$q,es,timefilter,AppState,mlJobService,mlResultsService,mlJobSelectService,mlTimeSeriesSearchService,mlForecastService,mlAnomaliesTableService,mlFieldFormatService){function loadForJobId(jobId){var jobPickerSelectedJob=_lodash2.default.find($scope.jobs,{id:jobId});if(void 0===jobPickerSelectedJob){var newJobs=[];_lodash2.default.each(mlJobService.jobs,function(job){if(!0===(0,_job_utils.isTimeSeriesViewJob)(job)){var bucketSpan=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span);newJobs.push({id:job.job_id,selected:!1,bucketSpanSeconds:bucketSpan.asSeconds()})}}),$scope.jobs=newJobs,jobPickerSelectedJob=_lodash2.default.find(newJobs,{id:jobId})}$scope.selectedJob=mlJobService.getJob(jobId),$scope.jobPickerSelections=[jobPickerSelectedJob];var jobDetectors=$scope.selectedJob.analysis_config.detectors,viewableDetectors=[];_lodash2.default.each(jobDetectors,function(dtr,index){(0,_job_utils.isTimeSeriesViewDetector)($scope.selectedJob,index)&&viewableDetectors.push({index:""+index,detector_description:dtr.detector_description})}),$scope.detectors=viewableDetectors;var appStateDtrIdx=$scope.appState.mlTimeSeriesExplorer.detectorIndex,detectorIndex=void 0!==appStateDtrIdx?appStateDtrIdx:+viewableDetectors[0].index;if(void 0===_lodash2.default.find(viewableDetectors,{index:""+detectorIndex})){var warningText="Requested detector index "+detectorIndex+" is not valid for job "+$scope.selectedJob.job_id;_notify.notify.warning(warningText,{lifetime:3e4}),detectorIndex=+viewableDetectors[0].index,$scope.appState.mlTimeSeriesExplorer.detectorIndex=detectorIndex,$scope.appState.save()}$scope.detectorId=""+detectorIndex,updateControlsForDetector(),mlFieldFormatService.populateFormats([jobId],$route.current.locals.indexPatterns).finally(function(){$scope.refresh()})}function updateControlsForDetector(){var detectorIndex=+$scope.detectorId,detector=$scope.selectedJob.analysis_config.detectors[detectorIndex],entities=[],entitiesState=$scope.appState.mlTimeSeriesExplorer.entities||{},partitionFieldName=_lodash2.default.get(detector,"partition_field_name"),overFieldName=_lodash2.default.get(detector,"over_field_name"),byFieldName=_lodash2.default.get(detector,"by_field_name");if(void 0!==partitionFieldName){var partitionFieldValue=_lodash2.default.get(entitiesState,partitionFieldName,"");entities.push({fieldName:partitionFieldName,fieldValue:partitionFieldValue})}if(void 0!==overFieldName){var overFieldValue=_lodash2.default.get(entitiesState,overFieldName,"");entities.push({fieldName:overFieldName,fieldValue:overFieldValue})}if(void 0!==byFieldName&&void 0===overFieldName){var byFieldValue=_lodash2.default.get(entitiesState,byFieldName,"");entities.push({fieldName:byFieldName,fieldValue:byFieldValue})}$scope.entities=entities,void 0!==overFieldName?($scope.forecastingDisabled=!0,$scope.forecastingDisabledMessage="Forecasting is not available for population detectors with an over field"):!1===(0,_job_utils.isJobVersionGte)($scope.selectedJob,FORECAST_JOB_MIN_VERSION)?($scope.forecastingDisabled=!0,$scope.forecastingDisabledMessage="Forecasting is only available for jobs created in version "+FORECAST_JOB_MIN_VERSION+" or later"):($scope.forecastingDisabled=!1,$scope.forecastingDisabledMessage="")}function loadEntityValues(){var bounds=timefilter.getActiveBounds(),detectorIndex=+$scope.detectorId;mlResultsService.getRecordsForCriteria([$scope.selectedJob.job_id],[{fieldName:"detector_index",fieldValue:detectorIndex}],0,bounds.min.valueOf(),bounds.max.valueOf(),ANOMALIES_MAX_RESULTS).then(function(resp){if(resp.records&&resp.records.length>0){var firstRec=resp.records[0];_lodash2.default.each($scope.entities,function(entity){firstRec.partition_field_name===entity.fieldName&&(entity.fieldValues=_lodash2.default.chain(resp.records).pluck("partition_field_value").uniq().value()),firstRec.over_field_name===entity.fieldName&&(entity.fieldValues=_lodash2.default.chain(resp.records).pluck("over_field_value").uniq().value()),firstRec.by_field_name===entity.fieldName&&(entity.fieldValues=_lodash2.default.chain(resp.records).pluck("by_field_value").uniq().value())})}})}function calculateInitialFocusRange(){var zoomState=$scope.appState.mlTimeSeriesExplorer.zoom;if(void 0!==zoomState){$scope.autoZoomDuration=getAutoZoomDuration();var zoomFrom=(0,_moment2.default)(zoomState.from,"YYYY-MM-DDTHH:mm:ss.SSSZ",!0),zoomTo=(0,_moment2.default)(zoomState.to,"YYYY-MM-DDTHH:mm:ss.SSSZ",!0),combinedData=void 0===$scope.contextForecastData?$scope.contextChartData:$scope.contextChartData.concat($scope.contextForecastData),earliestDataDate=_lodash2.default.first(combinedData).date,latestDataDate=new Date(_lodash2.default.last(combinedData).date.valueOf()+$scope.contextAggregationInterval.asMilliseconds());if(zoomFrom.isValid()&&zoomTo.isValid&&zoomFrom.isBetween(earliestDataDate,latestDataDate,null,"[]")&&zoomTo.isBetween(earliestDataDate,latestDataDate,null,"[]"))return[zoomFrom.toDate(),zoomTo.toDate()]}return calculateDefaultFocusRange()}function calculateDefaultFocusRange(){$scope.autoZoomDuration=getAutoZoomDuration();var combinedData=void 0===$scope.contextForecastData?$scope.contextChartData:$scope.contextChartData.concat($scope.contextForecastData),earliestDataDate=_lodash2.default.first(combinedData).date,latestDataDate=_lodash2.default.last(combinedData).date,latestMsToLoad=latestDataDate.getTime()+$scope.contextAggregationInterval.asMilliseconds(),earliestMsToLoad=Math.max(earliestDataDate.getTime(),latestMsToLoad-$scope.autoZoomDuration);return[new Date(earliestMsToLoad),new Date(latestMsToLoad)]}function calculateAggregationInterval(bounds,bucketsTarget){var barTarget=void 0!==bucketsTarget?bucketsTarget:100,maxBars=Math.floor(1.1*barTarget),buckets=new TimeBuckets;buckets.setInterval("auto"),buckets.setBounds(bounds),buckets.setBarTarget(Math.floor(barTarget)),buckets.setMaxBars(maxBars);var bucketSpanSeconds=_lodash2.default.find($scope.jobs,{id:$scope.selectedJob.job_id}).bucketSpanSeconds,aggInterval=buckets.getIntervalToNearestMultiple(bucketSpanSeconds);return aggInterval.asSeconds()<bucketSpanSeconds&&(buckets.setInterval(bucketSpanSeconds+"s"),aggInterval=buckets.getInterval()),console.log("calculateAggregationInterval() barTarget,maxBars,returning:",bucketsTarget,maxBars,bounds.max.diff(bounds.min)/aggInterval.asMilliseconds()),aggInterval}function getAutoZoomDuration(){var bucketSpanSeconds=_lodash2.default.find($scope.jobs,{id:$scope.selectedJob.job_id}).bucketSpanSeconds,autoZoomDuration=1e3*bucketSpanSeconds*(CHARTS_POINT_TARGET-1),maxBars=Math.floor(1.1*CHARTS_POINT_TARGET),buckets=new TimeBuckets;buckets.setInterval("auto"),buckets.setBarTarget(Math.floor(CHARTS_POINT_TARGET)),buckets.setMaxBars(maxBars);var nowMs=(new Date).getTime(),max=(0,_moment2.default)(nowMs),min=(0,_moment2.default)(nowMs-autoZoomDuration);buckets.setBounds({min:min,max:max});var calculatedInterval=buckets.getIntervalToNearestMultiple(bucketSpanSeconds),calculatedIntervalSecs=calculatedInterval.asSeconds();return calculatedIntervalSecs!==bucketSpanSeconds&&(autoZoomDuration*=bucketSpanSeconds/calculatedIntervalSecs),autoZoomDuration}$scope.timeFieldName="timestamp",timefilter.enableTimeRangeSelector(),timefilter.enableAutoRefreshSelector();var FORECAST_JOB_MIN_VERSION="6.1.0",CHARTS_POINT_TARGET=500,ANOMALIES_MAX_RESULTS=500,TimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);$scope.jobPickerSelections=[],$scope.selectedJob,$scope.detectors=[],$scope.loading=!0,$scope.loadCounter=0,$scope.hasResults=!1,$scope.anomalyRecords=[],$scope.modelPlotEnabled=!1,$scope.forecastingDisabled=!1,$scope.forecastingDisabledMessage="",$scope.showModelBounds=!0,$scope.showModelBoundsCheckbox=!1,$scope.showForecast=!0,$scope.showForecastCheckbox=!1;var _Private=Private(_check_privilege.permissionCheckProvider),checkPermission=_Private.checkPermission,createPermissionFailureMessage=_Private.createPermissionFailureMessage;$scope.permissions={canForecastJob:checkPermission("canForecastJob")},$scope.createPermissionFailureMessage=createPermissionFailureMessage,$scope.initializeVis=function(){var stateDefaults={mlTimeSeriesExplorer:{}};$scope.appState=new AppState(stateDefaults),$scope.jobs=[],mlJobService.loadJobs().then(function(resp){if(resp.jobs.length>0){$scope.jobs=(0,_timeseriesexplorer_utils.createTimeSeriesJobData)(resp.jobs);var timeSeriesJobIds=$scope.jobs.map(function(j){return j.id}),selectedJobIds=mlJobSelectService.getSelectedJobIds(!0),invalidIds=_lodash2.default.difference(selectedJobIds,timeSeriesJobIds);if(selectedJobIds=_lodash2.default.without.apply(_lodash2.default,[selectedJobIds].concat(_toConsumableArray(invalidIds))),invalidIds.length>0){var s=1===invalidIds.length?"":"s",warningText="Requested job"+s+" "+invalidIds+" cannot be viewed in this dashboard";0===selectedJobIds.length&&timeSeriesJobIds.length>0&&(warningText+=", auto selecting first job"),_notify.notify.warning(warningText,{lifetime:3e4})}selectedJobIds.length>1||mlJobSelectService.groupIds.length?selectedJobIds.length>1?(_notify.notify.warning("Only one job may be viewed at a time in this dashboard",{lifetime:3e4}),mlJobSelectService.setJobIds([selectedJobIds[0]])):selectedJobIds.length>0?(_notify.notify.warning("Only one job may be viewed at a time in this dashboard",{lifetime:3e4}),mlJobSelectService.setJobIds([selectedJobIds[0]])):$scope.jobs.length>0?mlJobSelectService.setJobIds([$scope.jobs[0].id]):$scope.loading=!1:invalidIds.length>0&&selectedJobIds.length>0?mlJobSelectService.setJobIds([selectedJobIds[0]]):selectedJobIds.length>0?loadForJobId(selectedJobIds[0]):0===selectedJobIds.length&&$scope.jobs.length>0?mlJobSelectService.setJobIds([$scope.jobs[0].id]):$scope.loading=!1}else $scope.loading=!1}).catch(function(resp){console.log("Time series explorer - error getting job info from elasticsearch:",resp)})},$scope.refresh=function(){function finish(counterVar){if(0==--awaitingCount&&counterVar===$scope.loadCounter){if($scope.contextChartData&&$scope.contextChartData.length||$scope.contextForecastData&&$scope.contextForecastData.length?$scope.hasResults=!0:$scope.hasResults=!1,$scope.loading=!1,$scope.contextChartData.length){var focusRange=calculateInitialFocusRange();$scope.zoomFrom=focusRange[0],$scope.zoomTo=focusRange[1]}($scope.contextChartData&&$scope.contextChartData.length||$scope.contextForecastData&&$scope.contextForecastData.length)&&$timeout(function(){$scope.$broadcast("render")},0)}}if(void 0!==$scope.selectedJob){$scope.loading=!0,$scope.hasResults=!1,delete $scope.chartDetails,delete $scope.contextChartData,delete $scope.focusChartData,delete $scope.contextForecastData,delete $scope.focusForecastData,$scope.loadCounter++;var awaitingCount=3,bounds=timefilter.getActiveBounds(),detectorIndex=+$scope.detectorId;$scope.modelPlotEnabled=(0,_job_utils.isModelPlotEnabled)($scope.selectedJob,detectorIndex,$scope.entities);var nonBlankEntities=_lodash2.default.filter($scope.entities,function(entity){return entity.fieldValue.length>0});$scope.criteriaFields=[{fieldName:"detector_index",fieldValue:detectorIndex}].concat(nonBlankEntities),$scope.contextAggregationInterval=calculateAggregationInterval(bounds,CHARTS_POINT_TARGET),console.log("aggregationInterval for context data (s):",$scope.contextAggregationInterval.asSeconds());var searchBounds=(0,_ml_time_buckets.getBoundsRoundedToInterval)(bounds,$scope.contextAggregationInterval,!1),counter=$scope.loadCounter;mlTimeSeriesSearchService.getMetricData($scope.selectedJob,detectorIndex,nonBlankEntities,searchBounds.min.valueOf(),searchBounds.max.valueOf(),$scope.contextAggregationInterval.expression).then(function(resp){var fullRangeChartData=(0,_timeseriesexplorer_utils.processMetricPlotResults)(resp.results,$scope.modelPlotEnabled);$scope.contextChartData=fullRangeChartData,console.log("Time series explorer context chart data set:",$scope.contextChartData),finish(counter)}).catch(function(resp){console.log("Time series explorer - error getting metric data from elasticsearch:",resp)}),mlResultsService.getRecordMaxScoreByTime($scope.selectedJob.job_id,$scope.criteriaFields,searchBounds.min.valueOf(),searchBounds.max.valueOf(),$scope.contextAggregationInterval.expression).then(function(resp){var fullRangeRecordScoreData=(0,_timeseriesexplorer_utils.processRecordScoreResults)(resp.results);$scope.swimlaneData=fullRangeRecordScoreData,console.log("Time series explorer swimlane anomalies data set:",$scope.swimlaneData),finish(counter)}).catch(function(resp){console.log("Time series explorer - error getting bucket anomaly scores from elasticsearch:",resp)}),mlTimeSeriesSearchService.getChartDetails($scope.selectedJob,detectorIndex,$scope.entities,searchBounds.min.valueOf(),searchBounds.max.valueOf()).then(function(resp){$scope.chartDetails=resp.results,finish(counter)}).catch(function(resp){console.log("Time series explorer - error getting entity counts from elasticsearch:",resp)});var forecastId=_lodash2.default.get($scope,"appState.mlTimeSeriesExplorer.forecastId");if(void 0!==forecastId){awaitingCount++;var aggType=void 0,detector=$scope.selectedJob.analysis_config.detectors[detectorIndex],esAgg=(0,_job_utils.mlFunctionToESAggregation)(detector.function);!1!==$scope.modelPlotEnabled||"sum"!==esAgg&&"count"!==esAgg||(aggType={avg:"sum",max:"sum",min:"sum"}),mlForecastService.getForecastData($scope.selectedJob,detectorIndex,forecastId,nonBlankEntities,searchBounds.min.valueOf(),searchBounds.max.valueOf(),$scope.contextAggregationInterval.expression,aggType).then(function(resp){$scope.contextForecastData=(0,_timeseriesexplorer_utils.processForecastResults)(resp.results),finish(counter)}).catch(function(resp){console.log("Time series explorer - error loading data for forecast ID "+forecastId,resp)})}loadEntityValues()}},$scope.refreshFocusData=function(fromDate,toDate){function finish(){0==--awaitingCount&&(refreshFocusData.focusChartData=(0,_timeseriesexplorer_utils.processDataForFocusAnomalies)(refreshFocusData.focusChartData,refreshFocusData.anomalyRecords,$scope.timeFieldName),refreshFocusData.focusChartData=(0,_timeseriesexplorer_utils.processScheduledEventsForChart)(refreshFocusData.focusChartData,refreshFocusData.scheduledEvents),$scope.$evalAsync(function(){$scope=Object.assign($scope,refreshFocusData),console.log("Time series explorer focus chart data set:",$scope.focusChartData),$scope.loading=!1}))}var awaitingCount=3,refreshFocusData={},detectorIndex=+$scope.detectorId,nonBlankEntities=_lodash2.default.filter($scope.entities,function(entity){return entity.fieldValue.length>0}),bounds={min:(0,_moment2.default)(fromDate),max:(0,_moment2.default)(toDate)};$scope.focusAggregationInterval=calculateAggregationInterval(bounds,CHARTS_POINT_TARGET);var searchBounds=(0,_ml_time_buckets.getBoundsRoundedToInterval)(bounds,$scope.focusAggregationInterval,!1);mlTimeSeriesSearchService.getMetricData($scope.selectedJob,detectorIndex,nonBlankEntities,searchBounds.min.valueOf(),searchBounds.max.valueOf(),$scope.focusAggregationInterval.expression).then(function(resp){refreshFocusData.focusChartData=(0,_timeseriesexplorer_utils.processMetricPlotResults)(resp.results,$scope.modelPlotEnabled),$scope.showModelBoundsCheckbox=!0===$scope.modelPlotEnabled&&refreshFocusData.focusChartData.length>0,finish()}).catch(function(resp){console.log("Time series explorer - error getting metric data from elasticsearch:",resp)}),mlResultsService.getRecordsForCriteria([$scope.selectedJob.job_id],$scope.criteriaFields,0,searchBounds.min.valueOf(),searchBounds.max.valueOf(),ANOMALIES_MAX_RESULTS).then(function(resp){refreshFocusData.anomalyRecords=_lodash2.default.chain(resp.records).sortBy(function(record){return record[$scope.timeFieldName]}).reverse().value(),console.log("Time series explorer anomalies:",refreshFocusData.anomalyRecords),finish()}),mlResultsService.getScheduledEventsByBucket([$scope.selectedJob.job_id],searchBounds.min.valueOf(),searchBounds.max.valueOf(),$scope.focusAggregationInterval.expression,1,10).then(function(resp){refreshFocusData.scheduledEvents=resp.events[$scope.selectedJob.job_id],finish()}).catch(function(resp){console.log("Time series explorer - error getting scheduled events from elasticsearch:",resp)});var forecastId=_lodash2.default.get($scope,"appState.mlTimeSeriesExplorer.forecastId");if(void 0!==forecastId){awaitingCount++;var aggType=void 0,detector=$scope.selectedJob.analysis_config.detectors[detectorIndex],esAgg=(0,_job_utils.mlFunctionToESAggregation)(detector.function);!1!==$scope.modelPlotEnabled||"sum"!==esAgg&&"count"!==esAgg||(aggType={avg:"sum",max:"sum",min:"sum"}),mlForecastService.getForecastData($scope.selectedJob,detectorIndex,forecastId,nonBlankEntities,searchBounds.min.valueOf(),searchBounds.max.valueOf(),$scope.focusAggregationInterval.expression,aggType).then(function(resp){refreshFocusData.focusForecastData=(0,_timeseriesexplorer_utils.processForecastResults)(resp.results),refreshFocusData.showForecastCheckbox=refreshFocusData.focusForecastData.length>0,finish()}).catch(function(resp){console.log("Time series explorer - error loading data for forecast ID "+forecastId,resp)})}},$scope.saveSeriesPropertiesAndRefresh=function(){$scope.appState.mlTimeSeriesExplorer.detectorIndex=+$scope.detectorId,$scope.appState.mlTimeSeriesExplorer.entities={},_lodash2.default.each($scope.entities,function(entity){$scope.appState.mlTimeSeriesExplorer.entities[entity.fieldName]=entity.fieldValue}),$scope.appState.save(),$scope.refresh()},$scope.loadForForecastId=function(forecastId){mlForecastService.getForecastDateRange($scope.selectedJob,forecastId).then(function(resp){var bounds=timefilter.getActiveBounds(),earliest=(0,_moment2.default)(resp.earliest||timefilter.time.from),latest=(0,_moment2.default)(resp.latest||timefilter.time.to);$scope.appState.mlTimeSeriesExplorer.forecastId=forecastId;var earliestDataDate=_lodash2.default.first($scope.contextChartData).date,zoomLatestMs=resp.latest,zoomEarliestMs=Math.max(earliestDataDate.getTime(),zoomLatestMs-$scope.autoZoomDuration),zoomState={from:(0,_moment2.default)(zoomEarliestMs).toISOString(),to:(0,_moment2.default)(zoomLatestMs).toISOString()};if($scope.appState.mlTimeSeriesExplorer.zoom=zoomState,$scope.appState.save(),$scope.showForecast=!0,earliest.isBefore(bounds.min)||latest.isAfter(bounds.max)){var earliestMs=Math.min(earliest.valueOf(),bounds.min.valueOf()),latestMs=Math.max(latest.valueOf(),bounds.max.valueOf());timefilter.time.from=(0,_moment2.default)(earliestMs).toISOString(),timefilter.time.to=(0,_moment2.default)(latestMs).toISOString()}else $scope.refresh()}).catch(function(resp){console.log("Time series explorer - error loading time range of forecast from elasticsearch:",resp)})},$scope.openForecastDialog=function(){var bounds=timefilter.getActiveBounds();$modal.open({template:_forecasting_modal2.default,controller:"MlForecastingModal",backdrop:"static",size:"lg",keyboard:!1,resolve:{params:function(){return{pscope:$scope,job:$scope.selectedJob,entities:$scope.chartDetails.entityData.entities,earliest:bounds.min.valueOf(),mlNodesAvailable:(0,_check_ml_nodes.mlNodesAvailable)()}}}})},$scope.detectorIndexChanged=function(){updateControlsForDetector(),loadEntityValues()},$scope.toggleShowModelBounds=function(){$timeout(function(){$scope.showModelBounds=!$scope.showModelBounds},0)},$scope.toggleShowForecast=function(){$timeout(function(){$scope.showForecast=!$scope.showForecast},0)},$scope.$listen(timefilter,"fetch",$scope.refresh);var refreshWatcher=Private(_refresh_interval_watcher.refreshIntervalWatcher);refreshWatcher.init(function(){$scope.refresh()});var filterChangeListener=function(field,value,operator){var entity=_lodash2.default.find($scope.entities,{fieldName:field});void 0!==entity&&("+"===operator&&entity.fieldValue!==value?(entity.fieldValue=value,$scope.saveSeriesPropertiesAndRefresh()):"-"===operator&&entity.fieldValue===value&&(entity.fieldValue="",$scope.saveSeriesPropertiesAndRefresh()))};mlAnomaliesTableService.filterChange.watch(filterChangeListener),$scope.$on("$destroy",function(){refreshWatcher.cancel(),mlAnomaliesTableService.filterChange.unwatch(filterChangeListener)}),mlJobSelectService.listenJobSelectionChange($scope,function(event,selections){selections.length>0&&(delete $scope.appState.mlTimeSeriesExplorer.detectorIndex,delete $scope.appState.mlTimeSeriesExplorer.entities,delete $scope.appState.mlTimeSeriesExplorer.forecastId,$scope.appState.save(),$scope.showForecastCheckbox=!1,loadForJobId(selections[0]))}),$scope.$on("contextChartSelected",function(event,selection){if(void 0!==$scope.contextChartData&&0!==$scope.contextChartData.length||void 0!==$scope.contextForecastData&&0!==$scope.contextForecastData.length){var defaultRange=calculateDefaultFocusRange();if(selection.from.getTime()===defaultRange[0].getTime()&&selection.to.getTime()===defaultRange[1].getTime()||!1!==isNaN(Date.parse(selection.from))||!1!==isNaN(Date.parse(selection.to)))delete $scope.appState.mlTimeSeriesExplorer.zoom;else{var zoomState={from:selection.from.toISOString(),to:selection.to.toISOString()};$scope.appState.mlTimeSeriesExplorer.zoom=zoomState}$scope.appState.save(),void 0!==$scope.focusChartData&&$scope.zoomFrom.getTime()===selection.from.getTime()&&$scope.zoomTo.getTime()===selection.to.getTime()||$scope.refreshFocusData(selection.from,selection.to),$scope.zoomFrom=selection.from,$scope.zoomTo=selection.to}}),$scope.initializeVis()})},3541:function(module,exports){module.exports='<ml-nav-menu name="timeseriesexplorer"></ml-nav-menu>\n<ml-chart-tooltip></ml-chart-tooltip>\n<div class="ml-time-series-explorer" ng-controller="MlTimeSeriesExplorerController">\n  <navbar ng-show="jobs.length > 0 && chrome.getVisible()">\n    <job-select-button\n      timeseriesonly="true"\n      single-selection="true">\n    </job-select-button>\n  </navbar>\n\n  <div class="no-results-container" ng-if="jobs.length === 0 && loading === false">\n    <div class="no-results">\n      <div><i class="fa fa-exclamation-triangle"></i>No single metric jobs found</div>\n      <div><a href="ml#/jobs">Create new single metric job</a></div>\n    </div>\n  </div>\n\n  <div class="series-controls" ng-show="jobs.length > 0">\n    <label for="selectDetector" class="kuiLabel">Detector:</label>\n    <select id="selectDetector" class="kuiSelect kuiSelect--large" ng-model="detectorId" ng-change="detectorIndexChanged()">\n      <option ng-repeat="detector in detectors track by detector.index" value="{{detector.index}}">{{detector.detector_description}}</option>\n    </select>\n\n    <div class="entity-controls" ng-repeat="entity in entities">\n      <datalist id="{{entity.fieldName}}_datalist">\n        <option ng-repeat="value in entity.fieldValues">{{value}}</option>\n      </datalist>\n\n      <label for="select{{entity.fieldName}}" class="kuiLabel">{{entity.fieldName}}:</label>\n      <input id="select{{entity.fieldName}}" class="kuiTextInput entity-input"\n        ng-class="{ \'entity-input-blank\': entity.fieldValue.length === 0 }"\n        ng-model="entity.fieldValue" ng-model-options="{ updateOn: \'blur\' }" placeholder="Enter value"\n        list=\'{{entity.fieldName}}_datalist\' />\n    </div>\n\n    <button class="kuiButton kuiButton--primary" ng-click="saveSeriesPropertiesAndRefresh()" aria-label="refresh">\n      <i class="fa fa-play" ></i>\n    </button>\n\n    <div ng-class="forecastingDisabled === false ? \'forecast-controls\' : [\'forecast-controls\', \'disabled\']"\n      data-toggle="tooltip"\n      ng-attr-tooltip="{{forecastingDisabled === true ?  forecastingDisabledMessage : undefined}}"\n      tooltip-placement="left">\n      <button\n        ng-click=\'openForecastDialog()\'\n        ng-disabled="forecastingDisabled === true"\n        class="kuiButton kuiButton--primary"\n        aria-label="Forecast">\n        Forecast\n      </button>\n    </div>\n\n  </div>\n\n  <ml-loading-indicator\n    label="Loading"\n    is-loading="loading === true"\n  />\n\n  <div class="no-results-container" ng-show="jobs.length > 0 && loading === false && hasResults === false">\n    <div class="no-results">\n      <div><i class="fa fa-info-circle" ></i>No results found</div>\n      <div>Try widening the time selection or moving further back in time</div>\n    </div>\n  </div>\n\n  <div ng-show="jobs.length > 0 && loading === false && hasResults === true">\n    <div class="results-container">\n\n      <span class="panel-title euiText">\n        Single time series analysis of {{chartDetails.functionLabel}}\n      </span>\n      <span ng-if="chartDetails.entityData.count === 1" class="entity-count-text">\n        <span ng-repeat="entity in chartDetails.entityData.entities">\n          {{$first ? \'(\' : \'\'}}{{entity.fieldName}}: {{entity.fieldValue}}{{$last ? \')\' : \', \'}}\n        </span>\n      </span>\n      <span ng-if="chartDetails.entityData.count !== 1" class="entity-count-text">\n        <span ng-repeat="countData in chartDetails.entityData.entities">\n          {{$first ? \'(\' : \'\'}}{{countData.cardinality}} distinct {{countData.fieldName}}{{countData.cardinality > 1 ? \' values\' : \'\'}}{{$last ? \')\' : \', \'}}\n        </span>\n      </span>\n\n      <div class="show-model-controls">\n        <div ng-show="showModelBoundsCheckbox === true">\n          <input id="toggleShowModelBoundsCheckbox"\n            type="checkbox"\n            class="kuiCheckBox"\n            ng-click="toggleShowModelBounds()"\n            ng-checked="showModelBounds === true">\n          <label for="toggleShowModelBoundsCheckbox" class="kuiCheckBoxLabel">show model bounds</label>\n        </div>\n\n        <div ng-show="showForecastCheckbox === true">\n          <input id="toggleShowForecaseCheckbox"\n            type="checkbox"\n            class="kuiCheckBox"\n            ng-click="toggleShowForecast()"\n            ng-checked="showForecast === true">\n          <label for="toggleShowForecaseCheckbox" class="kuiCheckBoxLabel">show forecast</label>\n        </div>\n      </div>\n\n      <div class="ml-timeseries-chart">\n\n        <ml-timeseries-chart  style="width: 1200px; height: 400px;"\n          selected-job="selectedJob"\n          detector-index="detectorId"\n          model-plot-enabled="modelPlotEnabled"\n          context-chart-data="contextChartData"\n          context-forecast-data="contextForecastData"\n          context-aggregation-interval="contextAggregationInterval"\n          swimlane-data="swimlaneData"\n          focus-chart-data="focusChartData"\n          focus-forecast-data="focusForecastData"\n          focus-aggregation-interval="focusAggregationInterval"\n          show-model-bounds="showModelBounds"\n          show-forecast="showForecast"\n          zoom-from="zoomFrom"\n          zoom-to="zoomTo"\n          auto-zoom-duration="autoZoomDuration">\n        </ml-timeseries-chart>\n      </div>\n\n      <span class="panel-title euiText">\n        Anomalies\n      </span>\n\n      <div class="ml-table-controls">\n        <ml-select-severity />\n        <ml-select-interval />\n      </div>\n\n      <ml-anomalies-table\n        anomaly-records="anomalyRecords"\n        time-field-name="timeFieldName"\n        filtering-enabled="true">\n      </ml-anomalies-table>\n\n    </div>\n  </div>\n\n</div>\n'},3542:function(module,exports){module.exports='<div class="forecasting-modal euiModal">\n  <ml-message-bar ></ml-message-bar>\n  <div class="euiModalHeader">\n    <div class="euiModalHeader__title">Forecasting</div>\n  </div>\n\n  <div class="euiModalBody euiText">\n    <div ng-if="previousForecasts.length > 0">\n      <h3 aria-describedby="ml_aria_description_forecasting_modal_view_list" class="view-forecast-title">View a previous forecast</h3><i ml-info-icon="forecasting_modal_view_list" />\n\n      <div class="previous-forecast-list">\n        <table class="euiTable euiTable--compressed">\n          <thead>\n            <tr>\n              <th class="euiTableHeaderCell" scope="col">\n                <div class="euiTableCellContent">Created</div>\n              </th>\n              <th class="euiTableHeaderCell" scope="col">\n                <div class="euiTableCellContent">From</div>\n              </th>\n              <th class="euiTableHeaderCell" scope="col">\n                <div class="euiTableCellContent">To</div>\n              </th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr ng-repeat="forecast in previousForecasts" class="euiTableRow">\n              <td class="euiTableRowCell">\n                <div class="euiTableCellContent">\n                  <span class="euiTableCellContent__text">\n                    <a class="euiLink" href="" ng-click="viewForecast(forecast.forecast_id)">{{forecast.runTime}}</a>\n                  </span>\n                </div>\n              </td>\n              <td class="euiTableRowCell">\n                <div class="euiTableCellContent">\n                  <span class="euiTableCellContent__text">{{forecast.earliestTime}}</span>\n                </div>\n              </td>\n              <td class="euiTableRowCell">\n                <div class="euiTableCellContent">\n                  <span class="euiTableCellContent__text">{{forecast.latestTime}}</span>\n                </div>\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    </div>\n\n    <h3>Run a new forecast</h3>\n    <div ng-show="showNumPartitionsWarning" class="warning-text">\n      Note that this data contains more than {{partitionsWarningNumber}} partitions\n      so running a forecast may take a long time and consume a high amount of resource.\n    </div>\n    <div class="form-group">\n      <label id="ml_aria_label_forecasting_modal_run_duration" for="forecastDuration" class="kuiLabel">Duration</label><i ml-info-icon="forecasting_modal_run_duration" />\n      <div ng-class="permissions.canForecastJob && invalidJobState === undefined ? \'control-wrapper\' : [\'control-wrapper\', \'disabled\']"\n        data-toggle="tooltip"\n        ng-attr-tooltip="{{permissions.canForecastJob === false ? createPermissionFailureMessage(\'canForecastJob\') :\n          invalidJobState !== undefined ? \'Forecasts cannot be run on \' + invalidJobState + \' jobs\' : undefined}}"\n        tooltip-placement="bottom">\n        <input\n          id="forecastDuration"\n          aria-labelledby="ml_aria_label_forecasting_modal_run_duration"\n          aria-describedby="ml_aria_description_forecasting_modal_run_duration"\n          ng-model="newForecastDuration"\n          ng-change="newForecastDurationChange()"\n          ng-disabled="isForecastRunning === true || permissions.canForecastJob === false || invalidJobState !== undefined || mlNodesAvailable === false"\n          required\n          type="text"\n          class="form-control" />\n      </div>\n      <div ng-class="permissions.canForecastJob && invalidJobState === undefined ? \'control-wrapper\' : [\'control-wrapper\', \'disabled\']"\n        data-toggle="tooltip"\n        ng-attr-tooltip="{{permissions.canForecastJob === false ? createPermissionFailureMessage(\'canForecastJob\') :\n          invalidJobState !== undefined ? \'Forecasts cannot be run on \' + invalidJobState + \' jobs\' : undefined}}"\n        tooltip-placement="left">\n        <button\n          class="kuiButton kuiButton--primary run-button"\n          ng-click="checkJobStateAndRunForecast()"\n          ng-disabled="newForecastDurationError !== null || isForecastRunning === true ||\n            permissions.canForecastJob === false || invalidJobState !== undefined || mlNodesAvailable === false" >\n          <i ng-if="isForecastRunning === false" class="fa fa-play" ></i>\n          <i ng-if="isForecastRunning === true" class="fa fa-spinner fa-spin" ></i>\n        </button>\n      </div>\n      <div ng-show="newForecastDurationError !== null" class="validation-error">{{newForecastDurationError}}</div>\n\n      <div ng-show="runStatus.forecastRequested === true" class="status-item-list">\n        <div class="status-item" ng-show="runStatus.jobOpening !== undefined">Opening job...\n          <i ng-show="runStatus.jobOpening === REQUEST_STATES.ERROR" aria-hidden="true" style="color:red;" class="fa fa-remove"></i>\n          <i ng-show="runStatus.jobOpening === REQUEST_STATES.WAITING" aria-hidden="true" class="fa fa-spinner fa-spin"></i>\n          <i ng-show="runStatus.jobOpening === REQUEST_STATES.DONE" aria-hidden="true" style="color:green;" class="fa fa-check"></i>\n        </div>\n\n        <div class="status-item" ng-show="runStatus.forecastProgress !== undefined">Running forecast...\n          <progressbar\n              ng-show="runStatus.forecastProgress >= 0"\n              ng-class="runStatus.forecastProgress < 3 ? \'empty-progress\' : \'\'"\n              animate="false"\n              value="runStatus.forecastProgress"\n              type="success">\n            <b>{{runStatus.forecastProgress}}%</b>\n          </progressbar>\n          <i ng-show="runStatus.forecastProgress === REQUEST_STATES.ERROR" aria-hidden="true" style="color:red;" class="fa fa-remove"></i>\n        </div>\n\n        <div class="status-item" ng-show="runStatus.jobClosing !== undefined">Closing job...\n          <i ng-show="runStatus.jobClosing === REQUEST_STATES.ERROR" aria-hidden="true" style="color:red;" class="fa fa-remove"></i>\n          <i ng-show="runStatus.jobClosing === REQUEST_STATES.WAITING" aria-hidden="true" class="fa fa-spinner fa-spin"></i>\n          <i ng-show="runStatus.jobClosing === REQUEST_STATES.DONE" aria-hidden="true" style="color:green;" class="fa fa-check"></i>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="euiModalFooter">\n    <button\n      ng-click="close()"\n      class="euiButton euiButton--primary euiButton--small euiButton--fill"\n      type="button">\n      <span class="euiButton__content">Close</span>\n    </button>\n  </div>\n</div>\n'},3543:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1),_lodash2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_lodash),_fields_service=__webpack_require__(481),_job_utils=__webpack_require__(57),_chart_config_builder=__webpack_require__(1190);__webpack_require__(2).uiModules.get("apps/ml").service("mlTimeSeriesSearchService",function($q,$timeout,Private,es,mlResultsService){this.getMetricData=function(job,detectorIndex,entityFields,earliestMs,latestMs,interval){if((0,_job_utils.isModelPlotEnabled)(job,detectorIndex,entityFields)){var criteriaFields=[],detector=job.analysis_config.detectors[detectorIndex];if(_lodash2.default.has(detector,"partition_field_name")){var partitionEntity=_lodash2.default.find(entityFields,{fieldName:detector.partition_field_name});void 0!==partitionEntity&&criteriaFields.push({fieldName:"partition_field_name",fieldValue:partitionEntity.fieldName},{fieldName:"partition_field_value",fieldValue:partitionEntity.fieldValue})}if(_lodash2.default.has(detector,"over_field_name")){var overEntity=_lodash2.default.find(entityFields,{fieldName:detector.over_field_name});void 0!==overEntity&&criteriaFields.push({fieldName:"over_field_name",fieldValue:overEntity.fieldName},{fieldName:"over_field_value",fieldValue:overEntity.fieldValue})}if(_lodash2.default.has(detector,"by_field_name")){var byEntity=_lodash2.default.find(entityFields,{fieldName:detector.by_field_name});void 0!==byEntity&&criteriaFields.push({fieldName:"by_field_name",fieldValue:byEntity.fieldName},{fieldName:"by_field_value",fieldValue:byEntity.fieldValue})}return mlResultsService.getModelPlotOutput(job.job_id,detectorIndex,criteriaFields,earliestMs,latestMs,interval)}var deferred=$q.defer(),obj={success:!0,results:{}},chartConfig=(0,_chart_config_builder.buildConfigFromDetector)(job,detectorIndex);return mlResultsService.getMetricData(chartConfig.datafeedConfig.indices,chartConfig.datafeedConfig.types,entityFields,chartConfig.datafeedConfig.query,chartConfig.metricFunction,chartConfig.metricFieldName,chartConfig.timeField,earliestMs,latestMs,interval).then(function(resp){_lodash2.default.each(resp.results,function(value,time){obj.results[time]={actual:value}}),deferred.resolve(obj)}).catch(function(resp){deferred.reject(resp)}),deferred.promise},this.getChartDetails=function(job,detectorIndex,entityFields,earliestMs,latestMs){var deferred=$q.defer(),obj={success:!0,results:{functionLabel:"",entityData:{entities:[]}}},chartConfig=(0,_chart_config_builder.buildConfigFromDetector)(job,detectorIndex),functionLabel=chartConfig.metricFunction;void 0!==chartConfig.metricFieldName&&(functionLabel+=" ",functionLabel+=chartConfig.metricFieldName),obj.results.functionLabel=functionLabel;var blankEntityFields=_lodash2.default.filter(entityFields,function(entity){return 0===entity.fieldValue.length});if(0===blankEntityFields.length)obj.results.entityData.count=1,obj.results.entityData.entities=entityFields,deferred.resolve(obj);else{var entityFieldNames=_lodash2.default.map(blankEntityFields,"fieldName");Private(_fields_service.FieldsServiceProvider).getCardinalityOfFields(chartConfig.datafeedConfig.indices,chartConfig.datafeedConfig.types,entityFieldNames,chartConfig.datafeedConfig.query,chartConfig.timeField,earliestMs,latestMs).then(function(results){_lodash2.default.each(blankEntityFields,function(field){obj.results.entityData.entities.push({fieldName:field.fieldName,cardinality:_lodash2.default.get(results,field.fieldName,0)})}),deferred.resolve(obj)}).catch(function(resp){deferred.reject(resp)})}return deferred.promise}})},3544:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_jquery=__webpack_require__(12),_jquery2=_interopRequireDefault(_jquery),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular),_d=__webpack_require__(15),_d2=_interopRequireDefault(_d),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment);__webpack_require__(181);var _resize_checker=__webpack_require__(485),_anomaly_utils=__webpack_require__(260),_chart_utils=__webpack_require__(133),_time_buckets=__webpack_require__(168),_context_chart_mask=__webpack_require__(3547),_context_chart_mask2=_interopRequireDefault(_context_chart_mask),_timeseriesexplorer_utils=__webpack_require__(1191);__webpack_require__(484);var _string_utils=__webpack_require__(43);__webpack_require__(2).uiModules.get("apps/ml").directive("mlTimeseriesChart",function($compile,$timeout,Private,timefilter,mlAnomaliesTableService,mlFieldFormatService,formatValueFilter,mlChartTooltipService){function link(scope,element){function render(){var chartElement=_d2.default.select(element.get(0));if(chartElement.selectAll("*").remove(),void 0!==scope.contextChartData){svgWidth=Math.max(_angular2.default.element(".results-container").width(),0);var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight),contextDataMin=void 0,contextDataMax=void 0;if(!0===scope.modelPlotEnabled||void 0!==scope.contextForecastData&&scope.contextForecastData.length>0){var combinedData=void 0===scope.contextForecastData?scope.contextChartData:scope.contextChartData.concat(scope.contextForecastData);contextDataMin=_d2.default.min(combinedData,function(d){return Math.min(d.value,d.lower)}),contextDataMax=_d2.default.max(combinedData,function(d){return Math.max(d.value,d.upper)})}else contextDataMin=_d2.default.min(scope.contextChartData,function(d){return d.value}),contextDataMax=_d2.default.max(scope.contextChartData,function(d){return d.value});var ceiledMax=contextDataMax>0?Math.pow(10,Math.ceil(Math.log10(Math.abs(contextDataMax)))):contextDataMax,flooredMin=contextDataMin>=0?contextDataMin:-1*Math.pow(10,Math.ceil(Math.log10(Math.abs(contextDataMin))));focusYScale.domain([flooredMin,ceiledMax]);var maxYAxisLabelWidth=0;svg.append("g").attr("class","temp-axis-label tick").selectAll("text.temp.axis").data(focusYScale.ticks()).enter().append("text").text(function(d){return void 0!==fieldFormat?fieldFormat.convert(d,"text"):focusYScale.tickFormat()(d)}).each(function(){maxYAxisLabelWidth=Math.max(this.getBBox().width+focusYAxis.tickPadding(),maxYAxisLabelWidth)}).remove(),_d2.default.select(".temp-axis-label").remove(),margin.left=Math.max(maxYAxisLabelWidth,40),vizWidth=Math.max(svgWidth-margin.left-margin.right,0),focusXScale.range([0,vizWidth]),focusYAxis.innerTickSize(-vizWidth);var focus=svg.append("g").attr("class","focus-chart").attr("transform","translate("+margin.left+","+margin.top+")"),context=svg.append("g").attr("class","context-chart").attr("transform","translate("+margin.left+","+(focusHeight+margin.top+chartSpacing)+")");createFocusChart(focus,vizWidth,focusHeight),drawContextElements(context,vizWidth,contextChartHeight,swimlaneHeight)}}function drawContextChartSelection(){if(void 0!==scope.contextChartData){var focusLoadFrom=void 0,focusLoadTo=void 0,contextXMin=contextXScale.domain()[0].getTime(),contextXMax=contextXScale.domain()[1].getTime(),combinedData=scope.contextChartData;if(void 0!==scope.contextForecastData&&(combinedData=combinedData.concat(scope.contextForecastData)),focusLoadFrom=scope.zoomFrom?scope.zoomFrom.getTime():_lodash2.default.reduce(combinedData,function(memo,point){return Math.min(memo,point.date.getTime())},new Date(2099,12,31).getTime()),focusLoadFrom=Math.max(focusLoadFrom,contextXMin),focusLoadTo=scope.zoomTo?scope.zoomTo.getTime():_lodash2.default.reduce(combinedData,function(memo,point){return Math.max(memo,point.date.getTime())},0),focusLoadTo=Math.min(focusLoadTo,contextXMax),focusLoadFrom!==contextXMin||focusLoadTo!==contextXMax)setContextBrushExtent(new Date(focusLoadFrom),new Date(focusLoadTo),!0);else{setBrushVisibility(!1);var selectedBounds=contextXScale.domain();scope.selectedBounds={min:(0,_moment2.default)(new Date(selectedBounds[0])),max:(0,_moment2.default)(selectedBounds[1])},scope.$root.$broadcast("contextChartSelected",{from:selectedBounds[0],to:selectedBounds[1]})}}}function createFocusChart(fcsGroup,fcsWidth,fcsHeight){var zoomGroup=fcsGroup.append("g").attr("class","focus-zoom");zoomGroup.append("rect").attr("x",0).attr("y",0).attr("width",fcsWidth).attr("height",focusZoomPanelHeight).attr("class","chart-border"),createZoomInfoElements(zoomGroup,fcsWidth),fcsGroup.append("rect").attr("x",0).attr("y",focusZoomPanelHeight).attr("width",fcsWidth).attr("height",focusChartHeight).attr("class","chart-border");var xAxisBg=fcsGroup.append("g").attr("class","x-axis-background");xAxisBg.append("rect").attr("x",0).attr("y",fcsHeight).attr("width",fcsWidth).attr("height",chartSpacing),xAxisBg.append("line").attr("x1",0).attr("y1",fcsHeight).attr("x2",0).attr("y2",fcsHeight+chartSpacing),xAxisBg.append("line").attr("x1",fcsWidth).attr("y1",fcsHeight).attr("x2",fcsWidth).attr("y2",fcsHeight+chartSpacing),xAxisBg.append("line").attr("x1",0).attr("y1",fcsHeight+chartSpacing).attr("x2",fcsWidth).attr("y2",fcsHeight+chartSpacing);var axes=fcsGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0,"+fcsHeight+")"),axes.append("g").attr("class","y axis"),fcsGroup.append("path").attr("class","area bounds"),fcsGroup.append("path").attr("class","values-line"),fcsGroup.append("g").attr("class","focus-chart-markers"),scope.contextForecastData&&(fcsGroup.append("path").attr("class","area forecast"),fcsGroup.append("path").attr("class","values-line forecast"),fcsGroup.append("g").attr("class","focus-chart-markers forecast")),fcsGroup.append("rect").attr("x",0).attr("y",0).attr("width",fcsWidth).attr("height",fcsHeight+24).attr("class","chart-border chart-border-highlight")}function renderFocusChart(){if(void 0!==scope.focusChartData){var data=scope.focusChartData,focusChart=_d2.default.select(".focus-chart"),focusAggInt=scope.focusAggregationInterval.expression,bucketSpan=scope.selectedJob.analysis_config.bucket_span;_angular2.default.element(".zoom-aggregation-interval").text("(aggregation interval: "+focusAggInt+", bucket span: "+bucketSpan+")");var bounds=scope.selectedBounds,aggMs=scope.focusAggregationInterval.asMilliseconds(),earliest=(0,_moment2.default)(Math.floor(bounds.min.valueOf()/aggMs)*aggMs),latest=(0,_moment2.default)(Math.ceil(bounds.max.valueOf()/aggMs)*aggMs);if(focusXScale.domain([earliest.toDate(),latest.toDate()]),scope.focusChartData.length>0||void 0!==scope.focusForecastData&&scope.focusForecastData.length>0){void 0!==fieldFormat?focusYAxis.tickFormat(function(d){return fieldFormat.convert(d,"text")}):focusYAxis.tickFormat(null);var yMin=0,yMax=0,combinedData=data;void 0!==scope.focusForecastData&&scope.focusForecastData.length>0&&(combinedData=data.concat(scope.focusForecastData)),yMin=_d2.default.min(combinedData,function(d){return void 0!==d.lower?Math.min(d.value,d.lower):d.value}),yMax=_d2.default.max(combinedData,function(d){return void 0!==d.upper?Math.max(d.value,d.upper):d.value}),yMax===yMin&&(contextYScale.domain()[0]!==contextYScale.domain()[1]&&yMin>=contextYScale.domain()[0]&&yMax<=contextYScale.domain()[1]?(yMin=contextYScale.domain()[0],yMax=contextYScale.domain()[1]):(yMin-=.05*yMin,yMax+=.05*yMax)),focusYScale.domain([yMin,yMax])}else focusYScale.domain([0,10]),focusYAxis.tickFormat("");var timeBuckets=new TimeBuckets;timeBuckets.setInterval("auto"),timeBuckets.setBounds(bounds);var xAxisTickFormat=timeBuckets.getScaledDateFormat();focusChart.select(".x.axis").call(focusXAxis.ticks((0,_chart_utils.numTicksForDateFormat)(vizWidth),xAxisTickFormat).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)})),focusChart.select(".y.axis").call(focusYAxis),(0,_chart_utils.filterAxisLabels)(focusChart.select(".x.axis"),vizWidth),!0===scope.modelPlotEnabled&&focusChart.select(".area.bounds").attr("d",focusBoundedArea(data)).classed("hidden",!scope.showModelBounds),focusChart.select(".values-line").attr("d",focusValuesLine(data)),(0,_chart_utils.drawLineChartDots)(data,focusChart,focusValuesLine);var dots=_d2.default.select(".focus-chart-markers").selectAll(".metric-value").data(data.filter(function(d){return null!==d.value}));dots.exit().remove(),dots.enter().append("circle").attr("r",FOCUS_CHART_ANOMALY_RADIUS).on("mouseover",function(d){showFocusChartTooltip(d,this)}).on("mouseout",function(){return mlChartTooltipService.hide()}),dots.attr("cx",function(d){return focusXScale(d.date)}).attr("cy",function(d){return focusYScale(d.value)}).attr("class",function(d){var markerClass="metric-value";return _lodash2.default.has(d,"anomalyScore")&&(markerClass+=" anomaly-marker ",markerClass+=(0,_anomaly_utils.getSeverityWithLow)(d.anomalyScore)),markerClass});var scheduledEventMarkers=_d2.default.select(".focus-chart-markers").selectAll(".scheduled-event-marker").data(data.filter(function(d){return void 0!==d.scheduledEvents}));if(scheduledEventMarkers.exit().remove(),scheduledEventMarkers.enter().append("rect").attr("width",2*FOCUS_CHART_ANOMALY_RADIUS).attr("height",SCHEDULED_EVENT_MARKER_HEIGHT).attr("class","scheduled-event-marker").attr("rx",1).attr("ry",1),scheduledEventMarkers.attr("x",function(d){return focusXScale(d.date)-FOCUS_CHART_ANOMALY_RADIUS}).attr("y",function(d){return focusYScale(d.value)-3}),void 0!==scope.focusForecastData){focusChart.select(".area.forecast").attr("d",focusBoundedArea(scope.focusForecastData)).classed("hidden",!scope.showForecast),focusChart.select(".values-line.forecast").attr("d",focusValuesLine(scope.focusForecastData)).classed("hidden",!scope.showForecast);var forecastDots=_d2.default.select(".focus-chart-markers.forecast").selectAll(".metric-value").data(scope.focusForecastData);forecastDots.exit().remove(),forecastDots.enter().append("circle").attr("r",FOCUS_CHART_ANOMALY_RADIUS).on("mouseover",function(d){showFocusChartTooltip(d,this)}).on("mouseout",function(){return mlChartTooltipService.hide()}),forecastDots.attr("cx",function(d){return focusXScale(d.date)}).attr("cy",function(d){return focusYScale(d.value)}).attr("class","metric-value").classed("hidden",!scope.showForecast)}}}function createZoomInfoElements(zoomGroup,fcsWidth){var bounds=timefilter.getActiveBounds(),boundsSecs=bounds.max.unix()-bounds.min.unix(),minSecs=10/vizWidth*boundsSecs,xPos=10,zoomLabel=zoomGroup.append("text").attr("x",xPos).attr("y",17).attr("class","zoom-info-text").text("Zoom:"),zoomOptions=[{durationMs:scope.autoZoomDuration,label:"auto"}];if(_lodash2.default.each(ZOOM_INTERVAL_OPTIONS,function(option){option.duration.asSeconds()>minSecs&&option.duration.asSeconds()<boundsSecs&&zoomOptions.push({durationMs:option.duration.asMilliseconds(),label:option.label})}),xPos+=zoomLabel.node().getBBox().width+4,_lodash2.default.each(zoomOptions,function(option){var text=zoomGroup.append("a").attr("data-ms",option.durationMs).attr("href","").append("text").attr("x",xPos).attr("y",17).attr("class","zoom-info-text").text(option.label);xPos+=text.node().getBBox().width+4}),zoomGroup.append("text").attr("x",xPos+6).attr("y",17).attr("class","zoom-info-text zoom-aggregation-interval").text("(aggregation interval: , bucket span: )"),!1===scope.modelPlotEnabled){var modelPlotLabel=zoomGroup.append("text").attr("x",300).attr("y",17).attr("class","zoom-info-text").text("Model bounds are not available");modelPlotLabel.attr("x",fcsWidth-(modelPlotLabel.node().getBBox().width+10))}(0,_jquery2.default)(".focus-zoom a").click(function(e){e.preventDefault(),setZoomInterval((0,_jquery2.default)(this).attr("data-ms"))})}function drawContextElements(cxtGroup,cxtWidth,cxtChartHeight,swlHeight){var data=scope.contextChartData;contextXScale=_d2.default.time.scale().range([0,cxtWidth]).domain(calculateContextXAxisDomain());var combinedData=void 0===scope.contextForecastData?data:data.concat(scope.contextForecastData),valuesRange={min:Number.MAX_VALUE,max:Number.MIN_VALUE};_lodash2.default.each(combinedData,function(item){valuesRange.min=Math.min(item.value,valuesRange.min),valuesRange.max=Math.max(item.value,valuesRange.max)});var dataMin=valuesRange.min,dataMax=valuesRange.max,chartLimits={min:dataMin,max:dataMax};if(!0===scope.modelPlotEnabled||void 0!==scope.contextForecastData&&scope.contextForecastData.length>0){var boundsRange={min:Number.MAX_VALUE,max:Number.MIN_VALUE};_lodash2.default.each(combinedData,function(item){boundsRange.min=Math.min(item.lower,boundsRange.min),boundsRange.max=Math.max(item.upper,boundsRange.max)}),dataMin=Math.min(dataMin,boundsRange.min),dataMax=Math.max(dataMax,boundsRange.max),valuesRange.max-valuesRange.min<.5*(dataMax-dataMin)&&(valuesRange.min>dataMin&&(chartLimits.min=valuesRange.min-.5*(valuesRange.max-valuesRange.min)),valuesRange.max<dataMax&&(chartLimits.max=valuesRange.max+.5*(valuesRange.max-valuesRange.min)))}contextYScale=_d2.default.scale.linear().range([cxtChartHeight,contextChartLineTopMargin]).domain([chartLimits.min,chartLimits.max]);var borders=cxtGroup.append("g").attr("class","axis");borders.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",cxtChartHeight+swlHeight),borders.append("line").attr("x1",cxtWidth).attr("y1",0).attr("x2",cxtWidth).attr("y2",cxtChartHeight+swlHeight);var bounds=timefilter.getActiveBounds(),timeBuckets=new TimeBuckets;timeBuckets.setInterval("auto"),timeBuckets.setBounds(bounds);var xAxisTickFormat=timeBuckets.getScaledDateFormat(),xAxis=_d2.default.svg.axis().scale(contextXScale).orient("top").innerTickSize(-cxtChartHeight).outerTickSize(0).tickPadding(0).ticks((0,_chart_utils.numTicksForDateFormat)(cxtWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)});cxtGroup.datum(data);var contextBoundsArea=_d2.default.svg.area().x(function(d){return contextXScale(d.date)}).y0(function(d){return contextYScale(Math.min(chartLimits.max,Math.max(d.lower,chartLimits.min)))}).y1(function(d){return contextYScale(Math.max(chartLimits.min,Math.min(d.upper,chartLimits.max)))}).defined(function(d){return null!==d.lower&&null!==d.upper});!0===scope.modelPlotEnabled&&cxtGroup.append("path").datum(data).attr("class","area context").attr("d",contextBoundsArea);var contextValuesLine=_d2.default.svg.line().x(function(d){return contextXScale(d.date)}).y(function(d){return contextYScale(d.value)}).defined(function(d){return null!==d.value});cxtGroup.append("path").datum(data).attr("class","values-line").attr("d",contextValuesLine),(0,_chart_utils.drawLineChartDots)(data,cxtGroup,contextValuesLine,1),void 0!==scope.contextForecastData&&(cxtGroup.append("path").datum(scope.contextForecastData).attr("class","area forecast").attr("d",contextBoundsArea),cxtGroup.append("path").datum(scope.contextForecastData).attr("class","values-line forecast").attr("d",contextValuesLine)),drawSwimlane(cxtGroup.append("g").attr("class","swimlane").attr("transform","translate(0,"+cxtChartHeight+")"),cxtWidth,swlHeight),mask=new _context_chart_mask2.default(cxtGroup,scope.contextChartData,scope.modelPlotEnabled,swlHeight).x(contextXScale).y(contextYScale),cxtGroup.append("g").attr("class","x axis context-chart-axis").call(xAxis),cxtGroup.selectAll(".x.context-chart-axis text").attr("dy",cxtChartHeight-5),(0,_chart_utils.filterAxisLabels)(cxtGroup.selectAll(".x.context-chart-axis"),cxtWidth),drawContextBrush(cxtGroup)}function drawContextBrush(contextGroup){function showBrush(show){if(!0===show){var brushExtent=brush.extent();mask.reveal(brushExtent),leftHandle.attr("x",contextXScale(brushExtent[0])-10),rightHandle.attr("x",contextXScale(brushExtent[1])+0),topBorder.attr("x",contextXScale(brushExtent[0])+1),topBorder.attr("width",contextXScale(brushExtent[1])-contextXScale(brushExtent[0])-2)}setBrushVisibility(show)}function brushing(){showBrush(!brush.empty())}function brushed(){var isEmpty=brush.empty();showBrush(!isEmpty);var selectedBounds=isEmpty?contextXScale.domain():brush.extent(),selectionMin=selectedBounds[0].getTime(),selectionMax=selectedBounds[1].getTime();contextGroup.selectAll(".swimlane-cell").style("fill",function(d){var cellMs=d.date.getTime();return cellMs<selectionMin||cellMs>selectionMax?anomalyGrayScale(d.score):anomalyColorScale(d.score)}),scope.selectedBounds={min:(0,_moment2.default)(selectionMin),max:(0,_moment2.default)(selectionMax)},scope.$root.$broadcast("contextChartSelected",{from:selectedBounds[0],to:selectedBounds[1]})}brush.x(contextXScale).on("brush",brushing).on("brushend",brushed),contextGroup.append("g").attr("class","x brush").call(brush).selectAll("rect").attr("y",-1).attr("height",contextChartHeight+swimlaneHeight+1),contextGroup.selectAll(".w rect").attr("x",-10).attr("width",10),contextGroup.selectAll(".e rect").attr("x",0).attr("width",10);var topBorder=contextGroup.append("rect").attr("class","top-border").attr("y",-2).attr("height",contextChartLineTopMargin),leftHandle=contextGroup.append("foreignObject").attr("width",10).attr("height",90).attr("class","brush-handle").html('<div class="brush-handle-inner brush-handle-inner-left"><i class="fa fa-caret-left"></i></div>'),rightHandle=contextGroup.append("foreignObject").attr("width",10).attr("height",90).attr("class","brush-handle").html('<div class="brush-handle-inner brush-handle-inner-right"><i class="fa fa-caret-right"></i></div>');setBrushVisibility(!brush.empty())}function setBrushVisibility(show){if(void 0!==mask){var visibility=show?"visible":"hidden";mask.style("visibility",visibility),_d2.default.selectAll(".brush").style("visibility",visibility),_d2.default.selectAll(".brush-handle-inner").style("visibility",visibility),_d2.default.selectAll(".top-border").style("visibility",visibility),_d2.default.selectAll(".chart-border-highlight").style("visibility",visibility)}}function drawSwimlane(swlGroup,swlWidth,swlHeight){var data=scope.swimlaneData,xAxisDomain=calculateContextXAxisDomain(),x=_d2.default.time.scale().range([0,swlWidth]).domain(xAxisDomain),y=_d2.default.scale.linear().range([swlHeight,0]).domain([0,swlHeight]),xAxis=_d2.default.svg.axis().scale(x).orient("bottom").innerTickSize(-swlHeight).outerTickSize(0),yAxis=_d2.default.svg.axis().scale(y).orient("left").tickValues(y.domain()).innerTickSize(-swlWidth).outerTickSize(0),axes=swlGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0,"+swlHeight+")").call(xAxis),axes.append("g").attr("class","y axis").call(yAxis);var earliest=xAxisDomain[0].getTime(),latest=xAxisDomain[1].getTime(),swimlaneAggMs=scope.contextAggregationInterval.asMilliseconds(),cellWidth=swlWidth/((latest-earliest)/swimlaneAggMs);cellWidth<1&&(cellWidth=1),swlGroup.append("g").attr("class","swimlane-cells").selectAll("cells").data(data).enter().append("rect").attr("x",function(d){return x(d.date)}).attr("y",0).attr("rx",0).attr("ry",0).attr("class",function(d){return d.score>0?"swimlane-cell":"swimlane-cell-hidden"}).attr("width",cellWidth).attr("height",swlHeight).style("fill",function(d){return anomalyColorScale(d.score)})}function calculateContextXAxisDomain(){var bounds=timefilter.getActiveBounds(),earliest=bounds.min.valueOf();void 0!==scope.swimlaneData&&scope.swimlaneData.length>0&&(earliest=Math.min(_lodash2.default.first(scope.swimlaneData).date.getTime(),bounds.min.valueOf()));var contextAggMs=scope.contextAggregationInterval.asMilliseconds(),earliestMs=Math.floor(earliest/contextAggMs)*contextAggMs,latestMs=Math.ceil(bounds.max.valueOf()/contextAggMs)*contextAggMs;return[new Date(earliestMs),new Date(latestMs)]}function setContextBrushExtent(from,to,fireEvent){brush.extent([from,to]),brush(_d2.default.select(".brush")),fireEvent&&brush.event(_d2.default.select(".brush"))}function setZoomInterval(ms){var bounds=timefilter.getActiveBounds(),minBoundsMs=bounds.min.valueOf(),maxBoundsMs=bounds.max.valueOf(),millis=+ms,to=scope.zoomTo.getTime(),from=to-millis;from<minBoundsMs&&(from=minBoundsMs,to=Math.min(minBoundsMs+millis,maxBoundsMs)),setContextBrushExtent(new Date(from),new Date(to),!0)}function showFocusChartTooltip(marker,circle){var formattedDate=(0,_moment2.default)(marker.date).format("MMMM Do YYYY, HH:mm"),contents=formattedDate+"<br/><hr/>";if(_lodash2.default.has(marker,"anomalyScore")){var score=parseInt(marker.anomalyScore);if(contents+="anomaly score: "+(score>0?score:"< 1")+"<br/>",!1===scope.modelPlotEnabled){if(_lodash2.default.has(marker,"actual"))contents+="actual: "+formatValueFilter(marker.actual,marker.function,fieldFormat),contents+="<br/>typical: "+formatValueFilter(marker.typical,marker.function,fieldFormat);else if(contents+="value: "+formatValueFilter(marker.value,marker.function,fieldFormat),_lodash2.default.has(marker,"byFieldName")&&_lodash2.default.has(marker,"numberOfCauses")){var numberOfCauses=marker.numberOfCauses,byFieldName=(0,_string_utils.mlEscape)(marker.byFieldName);contents+=numberOfCauses<10?"<br/> "+numberOfCauses+" unusual "+byFieldName+" values":"<br/> "+numberOfCauses+"+ unusual "+byFieldName+" values"}}else contents+="value: "+formatValueFilter(marker.value,marker.function,fieldFormat),contents+="<br/>upper bounds: "+formatValueFilter(marker.upper,marker.function,fieldFormat),contents+="<br/>lower bounds: "+formatValueFilter(marker.lower,marker.function,fieldFormat)}else!0===_lodash2.default.get(marker,"isForecast",!1)?contents+="prediction: "+formatValueFilter(marker.value,marker.function,fieldFormat):contents+="value: "+formatValueFilter(marker.value,marker.function,fieldFormat),!0===scope.modelPlotEnabled&&(contents+="<br/>upper bounds: "+formatValueFilter(marker.upper,marker.function,fieldFormat),contents+="<br/>lower bounds: "+formatValueFilter(marker.lower,marker.function,fieldFormat));_lodash2.default.has(marker,"scheduledEvents")&&(contents+="<br/><hr/>Scheduled events:<br/>"+marker.scheduledEvents.map(_string_utils.mlEscape).join("<br/>")),mlChartTooltipService.show(contents,circle,{x:2*FOCUS_CHART_ANOMALY_RADIUS,y:0})}function highlightFocusChartAnomaly(record){var anomalyTime=record.source.timestamp,markerToSelect=(0,_timeseriesexplorer_utils.findNearestChartPointToTime)(scope.focusChartData,anomalyTime);if(void 0!==markerToSelect){var selectedMarker=_d2.default.select(".focus-chart-markers").selectAll(".focus-chart-highlighted-marker").data([markerToSelect]);selectedMarker.enter().append("circle").attr("r",FOCUS_CHART_ANOMALY_RADIUS),selectedMarker.attr("cx",function(d){return focusXScale(d.date)}).attr("cy",function(d){return focusYScale(d.value)}).attr("class",function(d){var markerClass="metric-value anomaly-marker highlighted ";return markerClass+=(0,_anomaly_utils.getSeverityWithLow)(d.anomalyScore)});var circle=(0,_jquery2.default)(".focus-chart-markers .anomaly-marker.highlighted");circle.length&&showFocusChartTooltip(markerToSelect,circle[0])}}function unhighlightFocusChartAnomaly(){_d2.default.select(".focus-chart-markers").selectAll(".anomaly-marker.highlighted").remove(),mlChartTooltipService.hide()}var svgWidth=_angular2.default.element(".results-container").width(),focusZoomPanelHeight=25,focusChartHeight=310,focusHeight=focusZoomPanelHeight+focusChartHeight,contextChartHeight=60,contextChartLineTopMargin=3,chartSpacing=25,swimlaneHeight=30,margin={top:20,right:10,bottom:15,left:40},svgHeight=focusHeight+contextChartHeight+swimlaneHeight+chartSpacing+margin.top+margin.bottom,vizWidth=svgWidth-margin.left-margin.right,FOCUS_CHART_ANOMALY_RADIUS=7,SCHEDULED_EVENT_MARKER_HEIGHT=5,ZOOM_INTERVAL_OPTIONS=[{duration:_moment2.default.duration(1,"h"),label:"1h"},{duration:_moment2.default.duration(12,"h"),label:"12h"},{duration:_moment2.default.duration(1,"d"),label:"1d"},{duration:_moment2.default.duration(1,"w"),label:"1w"},{duration:_moment2.default.duration(2,"w"),label:"2w"},{duration:_moment2.default.duration(1,"M"),label:"1M"}],anomalyColorScale=_d2.default.scale.threshold().domain([3,25,50,75,100]).range(["#d2e9f7","#8bc8fb","#ffdd00","#ff7e00","#fe5050"]),anomalyGrayScale=_d2.default.scale.threshold().domain([3,25,50,75,100]).range(["#dce7ed","#b0c5d6","#b1a34e","#b17f4e","#c88686"]),focusXScale=_d2.default.time.scale().range([0,vizWidth]),focusYScale=_d2.default.scale.linear().range([focusHeight,focusZoomPanelHeight]),focusXAxis=_d2.default.svg.axis().scale(focusXScale).orient("bottom").innerTickSize(-focusChartHeight).outerTickSize(0).tickPadding(10),focusYAxis=_d2.default.svg.axis().scale(focusYScale).orient("left").innerTickSize(-vizWidth).outerTickSize(0).tickPadding(10),focusValuesLine=_d2.default.svg.line().x(function(d){return focusXScale(d.date)}).y(function(d){return focusYScale(d.value)}).defined(function(d){return null!==d.value}),focusBoundedArea=_d2.default.svg.area().x(function(d){return focusXScale(d.date)||1}).y0(function(d){return focusYScale(d.upper)}).y1(function(d){return focusYScale(d.lower)}).defined(function(d){return null!==d.lower&&null!==d.upper}),contextXScale=_d2.default.time.scale().range([0,vizWidth]),contextYScale=_d2.default.scale.linear().range([contextChartHeight,contextChartLineTopMargin]),TimeBuckets=Private(_time_buckets.TimeBucketsProvider),fieldFormat=void 0,brush=_d2.default.svg.brush(),mask=void 0;scope.$on("render",function(){fieldFormat=mlFieldFormatService.getFieldFormat(scope.selectedJob.job_id,scope.detectorIndex),render(),drawContextChartSelection()}),scope.$watchCollection("focusForecastData",renderFocusChart),scope.$watchCollection("focusChartData",renderFocusChart),scope.$watchGroup(["showModelBounds","showForecast"],renderFocusChart);var resizeChecker=new _resize_checker.ResizeChecker(_angular2.default.element(".ml-timeseries-chart"));resizeChecker.on("resize",function(){scope.$evalAsync(function(){render(),drawContextChartSelection(),renderFocusChart()})});var tableRecordMousenterListener=function(record){highlightFocusChartAnomaly(record)},tableRecordMouseleaveListener=function(record){unhighlightFocusChartAnomaly()};mlAnomaliesTableService.anomalyRecordMouseenter.watch(tableRecordMousenterListener),mlAnomaliesTableService.anomalyRecordMouseleave.watch(tableRecordMouseleaveListener),element.on("$destroy",function(){mlAnomaliesTableService.anomalyRecordMouseenter.unwatch(tableRecordMousenterListener),mlAnomaliesTableService.anomalyRecordMouseleave.unwatch(tableRecordMouseleaveListener),resizeChecker.destroy(),scope.$destroy()})}return{scope:{selectedJob:"=",detectorIndex:"=",modelPlotEnabled:"=",contextChartData:"=",contextForecastData:"=",contextChartAnomalyData:"=",focusChartData:"=",swimlaneData:"=",focusForecastData:"=",contextAggregationInterval:"=",focusAggregationInterval:"=",zoomFrom:"=",zoomTo:"=",autoZoomDuration:"=",showModelBounds:"=",showForecast:"="},link:link}})},3547:function(module,exports,__webpack_require__){"use strict";function ContextChartMask(contextGroup,data,drawBounds,swimlaneHeight){this.contextGroup=contextGroup,this.data=data,this.drawBounds=drawBounds,this.swimlaneHeight=swimlaneHeight,this.mask=this.contextGroup.append("g").attr("class","mask"),this.leftGroup=this.mask.append("g").attr("class","left-mask"),this.rightGroup=this.mask.append("g").attr("class","right-mask"),this.leftPolygon=this.leftGroup.append("polygon"),this.rightPolygon=this.rightGroup.append("polygon"),!0===this.drawBounds&&(this.leftGroup.append("path").attr("class","left area bounds"),this.rightGroup.append("path").attr("class","right area bounds")),this.leftGroup.append("path").attr("class","left values-line"),this.rightGroup.append("path").attr("class","right values-line"),this._x=null,this._y=null}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=ContextChartMask;var _d=__webpack_require__(15),_d2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_d),_chart_utils=__webpack_require__(133);ContextChartMask.prototype.style=function(prop,val){return this.leftGroup.style(prop,val),this.rightGroup.style(prop,val),this},ContextChartMask.prototype.x=function(f){return null==f?this._x:(this._x=f,this)},ContextChartMask.prototype.y=function(f){return null==f?this._y:(this._y=f,this)},ContextChartMask.prototype.redraw=function(){var yDomain=this._y.domain(),minY=yDomain[0],maxY=yDomain[1],xDomain=this._x.domain(),minX=xDomain[0],maxX=xDomain[1],that=this,leftData=this.data.filter(function(d){return d.date<that.from}),rightData=this.data.filter(function(d){return d.date>that.to});if(!0===this.drawBounds){var boundedArea=_d2.default.svg.area().x(function(d){return that._x(d.date)||1}).y0(function(d){return that._y(Math.min(maxY,Math.max(d.lower,minY)))}).y1(function(d){return that._y(Math.max(minY,Math.min(d.upper,maxY)))}).defined(function(d){return null!==d.lower&&null!==d.upper});this.leftGroup.select(".left.area.bounds").attr("d",boundedArea(leftData)),this.rightGroup.select(".right.area.bounds").attr("d",boundedArea(rightData))}var valuesLine=_d2.default.svg.line().x(function(d){return that._x(d.date)}).y(function(d){return that._y(d.value)}).defined(function(d){return null!==d.value});this.leftGroup.select(".left.values-line").attr("d",valuesLine(leftData)),(0,_chart_utils.drawLineChartDots)(leftData,this.leftGroup,valuesLine,1),this.rightGroup.select(".right.values-line").attr("d",valuesLine(rightData)),(0,_chart_utils.drawLineChartDots)(rightData,this.rightGroup,valuesLine,1);var leftPoly={l:this._x(minX),t:this._y(minY)+this.swimlaneHeight,r:this._x(this.from),b:0},rightPoly={l:this._x(this.to),t:this._y(minY)+this.swimlaneHeight,r:this._x(maxX),b:0};return this.leftPolygon.attr("points",leftPoly.l+","+leftPoly.t+"  "+leftPoly.r+","+leftPoly.t+"  "+leftPoly.r+","+leftPoly.b+"  "+leftPoly.l+","+leftPoly.b),this.rightPolygon.attr("points",rightPoly.l+","+rightPoly.t+"  "+rightPoly.r+","+rightPoly.t+"  "+rightPoly.r+","+rightPoly.b+"  "+rightPoly.l+","+rightPoly.b),this},ContextChartMask.prototype.reveal=function(extent){return this.from=extent[0],this.to=extent[1],this.redraw(),this},module.exports=exports.default},3548:function(module,exports){},3549:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3550),__webpack_require__(3551)},3550:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2).uiModules.get("apps/ml").directive("mlFormLabel",function(){return{scope:{labelId:"@",tooltipAppendToBody:"@",tooltipPlacement:"@"},restrict:"E",replace:!1,transclude:!0,template:'\n      <label class="kuiFormLabel" id="ml_aria_label_{{labelId}}" ng-transclude></label>\n      <i\n        ml-info-icon="{{labelId}}"\n        tooltip-append-to-body="{{tooltipAppendToBody || false}}"\n        tooltip-placement="{{tooltipPlacement || \'bottom\'}}"\n      />\n    '}})},3551:function(module,exports){},3552:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3553)},3553:function(module,exports,__webpack_require__){"use strict";var _tooltips=__webpack_require__(3554),_tooltips2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_tooltips);__webpack_require__(3555),__webpack_require__(2).uiModules.get("apps/ml").service("mlJsonTooltipService",function(){this.text=function(id){return _tooltips2.default[id]?_tooltips2.default[id].text:""}}).directive("mlInfoIcon",function(){return{scope:{id:"@mlInfoIcon"},restrict:"AE",replace:!0,template:'\n      <i aria-hidden="true" class="fa fa-info-circle" tooltip="{{text}}">\n        <span id="ml_aria_description_{{id}}" class="ml-info-tooltip-text">{{text}}</span>\n      </i>\n    ',controller:function($scope){$scope.text=_tooltips2.default[$scope.id]?_tooltips2.default[$scope.id].text:""}}})},3554:function(module,exports){module.exports={new_job_id:{text:"Unique identifier for job, can use lowercase alphanumeric and underscores."},new_job_description:{text:"Optional descriptive text."},new_job_group:{text:"Optional grouping for jobs. New groups can be created or picked from the list of existing groups."},new_job_custom_urls:{text:"Optional drill-through links to source data. Supports string substitution for analyzed fields e.g. $hostname$."},new_job_bucketspan:{text:"Interval for time series analysis."},new_job_sparsedata:{text:"Check if you wish to ignore empty buckets from being considered anomalous."},new_job_summarycountfieldname:{text:"Optional, for use if input data has been pre-summarized e.g. doc_count."},new_job_categorizationfieldname:{text:"Optional, for use if analyzing unstructured log data. Using text data types is recommended."},new_job_categorizationfilters:{text:"Optional, apply regular expressions to the categorization field"},new_job_detectors:{text:"Defines the fields and functions used for analysis."},new_job_influencers:{text:'Select which categorical fields have influence on the results. Who/what might you "blame" for an anomaly? Recommend 1-3 influencers.'},new_job_detector_description:{text:"User-friendly text used for dashboards."},new_job_detector_function:{text:"Analysis functions to be performed e.g. sum, count."},new_job_detector_fieldname:{text:"Required for functions: sum, mean, median, max, min, info_content, distinct_count."},new_job_detector_fieldname_subset:{text:"Required for functions: sum, mean, max, min, distinct_count."},new_job_detector_byfieldname:{text:"Required for individual analysis where anomalies are detected compared to an entity's own past behavior."},new_job_detector_overfieldname:{text:"Required for population analysis where anomalies are detected compared to the behavior of the population."},new_job_detector_partitionfieldname:{text:"Allows segmentation of modeling into logical groups."},new_job_detector_excludefrequent:{text:"If true will automatically identify and exclude frequently occurring entities which may otherwise have dominated results."},new_job_data_format:{text:"Describes the format of the input data: delimited, JSON, single line or Elasticsearch."},new_job_time_field:{text:"Name of the field containing the timestamp."},new_job_time_format:{text:"Format of the time field: epoch, epoch_ms or Java DateTimeFormatter string. Important to get right."},new_job_delimiter:{text:"Character used to separate fields."},new_job_quote_character:{text:"Character used to encapsulate values containing reserved characters."},new_job_enable_datafeed_job:{text:"Required for jobs that analyze data from Elasticsearch.\nRequires data format to be set to Elasticsearch/"},new_job_data_source:{text:"Elasticsearch versions 1.7.x and 2+ supported."},new_job_datafeed_query:{text:"Elasticsearch Query DSL for filtering input data."},new_job_datafeed_query_delay:{text:"Advanced option. Time delay in seconds, between current time and latest input data time."},new_job_datafeed_frequency:{text:"Advanced option. The interval between searches."},new_job_datafeed_scrollsize:{text:"Advanced option. The maximum number of documents requested for a search."},new_job_data_preview:{text:"This preview returns the contents of the source field only."},new_job_elasticsearch_server:{text:"Server address and port of Elasticsearch source."},new_job_enable_authenticated:{text:"Select to specify username and password for secure access."},new_job_datafeed_retrieve_source:{text:"Advanced option. Select to retrieve unfiltered _source document, instead of specified fields."},new_job_advanced_settings:{text:"Advanced options"},new_job_dedicated_index:{text:"Select to store results in a separate index for this job."},new_job_model_memory_limit:{text:"An approximate limit for the amount of memory used by the analytical models."},new_filter_ruleaction:{text:"A string specifying the rule action. Initially, the only valid option is 'filter_results' but it provisions for expansion to actions like 'disable_modeling'."},new_filter_targetfieldname:{text:"A string expecting a field name. The filter will apply on all results for the targetFieldName value the ruleConditions apply. When empty, filtering applies only to results for which the ruleConditions apply."},new_action_targetfieldvalue:{text:"A string expecting a value for targetFieldName. If any of the ruleConditions apply, all results will be excluded for that particular targetValue but not for others. Can only be specified if targetFieldName is not empty."},new_action_conditionsconnective:{text:"The logical connective of the ruleConditions."},new_action_ruleconditions:{text:"The list of conditions used to apply the rules."},new_action_conditiontype:{text:"A string specifying the condition type."},new_action_fieldname:{text:"A string specifying the field name on which the rule applies. When empty, rule applies to all results."},new_action_fieldvalue:{text:"A string specifying the numerical field value on which the rule applies. When empty, rule applies to all values of fieldName. Can only be specified if fieldName is not empty."},new_action_condition:{text:"The condition comparing fieldValue and value."},new_action_value:{text:"The numerical value to compare against fieldValue."},new_action_valuelist:{text:"A string that is a unique identifier to a list. Only applicable and required when conditionType is categorical."},forecasting_modal_run_duration:{text:"Length of forecast, up to a maximum of 8 weeks. Use s for seconds, m for minutes, h for hours, d for days, w for weeks."},forecasting_modal_view_list:{text:"Lists a maximum of five of the most recently run forecasts."},new_job_recognizer_job_prefix:{text:"A prefix which will be added to the beginning of each job ID."},new_custom_url_label:{text:"A label for the drill-through link."},new_custom_url_link_to:{text:"Link to a Kibana dashboard, Discover or another URL."},new_custom_url_dashboard:{text:"The dashboard to link to."},new_custom_url_discover_index:{text:"The index pattern to view in Discover."},new_custom_url_query_entity:{text:"Optional, entities from the anomaly that will be used in the dashboard query."},new_custom_url_value:{text:"URL of the drill-through link. Supports string substitution for analyzed fields e.g. $hostname$."},new_custom_url_time_range:{text:"The time span that will be displayed in the drill-down page. Set automatically, or enter a specific interval e.g. 10m or 1h."}}},3555:function(module,exports){},3556:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3557),__webpack_require__(3559),__webpack_require__(3560)},3557:function(module,exports,__webpack_require__){"use strict";var _confirm_modal=__webpack_require__(3558),_confirm_modal2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_confirm_modal);__webpack_require__(2).uiModules.get("apps/ml").service("mlConfirmModalService",function($modal,$q){this.open=function(options){var deferred=$q.defer();return $modal.open({template:_confirm_modal2.default,controller:"MlConfirmModal",backdrop:"static",keyboard:!1,size:void 0===options.size?"sm":options.size,resolve:{params:function(){return{message:options.message,title:options.title,okLabel:options.okLabel,cancelLabel:options.cancelLabel,hideCancel:options.hideCancel,ok:deferred.resolve,cancel:deferred.reject}}}}),deferred.promise}})},3558:function(module,exports){module.exports='<div class="confirm-modal">\n  <div class="modal-title" ng-show="(title !== undefined && title !== \'\' )">{{title}}</div>\n  <div class="modal-body" bind-html-unsafe="message"></div>\n  <div class="modal-footer">\n    <button\n      ng-click="ok()"\n      ng-disabled="(saveLock === true)"\n      class="kuiButton kuiButton--primary"\n      aria-label="OK">\n      {{okLabel}}\n    </button>\n    <button\n      ng-hide="hideCancel"\n      ng-click="cancel()"\n      ng-disabled="(saveLock === true)"\n      class="kuiButton kuiButton--primary"\n      aria-label="Cancel">\n      {{cancelLabel}}\n    </button>\n  </div>\n</div>\n'},3559:function(module,exports,__webpack_require__){"use strict";__webpack_require__(2).uiModules.get("apps/ml").controller("MlConfirmModal",function($scope,$modalInstance,params){$scope.okFunc=params.ok,$scope.cancelFunc=params.cancel,$scope.message=params.message||"",$scope.title=params.title||"",$scope.okLabel=params.okLabel||"OK",$scope.cancelLabel=params.cancelLabel||"Cancel",$scope.hideCancel=params.hideCancel||!1,$scope.ok=function(){$scope.okFunc(),$modalInstance.close()},$scope.cancel=function(){$scope.cancelFunc(),$modalInstance.close()}})},3560:function(module,exports){},3561:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3562)},3562:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_jquery=__webpack_require__(12),_jquery2=_interopRequireDefault(_jquery),_nav_menu=__webpack_require__(3563),_nav_menu2=_interopRequireDefault(_nav_menu),_routes=__webpack_require__(11),_routes2=_interopRequireDefault(_routes);__webpack_require__(2).uiModules.get("apps/ml").directive("mlNavMenu",function(){return{restrict:"E",transclude:!0,template:_nav_menu2.default,link:function(scope,el,attrs){scope.name=attrs.name,scope.showTabs=!1,"jobs"!==scope.name&&"settings"!==scope.name&&"timeseriesexplorer"!==scope.name&&"explorer"!==scope.name||(scope.showTabs=!0),scope.isActiveTab=function(path){return scope.name===path};var crumbNames={jobs:{label:"Job Management",url:"#/jobs"},new_job:{label:"Create New Job",url:"#/jobs/new_job"},single_metric:{label:"Single Metric Job",url:""},multi_metric:{label:"Multi Metric job",url:""},population:{label:"Population job",url:""},advanced:{label:"Advanced Job Configuration",url:""},datavisualizer:{label:"Data Visualizer",url:""},explorer:{label:"Anomaly Explorer",url:"#/explorer"},timeseriesexplorer:{label:"Single Metric Viewer",url:"#/timeseriesexplorer"},settings:{label:"Settings",url:"#/settings"},calendars_list:{label:"Calendar Management",url:"#/settings/calendars_list"},new_calendar:{label:"New Calendar",url:"#/settings/calendars_list/new_calendar"},edit_calendar:{label:"Edit Calendar",url:"#/settings/calendars_list/edit_calendar"}},breadcrumbs=[{label:"Machine Learning",url:"#/"}],crumbs=_routes2.default.getBreadcrumbs();_lodash2.default.each(crumbs,function(crumb){breadcrumbs.push(crumbNames[crumb.id])}),scope.breadcrumbs=breadcrumbs.filter(Boolean),el.ready(function(){var $crumbs=(0,_jquery2.default)(".kuiLocalBreadcrumbs a");$crumbs.length&&$crumbs[0].focus()})}}})},3563:function(module,exports){module.exports='<kbn-top-nav name="dashboard" config="topNavMenu">\n<div data-transclude-slots>\n    \x3c!-- Breadcrumbs. --\x3e\n    <div data-transclude-slot="topLeftCorner" class="kuiLocalBreadcrumbs">\n      <div ng-repeat="crumb in breadcrumbs" class="kuiLocalBreadcrumb">\n        <a ng-if="crumb.url" kbn-href="{{ crumb.url }}" class="kuiLocalBreadcrumb__link">{{ crumb.label }}</a>\n        <span ng-if="!crumb.url" class="kuiLocalBreadcrumb__link">{{ crumb.label }}</span>\n      </div>\n    </div>\n    \x3c!-- Tabs --\x3e\n    <div data-transclude-slot="bottomRow">\n      <div ng-if="showTabs" class="kuiLocalTabs" role="tablist">\n        <a kbn-href="#/jobs" class="kuiLocalTab" role="tab"\n        ng-class="{\'kuiLocalTab-isSelected\': isActiveTab(\'jobs\')}">\n        Job Management</a>\n        <a kbn-href="#/explorer" class="kuiLocalTab" role="tab"\n        ng-class="{\'kuiLocalTab-isSelected\': isActiveTab(\'explorer\')}">\n        Anomaly Explorer</a>\n        <a kbn-href="#/timeseriesexplorer" class="kuiLocalTab" role="tab"\n        ng-class="{\'kuiLocalTab-isSelected\': isActiveTab(\'timeseriesexplorer\')}">\n        Single Metric Viewer</a>\n        <a kbn-href="#/settings" class="kuiLocalTab" role="tab"\n        ng-class="{\'kuiLocalTab-isSelected\': isActiveTab(\'settings\')}">\n        Settings</a>\n      </div>\n    </div>\n  </div>\n</kbn-top-nav>\n'},3564:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3565)},3565:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3566);var _loading_indicator=__webpack_require__(3567),_loading_indicator2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_loading_indicator);__webpack_require__(2).uiModules.get("apps/ml").directive("mlLoadingIndicator",function(){return{restrict:"E",template:_loading_indicator2.default,transclude:!0,scope:{label:"@?",isLoading:"<",height:"<?"},link:function(scope){scope.height=scope.height?+scope.height:100}}})},3566:function(module,exports){},3567:function(module,exports){module.exports='<div ng-if="isLoading" class="loading-indicator" style="height: {{height}}px">\n  <div class="loading-spinner"><i class=\'fa fa-spinner fa-spin\'></i></div>\n  <div ng-if="label!==undefined" ml-loading-indicator-label>{{label}}</div>\n</div>\n'},3568:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3569),__webpack_require__(3570),__webpack_require__(3572)},3569:function(module,exports){},3570:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _routes=__webpack_require__(11),_routes2=_interopRequireDefault(_routes),_check_license=__webpack_require__(101),_check_privilege=__webpack_require__(93),_check_ml_nodes=__webpack_require__(108),_settings=__webpack_require__(3571),_settings2=_interopRequireDefault(_settings),_modules=__webpack_require__(2);_routes2.default.when("/settings",{template:_settings2.default,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkGetJobsPrivilege,mlNodeCount:_check_ml_nodes.getMlNodeCount}}),_modules.uiModules.get("apps/ml").controller("MlSettings",function($scope,timefilter){timefilter.disableTimeRangeSelector(),timefilter.disableAutoRefreshSelector()})},3571:function(module,exports){module.exports='<ml-nav-menu name="settings"></ml-nav-menu>\n<ml-settings ng-controller="MlSettings">\n\n  <div class="page-row">\n\n    <div class="kuiPanel management-panel">\n      <div class="kuiPanelHeader">\n        <div class="kuiPanelHeaderSection">\n          <div class="management-panel__heading-icon management-panel__heading-icon--elasticsearch"></div>\n          <div class="kuiPanelHeader__title ng-binding">\n            Job Management\n          </div>\n        </div>\n      </div>\n\n      <div class="kuiPanelBody management-panel__body">\n        <div class="row">\n          <ul class="list-unstyled">\n            <li class="col-xs-4 col-md-3 ng-scope">\n              <a\n                data-test-subj=""\n                class="management-panel__link ng-binding"\n                tooltip=""\n                tooltip-placement="bottom"\n                tooltip-popup-delay="400"\n                tooltip-append-to-body="1"\n                href="ml#/settings/calendars_list">\n                 Calendar management\n              </a>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </div>\n  </div>\n</ml-settings>\n'},3572:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3573),__webpack_require__(3585)},3573:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3574),__webpack_require__(3575)},3574:function(module,exports){},3575:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash);__webpack_require__(308),__webpack_require__(261),__webpack_require__(690);var _routes=__webpack_require__(11),_routes2=_interopRequireDefault(_routes),_check_license=__webpack_require__(101),_check_privilege=__webpack_require__(93),_check_ml_nodes=__webpack_require__(108),_buttons_enabled_checks=__webpack_require__(3583),_calendars_list=__webpack_require__(3584),_calendars_list2=_interopRequireDefault(_calendars_list),_modules=__webpack_require__(2);_routes2.default.when("/settings/calendars_list",{template:_calendars_list2.default,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkGetJobsPrivilege,mlNodeCount:_check_ml_nodes.getMlNodeCount}}),_modules.uiModules.get("apps/ml",["ui.bootstrap"]).controller("MlCalendarsList",function($scope,$filter,$route,$location,pagerFactory,Private,ml,timefilter,mlConfirmModalService){function loadCalendars(){ml.calendars().then(function(resp){calendars=resp,$scope.pager=pagerFactory.create(calendars.length,PAGE_SIZE,1),applyTableSettings()})}function applyTableSettings(){var filteredCalendars=_lodash2.default.filter(calendars,function(calendar){return void 0===$scope.filterRegexp||calendar.calendar_id.match($scope.filterRegexp)||calendar.job_ids.join(" ").match($scope.filterRegexp)});filteredCalendars=_lodash2.default.sortBy(filteredCalendars,function(calendar){switch($scope.sortField){case SORT_FIELD_LABELS.JOB_IDS:return calendar.job_ids.join();case SORT_FIELD_LABELS.EVENT_COUNT:return calendar.events.length;case SORT_FIELD_LABELS.CALENDAR_ID:default:return calendar[$scope.sortField]}}),!0===$scope.sortReverse&&(filteredCalendars=filteredCalendars.reverse()),$scope.displayCalendars=limitTo(filteredCalendars,$scope.pager.pageSize,$scope.pager.startIndex),$scope.pager.setTotalItems(filteredCalendars.length)}var _Private=Private(_check_privilege.permissionCheckProvider),checkPermission=_Private.checkPermission,createPermissionFailureMessage=_Private.createPermissionFailureMessage;$scope.permissions={canCreateCalendar:checkPermission("canCreateCalendar"),canDeleteCalendar:checkPermission("canDeleteCalendar")},timefilter.disableTimeRangeSelector(),timefilter.disableAutoRefreshSelector();var mlConfirm=mlConfirmModalService,calendars=[];$scope.displayCalendars=[],$scope.buttonChecks=(0,_buttons_enabled_checks.buttonsEnabledChecks)($scope.permissions,createPermissionFailureMessage,(0,_check_ml_nodes.mlNodesAvailable)());var PAGE_SIZE=20,limitTo=$filter("limitTo");$scope.pager=pagerFactory.create(0,PAGE_SIZE,1);var SORT_FIELD_LABELS={CALENDAR_ID:"calendar_id",JOB_IDS:"job_ids",EVENT_COUNT:"event_count"};$scope.SORT_FIELD_LABELS=SORT_FIELD_LABELS,$scope.sortField=SORT_FIELD_LABELS.CALENDAR_ID,$scope.sortReverse=!1,$scope.onSortChange=function(field,reverse){$scope.sortField=field,$scope.sortReverse=reverse},$scope.onQueryChange=function(query){$scope.filterRegexp=query?new RegExp("("+query+")","gi"):void 0},$scope.onPageNext=function(){$scope.pager.nextPage()},$scope.onPagePrevious=function(){$scope.pager.previousPage()},$scope.$watchMulti(["sortField","sortReverse","filterRegexp","pager.currentPage"],applyTableSettings),$scope.newCalendarClick=function(){$location.path("settings/calendars_list/new_calendar")},$scope.editCalendarClick=function(id){$location.path("settings/calendars_list/edit_calendar/"+id)},$scope.deleteCalendarClick=function(calendarId){mlConfirm.open({message:"Confirm deletion of "+calendarId+"?",title:"Delete calendar"}).then(function(){ml.deleteCalendar({calendarId:calendarId}).then(loadCalendars).catch(function(error){console.log(error)})}).catch(function(){})},loadCalendars()})},3583:function(module,exports,__webpack_require__){"use strict";function buttonsEnabledChecks(permissions,createPermissionFailureMessage,mlNodesAvailable){function newButtonWrapperClass(){return permissions.canCreateCalendar&&mlNodesAvailable?"button-wrapper":["button-wrapper","disabled"]}function newButtonWrapperTooltip(){var tooltip=void 0;return!1===permissions.canCreateCalendar?tooltip=createPermissionFailureMessage("canCreateCalendar"):!1===mlNodesAvailable&&(tooltip=NO_ML_NODES_ERROR),tooltip}function newButtonDisabled(){return!1===permissions.canCreateCalendar||!1===mlNodesAvailable}function deleteButtonWrapperClass(){return permissions.canDeleteCalendar&&mlNodesAvailable?"button-wrapper":["button-wrapper","disabled"]}function deleteButtonWrapperTooltip(){var tooltip=void 0;return!1===permissions.canDeleteCalendar?tooltip=createPermissionFailureMessage("canDeleteCalendar"):!1===mlNodesAvailable&&(tooltip=NO_ML_NODES_ERROR),tooltip}function deleteButtonDisabled(){return!1===(permissions.canDeleteCalendar&&mlNodesAvailable)}var NO_ML_NODES_ERROR="No ML nodes available";return{newButtonWrapperClass:newButtonWrapperClass,newButtonWrapperTooltip:newButtonWrapperTooltip,newButtonDisabled:newButtonDisabled,deleteButtonWrapperClass:deleteButtonWrapperClass,deleteButtonWrapperTooltip:deleteButtonWrapperTooltip,deleteButtonDisabled:deleteButtonDisabled}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.buttonsEnabledChecks=buttonsEnabledChecks},3584:function(module,exports){module.exports='<ml-nav-menu name="settings"></ml-nav-menu>\n<ml-calendars-list ng-controller="MlCalendarsList">\n  <ml-message-bar ></ml-message-bar>\n\n  <div class="calendars-list-container">\n    <div>\n      <div class="kuiViewContent kuiViewContent--constrainedWidth">\n        <div class="kuiViewContentItem kuiControlledTable kuiVerticalRhythm">\n          <div class="kuiToolBar">\n            <div class="kuiToolBarSearch">\n              <tool-bar-search-box\n                ng-disabled="true"\n                filter="query"\n                on-filter="onQueryChange">\n              </tool-bar-search-box>\n            </div>\n\n            <div class="kuiToolBarSection">\n              <div\n                ng-class="buttonChecks.newButtonWrapperClass()"\n                ng-attr-tooltip="{{buttonChecks.newButtonWrapperTooltip()}}"\n              >\n                <button class="kuiButton kuiButton--primary"\n                  ng-click="newCalendarClick()"\n                  aria-label="Create new dashboard"\n                  data-test-subj="newDashboardLink"\n                  tooltip="Create new calendar"\n                  ng-disabled=\'buttonChecks.newButtonDisabled()\'\n                  tooltip-append-to-body="true">\n                  <span aria-hidden="true" class="kuiButton__icon kuiIcon fa-plus"></span>\n                  New calendar\n                </button>\n              </div>\n            </div>\n\n            <div class="kuiToolBarSection">\n              <tool-bar-pager-text\n                start-item="pager.startItem"\n                end-item="pager.endItem"\n                total-items="pager.totalItems">\n              </tool-bar-pager-text>\n              <tool-bar-pager-buttons\n                has-previous-page="pager.hasPreviousPage"\n                has-next-page="pager.hasNextPage"\n                on-page-next="onPageNext"\n                on-page-previous="onPagePrevious">\n              </tool-bar-pager-buttons>\n            </div>\n          </div>\n\n          <table class="kuiTable">\n            <thead>\n              <tr>\n                <th scope="col" class="kuiTableHeaderCell">\n                  <sortable-column field="{{SORT_FIELD_LABELS.CALENDAR_ID}}" on-sort-change="onSortChange" sort-field="sortField" sort-reverse="sortReverse">\n                    ID\n                  </sortable-column>\n                </th>\n                <th scope="col" class="kuiTableHeaderCell">\n                  <sortable-column field="{{SORT_FIELD_LABELS.JOB_IDS}}" on-sort-change="onSortChange" sort-field="sortField" sort-reverse="sortReverse">\n                    Jobs\n                  </sortable-column>\n                </th>\n                <th scope="col" class="kuiTableHeaderCell">\n                  <sortable-column field="{{SORT_FIELD_LABELS.EVENT_COUNT}}" on-sort-change="onSortChange" sort-field="sortField" sort-reverse="sortReverse">\n                    Events\n                  </sortable-column>\n                </th>\n                <th scope="col" class="kuiTableHeaderCell actions-col"></th>\n              </tr>\n            </thead>\n\n            <tbody>\n              <tr ng-repeat="calendar in displayCalendars" class="kuiTableRow" ng-class="{ \'kuiTableRow-isBeingDeleted\': calendar.isBeingDeleted }">\n\n                <td class="kuiTableRowCell">\n                  <div class="kuiTableRowCell__liner">\n                    <span title="{{calendar.calendar_id}}">\n                      {{calendar.calendar_id}}\n                    </span>\n                  </div>\n                </td>\n\n                <td class="kuiTableRowCell">\n                  <div class="kuiTableRowCell__liner">\n                    <span title="{{calendar.job_ids.join(\', \')}}">\n                      {{calendar.job_ids.join(\', \')}}\n                    </span>\n                  </div>\n                </td>\n                <td class="kuiTableRowCell">\n                  <div class="kuiTableRowCell__liner">\n                    <span>\n                       {{calendar.events.length}} {{calendar.events.length === 1 ? \'event\' : \'events\'}}\n                    </span>\n                  </div>\n                </td>\n                <td class="kuiTableRowCell">\n                  <div class="kuiTableRowCell__liner">\n                    <div class="kuiMenuButtonGroup kuiMenuButtonGroup--alignRight">\n                      <div\n                        ng-class="buttonChecks.newButtonWrapperClass()"\n                        ng-attr-tooltip="{{buttonChecks.newButtonWrapperTooltip()}}">\n                        <button\n                          class="kuiMenuButton kuiMenuButton--basic kuiMenuButton--iconText"\n                          title="Edit"\n                          ng-disabled=\'buttonChecks.newButtonDisabled()\'\n                          ng-click="editCalendarClick(calendar.calendar_id)">\n                          <span class="kuiMenuButton__icon kuiIcon fa-pencil"></span>\n                          <span>Edit</span>\n                        </button>\n                      </div>\n                      <div\n                        ng-class="buttonChecks.deleteButtonWrapperClass()"\n                        ng-attr-tooltip="{{buttonChecks.deleteButtonWrapperTooltip()}}">\n                        <button\n                          class="kuiMenuButton kuiMenuButton--danger kuiMenuButton--iconText"\n                          title="Edit"\n                          ng-disabled=\'buttonChecks.deleteButtonDisabled()\'\n                          ng-click="deleteCalendarClick(calendar.calendar_id)"\n                          href="" >\n                          <span class="kuiMenuButton__icon kuiIcon fa-trash"></span>\n                          <span>Delete</span>\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n                </td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n    </div>\n  </div>\n</ml-calendars-list>\n'},3585:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3586),__webpack_require__(3587)},3586:function(module,exports){},3587:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}var _jquery=__webpack_require__(12),_jquery2=_interopRequireDefault(_jquery),_lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash);__webpack_require__(1154),__webpack_require__(1193);var _validate_calendar=__webpack_require__(3605),_routes=__webpack_require__(11),_routes2=_interopRequireDefault(_routes),_check_license=__webpack_require__(101),_check_privilege=__webpack_require__(93),_check_ml_nodes=__webpack_require__(108),_create_calendar=__webpack_require__(3606),_create_calendar2=_interopRequireDefault(_create_calendar),_modules=__webpack_require__(2);_routes2.default.when("/settings/calendars_list/new_calendar",{template:_create_calendar2.default,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkGetJobsPrivilege,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable}}).when("/settings/calendars_list/edit_calendar/:calendarId",{template:_create_calendar2.default,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkGetJobsPrivilege,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable}}),_modules.uiModules.get("apps/ml",["ui.bootstrap"]).controller("MlCreateCalendar",function($scope,$route,$location,ml,timefilter,mlMessageBarService,mlJobService,mlCalendarService){var msgs=mlMessageBarService;msgs.clear();var calendarId=$route.current.params.calendarId;$scope.isNewCalendar=void 0===calendarId,$scope.pageTitle=$scope.isNewCalendar?"Create new calendar":"Edit calendar "+calendarId,$scope.calendarId=calendarId||"",$scope.description="",$scope.events=[],$scope.jobIds=[],$scope.allJobs=[],$scope.groupIds=[],$scope.allGroups=[],$scope.updateJobsList={},$scope.updateGroupsList={},$scope.saveLock=!1,$scope.validation={checks:{calendarId:{valid:!0}}},mlJobService.loadJobs().then(function(){var jobs=mlJobService.jobs;$scope.allJobs=jobs.map(function(j){return{id:j.job_id}}),$scope.allGroups=mlJobService.getJobGroups().map(function(g){return{id:g.id}}),mlCalendarService.loadCalendars(jobs).then(function(resp){var _$scope$allGroups,calendars=resp.calendars,calGroups=mlCalendarService.getCalendarGroups();(_$scope$allGroups=$scope.allGroups).push.apply(_$scope$allGroups,_toConsumableArray(calGroups)),$scope.allGroups=_lodash2.default.uniq($scope.allGroups,"id"),$scope.allGroups=_lodash2.default.sortBy($scope.allGroups,"id"),calendars.forEach(function(calendar){void 0!==calendarId&&calendarId===calendar.calendar_id&&($scope.events=calendar.events||[],$scope.description=calendar.description||"",calendar.job_ids.forEach(function(id){$scope.allJobs.find(function(j){return j.id===id})?$scope.jobIds.push(id):$scope.allGroups.find(function(g){return g.id===id})&&$scope.groupIds.push(id)}))}),$scope.updateJobsList.update($scope.jobIds),$scope.updateGroupsList.update($scope.groupIds)}),(0,_jquery2.default)(".new-calendar-container #id").focus()}),$scope.save=function(){msgs.clear();var events=$scope.events.map(function(event){return{description:event.description,start_time:event.start_time,end_time:event.end_time}}),calendar={calendarId:$scope.calendarId,description:$scope.description,events:events,job_ids:[].concat(_toConsumableArray($scope.jobIds),_toConsumableArray($scope.groupIds))};(0,_validate_calendar.validateCalendarId)(calendar.calendarId,$scope.validation.checks)&&($scope.saveLock=!0,($scope.isNewCalendar?ml.addCalendar:ml.updateCalendar)(calendar).then(function(){$location.path("settings/calendars_list"),$scope.saveLock=!1}).catch(function(error){msgs.error("Save calendar failed: ",error),$scope.saveLock=!1}))},$scope.cancel=function(){$location.path("settings/calendars_list")},$scope.saveEnabled=function(){return""!==$scope.calendarId&&void 0!==$scope.calendarId&&!1===$scope.saveLock}})},3588:function(module,exports){},3589:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}__webpack_require__(3590),__webpack_require__(3595);var _events_list=__webpack_require__(3604),_events_list2=_interopRequireDefault(_events_list),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment);__webpack_require__(2).uiModules.get("apps/ml").directive("mlEventsList",function($filter,pagerFactory,mlNewEventService,mlImportEventsService,config){return{restrict:"AE",replace:!0,transclude:!0,template:_events_list2.default,scope:{events:"=",showControls:"=",lockControls:"=",asteriskText:"="},controller:function($scope){function applyTableSettings(){var pageOfEvents=orderBy($scope.events,$scope.sortField,$scope.sortReverse);$scope.pageOfEvents=limitTo(pageOfEvents,$scope.pager.pageSize,$scope.pager.startIndex),$scope.pager.setTotalItems($scope.events.length)}$scope.pageOfEvents=[],$scope.dateFormatTz=config.get("dateFormat:tz");var orderBy=$filter("orderBy"),limitTo=$filter("limitTo");$scope.pager=pagerFactory.create($scope.events.length,20,1),$scope.sortField="description",$scope.sortReverse=!1,$scope.onSortChange=function(field,reverse){$scope.sortField=field,$scope.sortReverse=reverse},$scope.onPageNext=function(){$scope.pager.nextPage()},$scope.onPagePrevious=function(){$scope.pager.previousPage()},$scope.$watchMulti(["events","sortField","sortReverse","pager.currentPage"],applyTableSettings),$scope.clickNewEvent=function(){mlNewEventService.openNewEventWindow().then(function(event){$scope.events.push(event),applyTableSettings()}).catch(function(){})},$scope.formatTime=function(timeMs){return(0,_moment2.default)(timeMs).format("YYYY-MM-DD HH:mm:ss")},$scope.deleteEvent=function(eventToDelete){$scope.events.splice($scope.events.indexOf(eventToDelete),1),applyTableSettings()},$scope.clickImportEvents=function(){mlImportEventsService.openImportEventsWindow().then(function(events){var _$scope$events;(_$scope$events=$scope.events).push.apply(_$scope$events,_toConsumableArray(events)),applyTableSettings()}).catch(function(){})}}}})},3590:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3591),__webpack_require__(3592),__webpack_require__(3594)},3591:function(module,exports){},3592:function(module,exports,__webpack_require__){"use strict";var _new_event_modal=__webpack_require__(3593),_new_event_modal2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_new_event_modal);__webpack_require__(2).uiModules.get("apps/ml").service("mlNewEventService",function($q,$modal){this.openNewEventWindow=function(){return $q(function(resolve,reject){$modal.open({template:_new_event_modal2.default,controller:"MlNewEventModal",backdrop:"static",keyboard:!1}).result.then(resolve).catch(reject)})}})},3593:function(module,exports){module.exports='<div class="new-event-modal">\n  <ml-message-bar ></ml-message-bar>\n  <h3 class="euiTitle">Create new event</h3>\n  <div class="euiSpacer euiSpacer--s"></div>\n\n  <div class="ml-new-event-contents" >\n\n    <div class="kuiFormSection" aria-hidden="false">\n      <label for="id" class="kuiFormLabel">\n        Description\n      </label>\n      <input\n        type="text"\n        ng-disabled="isNewCalendar===false"\n        id="id"\n        name="id"\n        ng-model="ui.description"\n        ng-trim="false"\n        class="kuiTextInput fullWidth"\n        autofocus\n        required />\n    </div>\n    <div class="main-container row1">\n      <div class="tabs-container">\n        <ul class="nav nav-pills nav-stacked">\n          <li ng-class="{ active: ui.rangeType === \'0\' }"><a ng-click="ui.setRangeType(\'0\')"> Single day</a></li>\n          <li ng-class="{ active: ui.rangeType === \'1\' }"><a ng-click="ui.setRangeType(\'1\')"> Day range</a></li>\n          <li ng-class="{ active: ui.rangeType === \'2\' }"><a ng-click="ui.setRangeType(\'2\')"> Time range</a></li>\n        </ul>\n      </div>\n      <div\n        class="calendar-container"\n        ng-class="{ \'top-tab-selected\': ui.rangeType === \'0\' }" >\n\n        <div\n          ng-show="ui.rangeType === RANGE_TYPE.SINGLE_DAY"\n          class="calendar">\n          <datepicker\n            offset-timezone\n            ng-model="ui.timepicker.start"\n            show-weeks="false">\n          </datepicker>\n        </div>\n\n        <div ng-show="ui.rangeType === RANGE_TYPE.DAY_RANGE">\n          <div class="row">\n            <div class="col-md-6 calendar">\n              <label class="kuiFormLabel">\n                From:\n              </label>\n              <datepicker\n                offset-timezone\n                ng-model="ui.timepicker.start"\n                show-weeks="false">\n              </datepicker>\n              <div class="partition"></div>\n            </div>\n            <div class="col-md-6 calendar">\n              <label class="kuiFormLabel">\n                To:\n              </label>\n              <datepicker\n                offset-timezone\n                ng-model="ui.timepicker.end"\n                show-weeks="false">\n              </datepicker>\n            </div>\n          </div>\n        </div>\n\n        <div ng-show="ui.rangeType === RANGE_TYPE.TIME_RANGE">\n          <div class="row">\n            <div class="col-md-6 calendar">\n              <div class="calendar-input-container">\n                <label class="kuiFormLabel">\n                  From:\n                </label>\n                <input type="text" class="form-control" input-datetime="YYYY-MM-DD HH:mm:ss" ng-model="ui.timepicker.start">\n              </div>\n              <datepicker\n                offset-timezone\n                ng-model="ui.timepicker.start"\n                show-weeks="false">\n              </datepicker>\n              <div class="partition partition-large"></div>\n            </div>\n            <div class="col-md-6 calendar">\n              <label class="kuiFormLabel">\n                From:\n              </label>\n              <div class="calendar-input-container">\n                <input type="text" class="form-control" input-datetime="YYYY-MM-DD HH:mm:ss" ng-model="ui.timepicker.end">\n              </div>\n              <datepicker\n                offset-timezone\n                ng-model="ui.timepicker.end"\n                show-weeks="false">\n              </datepicker>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n  </div>\n\n  <div class="clearfix"></div>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium" />\n\n  <button\n    ng-click="save()"\n    ng-disabled="ui.saveEnabled() === false"\n    class="kuiButton kuiButton--primary" >\n    Add\n  </button>\n  <button\n    ng-click="cancel()"\n    ng-disabled="(saveLock === true)"\n    class="kuiButton kuiButton--primary"\n    aria-label="Cancel">\n    Cancel\n  </button>\n\n</div>\n'},3594:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment),_jquery=__webpack_require__(12),_jquery2=_interopRequireDefault(_jquery);__webpack_require__(2).uiModules.get("apps/ml").controller("MlNewEventModal",function($scope,$modalInstance,$timeout){function extractForm(){var start=null,end=null,startMoment=(0,_moment2.default)($scope.ui.timepicker.start);if($scope.ui.rangeType===RANGE_TYPE.SINGLE_DAY){var endMoment=(0,_moment2.default)($scope.ui.timepicker.start);start=startMoment.startOf("day"),end=endMoment.startOf("day").add(1,"days")}else if($scope.ui.rangeType===RANGE_TYPE.DAY_RANGE){var _endMoment=(0,_moment2.default)($scope.ui.timepicker.end);start=startMoment.startOf("day"),end=_endMoment.startOf("day").add(1,"days")}else $scope.ui.rangeType===RANGE_TYPE.TIME_RANGE&&(start=startMoment,end=(0,_moment2.default)($scope.ui.timepicker.end));return{description:$scope.ui.description,start_time:start.valueOf(),end_time:end.valueOf()}}var RANGE_TYPE={SINGLE_DAY:"0",DAY_RANGE:"1",TIME_RANGE:"2"};$scope.RANGE_TYPE=RANGE_TYPE,$scope.event={description:"",start:"",end:""},$scope.ui={saveEnabled:function(){return""!==$scope.ui.description&&void 0!==$scope.ui.description},description:"",rangeType:RANGE_TYPE.SINGLE_DAY,timepicker:{start:(0,_moment2.default)().startOf("day"),end:(0,_moment2.default)().startOf("day").add(1,"days")},setRangeType:function(i){$scope.ui.rangeType=i;var width=425;i===RANGE_TYPE.SINGLE_DAY?width=425:i!==RANGE_TYPE.DAY_RANGE&&i!==RANGE_TYPE.TIME_RANGE||(width=700),(0,_jquery2.default)(".modal-dialog").width(width)}},$timeout(function(){$scope.ui.setRangeType("0"),(0,_jquery2.default)(".ml-new-event-contents #id").focus()},0),$scope.save=function(){var event=extractForm();$modalInstance.close(event)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}})},3595:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3596),__webpack_require__(3597),__webpack_require__(3599)},3596:function(module,exports){},3597:function(module,exports,__webpack_require__){"use strict";var _import_events_modal=__webpack_require__(3598),_import_events_modal2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_import_events_modal);__webpack_require__(2).uiModules.get("apps/ml").service("mlImportEventsService",function($q,$modal){this.openImportEventsWindow=function(){return $q(function(resolve,reject){$modal.open({template:_import_events_modal2.default,controller:"MlImportEventsModal",backdrop:"static",keyboard:!1}).result.then(resolve).catch(reject)})}})},3598:function(module,exports){module.exports='<div class="import-events-modal">\n  <ml-message-bar ></ml-message-bar>\n  <h3 class="euiTitle">Import events</h3>\n  <div class="euiSpacer euiSpacer--s"></div>\n\n  <div>\n    Import events from an ICS file\n  </div>\n  <div class="euiSpacer euiSpacer--m"></div>\n\n  <div class="import-events-container">\n\n    <div class="kuiFormSection no-shadow euiPanel euiPanel--paddingMedium">\n      <input\n        type=\'file\'\n        ng-disabled="(loadingLock === true)"\n        ml-file-input-on-change="fileNameChanged"\n        />\n    </div>\n\n    <div\n      ng-if="fileLoaded===true && newEvents.length >= 0"\n      class="kuiFormSection">\n      <span class="kuiFormLabel">Events to import: {{newEvents.length}}</span>\n    </div>\n\n    <div\n      ng-if="error===true"\n      class="kuiFormSection euiCallOut euiCallOut--danger">\n      <div class="euiCallOutHeader">\n        <span class="euiCallOutHeader__title">{{errorMessage}}</span>\n      </div>\n    </div>\n\n    <div\n      ng-if="loadingLock === true"\n      class="kuiFormSection">\n      <ml-loading-indicator\n        label="Importing events"\n        is-loading="true"\n        height="50"\n      />\n    </div>\n\n    <div ng-show="fileLoaded===true && newEvents.length >= 0">\n      <ml-events-list\n        events=\'newEvents\'\n        show-controls=\'false\'\n        asterisk-text=\'RECURRING_WARNING\'\n        >\n      </ml-events-list>\n\n      <div class="euiSpacer euiSpacer--m"></div>\n\n      <div ng-if="showRecurringWarning" class="recurring-warning">\n        *{{RECURRING_WARNING}}\n        <div class="euiSpacer euiSpacer--m"></div>\n      </div>\n\n      <div>\n        <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n          <input\n            ng-model=\'includePastEvents\'\n            type="checkbox"\n            class=\'kuiCheckBox\'\n            ng-click="createEventsList()"/>\n          <span class=\'kuiCheckBoxLabel__text\'>Include past events</span>\n        </label>\n      </div>\n    </div>\n  </div>\n\n  <div class="clearfix"></div>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium" />\n\n  <button\n    ng-click="save()"\n    ng-disabled="loadingLock === true"\n    class="kuiButton kuiButton--primary" >\n    Import\n  </button>\n  <button\n    ng-click="cancel()"\n    ng-disabled="loadingLock === true"\n    class="kuiButton kuiButton--primary"\n    aria-label="Cancel">\n    Cancel\n  </button>\n\n</div>\n'},3599:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}var _jquery=__webpack_require__(12),_jquery2=_interopRequireDefault(_jquery),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment);__webpack_require__(1193);var _modules=__webpack_require__(2),icalendar=__webpack_require__(1194);_modules.uiModules.get("apps/ml").controller("MlImportEventsModal",function($scope,$q,$timeout,$modalInstance){function readFile(file){return $q(function(resolve,reject){if($scope.loadingLock=!0,file&&file.size){var reader=new FileReader;reader.readAsText(file),reader.onload=function(){return function(){$scope.loadingLock=!1;var data=reader.result;""===data?reject():resolve({data:data})}}()}else reject()})}function reset(){$scope.file=void 0,$scope.fileLoaded=!1,$scope.loadingLock=!1,$scope.newEvents=[],$scope.error=!1,$scope.errorMessage=""}function parseICSFile(data){return createEvents(icalendar.parse_calendar(data))}function createEvents(ical){var events=ical.events(),mlEvents=[];return events.forEach(function(e){if("VEVENT"===e.element){var description=e.properties.SUMMARY,start=e.properties.DTSTART,end=e.properties.DTEND,recurring=void 0!==e.properties.RRULE;description&&start&&end&&description.length&&start.length&&end.length&&mlEvents.push({description:description[0].value,start_time:start[0].value.valueOf(),end_time:end[0].value.valueOf(),asterisk:recurring})}}),mlEvents}$scope.loadingLock=!1,$scope.allNewEvents=[],$scope.newEvents=[],$scope.fileLoaded=!1,$scope.file=void 0,$scope.includePastEvents=!1,$scope.showRecurringWarning=!1,$scope.RECURRING_WARNING="Recurring events not supported. Only the first event will be imported.",$timeout(function(){(0,_jquery2.default)(".modal-dialog").width(750)},0),$scope.fileNameChanged=function(event){$scope.$apply(function(){event.target.files.length&&(reset(),$scope.file=event.target.files[0],$scope.file.size<=1e8?readFile($scope.file).then(function(resp){try{$scope.allNewEvents=parseICSFile(resp.data),$scope.createEventsList(),$scope.fileLoaded=!0,$scope.loadingLock=!1}catch(error){$scope.error=!0,$scope.errorMessage="Could not parse ICS file"}}).catch(function(error){console.error(error),$scope.loadingLock=!1}):($scope.fileLoaded=!1,$scope.loadingLock=!1))})},$scope.createEventsList=function(){if($scope.includePastEvents)$scope.newEvents=[].concat(_toConsumableArray($scope.allNewEvents));else{var now=(0,_moment2.default)().valueOf();$scope.newEvents=$scope.allNewEvents.filter(function(e){return e.start_time>now})}$scope.showRecurringWarning=void 0!==$scope.newEvents.find(function(e){return e.asterisk})},$scope.save=function(){$modalInstance.close($scope.newEvents),reset()},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}).directive("mlFileInputOnChange",function(){return{restrict:"A",link:function(scope,element,attrs){var onChangeHandler=scope.$eval(attrs.mlFileInputOnChange);element.on("change",onChangeHandler),element.on("$destroy",function(){element.off()})}}})},3602:function(module,exports,__webpack_require__){"use strict";var util=__webpack_require__(309),CalendarObject=__webpack_require__(115).CalendarObject,schema=__webpack_require__(115).schema,iCalendar=__webpack_require__(487).iCalendar,RRule=__webpack_require__(486).RRule,VEvent=exports.VEvent=function(calendar,uid){calendar instanceof iCalendar||null==calendar||(uid=calendar,calendar=null),CalendarObject.call(this,calendar,"VEVENT"),void 0!==uid&&(this.addProperty("DTSTAMP",new Date),this.addProperty("UID",uid))};util.inherits(VEvent,CalendarObject),VEvent.prototype.setSummary=function(summ){this.addProperty("SUMMARY",summ)},VEvent.prototype.setLocation=function(loc){this.addProperty("LOCATION",loc)},VEvent.prototype.setDescription=function(desc){this.addProperty("DESCRIPTION",desc)},VEvent.prototype.setDate=function(start,end){this.addProperty("DTSTART",start),end instanceof Date?this.addProperty("DTEND",end):this.addProperty("DURATION",end)},VEvent.prototype.rrule=function(){var rr=this.getPropertyValue("RRULE");if(!rr)return null;for(var ex,exceptions=[],i=0;ex=this.getPropertyValue("EXDATE",i++);)exceptions.push.apply(exceptions,ex);return new RRule(rr,{DTSTART:this.getPropertyValue("DTSTART"),DTEND:this.getPropertyValue("DTEND"),EXDATE:exceptions})},VEvent.prototype.inTimeRange=function(start,end){var rr=this.rrule();if(rr){var next=rr.next(start);return null!==next&&(!end||next<=end)}var dtstart=this.getPropertyValue("DTSTART"),dtend=this.getPropertyValue("DTEND");if(!dtend){var duration=this.getPropertyValue("DURATION");if(0===duration)return(!start||start<=dtstart)&&(!end||end>dtstart);dtend=duration?new Date(dtstart.valueOf()+1e3*this.getPropertyValue("DURATION")):new Date(dtstart.valueOf()+864e5)}return(!start||start<dtend)&&(!end||end>dtstart)},VEvent.prototype.reply=function(fromuser,status,options){var resp=this.clone(!0);options=options||{},!0===status||void 0===status?status="ACCEPTED":!1===status&&(status="DECLINED"),resp.setProperty("ATTENDEE",fromuser,{PARTSTAT:status,CN:options.CN||fromuser}),resp.setProperty("DTSTAMP",new Date),resp.setProperty("LAST-MODIFIED",new Date);var ics=new iCalendar;return ics.addProperty("METHOD","REPLY"),this.calendar&&ics.addComponents(this.calendar.getComponents("VTIMEZONE")),ics.addComponent(resp),ics},schema.VEVENT={factory:VEvent,valid_properties:[],required_properties:["DTSTAMP","UID"],valid_children:[],required_children:[]}},3603:function(module,exports,__webpack_require__){var assert=__webpack_require__(691),util=__webpack_require__(309),CalendarObject=__webpack_require__(115).CalendarObject,schema=__webpack_require__(115).schema,RRule=__webpack_require__(486).RRule,VTimezone=exports.VTimezone=function(calendar,tzid){CalendarObject.call(this,calendar,"VTIMEZONE"),this.addProperty("TZID",tzid)};util.inherits(VTimezone,CalendarObject),VTimezone.prototype.getRRule=function(section){var comp=this.getComponents(section)[0];return comp&&comp.getPropertyValue("RRULE")?new RRule(comp.getPropertyValue("RRULE"),comp.getPropertyValue("DTSTART"),comp.getPropertyValue("DTEND")):null},VTimezone.prototype.getOffsetForDate=function(dt){if(!this.getComponents("DAYLIGHT").length)return this.getComponents("STANDARD")[0].getPropertyValue("TZOFFSETTO");assert.equal(1,this.components.STANDARD.length),assert.equal(1,this.components.DAYLIGHT.length);var next_std=this.getRRule("STANDARD"),next_dst=this.getRRule("DAYLIGHT");if(null===next_std||null===next_dst){return this.getComponents("STANDARD")[0].getPropertyValue("TZOFFSETTO")}return next_std=next_std.next(dt),next_dst=next_dst.next(dt),this.getComponents(next_dst<next_std?"STANDARD":"DAYLIGHT")[0].getPropertyValue("TZOFFSETTO")},VTimezone.prototype.fromLocalTime=function(dtarray){var hrs=this.getOffsetForDate(dtarray),min=hrs%100;return hrs=(hrs-min)/100,new Date(Date.UTC(dtarray[0],dtarray[1]-1,dtarray[2],dtarray[3]-hrs,dtarray[4]-min,dtarray[5]))},schema.VTIMEZONE={factory:VTimezone}},3604:function(module,exports){module.exports='<div class="events-list">\n  <div\n    class="kuiVerticalRhythm"\n    ng-class="{\'kuiControlledTable\': showControls}">\n    <div ng-if="showControls" class="kuiToolBar">\n\n      <div class="kuiToolBarSection">\n        <button\n          class="kuiButton kuiButton--primary"\n          href=""\n          aria-label="Create new event"\n          tooltip="Create new event"\n          tooltip-append-to-body="true"\n          ng-disabled="lockControls === true"\n          ng-click="clickNewEvent()">\n          <span aria-hidden="true" class="kuiButton__icon kuiIcon fa-plus"></span>\n          New event\n        </button>\n\n        <button\n          class="kuiButton kuiButton--primary"\n          href=""\n          aria-label="Import events"\n          tooltip="Import events"\n          tooltip-append-to-body="true"\n          ng-disabled="lockControls === true"\n          ng-click="clickImportEvents()">\n          <span aria-hidden="true" class="kuiButton__icon kuiIcon fa-upload"></span>\n          Import events\n        </button>\n      </div>\n\n      <div class="kuiToolBarSection">\n        <tool-bar-pager-text\n          start-item="pager.startItem"\n          end-item="pager.endItem"\n          total-items="pager.totalItems">\n        </tool-bar-pager-text>\n        <tool-bar-pager-buttons\n          has-previous-page="pager.hasPreviousPage"\n          has-next-page="pager.hasNextPage"\n          on-page-next="onPageNext"\n          on-page-previous="onPagePrevious">\n        </tool-bar-pager-buttons>\n      </div>\n    </div>\n\n    <table class="kuiTable" ng-show="pageOfEvents.length">\n      <thead>\n        <tr>\n          <th scope="col" class="kuiTableHeaderCell">\n            <sortable-column field="description" on-sort-change="onSortChange" sort-field="sortField" sort-reverse="sortReverse">\n              Description\n            </sortable-column>\n          </th>\n          <th scope="col" class="kuiTableHeaderCell">\n            <sortable-column field="start_time" on-sort-change="onSortChange" sort-field="sortField" sort-reverse="sortReverse">\n              Start\n            </sortable-column>\n          </th>\n          <th scope="col" class="kuiTableHeaderCell">\n            <sortable-column field="end_time" on-sort-change="onSortChange" sort-field="sortField" sort-reverse="sortReverse">\n              End\n            </sortable-column>\n          </th>\n          <th scope="col" class="kuiTableHeaderCell actions-col"></th>\n        </tr>\n      </thead>\n\n      <tbody>\n        <tr ng-repeat="event in pageOfEvents track by $index" class="kuiTableRow" ng-class="{ \'kuiTableRow-isBeingDeleted\': event.isBeingDeleted }">\n\n          <td class="kuiTableRowCell">\n            <div class="kuiTableRowCell__liner">\n              <span>\n                {{event.description}}\n              </span>\n              <span\n                ng-if="event.asterisk"\n                class="asterisk"\n                tooltip=\'{{asteriskText}}\'>*</span>\n            </div>\n          </td>\n\n          <td class="kuiTableRowCell">\n            <div class="kuiTableRowCell__liner">\n              <span>\n                {{formatTime(event.start_time)}}\n              </span>\n            </div>\n          </td>\n\n          <td class="kuiTableRowCell">\n            <div class="kuiTableRowCell__liner">\n              <span>\n                {{formatTime(event.end_time)}}\n              </span>\n            </div>\n          </td>\n          <td class="kuiTableRowCell">\n            <div class="kuiTableRowCell__liner">\n              <div class="kuiMenuButtonGroup kuiMenuButtonGroup--alignRight">\n                <button\n                  class="kuiMenuButton kuiMenuButton--danger kuiMenuButton--iconText"\n                  title="Edit"\n                  ng-disabled="lockControls === true"\n                  ng-click="deleteEvent(event)"\n                  href="">\n                  <span class="kuiMenuButton__icon kuiIcon fa-trash"></span>\n                  <span>Delete</span>\n                </button>\n              </div>\n            </div>\n          </td>\n\n        </tr>\n      </tbody>\n\n      <tfoot>\n        <tr>\n          <td colspan="4" class="kuiTableHeaderCell footer-cell">\n          Times are displayed in {{dateFormatTz === \'Browser\' ? \'the browser\' : dateFormatTz}} timezone\n        </td>\n        </tr>\n      </tfoot>\n\n    </table>\n\n\n  </div>\n</div>\n'},3605:function(module,exports,__webpack_require__){"use strict";function validateCalendarId(calendarId,checks){var valid=!0;if(_lodash2.default.each(checks,function(item){return item.valid=!0}),""===calendarId||void 0===calendarId)checks.calendarId.valid=!1;else if(!1===(0,_job_utils.isJobIdValid)(calendarId)){checks.calendarId.valid=!1;var msg="Calendar ID can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";msg+="must start and end with an alphanumeric character",checks.calendarId.message=msg}return _lodash2.default.each(checks,function(item){!1===item.valid&&(valid=!1)}),valid}Object.defineProperty(exports,"__esModule",{value:!0}),exports.validateCalendarId=validateCalendarId;var _job_utils=__webpack_require__(57),_lodash=__webpack_require__(1),_lodash2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_lodash)},3606:function(module,exports){module.exports='<ml-nav-menu name="calendars_list"></ml-nav-menu>\n<ml-new-calendar ng-controller="MlCreateCalendar">\n  <ml-message-bar></ml-message-bar>\n  <div class="new-calendar-container">\n    <div class="kuiViewContent kuiViewContent--constrainedWidth">\n      <h3 class="euiTitle">{{pageTitle}}</h3>\n      <div class="kuiViewContentItem kuiVerticalRhythm">\n        <div class="kuiBar">\n          <div class="kuiBarSection">\n            <div class="kuiButtonGroup">\n              <button\n                class="kuiButton kuiButton--primary"\n                ng-disabled="saveEnabled() === false"\n                ng-click="save()" >\n                Save\n              </button>\n              <button\n                class="kuiButton kuiButton--basic"\n                ng-click="cancel()"\n                ng-disabled="saveLock === true"\n                data-test-subj="btnCancel">\n                Cancel\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="kuiViewContentItem kuiVerticalRhythm">\n        <div class="kuiFormSection" aria-hidden="false">\n          <label for="id" class="kuiFormLabel">\n            Calendar ID\n          </label>\n          <input\n            type="text"\n            ng-disabled="isNewCalendar===false"\n            id="id"\n            name="id"\n            ng-model="calendarId"\n            ng-trim="true"\n            class="kuiTextInput fullWidth"\n            autofocus />\n            <div ng-hide="validation.checks.calendarId.valid" class="validation-error">\n              <div class="euiSpacer euiSpacer--s"></div>\n              {{ ( validation.checks.calendarId.message || "Enter a name for the calendar" ) }}\n            </div>\n          </div>\n          <div class="kuiFormSection" aria-hidden="false">\n            <label for="description" class="kuiFormLabel">\n              Description\n            </label>\n            <input\n            type="text"\n            ng-disabled="isNewCalendar===false"\n            id="description"\n            name="description"\n            ng-model="description"\n            class="kuiTextInput fullWidth" />\n        </div>\n        <div class="kuiFormSection">\n          <label class="kuiFormLabel">\n            Jobs\n          </label>\n          <ml-item-select\n            item-ids=\'jobIds\'\n            all-items=\'allJobs\'\n            placeholder=\'"Jobs"\'\n            external-update-function=\'updateJobsList\'\n            >\n          </ml-item-select>\n        </div>\n        <div class="kuiFormSection">\n          <label class="kuiFormLabel">\n            Groups\n          </label>\n          <ml-item-select\n            item-ids=\'groupIds\'\n            all-items=\'allGroups\'\n            placeholder=\'"Groups"\'\n            allow-tagging=\'true\'\n            tagging-text=\'"(new group)"\'\n            external-update-function=\'updateGroupsList\'\n            >\n          </ml-item-select>\n        </div>\n\n      </div>\n      <div class="kuiViewContentItem kuiVerticalRhythm">\n        <label class="kuiFormLabel">\n          Events\n        </label>\n        <ml-events-list\n          events=\'events\'\n          show-controls=\'true\'\n          lock-controls=\'saveLock\'\n        />\n      </div>\n\n    </div>\n\n  </div>\n</ml-calendars-list>\n'},372:function(module,exports,__webpack_require__){"use strict";function stateFactoryProvider(AppState){function initializeAppState(stateName,defaultState){var appState=new AppState;return appState.fetch(),void 0===appState[stateName]&&(appState[stateName]=_lodash2.default.cloneDeep(defaultState)||{},appState.save()),void 0!==defaultState&&appState[stateName]!==defaultState&&(_lodash2.default.isEqual(Object.keys(defaultState).sort(),Object.keys(appState[stateName]).sort())||(appState[stateName]=_lodash2.default.cloneDeep(defaultState),appState.save())),appState}return function(stateName,defaultState){function updateAppState(){appState.fetch(),void 0===appState[stateName]&&(appState=initializeAppState(stateName,defaultState),_changed=!0)}if("string"!=typeof stateName)throw"stateName needs to be of type `string`";var appState=initializeAppState(stateName,defaultState),listener=(0,_listener_factory.listenerFactoryProvider)()(),_changed=!1,state={get:function(name){return updateAppState(),appState[stateName][name]},set:function(name,value){return updateAppState(),_lodash2.default.isEqual(appState[stateName][name],value)||(appState[stateName][name]=value,appState.save(),_changed=!0),state},reset:function(){return updateAppState(),_lodash2.default.isEqual(appState[stateName],defaultState)||(appState[stateName]=_lodash2.default.cloneDeep(defaultState),appState.save(),_changed=!0),state},watch:listener.watch,unwatch:listener.unwatch,changed:function(){_changed&&(listener.changed.apply(listener,arguments),_changed=!1)}};return state}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.stateFactoryProvider=stateFactoryProvider;var _lodash=__webpack_require__(1),_lodash2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_lodash),_listener_factory=__webpack_require__(473)},373:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.CHART_STATE={NOT_STARTED:0,LOADING:1,LOADED:2,NO_RESULTS:3},exports.JOB_STATE={NOT_STARTED:0,RUNNING:1,FINISHED:2,STOPPING:3}},374:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1),_lodash2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_lodash);__webpack_require__(251);var _job_utils=__webpack_require__(57),_index_utils=__webpack_require__(132);__webpack_require__(2).uiModules.get("apps/ml").service("mlFieldFormatService",function($q,courier,Private,mlJobService){function getFormatsForJob(jobId){var deferred=$q.defer(),jobObj=mlJobService.getJob(jobId),detectors=jobObj.analysis_config.detectors||[],formatsByDetector={},indexPatternId=indexPatternIdsByJob[jobId];if(void 0!==indexPatternId)return getIndexPattern(indexPatternId).then(function(indexPatternData){var fieldsByName=_lodash2.default.get(indexPatternData,"fields.byName",[]);_lodash2.default.each(detectors,function(dtr){var esAgg=(0,_job_utils.mlFunctionToESAggregation)(dtr.function);void 0!==dtr.field_name&&"cardinality"!==esAgg&&(formatsByDetector[dtr.detector_index]=_lodash2.default.get(fieldsByName,[dtr.field_name,"format"]))}),deferred.resolve(formatsByDetector)}).catch(function(err){deferred.reject(err)}),deferred.promise;deferred.resolve(formatsByDetector)}var indexPatternIdsByJob={},formatsByJob={},getIndexPattern=Private(_index_utils.getIndexPatternProvider);this.populateFormats=function(jobIds,indexPatterns){var deferred=$q.defer();_lodash2.default.each(jobIds,function(jobId){var jobObj=mlJobService.getJob(jobId),datafeedIndices=jobObj.datafeed_config.indices,indexPattern=_lodash2.default.find(indexPatterns,function(index){return _lodash2.default.find(datafeedIndices,function(datafeedIndex){return index.get("title")===datafeedIndex})});void 0!==indexPattern&&(indexPatternIdsByJob[jobId]=indexPattern.id)});var promises=jobIds.map(function(jobId){return $q.all([getFormatsForJob(jobId)])});return $q.all(promises).then(function(fmtsByJobByDetector){_lodash2.default.each(fmtsByJobByDetector,function(formatsByDetector,index){formatsByJob[jobIds[index]]=formatsByDetector[0]}),deferred.resolve(formatsByJob)}).catch(function(err){console.log("mlFieldFormatService error populating formats:",err),deferred.reject({formats:{},err:err})}),deferred.promise},this.getFieldFormat=function(jobId,detectorIndex){return _lodash2.default.get(formatsByJob,[jobId,detectorIndex])},this.getFieldFormatFromIndexPattern=function(fullIndexPattern,fieldName,esAggName){var fieldFormat=void 0;if("cardinality"!==esAggName){var indexPatternFields=_lodash2.default.get(fullIndexPattern,"fields.byName",[]);fieldFormat=_lodash2.default.get(indexPatternFields,[fieldName,"format"])}return fieldFormat}})},375:function(module,exports,__webpack_require__){"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var _lodash=__webpack_require__(1),_lodash2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_lodash),_job_utils=__webpack_require__(57),_string_utils=__webpack_require__(43),_index_patterns=__webpack_require__(301);__webpack_require__(2).uiModules.get("apps/ml").service("mlResultsService",function($q,es,ml){this.getScoresByBucket=function(jobIds,earliestMs,latestMs,interval,maxResults){return $q(function(resolve,reject){var obj={success:!0,results:{}},boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}}];if(jobIds&&jobIds.length>0&&(1!==jobIds.length||"*"!==jobIds[0])){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){i>0&&(jobIdFilterStr+=" OR "),jobIdFilterStr+="job_id:",jobIdFilterStr+=jobId}),boolCriteria.push({query_string:{analyze_wildcard:!1,query:jobIdFilterStr}})}es.search({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:bucket",analyze_wildcard:!1}},{bool:{must:boolCriteria}}]}},aggs:{jobId:{terms:{field:"job_id",size:void 0!==maxResults?maxResults:5,order:{anomalyScore:"desc"}},aggs:{anomalyScore:{max:{field:"anomaly_score"}},byTime:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:1,extended_bounds:{min:earliestMs,max:latestMs}},aggs:{anomalyScore:{max:{field:"anomaly_score"}}}}}}}}}).then(function(resp){var dataByJobId=_lodash2.default.get(resp,["aggregations","jobId","buckets"],[]);_lodash2.default.each(dataByJobId,function(dataForJob){var jobId=dataForJob.key,resultsForTime={},dataByTime=_lodash2.default.get(dataForJob,["byTime","buckets"],[]);_lodash2.default.each(dataByTime,function(dataForTime){if(void 0!==_lodash2.default.get(dataForTime,["anomalyScore","value"])){var time=dataForTime.key;resultsForTime[time]=_lodash2.default.get(dataForTime,["anomalyScore","value"])}}),obj.results[jobId]=resultsForTime}),resolve(obj)}).catch(function(resp){reject(resp)})})},this.getScheduledEventsByBucket=function(jobIds,earliestMs,latestMs,interval,maxJobs,maxEvents){return $q(function(resolve,reject){var obj={success:!0,events:{}},boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{exists:{field:"scheduled_events"}}];if(jobIds&&jobIds.length>0&&(1!==jobIds.length||"*"!==jobIds[0])){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){jobIdFilterStr+=(i>0?" OR ":"")+"job_id:"+jobId}),boolCriteria.push({query_string:{analyze_wildcard:!1,query:jobIdFilterStr}})}es.search({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:bucket",analyze_wildcard:!1}},{bool:{must:boolCriteria}}]}},aggs:{jobs:{terms:{field:"job_id",min_doc_count:1,size:maxJobs},aggs:{times:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:1},aggs:{events:{terms:{field:"scheduled_events",size:maxEvents}}}}}}}}}).then(function(resp){var dataByJobId=_lodash2.default.get(resp,["aggregations","jobs","buckets"],[]);_lodash2.default.each(dataByJobId,function(dataForJob){var jobId=dataForJob.key,resultsForTime={},dataByTime=_lodash2.default.get(dataForJob,["times","buckets"],[]);_lodash2.default.each(dataByTime,function(dataForTime){var time=dataForTime.key,events=_lodash2.default.get(dataForTime,["events","buckets"]);resultsForTime[time]=_lodash2.default.map(events,"key")}),obj.events[jobId]=resultsForTime}),resolve(obj)}).catch(function(resp){reject(resp)})})},this.getTopInfluencers=function(jobIds,earliestMs,latestMs,maxFieldNames,maxFieldValues){return $q(function(resolve,reject){var obj={success:!0,influencers:{}},boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}}];if(jobIds&&jobIds.length>0&&(1!==jobIds.length||"*"!==jobIds[0])){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){i>0&&(jobIdFilterStr+=" OR "),jobIdFilterStr+="job_id:",jobIdFilterStr+=jobId}),boolCriteria.push({query_string:{analyze_wildcard:!1,query:jobIdFilterStr}})}es.search({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:influencer",analyze_wildcard:!1}},{bool:{must:boolCriteria}}]}},aggs:{influencerFieldNames:{terms:{field:"influencer_field_name",size:5,order:{maxAnomalyScore:"desc"}},aggs:{maxAnomalyScore:{max:{field:"influencer_score"}},influencerFieldValues:{terms:{field:"influencer_field_value",size:void 0!==maxFieldValues?maxFieldValues:10,order:{maxAnomalyScore:"desc"}},aggs:{maxAnomalyScore:{max:{field:"influencer_score"}},sumAnomalyScore:{sum:{field:"influencer_score"}}}}}}}}}).then(function(resp){var fieldNameBuckets=_lodash2.default.get(resp,["aggregations","influencerFieldNames","buckets"],[]);_lodash2.default.each(fieldNameBuckets,function(nameBucket){var fieldName=nameBucket.key,fieldValues=[],fieldValueBuckets=_lodash2.default.get(nameBucket,["influencerFieldValues","buckets"],[]);_lodash2.default.each(fieldValueBuckets,function(valueBucket){var fieldValueResult={influencerFieldValue:valueBucket.key,maxAnomalyScore:valueBucket.maxAnomalyScore.value,sumAnomalyScore:valueBucket.sumAnomalyScore.value};fieldValues.push(fieldValueResult)}),obj.influencers[fieldName]=fieldValues}),resolve(obj)}).catch(function(resp){reject(resp)})})},this.getTopInfluencerValues=function(jobIds,influencerFieldName,earliestMs,latestMs,maxResults){return $q(function(resolve,reject){var obj={success:!0,results:[]},boolCriteria=[];if(boolCriteria.push({range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}}),jobIds&&jobIds.length>0&&(1!==jobIds.length||"*"!==jobIds[0])){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){i>0&&(jobIdFilterStr+=" OR "),jobIdFilterStr+="job_id:",jobIdFilterStr+=jobId}),boolCriteria.push({query_string:{analyze_wildcard:!1,query:jobIdFilterStr}})}es.search({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:influencer AND influencer_field_name: "+(0,_string_utils.escapeForElasticsearchQuery)(influencerFieldName),analyze_wildcard:!1}},{bool:{must:boolCriteria}}]}},aggs:{influencerFieldValues:{terms:{field:"influencer_field_value",size:void 0!==maxResults?maxResults:2,order:{maxAnomalyScore:"desc"}},aggs:{maxAnomalyScore:{max:{field:"influencer_score"}},sumAnomalyScore:{sum:{field:"influencer_score"}}}}}}}).then(function(resp){var buckets=_lodash2.default.get(resp,["aggregations","influencerFieldValues","buckets"],[]);_lodash2.default.each(buckets,function(bucket){var result={influencerFieldValue:bucket.key,maxAnomalyScore:bucket.maxAnomalyScore.value,sumAnomalyScore:bucket.sumAnomalyScore.value};obj.results.push(result)}),resolve(obj)}).catch(function(resp){reject(resp)})})},this.getOverallBucketScores=function(jobIds,topN,earliestMs,latestMs,interval){return $q(function(resolve,reject){var obj={success:!0,results:{}};ml.overallBuckets({jobId:jobIds,topN:topN,bucketSpan:interval,start:earliestMs,end:latestMs}).then(function(resp){var dataByTime=_lodash2.default.get(resp,["overall_buckets"],[]);_lodash2.default.each(dataByTime,function(dataForTime){var value=_lodash2.default.get(dataForTime,["overall_score"]);void 0!==value&&(obj.results[dataForTime.timestamp]=value)}),resolve(obj)}).catch(function(resp){reject(resp)})})},this.getInfluencerValueMaxScoreByTime=function(jobIds,influencerFieldName,influencerFieldValues,earliestMs,latestMs,interval,maxResults){return $q(function(resolve,reject){var obj={success:!0,results:{}},boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{range:{influencer_score:{gt:0}}}];if(jobIds&&jobIds.length>0&&(1!==jobIds.length||"*"!==jobIds[0])){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){i>0&&(jobIdFilterStr+=" OR "),jobIdFilterStr+="job_id:"+jobId}),boolCriteria.push({query_string:{analyze_wildcard:!1,query:jobIdFilterStr}})}if(influencerFieldValues&&influencerFieldValues.length>0){var influencerFilterStr="";_lodash2.default.each(influencerFieldValues,function(value,i){i>0&&(influencerFilterStr+=" OR "),influencerFilterStr+="influencer_field_value:"+(0,_string_utils.escapeForElasticsearchQuery)(value)}),boolCriteria.push({query_string:{analyze_wildcard:!1,query:influencerFilterStr}})}es.search({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:influencer AND influencer_field_name: "+(0,_string_utils.escapeForElasticsearchQuery)(influencerFieldName),analyze_wildcard:!1}},{bool:{must:boolCriteria}}]}},aggs:{influencerFieldValues:{terms:{field:"influencer_field_value",size:void 0!==maxResults?maxResults:10,order:{maxAnomalyScore:"desc"}},aggs:{maxAnomalyScore:{max:{field:"influencer_score"}},byTime:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:1},aggs:{maxAnomalyScore:{max:{field:"influencer_score"}}}}}}}}}).then(function(resp){var fieldValueBuckets=_lodash2.default.get(resp,["aggregations","influencerFieldValues","buckets"],[]);_lodash2.default.each(fieldValueBuckets,function(valueBucket){var fieldValue=valueBucket.key,fieldValues={},timeBuckets=_lodash2.default.get(valueBucket,["byTime","buckets"],[]);_lodash2.default.each(timeBuckets,function(timeBucket){var time=timeBucket.key,score=timeBucket.maxAnomalyScore.value;fieldValues[time]=score}),obj.results[fieldValue]=fieldValues}),resolve(obj)}).catch(function(resp){reject(resp)})})},this.getCategoryDefinition=function(jobId,categoryId){return $q(function(resolve,reject){var obj={success:!0,categoryId:categoryId,terms:null,regex:null,examples:[]};es.search({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:1,body:{query:{bool:{filter:[{term:{job_id:jobId}},{term:{category_id:categoryId}}]}}}}).then(function(resp){if(0!==resp.hits.total){var source=_lodash2.default.first(resp.hits.hits)._source;obj.categoryId=source.category_id,obj.regex=source.regex,obj.terms=source.terms,obj.examples=source.examples}resolve(obj)}).catch(function(resp){reject(resp)})})},this.getCategoryExamples=function(jobId,categoryIds,maxExamples){return $q(function(resolve,reject){var obj={success:!0,jobId:jobId,examplesByCategoryId:{}};es.search({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:500,body:{query:{bool:{filter:[{term:{job_id:jobId}},{terms:{category_id:categoryIds}}]}}}}).then(function(resp){0!==resp.hits.total&&_lodash2.default.each(resp.hits.hits,function(hit){obj.examplesByCategoryId[hit._source.category_id]=maxExamples?_lodash2.default.slice(hit._source.examples,0,Math.min(hit._source.examples.length,maxExamples)):hit._source.examples}),resolve(obj)}).catch(function(resp){reject(resp)})})},this.getRecordInfluencers=function(jobIds,threshold,earliestMs,latestMs,maxResults){return $q(function(resolve,reject){var obj={success:!0,records:[]},boolCriteria=[{nested:{path:"influencers",query:{bool:{must:[{exists:{field:"influencers"}}]}}}},{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{range:{record_score:{gte:threshold}}}];if(jobIds&&jobIds.length>0&&(1!==jobIds.length||"*"!==jobIds[0])){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){i>0&&(jobIdFilterStr+=" OR "),jobIdFilterStr+="job_id:",jobIdFilterStr+=jobId}),boolCriteria.push({query_string:{analyze_wildcard:!1,query:jobIdFilterStr}})}es.search({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:void 0!==maxResults?maxResults:100,body:{_source:["job_id","detector_index","influencers","record_score"],query:{bool:{filter:[{query_string:{query:"result_type:record",analyze_wildcard:!1}},{bool:{must:boolCriteria}}]}},sort:[{record_score:{order:"desc"}}]}}).then(function(resp){0!==resp.hits.total&&_lodash2.default.each(resp.hits.hits,function(hit){obj.records.push(hit._source)}),resolve(obj)}).catch(function(resp){reject(resp)})})},this.getRecordsForInfluencer=function(jobIds,influencers,threshold,earliestMs,latestMs,maxResults){return $q(function(resolve,reject){var obj={success:!0,records:[]},boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{range:{record_score:{gte:threshold}}}];if(jobIds&&jobIds.length>0&&(1!==jobIds.length||"*"!==jobIds[0])){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){i>0&&(jobIdFilterStr+=" OR "),jobIdFilterStr+="job_id:",jobIdFilterStr+=jobId}),boolCriteria.push({query_string:{analyze_wildcard:!1,query:jobIdFilterStr}})}influencers.length>0&&boolCriteria.push({bool:{should:influencers.map(function(influencer){return{nested:{path:"influencers",query:{bool:{must:[{match:{"influencers.influencer_field_name":influencer.fieldName}},{match:{"influencers.influencer_field_values":influencer.fieldValue}}]}}}}}),minimum_should_match:1}}),es.search({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:void 0!==maxResults?maxResults:100,body:{query:{bool:{filter:[{query_string:{query:"result_type:record",analyze_wildcard:!1}},{bool:{must:boolCriteria}}]}},sort:[{record_score:{order:"desc"}}]}}).then(function(resp){0!==resp.hits.total&&_lodash2.default.each(resp.hits.hits,function(hit){obj.records.push(hit._source)}),resolve(obj)}).catch(function(resp){reject(resp)})})},this.getRecordsForDetector=function(jobId,detectorIndex,checkForInfluencers,influencerFieldName,influencerFieldValue,threshold,earliestMs,latestMs,maxResults){return $q(function(resolve,reject){var obj={success:!0,records:[]},boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{term:{job_id:jobId}},{term:{detector_index:detectorIndex}},{range:{record_score:{gte:threshold}}}];influencerFieldName&&influencerFieldValue?boolCriteria.push({nested:{path:"influencers",query:{bool:{must:[{match:{"influencers.influencer_field_name":influencerFieldName}},{match:{"influencers.influencer_field_values":influencerFieldValue}}]}}}}):!0===checkForInfluencers&&boolCriteria.push({nested:{path:"influencers",query:{bool:{must:[{exists:{field:"influencers"}}]}}}}),es.search({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:void 0!==maxResults?maxResults:100,body:{query:{bool:{filter:[{query_string:{query:"result_type:record",analyze_wildcard:!1}},{bool:{must:boolCriteria}}]}},sort:[{record_score:{order:"desc"}}]}}).then(function(resp){0!==resp.hits.total&&_lodash2.default.each(resp.hits.hits,function(hit){obj.records.push(hit._source)}),resolve(obj)}).catch(function(resp){reject(resp)})})},this.getRecords=function(jobIds,threshold,earliestMs,latestMs,maxResults){return this.getRecordsForInfluencer(jobIds,[],threshold,earliestMs,latestMs,maxResults)},this.getRecordsForCriteria=function(jobIds,criteriaFields,threshold,earliestMs,latestMs,maxResults){return $q(function(resolve,reject){var obj={success:!0,records:[]},boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{range:{record_score:{gte:threshold}}}];if(jobIds&&jobIds.length>0&&(1!==jobIds.length||"*"!==jobIds[0])){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){i>0&&(jobIdFilterStr+=" OR "),jobIdFilterStr+="job_id:",jobIdFilterStr+=jobId}),boolCriteria.push({query_string:{analyze_wildcard:!1,query:jobIdFilterStr}})}_lodash2.default.each(criteriaFields,function(criteria){boolCriteria.push({term:_defineProperty({},criteria.fieldName,criteria.fieldValue)})}),es.search({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:void 0!==maxResults?maxResults:100,body:{query:{bool:{filter:[{query_string:{query:"result_type:record",analyze_wildcard:!1}},{bool:{must:boolCriteria}}]}},sort:[{record_score:{order:"desc"}}]}}).then(function(resp){0!==resp.hits.total&&_lodash2.default.each(resp.hits.hits,function(hit){obj.records.push(hit._source)}),resolve(obj)}).catch(function(resp){reject(resp)})})},this.getMetricData=function(index,types,entityFields,query,metricFunction,metricFieldName,timeFieldName,earliestMs,latestMs,interval){return $q(function(resolve,reject){var obj={success:!0,results:{}},mustCriteria=[],shouldCriteria=[];types&&types.length&&mustCriteria.push({terms:{_type:types}}),mustCriteria.push({range:_defineProperty({},timeFieldName,{gte:earliestMs,lte:latestMs,format:"epoch_millis"})}),query&&mustCriteria.push(query),_lodash2.default.each(entityFields,function(entity){0!==entity.fieldValue.length?mustCriteria.push({term:_defineProperty({},entity.fieldName,entity.fieldValue)}):(shouldCriteria.push({bool:{must:[{term:_defineProperty({},entity.fieldName,"")}]}}),shouldCriteria.push({bool:{must_not:[{exists:{field:entity.fieldName}}]}}))});var body={query:{bool:{must:mustCriteria}},size:0,_source:{excludes:[]},aggs:{byTime:{date_histogram:{field:timeFieldName,interval:interval,min_doc_count:0}}}};if(shouldCriteria.length>0&&(body.query.bool.should=shouldCriteria,body.query.bool.minimum_should_match=shouldCriteria.length/2),void 0!==metricFieldName&&""!==metricFieldName){body.aggs.byTime.aggs={};var metricAgg=_defineProperty({},metricFunction,{field:metricFieldName});"percentiles"===metricFunction&&(metricAgg[metricFunction].percents=[_job_utils.ML_MEDIAN_PERCENTS]),body.aggs.byTime.aggs.metric=metricAgg}es.search({index:index,body:body}).then(function(resp){var dataByTime=_lodash2.default.get(resp,["aggregations","byTime","buckets"],[]);_lodash2.default.each(dataByTime,function(dataForTime){if("count"===metricFunction)obj.results[dataForTime.key]=dataForTime.doc_count;else{var value=_lodash2.default.get(dataForTime,["metric","value"]),values=_lodash2.default.get(dataForTime,["metric","values"]);if(0===dataForTime.doc_count)obj.results[dataForTime.key]=null;else if(void 0!==value)obj.results[dataForTime.key]=value;else if(void 0!==values){var medianValues=values[_job_utils.ML_MEDIAN_PERCENTS];obj.results[dataForTime.key]=isNaN(medianValues)?null:medianValues}else obj.results[dataForTime.key]=null}}),resolve(obj)}).catch(function(resp){reject(resp)})})},this.getEventRateData=function(index,query,timeFieldName,earliestMs,latestMs,interval){return $q(function(resolve,reject){var obj={success:!0,results:{}},mustCriteria=[{range:_defineProperty({},timeFieldName,{gte:earliestMs,lte:latestMs,format:"epoch_millis"})}];query&&mustCriteria.push(query),es.search({index:index,size:0,body:{query:{bool:{must:mustCriteria}},_source:{excludes:[]},aggs:{eventRate:{date_histogram:{field:timeFieldName,interval:interval,min_doc_count:0,extended_bounds:{min:earliestMs,max:latestMs}}}}}}).then(function(resp){var dataByTimeBucket=_lodash2.default.get(resp,["aggregations","eventRate","buckets"],[]);_lodash2.default.each(dataByTimeBucket,function(dataForTime){var time=dataForTime.key;obj.results[time]=dataForTime.doc_count}),obj.total=resp.hits.total,resolve(obj)}).catch(function(resp){reject(resp)})})},this.getModelPlotOutput=function(jobId,detectorIndex,criteriaFields,earliestMs,latestMs,interval,aggType){return $q(function(resolve,reject){var obj={success:!0,results:{}},modelAggs=void 0===aggType?{max:"max",min:"min"}:{max:aggType.max,min:aggType.min},mustCriteria=[{term:{job_id:jobId}},{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}}];_lodash2.default.each(criteriaFields,function(criteria){mustCriteria.push({term:_defineProperty({},criteria.fieldName,criteria.fieldValue)})});var shouldCriteria=[{term:{detector_index:detectorIndex}},{bool:{must_not:[{exists:{field:"detector_index"}}]}}];es.search({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:model_plot",analyze_wildcard:!0}},{bool:{must:mustCriteria,should:shouldCriteria,minimum_should_match:1}}]}},aggs:{times:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:0},aggs:{actual:{avg:{field:"actual"}},modelUpper:_defineProperty({},modelAggs.max,{field:"model_upper"}),modelLower:_defineProperty({},modelAggs.min,{field:"model_lower"})}}}}}).then(function(resp){var aggregationsByTime=_lodash2.default.get(resp,["aggregations","times","buckets"],[]);_lodash2.default.each(aggregationsByTime,function(dataForTime){var time=dataForTime.key,modelUpper=_lodash2.default.get(dataForTime,["modelUpper","value"]),modelLower=_lodash2.default.get(dataForTime,["modelLower","value"]),actual=_lodash2.default.get(dataForTime,["actual","value"]);void 0!==modelUpper&&!1!==isFinite(modelUpper)||(modelUpper=null),void 0!==modelLower&&!1!==isFinite(modelLower)||(modelLower=null),obj.results[time]={actual:actual,modelUpper:modelUpper,modelLower:modelLower}}),resolve(obj)}).catch(function(resp){reject(resp)})})},this.getRecordMaxScoreByTime=function(jobId,criteriaFields,earliestMs,latestMs,interval){return $q(function(resolve,reject){var obj={success:!0,results:{}},mustCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{term:{job_id:jobId}}],shouldCriteria=[];_lodash2.default.each(criteriaFields,function(criteria){if(0!==criteria.fieldValue.length)mustCriteria.push({term:_defineProperty({},criteria.fieldName,criteria.fieldValue)});else{var emptyFieldCondition={bool:{must:[{term:{}}]}};emptyFieldCondition.bool.must[0].term[criteria.fieldName]="",shouldCriteria.push(emptyFieldCondition),shouldCriteria.push({bool:{must_not:[{exists:{field:criteria.fieldName}}]}})}}),es.search({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:record",analyze_wildcard:!0}},{bool:{must:mustCriteria}}]}},aggs:{times:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:1},aggs:{recordScore:{max:{field:"record_score"}}}}}}}).then(function(resp){var aggregationsByTime=_lodash2.default.get(resp,["aggregations","times","buckets"],[]);_lodash2.default.each(aggregationsByTime,function(dataForTime){var time=dataForTime.key;obj.results[time]={score:_lodash2.default.get(dataForTime,["recordScore","value"])}}),resolve(obj)}).catch(function(resp){reject(resp)})})}})},376:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3493),__webpack_require__(3494)},377:function(module,exports,__webpack_require__){(function(Buffer){function pad(n,d){d=d||2;var neg=n<0;return neg&&(n*=-1),n=n.toString(),(neg?"-":"")+"000000000000000000".substr(0,d-n.length)+n}var RRule=__webpack_require__(486).RRule,_types={BINARY:{format:function(value){return value.toString("base64")},parse:function(value){return new Buffer(value,"base64")}},BOOLEAN:{format:function(value){return value?"TRUE":"FALSE"},parse:function(value){return"TRUE"==value.toUpperCase()}},"CAL-ADDRESS":{format:function(value){var v=value.toString();return 0!=v.lastIndexOf("mailto:")&&(v="mailto:"+v),v}},DATE:{format:function(value){return value instanceof Date||(value=new Date(value)),value.getFullYear()+pad(value.getMonth()+1)+pad(value.getDate())},parse:function(value){var dt=new Date(parseInt(value.substr(0,4),10),parseInt(value.substr(4,2),10)-1,parseInt(value.substr(6,2),10),0,0,0);return dt.date_only=!0,dt}},"DATE-TIME":{format:function(value,parameters){return value instanceof Date||(value=new Date(value)),value.date_only||"DATE"===parameters.VALUE?format_value("DATE",value):value.getUTCFullYear()+pad(value.getUTCMonth()+1)+pad(value.getUTCDate())+"T"+format_value("TIME",value)},parse:function(value,parameters,calendar){if("DATE"===parameters.VALUE||value.length<=8)return _types.DATE.parse(value);var tz=parameters.TZID,d=[parseInt(value.substr(0,4),10),parseInt(value.substr(4,2),10),parseInt(value.substr(6,2),10),parseInt(value.substr(9,2),10),parseInt(value.substr(11,2),10),parseInt(value.substr(13,2),10)],utc=value.length>15&&"Z"===value[15];if(void 0!==tz){var tzobj=calendar.timezone(tz);if(!tzobj)throw new Error("Unable to load TZ data for "+tz);return tzobj.fromLocalTime(d)}return d[1]-=1,utc?new Date(Date.UTC.apply(null,d)):new Date(d[0],d[1],d[2],d[3],d[4],d[5])}},DURATION:{format:function(value){var neg=value<0;neg&&(value*=-1);var w=Math.floor(value/604800);value-=60*w*60*24*7;var d=Math.floor(value/86400);value-=60*d*60*24;var h=Math.floor(value/3600);value-=60*h*60;var m=Math.floor(value/60);value-=60*m;var s=value,dur=["P"];return neg&&dur.unshift("-"),w&&dur.push(w+"W"),d&&dur.push(d+"D"),(h||m||s)&&dur.push("T"),h&&dur.push(h+"H"),m&&dur.push(m+"M"),s&&dur.push(s+"S"),dur.join("")},parse:function(value){for(var match=/(-)?P(\d+W)?(\d+D)?(?:T(\d+H)?(\d+M)?(\d+S)?)?/.exec(value).slice(1),mul=[-1,604800,86400,3600,60,1],dur=0,i=1;i<match.length;++i)void 0!==match[i]&&(dur+=parseInt(match[i],10)*mul[i]);return void 0!==match[0]&&(dur*=mul[0]),dur}},FLOAT:{format:function(value){return value.toString()}},INTEGER:{format:function(value){return value.toString()}},PERIOD:{format:function(value){return format_value("DATE-TIME",value[0])+"/"+format_value(value[1]instanceof Date?"DATE-TIME":"DURATION",value[1])}},RECUR:{format:function(value){return(value instanceof RRule?value:new RRule(value)).toString()},parse:function(value){return RRule.parse(value)}},TEXT:{format:function(value){return(value||"").toString().replace(/([\\,;])/g,"\\$1").replace(/\n/g,"\\n")},parse:function(value){return value.replace(/\\([\\,;])/g,"$1").replace(/\\[nN]/g,"\n")}},TIME:{format:function(value){return value instanceof Date||(value=new Date(value)),pad(value.getUTCHours())+pad(value.getUTCMinutes())+pad(value.getUTCSeconds())+"Z"},parse:function(value){return value.length>6&&"Z"===value[6]?new Date(Date.UTC(0,0,0,parseInt(value.substr(0,2),10),parseInt(value.substr(2,2),10),parseInt(value.substr(4,2),10))):new Date(0,0,0,parseInt(value.substr(0,2),10),parseInt(value.substr(2,2),10),parseInt(value.substr(4,2),10))}},URI:{format:function(value){return value.toString()}},"UTC-OFFSET":{format:function(value){var west=value<0;return west&&(value*=-1),(west?"-":"+")+pad(value,4)}}},format_value=exports.format_value=function(type,value,parameters){if(void 0===value)return"";var fmt=_types[type||"TEXT"];if(void 0===fmt)throw Error("Invalid iCalendar datatype: "+type);return Array.isArray(value)&&"PERIOD"!==type||"PERIOD"===type&&value[0]&&Array.isArray(value[0])?value.map(function(v){return fmt.format(v,parameters||{})}).join(","):fmt.format(value,parameters||{})},parse_value=exports.parse_value=function(type,value,parameters,calendar,expect_list){if(expect_list)return value.split(",").map(function(x){return parse_value(type,x,parameters,calendar)});var fmt=_types[type||"TEXT"];if(void 0===fmt)throw Error("Invalid iCalendar datatype: "+type);parameters=parameters||{};var otherFmt=parameters.VALUE&&_types[parameters.VALUE];return otherFmt&&(fmt=otherFmt),fmt.parse?fmt.parse(value,parameters,calendar):value}}).call(exports,__webpack_require__(28).Buffer)},43:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function replaceStringTokens(str,valuesByTokenName,encodeForURI){return String(str).replace(/\$([^?&$\'"]{1,40})\$/g,function(match,name){var tokenValue=_lodash2.default.get(valuesByTokenName,name,null);return!0===encodeForURI&&null!==tokenValue&&(tokenValue=encodeURIComponent(tokenValue)),null!==tokenValue?tokenValue:match})}function detectorToString(dtr){var txt="";return void 0!==dtr.function&&""!==dtr.function?(txt+=dtr.function,void 0!==dtr.field_name&&""!==dtr.field_name&&(txt+="("+quoteField(dtr.field_name)+")")):void 0!==dtr.field_name&&""!==dtr.field_name&&(txt+=quoteField(dtr.field_name)),void 0!==dtr.by_field_name&&""!==dtr.by_field_name&&(txt+=" by "+quoteField(dtr.by_field_name)),void 0!==dtr.over_field_name&&""!==dtr.over_field_name&&(txt+=" over "+quoteField(dtr.over_field_name)),void 0!==dtr.use_null&&(txt+=" use_null="+dtr.use_null),void 0!==dtr.partition_field_name&&""!==dtr.partition_field_name&&(txt+=" partition_field_name="+quoteField(dtr.partition_field_name)),void 0!==dtr.exclude_frequent&&""!==dtr.exclude_frequent&&(txt+=" exclude_frequent="+dtr.exclude_frequent),txt}function quoteField(field){return field.match(/\W/g)?'"'+field+'"':field}function sortByKey(list,reverse,comparator){var keys=_lodash2.default.sortBy(_lodash2.default.keys(list),function(key){return comparator?comparator(list[key],key):key});return reverse&&(keys=keys.reverse()),_lodash2.default.object(keys,_lodash2.default.map(keys,function(key){return list[key]}))}function guessTimeFormat(time){var format="",matched=!1;if(isNaN(time)){var match=void 0;if(!matched){var reg="";if(reg+="(",reg+="(",reg+="(\\d{4})",reg+="([-/.\\s])",reg+="(",reg+="([01]\\d)",reg+="|",reg+="(\\w{3})",reg+=")",reg+="([-/.\\s])",reg+="([0-3]\\d)",reg+=")",reg+="|",reg+="(",reg+="(",reg+="(\\d{1,2})",reg+="|",reg+="(\\w{3})",reg+=")",reg+="([-/.\\s])",reg+="(",reg+="(\\d{1,2})",reg+="|",reg+="(\\w{3})",reg+=")",reg+="([-/.\\s])",reg+="(\\d{4})",reg+=")",reg+=")",reg+="([T\\s])?",reg+="([0-2]\\d)",reg+="([:.])",reg+="([0-5]\\d)",reg+="(",reg+="([:.])",reg+="([0-5]\\d)",reg+=")?",reg+="(",reg+="([:.])",reg+="(\\d{3})",reg+=")?",reg+="(",reg+="([+-]\\d{2}[:.]\\d{2}[:.]\\d{2})",reg+="|",reg+="([+-]\\d{2}[:.]\\d{2})",reg+="|",reg+="([+-]\\d{6})",reg+="|",reg+="([+-]\\d{4})",reg+="|",reg+="(Z)",reg+="|",reg+="([+-]\\d{2})",reg+="|",reg+="(",reg+="(\\s)",reg+="(\\w{1,4})",reg+=")",reg+=")?",console.log("guessTimeFormat: time format regex: "+reg),match=time.match(new RegExp(reg))){if(void 0!==match[2]?(format+="yyyy",format+=match[4],void 0!==match[6]?format+="MM":void 0!==match[7]&&(format+="MMM"),format+=match[8],format+="dd"):void 0!==match[10]&&(void 0!==match[13]?(format+="MMM",format+=match[14],format+="dd"):void 0!==match[17]?(format+="dd",format+=match[14],format+="MMM"):void 0!==match[12]&&+match[12]>12?(format+="dd",format+=match[14],format+="MM"):(format+="MM",format+=match[14],format+="dd"),format+=match[18],format+="yyyy"),format+="T"===match[20]?"'"+match[20]+"'":match[20],format+="HH",format+=match[22],format+="mm",void 0!==match[24]&&(format+=match[25],format+="ss"),void 0!==match[27]&&(format+=match[28],format+="SSS"),void 0!==match[31])format+="XXXXX";else if(void 0!==match[32])format+="XXX";else if(void 0!==match[33])format+="XXXX";else if(void 0!==match[34])format+="Z";else if(void 0!==match[35]||void 0!==match[36])format+="X";else if(void 0!==match[37]){void 0!==match[38]&&(format+=match[38]);for(var i=0;i<match[39].length;i++)format+="z"}matched=!0}}}else format=time>1e10?"epoch_ms":"epoch",matched=!0;return matched?console.log("guessTimeFormat: guessed time format: ",format):console.log("guessTimeFormat: time format could not be guessed from: "+time),format}function toLocaleString(x){var result=x;if(x&&"number"==typeof x){var parts=x.toString().split(".");parts[0]=parts[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),result=parts.join(".")}return result}function mlEscape(str){var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return String(str).replace(/[&<>"'\/]/g,function(s){return entityMap[s]})}function escapeForElasticsearchQuery(str){return String(str).replace(/[-[\]{}()+!<>=?:\/\\^"~*&|\s]/g,"\\$&")}function isWebUrl(str){var absoluteUrl=(0,_relative_to_absolute.relativeToAbsolute)(str);return absoluteUrl.startsWith("http://")||absoluteUrl.startsWith("https://")}function calculateTextWidth(txt,isNumber,elementSelection){txt=isNumber?_d2.default.format(",")(txt):txt;var svg=elementSelection,$el=void 0;if(void 0===elementSelection){$el=_d2.default.select("body").append("div"),svg=$el.append("svg")}var tempLabelText=svg.append("g").attr("class","temp-axis-label tick").selectAll("text.temp.axis").data("a").enter().append("text").text(txt),width=tempLabelText[0][0].getBBox().width;return _d2.default.select(".temp-axis-label").remove(),void 0!==$el&&$el.remove(),Math.ceil(width)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.replaceStringTokens=replaceStringTokens,exports.detectorToString=detectorToString,exports.sortByKey=sortByKey,exports.guessTimeFormat=guessTimeFormat,exports.toLocaleString=toLocaleString,exports.mlEscape=mlEscape,exports.escapeForElasticsearchQuery=escapeForElasticsearchQuery,exports.isWebUrl=isWebUrl,exports.calculateTextWidth=calculateTextWidth;var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_d=__webpack_require__(15),_d2=_interopRequireDefault(_d),_relative_to_absolute=__webpack_require__(1033)},473:function(module,exports,__webpack_require__){"use strict";function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function listenerFactoryProvider(){return function(){var listeners=[];return{changed:function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];listeners.forEach(function(listener){return listener.apply(void 0,_toConsumableArray(args))})},watch:function(listener){listeners.push(listener)},unwatch:function(listener){var index=listeners.indexOf(listener);index>-1&&listeners.splice(index,1)},unwatchAll:function(){listeners.splice(0)}}}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.listenerFactoryProvider=listenerFactoryProvider},474:function(module,exports,__webpack_require__){"use strict";function addItemToRecentlyAccessed(page,itemId,url){var pageLabel="",id="ml-job-"+itemId;switch(page){case"explorer":pageLabel="Anomaly Explorer";break;case"timeseriesexplorer":pageLabel="Single Metric Viewer";break;case"jobs/new_job/datavisualizer":pageLabel="Data Visualizer",id="ml-datavisualizer-"+itemId;break;default:return void console.error("addItemToRecentlyAccessed - No page specified")}url="ml#/"+page+"/"+url,_persisted_log.recentlyAccessed.add(url,"ML - "+itemId+" - "+pageLabel,id)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.addItemToRecentlyAccessed=addItemToRecentlyAccessed;var _persisted_log=__webpack_require__(130)},475:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.DATAFEED_STATE={STARTED:"started",STARTING:"starting",STOPPED:"stopped",STOPPING:"stopping"},exports.FORECAST_REQUEST_STATE={FAILED:"failed",FINISHED:"finished",SCHEDULED:"scheduled",STARTED:"started"},exports.JOB_STATE={CLOSED:"closed",CLOSING:"closing",FAILED:"failed",OPENED:"opened",OPENING:"opening"}},476:function(module,exports,__webpack_require__){"use strict";function getMostSevereMessageStatus(messages){var statuses=messages.map(function(m){return m.status});return[_validation.VALIDATION_STATUS.INFO,_validation.VALIDATION_STATUS.WARNING,_validation.VALIDATION_STATUS.ERROR].reduce(function(previous,current){return contains(statuses,current)?current:previous},_validation.VALIDATION_STATUS.SUCCESS)}function addJobValidationMethods($scope,service){$scope.getDuration=function(){return{start:$scope.formConfig.start,end:$scope.formConfig.end}},$scope.isCurrentJobConfig=!1,$scope.$watch("formConfig",function(){$scope.isCurrentJobConfig=!1},!0),$scope.getJobConfig=function(){return $scope.isCurrentJobConfig=!0,service.getJobFromConfig($scope.formConfig)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getMostSevereMessageStatus=getMostSevereMessageStatus,exports.addJobValidationMethods=addJobValidationMethods;var _validation=__webpack_require__(1158),contains=function(arr,str){return arr.findIndex(function(v){return v===str})>=0}},480:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3401)},481:function(module,exports,__webpack_require__){"use strict";function FieldsServiceProvider(es,ml){function getCardinalityOfFields(index,types,fieldNames,query,timeFieldName,earliestMs,latestMs){return ml.getCardinalityOfFields({index:index,types:types,fieldNames:fieldNames,query:query,timeFieldName:timeFieldName,earliestMs:earliestMs,latestMs:latestMs})}function getTimeFieldRange(index,timeFieldName,query){return ml.getTimeFieldRange({index:index,timeFieldName:timeFieldName,query:query})}return{getCardinalityOfFields:getCardinalityOfFields,getTimeFieldRange:getTimeFieldRange}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.FieldsServiceProvider=FieldsServiceProvider},482:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3441),__webpack_require__(3443)},483:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment),_parse_interval=__webpack_require__(107),_fields_service=__webpack_require__(481),_anomaly_utils=__webpack_require__(260),_string_utils=__webpack_require__(43),_job_utils=__webpack_require__(57);__webpack_require__(2).uiModules.get("apps/ml").service("mlJobService",function($rootScope,$http,$q,es,ml,mlMessageBarService,Private){function checkSaveResponse(resp,origJob){if(!resp)return console.log("checkSaveResponse(): response is empty"),!1;if(resp.job_id){if(resp.job_id===origJob.job_id)return console.log("checkSaveResponse(): save successful"),!0}else if(resp.errorCode)return console.log("checkSaveResponse(): save failed",resp),!1}function processBasicJobInfo(mlJobService,jobsList){var processedJobsList=[],detectorDescriptionsByJob={},detectorsByJob={},customUrlsByJob={},jobsListCopy=_lodash2.default.cloneDeep(jobsList);return _lodash2.default.each(jobsListCopy,function(jobObj){var analysisConfig=jobObj.analysis_config,bucketSpan=(0,_parse_interval.parseInterval)(analysisConfig.bucket_span),job={id:jobObj.job_id,bucketSpanSeconds:bucketSpan.asSeconds()};_lodash2.default.has(jobObj,"description")&&!1===/^\s*$/.test(jobObj.description)?job.description=jobObj.description:job.description=jobObj.job_id,job.detectorDescriptions=[],job.detectors=[];var detectors=_lodash2.default.get(analysisConfig,"detectors",[]);_lodash2.default.each(detectors,function(detector){_lodash2.default.has(detector,"detector_description")&&(job.detectorDescriptions.push(detector.detector_description),job.detectors.push(detector))}),_lodash2.default.has(jobObj,"custom_settings.custom_urls")&&(job.customUrls=[],_lodash2.default.each(jobObj.custom_settings.custom_urls,function(url){_lodash2.default.has(url,"url_name")&&_lodash2.default.has(url,"url_value")&&(0,_string_utils.isWebUrl)(url.url_value)&&job.customUrls.push(url)}),job.customUrls.length>0&&(customUrlsByJob[job.id]=job.customUrls)),mlJobService.jobDescriptions[job.id]=job.description,detectorDescriptionsByJob[job.id]=job.detectorDescriptions,detectorsByJob[job.id]=job.detectors,mlJobService.basicJobs[job.id]=job,processedJobsList.push(job)}),detectorDescriptionsByJob=(0,_anomaly_utils.labelDuplicateDetectorDescriptions)(detectorDescriptionsByJob),_lodash2.default.each(detectorsByJob,function(dtrs,jobId){_lodash2.default.each(dtrs,function(dtr,i){dtr.detector_description=detectorDescriptionsByJob[jobId][i]})}),mlJobService.detectorsByJob=detectorsByJob,mlJobService.customUrlsByJob=customUrlsByJob,processedJobsList}function createJobStats(jobsList,jobStats){jobStats.activeNodes.value=0,jobStats.total.value=0,jobStats.open.value=0,jobStats.closed.value=0,jobStats.failed.value=0,jobStats.activeDatafeeds.value=0;var mlNodes={},failedJobs=0;_lodash2.default.each(jobsList,function(job){"opened"===job.state?jobStats.open.value++:"closed"===job.state?jobStats.closed.value++:"failed"===job.state&&failedJobs++,job.datafeed_config&&"started"===job.datafeed_config.state&&jobStats.activeDatafeeds.value++,job.node&&job.node.name&&(mlNodes[job.node.name]={})}),jobStats.total.value=jobsList.length,failedJobs?(jobStats.failed.value=failedJobs,jobStats.failed.show=!0):jobStats.failed.show=!1,jobStats.activeNodes.value=Object.keys(mlNodes).length}function createJobUrls(jobsList,jobUrls){_lodash2.default.each(jobsList,function(job){if(job.data_counts){var from=(0,_moment2.default)(job.data_counts.earliest_record_timestamp).toISOString(),to=(0,_moment2.default)(job.data_counts.latest_record_timestamp).toISOString(),path="?_g=(ml:(jobIds:!('"+job.job_id+"'))";path+=",refreshInterval:(display:Off,pause:!f,value:0),time:(from:'"+from+"'",path+=",mode:absolute,to:'"+to+"'",path+="))&_a=(filters:!(),query:(query_string:(analyze_wildcard:!t,query:'*')))",jobUrls[job.job_id]?jobUrls[job.job_id].url=path:jobUrls[job.job_id]={url:path}}})}var msgs=mlMessageBarService,jobs=[],datafeedIds={};this.currentJob=void 0,this.jobs=[],this.basicJobs={},this.jobDescriptions={},this.detectorsByJob={},this.customUrlsByJob={},this.jobStats={activeNodes:{label:"Active ML Nodes",value:0,show:!0},total:{label:"Total jobs",value:0,show:!0},open:{label:"Open jobs",value:0,show:!0},closed:{label:"Closed jobs",value:0,show:!0},failed:{label:"Failed jobs",value:0,show:!1},activeDatafeeds:{label:"Active datafeeds",value:0,show:!0}},this.jobUrls={},this.getBlankJob=function(){return{job_id:"",description:"",groups:[],analysis_config:{bucket_span:"15m",influencers:[],detectors:[]},data_description:{time_field:"",time_format:"",field_delimiter:"",quote_character:'"',format:"delimited"}}},this.loadJobs=function(){function error(err){console.log("MlJobsList error getting list of jobs:",err),msgs.error("Jobs list could not be retrieved"),msgs.error("",err),deferred.reject({jobs:jobs,err:err})}var _this=this,deferred=$q.defer();return jobs=[],datafeedIds={},ml.jobs().then(function(resp){_angular2.default.copy(resp.jobs,jobs),ml.jobStats().then(function(statsResp){for(var i=0;i<jobs.length;i++){var job=jobs[i];job.data_counts={},job.model_size_stats={},job.datafeed_config={};for(var j=0;j<statsResp.jobs.length;j++)if(job.job_id===statsResp.jobs[j].job_id){var jobStats=_angular2.default.copy(statsResp.jobs[j]);job.state=jobStats.state,job.data_counts=jobStats.data_counts,job.model_size_stats=jobStats.model_size_stats,jobStats.node&&(job.node=jobStats.node),jobStats.open_time&&(job.open_time=jobStats.open_time)}}_this.loadDatafeeds().then(function(datafeedsResp){for(var _i=0;_i<jobs.length;_i++)for(var _j=0;_j<datafeedsResp.datafeeds.length;_j++)jobs[_i].job_id===datafeedsResp.datafeeds[_j].job_id&&(jobs[_i].datafeed_config=datafeedsResp.datafeeds[_j],datafeedIds[jobs[_i].job_id]=datafeedsResp.datafeeds[_j].datafeed_id);processBasicJobInfo(_this,jobs),_this.jobs=jobs,createJobStats(_this.jobs,_this.jobStats),createJobUrls(_this.jobs,_this.jobUrls),deferred.resolve({jobs:_this.jobs})})}).catch(function(err){error(err)})}).catch(function(err){error(err)}),deferred.promise},this.refreshJob=function(jobId){function error(err){console.log("MlJobsList error getting list of jobs:",err),msgs.error("Jobs list could not be retrieved"),msgs.error("",err),deferred.reject({jobs:jobs,err:err})}var _this2=this,deferred=$q.defer();return ml.jobs({jobId:jobId}).then(function(resp){console.log("refreshJob query response:",resp);var newJob={};resp.jobs&&resp.jobs.length&&(_angular2.default.copy(resp.jobs[0],newJob),ml.jobStats({jobId:jobId}).then(function(statsResp){for(var j=0;j<statsResp.jobs.length;j++)if(newJob.job_id===statsResp.jobs[j].job_id){var statsJob=statsResp.jobs[j];newJob.state=statsJob.state,newJob.data_counts={},newJob.model_size_stats={},_angular2.default.copy(statsJob.data_counts,newJob.data_counts),_angular2.default.copy(statsJob.model_size_stats,newJob.model_size_stats),newJob.node&&_angular2.default.copy(statsJob.node,newJob.node),statsJob.open_time&&(newJob.open_time=statsJob.open_time)}for(var i=0;i<jobs.length;i++)jobs[i].job_id===newJob.job_id&&(jobs[i]=newJob);var datafeedId=_this2.getDatafeedId(jobId);_this2.loadDatafeeds(datafeedId).then(function(datafeedsResp){for(var _i2=0;_i2<jobs.length;_i2++)for(var _j2=0;_j2<datafeedsResp.datafeeds.length;_j2++)jobs[_i2].job_id===datafeedsResp.datafeeds[_j2].job_id&&(jobs[_i2].datafeed_config=datafeedsResp.datafeeds[_j2],datafeedIds[jobs[_i2].job_id]=datafeedsResp.datafeeds[_j2].datafeed_id);_this2.jobs=jobs,createJobStats(_this2.jobs,_this2.jobStats),createJobUrls(_this2.jobs,_this2.jobUrls),deferred.resolve({jobs:_this2.jobs})})}).catch(function(err){error(err)}))}).catch(function(err){error(err)}),deferred.promise},this.loadDatafeeds=function(datafeedId){function error(err){console.log("loadDatafeeds error getting list of datafeeds:",err),msgs.error("datafeeds list could not be retrieved"),msgs.error("",err),deferred.reject({jobs:jobs,err:err})}var deferred=$q.defer(),datafeeds=[],sId=void 0!==datafeedId?{datafeed_id:datafeedId}:void 0;return ml.datafeeds(sId).then(function(resp){_angular2.default.copy(resp.datafeeds,datafeeds),ml.datafeedStats().then(function(statsResp){for(var i=0;i<datafeeds.length;i++)for(var datafeed=datafeeds[i],j=0;j<statsResp.datafeeds.length;j++)datafeed.datafeed_id===statsResp.datafeeds[j].datafeed_id&&(datafeed.state=statsResp.datafeeds[j].state);deferred.resolve({datafeeds:datafeeds})}).catch(function(err){error(err)})}).catch(function(err){error(err)}),deferred.promise},this.updateSingleJobCounts=function(jobId){function error(err){console.log("updateSingleJobCounts error getting job details:",err),msgs.error("Job details could not be retrieved for "+jobId),msgs.error("",err),deferred.reject({jobs:jobs,err:err})}var _this3=this,deferred=$q.defer();return console.log("mlJobService: update job counts and state for "+jobId),ml.jobStats({jobId:jobId}).then(function(resp){if(console.log("updateSingleJobCounts controller query response:",resp),resp.jobs&&resp.jobs.length){var newJob={};_angular2.default.copy(resp.jobs[0],newJob);for(var i=0;i<jobs.length;i++)if(jobs[i].job_id===jobId){var job=jobs[i];job.state=newJob.state,job.data_counts=newJob.data_counts,newJob.model_size_stats&&(job.model_size_stats=newJob.model_size_stats),newJob.node&&(job.node=newJob.node),newJob.open_time&&(job.open_time=newJob.open_time)}var datafeedId=_this3.getDatafeedId(jobId);_this3.loadDatafeeds(datafeedId).then(function(datafeedsResp){for(var _i3=0;_i3<jobs.length;_i3++)for(var j=0;j<datafeedsResp.datafeeds.length;j++)jobs[_i3].job_id===datafeedsResp.datafeeds[j].job_id&&(jobs[_i3].datafeed_config=datafeedsResp.datafeeds[j],datafeedIds[jobs[_i3].job_id]=datafeedsResp.datafeeds[j].datafeed_id);createJobStats(_this3.jobs,_this3.jobStats),createJobUrls(_this3.jobs,_this3.jobUrls),deferred.resolve({jobs:_this3.jobs})}).catch(function(err){error(err)})}else deferred.resolve({jobs:_this3.jobs})}).catch(function(err){error(err)}),deferred.promise},this.updateAllJobStats=function(){function error(err){console.log("updateAllJobStats error getting list job details:",err),msgs.error("Job details could not be retrieved"),msgs.error("",err),deferred.reject({jobs:jobs,err:err})}var _this4=this,deferred=$q.defer();return console.log("mlJobService: update all jobs counts and state"),ml.jobStats().then(function(resp){console.log("updateAllJobStats controller query response:",resp);for(var newJobsAdded=!1,d=0;d<resp.jobs.length;d++){var newJobStats={},jobExists=!1;_angular2.default.copy(resp.jobs[d],newJobStats);for(var i=0;i<jobs.length;i++){var job=jobs[i];job.job_id===newJobStats.job_id&&(jobExists=!0,job.state=newJobStats.state,job.data_counts=newJobStats.data_counts,newJobStats.model_size_stats&&(job.model_size_stats=newJobStats.model_size_stats),newJobStats.node&&(job.node=newJobStats.node),newJobStats.open_time&&(job.open_time=newJobStats.open_time))}jobExists||(jobs.splice(d,0,newJobStats),newJobsAdded=!0)}ml.datafeedStats().then(function(datafeedsResp){for(var _i4=0;_i4<jobs.length;_i4++){var datafeed=jobs[_i4].datafeed_config;if(datafeed)for(var j=0;j<datafeedsResp.datafeeds.length;j++){var newDatafeedStats={};_angular2.default.copy(datafeedsResp.datafeeds[j],newDatafeedStats),datafeed.datafeed_id===newDatafeedStats.datafeed_id&&(datafeed.state=newDatafeedStats.state,newDatafeedStats.node&&(datafeed.node=newDatafeedStats.node))}}_this4.jobs=jobs,newJobsAdded||resp.jobs.length!==jobs.length?(console.log("updateAllJobStats: number of jobs differs. reloading all jobs"),_this4.loadJobs().then(function(){deferred.resolve({jobs:_this4.jobs,listChanged:!0})}).catch(function(err){error(err)})):(createJobStats(_this4.jobs,_this4.jobStats),createJobUrls(_this4.jobs,_this4.jobUrls),deferred.resolve({jobs:_this4.jobs,listChanged:!1}))}).catch(function(err){error(err)})}).catch(function(err){error(err)}),deferred.promise},this.getRunningJobs=function(){var runningJobs=[];return _lodash2.default.each(jobs,function(job){job.datafeed_config&&"started"===job.datafeed_config.state&&runningJobs.push(job)}),runningJobs},this.updateSingleJobDatafeedState=function(jobId){var deferred=$q.defer(),datafeedId=this.getDatafeedId(jobId);return ml.datafeedStats({datafeedId:datafeedId}).then(function(resp){var datafeeds=resp.datafeeds,state="UNKNOWN";datafeeds&&datafeeds.length&&(state=datafeeds[0].state),deferred.resolve(state)}).catch(function(resp){deferred.reject(resp)}),deferred.promise},this.saveNewJob=function(job){var func=function(resp){return console.log("Response for job query:",resp),{success:checkSaveResponse(resp,job),job:job,resp:resp}};return ml.addJob({jobId:job.job_id,job:job}).then(func).catch(func)},this.deleteJob=function(job,statusIn){function deleteJob(){ml.forceDeleteJob({jobId:job.job_id}).then(function(){status.deleteJob=1,deferred.resolve({success:!0})}).catch(function(resp){status.deleteJob=-1,deleteFailed(resp,"Delete job")})}function deleteFailed(resp,txt){500===resp.statusCode&&(status.errorMessage=txt),deferred.reject({success:!1})}var deferred=$q.defer(),status=statusIn||{deleteDatafeed:0,deleteJob:0,errorMessage:""};if(job.datafeed_config&&Object.keys(job.datafeed_config).length){var datafeedId=this.getDatafeedId(job.job_id);ml.forceDeleteDatafeed({datafeedId:datafeedId}).then(function(){status.deleteDatafeed=1,deleteJob()}).catch(function(resp){status.deleteDatafeed=-1,status.deleteJob=-1,deleteFailed(resp,"Delete datafeed")})}else deleteJob();return deferred.promise},this.cloneJob=function(job){var tempJob=_angular2.default.copy(job);if(delete tempJob.state,delete tempJob.job_version,delete tempJob.data_counts,delete tempJob.create_time,delete tempJob.finished_time,delete tempJob.last_data_time,delete tempJob.model_size_stats,delete tempJob.node,delete tempJob.average_bucket_processing_time_ms,delete tempJob.model_snapshot_id,delete tempJob.open_time,delete tempJob.established_model_memory,delete tempJob.analysis_config.use_per_partition_normalization,_lodash2.default.each(tempJob.analysis_config.detectors,function(d){delete d.detector_index}),tempJob.datafeed_config&&(delete tempJob.datafeed_config.datafeed_id,delete tempJob.datafeed_config.job_id,delete tempJob.datafeed_config.state,delete tempJob.datafeed_config.node,tempJob.datafeed_config.query_delay)){var interval=(0,_parse_interval.parseInterval)(tempJob.datafeed_config.query_delay);if(null!==interval){var queryDelay=interval.asSeconds();queryDelay>60&&queryDelay<120&&delete tempJob.datafeed_config.query_delay}}return tempJob},this.updateJob=function(jobId,job){return ml.updateJob({jobId:jobId,job:job}).then(function(resp){return console.log("update job",resp),{success:!0}}).catch(function(err){return msgs.error("Could not update job: "+jobId),console.log("update job",err),{success:!1,message:err.message}})},this.validateJob=function(obj){return ml.validateJob(obj).then(function(messages){return console.log("validate job",messages),{success:!0,messages:messages}}).catch(function(err){return msgs.error("Job Validation Error: "+err.message),console.log("validate job",err),{success:!1,messages:[{status:"error",text:err.message}]}})},this.getJob=function(jobId){return _lodash2.default.find(jobs,function(j){return j.job_id===jobId})},this.getBasicJobInfo=function(){var _this5=this,deferred=$q.defer(),obj={success:!0,jobs:[]};return ml.jobs().then(function(resp){resp.jobs&&resp.jobs.length>0&&(obj.jobs=processBasicJobInfo(_this5,resp.jobs)),deferred.resolve(obj)}).catch(function(resp){console.log("getBasicJobInfo error getting list of jobs:",resp),deferred.reject(resp)}),deferred.promise},this.getJobViewByFields=function(){var deferred=$q.defer(),obj={success:!0,fieldsByJob:{"*":[]}};return ml.jobs().then(function(resp){resp.jobs&&resp.jobs.length>0&&(_lodash2.default.each(resp.jobs,function(jobObj){var fieldsForJob=[],analysisConfig=jobObj.analysis_config,detectors=analysisConfig.detectors||[];_lodash2.default.each(detectors,function(detector){_lodash2.default.has(detector,"partition_field_name")&&fieldsForJob.push(detector.partition_field_name),_lodash2.default.has(detector,"over_field_name")&&fieldsForJob.push(detector.over_field_name),_lodash2.default.has(detector,"by_field_name")&&!_lodash2.default.has(detector,"over_field_name")&&fieldsForJob.push(detector.by_field_name)}),obj.fieldsByJob[jobObj.job_id]=_lodash2.default.uniq(fieldsForJob),obj.fieldsByJob["*"]=_lodash2.default.union(obj.fieldsByJob["*"],obj.fieldsByJob[jobObj.job_id])}),_lodash2.default.each(obj.fieldsByJob,function(fields,jobId){obj.fieldsByJob[jobId]=_lodash2.default.sortBy(fields,function(field){return field.toLowerCase()})})),deferred.resolve(obj)}).catch(function(resp){console.log("getJobViewByFields error getting list of viewBy fields:",resp),deferred.reject(resp)}),deferred.promise},this.searchTimeFields=function(index,type,field){var deferred=$q.defer(),obj={time:""};return es.search({method:"GET",index:index,type:type,size:1,_source:field}).then(function(resp){if(0!==resp.hits.total&&resp.hits.hits.length){var hit=resp.hits.hits[0];hit._source&&hit._source[field]&&(obj.time=hit._source[field])}deferred.resolve(obj)}).catch(function(resp){deferred.reject(resp)}),deferred.promise},this.searchPreview=function(job){var deferred=$q.defer();if(job.datafeed_config){var query={match_all:{}};job.datafeed_config.query&&(query=job.datafeed_config.query),Private(_fields_service.FieldsServiceProvider).getTimeFieldRange(job.datafeed_config.indices,job.data_description.time_field,query).then(function(timeRange){var bucketSpan=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span),earliestMs=timeRange.start.epoch,latestMs=+timeRange.start.epoch+10*bucketSpan.asMilliseconds(),body={query:{bool:{must:[{range:_defineProperty({},job.data_description.time_field,{gte:earliestMs,lt:latestMs,format:"epoch_millis"})},query]}}},aggregations=job.datafeed_config.aggs||job.datafeed_config.aggregations;if(aggregations&&Object.keys(aggregations).length){body.size=0,body.aggregations=aggregations;var scriptFields=job.datafeed_config.script_fields;scriptFields&&Object.keys(scriptFields).length&&(body.script_fields=scriptFields)}else{body.size=_job_utils.ML_DATA_PREVIEW_COUNT;var _scriptFields=job.datafeed_config.script_fields;_scriptFields&&Object.keys(_scriptFields).length&&(body.script_fields=_scriptFields);var fields={};job.analysis_config.detectors&&_lodash2.default.each(job.analysis_config.detectors,function(dtr){dtr.by_field_name&&(fields[dtr.by_field_name]={}),dtr.field_name&&(fields[dtr.field_name]={}),dtr.over_field_name&&(fields[dtr.over_field_name]={}),dtr.partition_field_name&&(fields[dtr.partition_field_name]={})}),job.analysis_config.influencers&&_lodash2.default.each(job.analysis_config.influencers,function(inf){fields[inf]={}}),job.analysis_config.categorization_field_name&&(fields[job.analysis_config.categorization_field_name]={}),job.analysis_config.summary_count_field_name&&(fields[job.analysis_config.summary_count_field_name]={}),job.data_description.time_field&&(fields[job.data_description.time_field]={});var fieldsList=Object.keys(fields);fieldsList.length&&(body._source=fieldsList)}var data={index:job.datafeed_config.indices,body:body};es.search(data).then(function(resp){deferred.resolve(resp)}).catch(function(resp){deferred.reject(resp)})}).catch(function(resp){deferred.reject(resp)})}return deferred.promise},this.openJob=function(jobId){return ml.openJob({jobId:jobId})},this.closeJob=function(jobId){return ml.closeJob({jobId:jobId})},this.forceCloseJob=function(jobId){return ml.forceCloseJob({jobId:jobId})},this.saveNewDatafeed=function(datafeedConfig,jobId){var datafeedId="datafeed-"+jobId;return datafeedConfig.job_id=jobId,ml.addDatafeed({datafeedId:datafeedId,datafeedConfig:datafeedConfig})},this.updateDatafeed=function(datafeedId,datafeedConfig){return ml.updateDatafeed({datafeedId:datafeedId,datafeedConfig:datafeedConfig}).then(function(resp){return console.log("update datafeed",resp),{success:!0}}).catch(function(err){return msgs.error("Could not update datafeed: "+datafeedId),console.log("update datafeed",err),{success:!1,message:err.message}})},this.deleteDatafeed=function(){},this.startDatafeed=function(datafeedId,jobId,start,end){var deferred=$q.defer();return _lodash2.default.isNumber(end)&&end++,ml.startDatafeed({datafeedId:datafeedId,start:start,end:end}).then(function(resp){deferred.resolve(resp)}).catch(function(err){console.log("MlJobsList error starting datafeed:",err),msgs.error("Could not start datafeed for "+jobId,err),deferred.reject(err)}),deferred.promise},this.stopDatafeed=function(datafeedId,jobId){var deferred=$q.defer();return ml.stopDatafeed({datafeedId:datafeedId}).then(function(resp){deferred.resolve(resp)}).catch(function(err){console.log("MlJobsList error stopping datafeed:",err),500===err.statusCode?(msgs.error("Could not stop datafeed for "+jobId),msgs.error("Request may have timed out and may still be running in the background.")):msgs.error("Could not stop datafeed for "+jobId,err),deferred.reject(err)}),deferred.promise},this.validateDetector=function(detector){var deferred=$q.defer();return detector?ml.validateDetector({detector:detector}).then(function(resp){deferred.resolve(resp)}).catch(function(resp){deferred.reject(resp)}):deferred.reject({}),deferred.promise},this.getDatafeedId=function(jobId){var datafeedId=datafeedIds[jobId];return void 0===datafeedId&&(datafeedId="datafeed-"+jobId),datafeedId},this.getDatafeedPreview=function(jobId){var datafeedId=this.getDatafeedId(jobId);return ml.datafeedPreview({datafeedId:datafeedId})},this.getJobGroups=function(){var groups=[],tempGroups={};return this.jobs.forEach(function(job){Array.isArray(job.groups)&&job.groups.forEach(function(group){void 0===tempGroups[group]?tempGroups[group]=[job]:tempGroups[group].push(job)})}),_lodash2.default.each(tempGroups,function(js,id){groups.push({id:id,jobs:js})}),groups}})},484:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_moment=__webpack_require__(9),_moment2=_interopRequireDefault(_moment);__webpack_require__(2).uiModules.get("apps/ml").filter("formatValue",function(){function formatValue(value,fx,fieldFormat){if("time_of_week"===fx){var d=new Date,i=parseInt(value);return d.setTime(1e3*i),(0,_moment2.default)(d).format("ddd hh:mm")}if("time_of_day"===fx){var _d=new Date,_i=parseInt(value);return _d.setTime(1e3*_i),(0,_moment2.default)(_d).format("hh:mm")}if(void 0!==fieldFormat)return fieldFormat.convert(value,"text");var absValue=Math.abs(value);if(absValue>=1e4||absValue===Math.floor(absValue))return void 0!==fieldFormat?fieldFormat.convert(value,"text"):Number(value.toFixed(0));if(absValue>=10)return Number(value.toFixed(1));var multiple=void 0;return multiple=value>0?Math.pow(10,SIGFIGS_IF_ROUNDING-Math.floor(Math.log(value)/Math.LN10)-1):Math.pow(10,SIGFIGS_IF_ROUNDING-Math.floor(Math.log(-1*value)/Math.LN10)-1),Math.round(value*multiple)/multiple}var SIGFIGS_IF_ROUNDING=3;return function(value,fx,fieldFormat){return Array.isArray(value)?1===value.length?formatValue(value[0],fx,fieldFormat):_lodash2.default.map(value,function(val){return formatValue(val,fx)}):formatValue(value,fx,fieldFormat)}})},486:function(module,exports,__webpack_require__){function to_utc_date(dt){return Array.isArray(dt)?(dt=dt.slice(0),dt[1]--):dt=[dt.getFullYear(),dt.getMonth(),dt.getDate(),dt.getHours(),dt.getMinutes(),dt.getSeconds(),dt.getMilliseconds()],new Date(Date.UTC.apply(null,dt))}function from_utc_date(udt){return new Date(udt.getUTCFullYear(),udt.getUTCMonth(),udt.getUTCDate(),udt.getUTCHours(),udt.getUTCMinutes(),udt.getUTCSeconds(),udt.getUTCMilliseconds())}function trunc(n){return n<0?Math.ceil(n):Math.floor(n)}function y(dt){return dt.getUTCFullYear()}function m(dt){return dt.getUTCMonth()+1}function d(dt){return dt.getUTCDate()}function hr(dt){return dt.getUTCHours()}function min(dt){return dt.getUTCMinutes()}function sec(dt){return dt.getUTCSeconds()}function ms(dt){return dt.getUTCMilliseconds()}function set_y(dt,v){return dt.setUTCFullYear(v),dt}function set_m(dt,v){return dt.setUTCMonth(v-1),dt}function set_d(dt,v){return dt.setUTCDate(v),dt}function set_hr(dt,v){return dt.setUTCHours(v),dt}function set_min(dt,v){return dt.setUTCMinutes(v),dt}function set_sec(dt,v){return dt.setUTCSeconds(v),dt}function set_ms(dt,v){return dt.setUTCMilliseconds(v),dt}function add_y(dt,v){return set_y(dt,y(dt)+v)}function add_m(dt,v){return set_m(dt,m(dt)+v)}function add_d(dt,v){return set_d(dt,d(dt)+v)}function wkday(dt){return dt.getUTCDay()}function daydiff(dt1,dt2){return(dt2-dt1)/864e5}function sort_dates(dateary){return dateary.sort(function(dt1,dt2){return null===dt1&&null===dt2?0:null===dt1?1:null===dt2?-1:dt1.valueOf()-dt2.valueOf()})}function check_bymonth(rules,dt){return!rules||!rules.length||-1!==rules.indexOf(m(dt))}function bymonth(rules,dt){return rules&&rules.length?sort_dates(rules.map(function(rule){var delta=rule-m(dt);delta<0&&(delta+=12);var newdt=add_m(new Date(dt),delta);return set_d(newdt,1),newdt})).shift()||dt:dt}function bymonthday(rules,dt,after){return rules&&rules.length?sort_dates(rules.map(function(rule){var newdt=set_d(new Date(dt),rule);return newdt.valueOf()<=after.valueOf()?null:newdt})).shift()||dt:dt}function byday(rules,dt,after){return rules&&rules.length?sort_dates(rules.map(function(rule){var days=rule[1]-wkday(dt);days<0&&(days+=7);var newdt=add_d(new Date(dt),days);if(rule[0]>0){var wk=0|(d(newdt)-1)/7+1;if(wk>rule[0])return null;add_d(newdt,7*(rule[0]-wk))}else if(rule[0]<0){for(var dt2=new Date(newdt),days=[];m(dt2)===m(newdt);)days.push(d(dt2)),add_d(dt2,7);set_d(newdt,days.reverse()[-rule[0]-1])}return newdt.valueOf()<=after.valueOf()?null:newdt})).shift()||dt:dt}var types=__webpack_require__(377),SUPPORTED_PARTS=["FREQ","INTERVAL","COUNT","UNTIL","BYDAY","BYMONTH","BYMONTHDAY"],WKDAYS=["SU","MO","TU","WE","TH","FR","SA"],RRule=exports.RRule=function(rule,options,dtend){options instanceof Date&&(options={DTSTART:options,DTEND:dtend}),options=options||{},this.start=options.DTSTART?to_utc_date(options.DTSTART):null,this.end=options.DTEND?to_utc_date(options.DTEND):null,this.exceptions=options.EXDATE||[],"string"==typeof rule&&(rule=RRule.parse(rule)),this.rule={};for(var i in rule||{}){if(-1==SUPPORTED_PARTS.indexOf(i))throw new Error(i+" is not currently supported!");this.rule[i]=RULE_PARTS[i]?RULE_PARTS[i].parse(rule[i]):rule[i]}};RRule.parse=function(value){for(var parts=value.split(/=|;/),rrule={},i=0;i<parts.length;i+=2)rrule[parts[i]]=parts[i+1];return rrule},RRule.prototype.setFrequency=function(freq){this.rule.FREQ=freq},RRule.prototype.valueOf=function(){return this.rule},RRule.prototype.toString=function(){var out=["FREQ="+this.rule.FREQ];for(var k in this.rule)"FREQ"!=k&&out.push(k+"="+((RULE_PARTS[k]||{}).format?RULE_PARTS[k].format(this.rule[k]):this.rule[k]));return out.join(";")},RRule.prototype.next=function(after){if(after=after&&to_utc_date(after),(!after||after<this.start)&&(after=new Date(this.start.valueOf()-1)),this.until&&after>this.until)return null;var freq=FREQ[this.rule.FREQ];if(!freq)throw new Error(this.rule.FREQ+" recurrence is not supported");NextOccurs:for(;;){for(var next=freq.next(this.rule,this.start,after),nextInLocal=from_utc_date(next),i=0;i<this.exceptions.length;i++){var exdate=this.exceptions[i];if(exdate.valueOf()==nextInLocal.valueOf()||exdate.date_only&&y(to_utc_date(exdate))==y(nextInLocal)&&m(to_utc_date(exdate))==m(nextInLocal)&&d(to_utc_date(exdate))==d(nextInLocal)){after=next;continue NextOccurs}}break}return this.until&&next>this.until?null:this.rule.COUNT&&null!==this.count_end&&(void 0===this.count_end&&(this.count_end=null,this.count_end=this.nextOccurences(this.rule.COUNT).pop()),next>to_utc_date(this.count_end))?null:this.rule.UNTIL&&next>to_utc_date(this.rule.UNTIL)?null:from_utc_date(next)},RRule.prototype.nextOccurences=function(after,count_or_until){1===arguments.length&&(count_or_until=after,after=void 0);var arr=[];if(count_or_until instanceof Date)for(;;){if(!((after=this.next(after))&&after<=count_or_until))break;arr.push(after)}else for(;count_or_until--&&null!==after;)(after=this.next(after))&&arr.push(after);return arr};var RULE_PARTS={INTERVAL:{parse:function(v){return parseInt(v,10)}},UNTIL:{parse:function(v){return v instanceof Date?v:types.parse_value("DATE-TIME",v)},format:function(v){return types.format_value("DATE-TIME",v)}},FREQ:{parse:function(v){return v}},BYMONTH:{parse:function(v){return"number"==typeof v?[v]:v.split(",").map(function(mo){return parseInt(mo,10)})},format:function(v){return v.join(",")}},BYDAY:{parse:function(v){var days=v.split(",").map(function(day){var m=day.match(/([+-]?\d)?(SU|MO|TU|WE|TH|FR|SA)/);return[parseInt(m[1],10)||0,WKDAYS.indexOf(m[2])]});return days.sort(function(d1,d2){return d1[0]==d2[0]?d1[1]-d2[1]:d1[0]-d2[0]}),days},format:function(v){return v.map(function(day){return(day[0]||"")+WKDAYS[day[1]]}).join(",")}},EXDATE:{parse:function(v){return v.split(",").map(function(dt){return 8==dt.length?types.parse_value("DATE",dt):types.parse_value("DATE-TIME",dt)})},format:function(v){return v.map(function(dt){return types.format_value(dt.date_only?"DATE":"DATE-TIME",dt)}).join(",")}}};RULE_PARTS.BYMONTHDAY=RULE_PARTS.BYMONTH,RULE_PARTS.COUNT=RULE_PARTS.INTERVAL;var FREQ={DAILY:{next:function(rule,start,after){var next=new Date(after);set_hr(next,hr(start)),set_min(next,min(start)),set_sec(next,sec(start)),set_ms(next,ms(start));var interval=rule.INTERVAL||1,mod_days=trunc(daydiff(next,start))%interval;mod_days&&add_d(next,interval-mod_days);for(var i=0;i<2&&(next=byday(rule.BYDAY,next,after),!(next.valueOf()>after.valueOf()));++i)add_d(next,interval);return next}},WEEKLY:{next:function(rule,start,after){var next=new Date(after);set_hr(next,hr(start)),set_min(next,min(start)),set_sec(next,sec(start)),set_ms(next,ms(start));var interval=rule.INTERVAL||1,mod_weeks=trunc(daydiff(start,next)/7)%interval;for(mod_weeks&&add_d(next,7*(interval-mod_weeks));;){if(next=byday(rule.BYDAY,next,after),rule.BYDAY&&rule.BYDAY.length||(startDayOfWeek=wkday(start),nextDayOfWeek=wkday(next),nextDayOfWeek>startDayOfWeek?add_d(next,startDayOfWeek-nextDayOfWeek):startDayOfWeek>nextDayOfWeek&&add_d(next,startDayOfWeek-nextDayOfWeek-7)),next.valueOf()>after.valueOf()&&check_bymonth(rule.BYMONTH,next))break;add_d(next,7*interval)}return next}},MONTHLY:{next:function(rule,start,after){var next=new Date(after);set_hr(next,hr(start)),set_min(next,min(start)),set_sec(next,sec(start)),set_ms(next,ms(start));var interval=rule.INTERVAL||1,delta=m(next)-m(start)+12*(y(next)-y(start));delta%interval&&add_m(next,interval-delta%interval);for(var i=0;i<2&&(i&&set_d(next,1),next=byday(rule.BYDAY,next,after),next=bymonthday(rule.BYMONTHDAY,next,after),rule.BYDAY&&rule.BYDAY.length||rule.BYMONTHDAY&&rule.BYMONTHDAY.length||set_d(next,d(start)),!(next.valueOf()>after.valueOf()));++i)add_m(next,interval);return next}},YEARLY:{next:function(rule,start,after){var next=new Date(after);set_hr(next,hr(start)),set_min(next,min(start)),set_sec(next,sec(start)),set_ms(next,ms(start));var interval=rule.INTERVAL||1,mod_year=(y(after)-y(start))%interval;mod_year&&add_y(next,interval-mod_year);for(var i=0;i<2&&(next=bymonth(rule.BYMONTH,next),next=bymonthday(rule.BYMONTHDAY,next,after),next=byday(rule.BYDAY,next,after),rule.BYMONTH&&rule.BYMONTH.length||set_m(next,m(start)),rule.BYDAY&&rule.BYDAY.length||rule.BYMONTHDAY&&rule.BYMONTHDAY.length||set_d(next,d(start)),!(next.valueOf()>after.valueOf()));++i)set_d(set_m(add_y(next,interval),1),1);return next}}}},487:function(module,exports,__webpack_require__){var util=(__webpack_require__(691),__webpack_require__(309)),CalendarObject=__webpack_require__(115).CalendarObject,schema=(__webpack_require__(115).CalendarProperty,__webpack_require__(115).schema),iCalendar=exports.iCalendar=function(empty){CalendarObject.call(this,this,"VCALENDAR"),this.calendar=this,empty||(this.addProperty("VERSION","2.0"),this.addProperty("PRODID",__webpack_require__(1194).PRODID))};util.inherits(iCalendar,CalendarObject),iCalendar.prototype.events=function(){return this.components.VEVENT||[]},iCalendar.prototype.timezone=function(tzid){for(var i=0;i<this.components.VTIMEZONE.length;++i){var tz=this.components.VTIMEZONE[i];if(tz.getPropertyValue("TZID")==tzid)return tz}},schema.VCALENDAR={factory:iCalendar,valid_properties:[],required_properties:["PRODID","VERSION"],valid_children:["VEVENT"],required_children:[]},schema.VTODO={required_properties:["DTSTAMP","UID"]},schema.VJOURNAL={required_properties:["DTSTAMP","UID"]},schema.VFREEBUSY={required_properties:["DTSTAMP","UID"]},schema.VALARM={required_properties:["ACTION","TRIGGER"]}},57:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function calculateDatafeedFrequencyDefaultSeconds(bucketSpanSeconds){var freq=3600;return bucketSpanSeconds<=120?freq=60:bucketSpanSeconds<=1200?freq=Math.floor(bucketSpanSeconds/2):bucketSpanSeconds<=43200&&(freq=600),freq}function isTimeSeriesViewJob(job){for(var isViewable=!1,dtrs=job.analysis_config.detectors,i=0;i<dtrs.length&&!0!==(isViewable=isTimeSeriesViewDetector(job,i));i++);return isViewable}function isTimeSeriesViewDetector(job,dtrIndex){var isDetectorViewable=!1,dtrs=job.analysis_config.detectors;if(dtrIndex>=0&&dtrIndex<dtrs.length){var dtr=dtrs[dtrIndex];isDetectorViewable=!0===isTimeSeriesViewFunction(dtr.function)&&"mlcategory"!==dtr.by_field_name&&"mlcategory"!==dtr.partition_field_name&&"mlcategory"!==dtr.over_field_name;var usesScriptFields=_lodash2.default.has(job,"datafeed_config.script_fields");if(!0===isDetectorViewable&&!0===usesScriptFields){var scriptFields=usesScriptFields?_lodash2.default.keys(job.datafeed_config.script_fields):[];isDetectorViewable=-1===scriptFields.indexOf(dtr.field_name)&&-1===scriptFields.indexOf(dtr.partition_field_name)&&-1===scriptFields.indexOf(dtr.by_field_name)&&-1===scriptFields.indexOf(dtr.over_field_name)}}return isDetectorViewable}function isTimeSeriesViewFunction(functionName){return null!==mlFunctionToESAggregation(functionName)}function isModelPlotEnabled(job,detectorIndex,entityFields){var isEnabled=_lodash2.default.get(job,["model_plot_config","enabled"],!1);if(!0===isEnabled){var termsStr=_lodash2.default.get(job,["model_plot_config","terms"],"");if(""!==termsStr){var detector=job.analysis_config.detectors[detectorIndex],detectorHasPartitionField=_lodash2.default.has(detector,"partition_field_name"),detectorHasByField=_lodash2.default.has(detector,"by_field_name"),terms=termsStr.split(",");if(!0===detectorHasPartitionField){var partitionEntity=_lodash2.default.find(entityFields,{fieldName:detector.partition_field_name});isEnabled=void 0!==partitionEntity&&-1!==terms.indexOf(partitionEntity.fieldValue)}if(!0===isEnabled&&!0===detectorHasByField){var byEntity=_lodash2.default.find(entityFields,{fieldName:detector.by_field_name});isEnabled=void 0!==byEntity&&-1!==terms.indexOf(byEntity.fieldValue)}}}return isEnabled}function isJobVersionGte(job,version){var jobVersion=_lodash2.default.get(job,"job_version","0.0.0");return _semver2.default.gte(jobVersion,version)}function mlFunctionToESAggregation(functionName){return"mean"===functionName||"high_mean"===functionName||"low_mean"===functionName||"metric"===functionName?"avg":"sum"===functionName||"high_sum"===functionName||"low_sum"===functionName||"non_null_sum"===functionName||"low_non_null_sum"===functionName||"high_non_null_sum"===functionName?"sum":"count"===functionName||"high_count"===functionName||"low_count"===functionName||"non_zero_count"===functionName||"low_non_zero_count"===functionName||"high_non_zero_count"===functionName?"count":"distinct_count"===functionName||"low_distinct_count"===functionName||"high_distinct_count"===functionName?"cardinality":"median"===functionName||"high_median"===functionName||"low_median"===functionName?"percentiles":"min"===functionName||"max"===functionName?functionName:null}function isJobIdValid(jobId){return!(!jobId.match(/^[a-z0-9\-\_]{1,64}$/g)||jobId.match(/^([_-].*)?(.*[_-])?$/g))}function prefixDatafeedId(datafeedId,prefix){return datafeedId.match(/^datafeed-/)?datafeedId.replace(/^datafeed-/,"datafeed-"+prefix):""+prefix+datafeedId}function getSafeAggregationName(fieldName,index){return fieldName.match(/^[a-zA-Z0-9-_.]+$/)?fieldName:"field_"+index}function uniqWithIsEqual(arr){return arr.reduce(function(dedupedArray,value){return 0===dedupedArray.filter(function(compareValue){return _lodash2.default.isEqual(compareValue,value)}).length&&dedupedArray.push(value),dedupedArray},[])}function basicJobValidation(job,fields,limits){var messages=[],valid=!0;if(job){if(_lodash2.default.isEmpty(job.job_id)?(messages.push({id:"job_id_empty"}),valid=!1):!1===isJobIdValid(job.job_id)?(messages.push({id:"job_id_invalid"}),valid=!1):messages.push({id:"job_id_valid"}),void 0!==job.groups){var groupIdValid=!0;job.groups.forEach(function(group){!1===isJobIdValid(group)&&(groupIdValid=!1,valid=!1)}),job.groups.length>0&&groupIdValid?messages.push({id:"job_group_id_valid"}):job.groups.length>0&&!groupIdValid&&messages.push({id:"job_group_id_invalid"})}if(job.analysis_config.categorization_filters){var v=!0;_lodash2.default.each(job.analysis_config.categorization_filters,function(d){try{new RegExp(d)}catch(e){v=!1}void 0!==job.analysis_config.categorization_field_name&&""!==job.analysis_config.categorization_field_name||(v=!1),""===d&&(v=!1)}),v?messages.push({id:"categorization_filters_valid"}):(messages.push({id:"categorization_filters_invalid"}),valid=!1)}if(0===job.analysis_config.detectors.length)messages.push({id:"detectors_empty"}),valid=!1;else{var _v=!0;_lodash2.default.each(job.analysis_config.detectors,function(d){_lodash2.default.isEmpty(d.function)&&(_v=!1)}),_v?messages.push({id:"detectors_function_not_empty"}):(messages.push({id:"detectors_function_empty"}),valid=!1)}if(job.analysis_config.detectors.length>=2){var compareSubSet=job.analysis_config.detectors.map(function(d){return _lodash2.default.pick(d,["function","field_name","by_field_name","over_field_name","partition_field_name"])}),dedupedSubSet=uniqWithIsEqual(compareSubSet);compareSubSet.length!==dedupedSubSet.length&&(messages.push({id:"detectors_duplicates"}),valid=!1)}if(""===job.analysis_config.bucket_span||void 0===job.analysis_config.bucket_span)messages.push({id:"bucket_span_empty"}),valid=!1;else{var bucketSpan=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span,!1);null===bucketSpan||0===bucketSpan.asMilliseconds()?(messages.push({id:"bucket_span_invalid"}),valid=!1):messages.push({id:"bucket_span_valid"})}if(void 0!==fields){0===Object.keys(fields).length?(messages.push({id:"index_fields_invalid"}),valid=!1):messages.push({id:"index_fields_valid"})}if(void 0!==job.analysis_limits&&void 0!==job.analysis_limits.model_memory_limit&&"object"===(void 0===limits?"undefined":_typeof(limits))&&void 0!==limits.max_model_memory_limit){var max=limits.max_model_memory_limit.toUpperCase(),mml=job.analysis_limits.model_memory_limit.toUpperCase();(0,_numeral2.default)(mml).value()>(0,_numeral2.default)(max).value()?(messages.push({id:"model_memory_limit_invalid"}),valid=!1):messages.push({id:"model_memory_limit_valid"})}}else valid=!1;return{messages:messages,valid:valid,contains:function(id){return _lodash2.default.some(messages,{id:id})},find:function(id){return _lodash2.default.find(messages,{id:id})}}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ML_DATA_PREVIEW_COUNT=exports.ML_MEDIAN_PERCENTS=void 0;var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.calculateDatafeedFrequencyDefaultSeconds=calculateDatafeedFrequencyDefaultSeconds,exports.isTimeSeriesViewJob=isTimeSeriesViewJob,exports.isTimeSeriesViewDetector=isTimeSeriesViewDetector,exports.isTimeSeriesViewFunction=isTimeSeriesViewFunction,exports.isModelPlotEnabled=isModelPlotEnabled,exports.isJobVersionGte=isJobVersionGte,exports.mlFunctionToESAggregation=mlFunctionToESAggregation,exports.isJobIdValid=isJobIdValid,exports.prefixDatafeedId=prefixDatafeedId,exports.getSafeAggregationName=getSafeAggregationName,exports.uniqWithIsEqual=uniqWithIsEqual,exports.basicJobValidation=basicJobValidation;var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_semver=__webpack_require__(673),_semver2=_interopRequireDefault(_semver),_numeral=__webpack_require__(82),_numeral2=_interopRequireDefault(_numeral),_parse_interval=__webpack_require__(166);exports.ML_MEDIAN_PERCENTS="50.0",exports.ML_DATA_PREVIEW_COUNT=10},674:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3261),__webpack_require__(3262),__webpack_require__(3264)},682:function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function filterAggTypes(aggTypes){var filteredAggTypes=[],typeCopy=void 0;return _lodash2.default.each(aggTypes,function(type){type.mlName=type.name,type.mlModelPlotAgg={max:type.name,min:type.name},type.isCountType=!1,type.isAggregatableStringType=!1,_lodash2.default.each(type.params,function(p){p.filterFieldTypes&&"string"==typeof p.filterFieldTypes&&(p.filterFieldTypes=p.filterFieldTypes.replace(",date",""))}),"count"===type.name?(type.mlModelPlotAgg={max:"max",min:"min"},type.isCountType=!0,filteredAggTypes.push(type),typeCopy=_angular2.default.copy(type),typeCopy.title="High count",typeCopy.mlName="high_count",filteredAggTypes.push(typeCopy),typeCopy=_angular2.default.copy(type),typeCopy.title="Low count",typeCopy.mlName="low_count",filteredAggTypes.push(typeCopy)):"sum"===type.name?(filteredAggTypes.push(type),typeCopy=_angular2.default.copy(type),typeCopy.title="High sum",typeCopy.mlName="high_sum",filteredAggTypes.push(typeCopy),typeCopy=_angular2.default.copy(type),typeCopy.title="Low sum",typeCopy.mlName="low_sum",filteredAggTypes.push(typeCopy)):"avg"===type.name?(type.title="Mean",type.mlName="mean",filteredAggTypes.push(type),typeCopy=_angular2.default.copy(type),typeCopy.title="High mean",typeCopy.mlName="high_mean",filteredAggTypes.push(typeCopy),typeCopy=_angular2.default.copy(type),typeCopy.title="Low mean",typeCopy.mlName="low_mean",filteredAggTypes.push(typeCopy)):"median"===type.name?(type.mlModelPlotAgg={max:"max",min:"min"},filteredAggTypes.push(type),typeCopy=_angular2.default.copy(type),typeCopy.title="High median",typeCopy.mlName="high_median",filteredAggTypes.push(typeCopy),typeCopy=_angular2.default.copy(type),typeCopy.title="Low median",typeCopy.mlName="low_median",filteredAggTypes.push(typeCopy)):"min"===type.name?filteredAggTypes.push(type):"max"===type.name?filteredAggTypes.push(type):"cardinality"===type.name&&(type.title="Distinct count",type.mlName="distinct_count",type.mlModelPlotAgg={max:"max",min:"min"},type.isAggregatableStringType=!0,_lodash2.default.each(type.params,function(p){p.filterFieldTypes&&(p.filterFieldTypes="number,boolean,ip,string")}),filteredAggTypes.push(type))}),filteredAggTypes}Object.defineProperty(exports,"__esModule",{value:!0}),exports.filterAggTypes=filterAggTypes;var _lodash=__webpack_require__(1),_lodash2=_interopRequireDefault(_lodash),_angular=__webpack_require__(13),_angular2=_interopRequireDefault(_angular)},683:function(module,exports,__webpack_require__){"use strict";function validateJob(job,checks){var limits=(0,_new_job_defaults.newJobLimits)(),validationResults=(0,_job_utils.basicJobValidation)(job,void 0,limits),valid=!0;if(_lodash2.default.each(checks,function(item){item.valid=!0}),validationResults.contains("job_id_empty"))checks.jobId.valid=!1;else if(validationResults.contains("job_id_invalid")){checks.jobId.valid=!1;var msg="Job name can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";msg+="must start and end with an alphanumeric character",checks.jobId.message=msg}if(validationResults.contains("job_group_id_invalid")){checks.groupIds.valid=!1;var _msg="Job group names can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";_msg+="must start and end with an alphanumeric character",checks.groupIds.message=_msg}if(validationResults.contains("model_memory_limit_invalid")){checks.modelMemoryLimit.valid=!1;var _msg2="Model memory limit cannot be higher than the maximum value of "+limits.max_model_memory_limit.toUpperCase();checks.modelMemoryLimit.message=_msg2}if(validationResults.contains("detectors_duplicates")){checks.duplicateDetectors.valid=!1;checks.duplicateDetectors.message="Duplicate detectors were found."}return _lodash2.default.each(checks,function(item){!1===item.valid&&(valid=!1)}),valid}Object.defineProperty(exports,"__esModule",{value:!0}),exports.validateJob=validateJob;var _job_utils=__webpack_require__(57),_new_job_defaults=__webpack_require__(258),_lodash=__webpack_require__(1),_lodash2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_lodash)},684:function(module,exports,__webpack_require__){"use strict";function adjustIntervalDisplayed(formConfig){var makeTheSame=!1,intervalSeconds=formConfig.chartInterval.getInterval().asSeconds(),bucketSpan=(0,_parse_interval.parseInterval)(formConfig.bucketSpan);if(null!==bucketSpan){if(bucketSpan.asSeconds()>intervalSeconds&&(makeTheSame=!0),void 0!==formConfig.agg.type){var mlName=formConfig.agg.type.mlName;"count"!==mlName&&"low_count"!==mlName&&"high_count"!==mlName&&"distinct_count"!==mlName||(makeTheSame=!0)}makeTheSame&&formConfig.chartInterval.setInterval(formConfig.bucketSpan)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.adjustIntervalDisplayed=adjustIntervalDisplayed;var _parse_interval=__webpack_require__(166)},685:function(module,exports,__webpack_require__){"use strict";function populateAppStateSettings(appState,scope){if(void 0!==appState.mlJobSettings&&Object.keys(appState.mlJobSettings).length){var finish=function(success){success&&(scope.bucketSpanEstimatorExportedFunctions.guessBucketSpan&&"function"==typeof scope.bucketSpanEstimatorExportedFunctions.guessBucketSpan&&scope.bucketSpanEstimatorExportedFunctions.guessBucketSpan(),(0,_jquery2.default)("#job-id-input").focus())},jobSettings=appState.mlJobSettings;(function(){return scope.formConfig.hasOwnProperty("field")?populateSingleMetricSettings(jobSettings,scope):scope.formConfig.hasOwnProperty("overField")?populatePopulationSettings(jobSettings,scope):scope.formConfig.hasOwnProperty("fields")?populateMultiMetricSettings(jobSettings,scope):void 0})().then(function(){return finish(!0)}).catch(function(){return finish(!1)})}}function populateSingleMetricSettings(jobSettings,scope){return new Promise(function(resolve,reject){jobSettings.fields.forEach(function(f){if(void 0!==f.agg){var agg=scope.ui.aggTypeOptions.find(function(o){return o.name===f.agg});void 0!==agg&&(scope.formConfig.agg.type=agg,scope.aggChange())}if(void 0!==f.fieldName){var field=scope.ui.fields.find(function(o){return o.name===f.fieldName});scope.formConfig.field=field||null}}),void 0!==scope.formConfig.agg.type&&void 0!==scope.formConfig.field||"count"===scope.formConfig.agg.type.name&&void 0===scope.formConfig.field?(scope.loadVis(),resolve()):reject()})}function populateMultiMetricSettings(jobSettings,scope){return new Promise(function(resolve,reject){if(jobSettings.fields.forEach(function(f){if(void 0!==f.fieldName){var field=scope.ui.fields.find(function(o){return o.id===f.fieldName});if(void 0!==field&&(scope.formConfig.fields[field.id]=field),void 0!==f.agg){var agg=scope.ui.aggTypeOptions.find(function(o){return o.name===f.agg});void 0!==agg&&(scope.formConfig.fields[field.id].agg.type=agg)}}}),void 0!==jobSettings.split){var field=scope.ui.splitFields.find(function(o){return o.name===jobSettings.split});void 0!==field&&(scope.formConfig.splitField=field,scope.splitChange())}void 0!==scope.formConfig.fields&&Object.keys(scope.formConfig.fields).length>0?(scope.loadVis(),resolve()):reject()})}function populatePopulationSettings(jobSettings,scope){return new Promise(function(resolve,reject){if(void 0!==jobSettings.population){var loop=function(i){var f=jobSettings.fields[i];if(void 0!==f.split){var splitField=scope.ui.splitFields.find(function(o){return o.name===f.split});void 0!==splitField?scope.splitChange(i,splitField).then(function(){check(i)}):check(i)}else check(i)},check=function(i){i+1<jobSettings.fields.length&&loop(i+1)},overField=scope.ui.overFields.find(function(o){return o.name===jobSettings.population});void 0!==overField&&(scope.formConfig.overField=overField,scope.overChange()),jobSettings.fields.forEach(function(f){if(void 0!==f.fieldName){var tempField=scope.ui.fields.find(function(o){return o.id===f.fieldName}),field=_extends({},tempField);if(void 0!==field){if(void 0!==f.agg){var agg=scope.ui.aggTypeOptions.find(function(o){return o.name===f.agg});void 0!==agg&&(field.agg={type:agg})}scope.formConfig.fields.push(field)}}}),scope.formChange(),loop(0)}void 0!==scope.formConfig.fields&&Object.keys(scope.formConfig.fields).length>0?resolve():reject()})}Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};exports.populateAppStateSettings=populateAppStateSettings;var _jquery=__webpack_require__(12),_jquery2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_jquery)},686:function(module,exports,__webpack_require__){"use strict";function createFields(scope,indexPattern){var isPopulation=scope.formConfig.hasOwnProperty("overField"),agg=scope.formConfig.agg,fields=[],categoryFields=[];scope.ui.fields=[],agg.type.params.forEach(function(param){"field"===param.name&&(fields=getIndexedFields(indexPattern,[_field_types.KBN_FIELD_TYPES.NUMBER,_field_types.KBN_FIELD_TYPES.STRING,_field_types.KBN_FIELD_TYPES.IP])),"customLabel"===param.name&&(categoryFields=getIndexedFields(indexPattern,[_field_types.KBN_FIELD_TYPES.STRING,_field_types.KBN_FIELD_TYPES.IP]))});var countAgg={type:scope.ui.aggTypeOptions.find(function(o){return"count"===o.name})},eventRateField={id:_general.EVENT_RATE_COUNT_FIELD,name:"event rate",tooltip:"System defined field",isCountField:!0,agg:countAgg,mlType:_field_types.ML_JOB_FIELD_TYPES.NUMBER,splitField:void 0,firstSplitFieldName:void 0,cardLabels:void 0};isPopulation&&(eventRateField.splitField=void 0,eventRateField.firstSplitFieldName=void 0,eventRateField.cardLabels=void 0),scope.ui.fields.push(eventRateField);var cardinalityAgg={type:scope.ui.aggTypeOptions.find(function(o){return"cardinality"===o.name})};fields.forEach(function(field,i){var id=(0,_job_utils.getSafeAggregationName)(field.displayName,i),f={id:id,name:field.displayName,tooltip:field.displayName,agg:field.mlType===_field_types.ML_JOB_FIELD_TYPES.KEYWORD||field.mlType===_field_types.ML_JOB_FIELD_TYPES.IP?_extends({},cardinalityAgg):_extends({},agg),mlType:field.mlType};isPopulation&&(f.splitField=void 0,f.firstSplitFieldName=void 0,f.cardLabels=void 0),scope.ui.fields.push(f)}),categoryFields.forEach(function(field){scope.ui.splitFields.push(field),isPopulation&&scope.ui.overFields.push(field)})}function getIndexedFields(indexPattern,fieldTypes){var fields=indexPattern.fields.raw.filter(function(f){return!0===f.aggregatable});return fieldTypes&&(fields=fields.filter(function(f){return"_type"!==f.displayName&&"_id"!==f.displayName&&"_index"!==f.displayName&&!0!==f.scripted}),fields=fields.filter(function(f){return fieldTypes.find(function(t){return t===f.type})}),fields.forEach(function(f){return f.mlType=(0,_field_types_utils.kbnTypeToMLJobType)(f)}),fields=fields.sort(orderBy(["name","type"]))),fields}function orderBy(items){return function(a,b){var result=0;return items.forEach(function(i){var aa=a[i].toLowerCase(),bb=b[i].toLowerCase();aa<bb?result=-1:aa>bb&&(result=1)}),result||0}}Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};exports.createFields=createFields,exports.getIndexedFields=getIndexedFields;var _general=__webpack_require__(305),_field_types=__webpack_require__(208),_job_utils=__webpack_require__(57),_field_types_utils=__webpack_require__(1177)},687:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1),_lodash2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_lodash),_index_patterns=__webpack_require__(301),_string_utils=__webpack_require__(43);__webpack_require__(2).uiModules.get("apps/ml").service("mlSimpleJobSearchService",function($q,es){this.getScoresByRecord=function(jobId,earliestMs,latestMs,interval,firstSplitField){var deferred=$q.defer(),obj={success:!0,results:{}},jobIdFilterStr="job_id: "+jobId;return firstSplitField&&void 0!==firstSplitField.value&&(jobIdFilterStr+=" AND "+(0,_string_utils.escapeForElasticsearchQuery)(firstSplitField.name)+":",jobIdFilterStr+='"'+String(firstSplitField.value).replace(/\\/g,"\\\\")+'"'),es.search({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:record"}},{bool:{must:[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{query_string:{query:jobIdFilterStr}}]}}]}},aggs:{detector_index:{terms:{field:"detector_index",order:{recordScore:"desc"}},aggs:{recordScore:{max:{field:"record_score"}},byTime:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:1,extended_bounds:{min:earliestMs,max:latestMs}},aggs:{recordScore:{max:{field:"record_score"}}}}}}}}}).then(function(resp){var detectorsByIndex=_lodash2.default.get(resp,["aggregations","detector_index","buckets"],[]);_lodash2.default.each(detectorsByIndex,function(dtr){for(var dtrResults={},dtrIndex=+dtr.key,buckets=_lodash2.default.get(dtr,["byTime","buckets"],[]),j=0;j<buckets.length;j++){var bkt=buckets[j];dtrResults[bkt.key]={recordScore:_lodash2.default.get(bkt,["recordScore","value"])}}obj.results[dtrIndex]=dtrResults}),deferred.resolve(obj)}).catch(function(resp){deferred.reject(resp)}),deferred.promise},this.getCategoryFields=function(index,field,size,query){var deferred=$q.defer(),obj={success:!0,results:{}};return es.search({index:index,size:0,body:{query:query,aggs:{catFields:{terms:{field:field,size:size}}}}}).then(function(resp){obj.results.values=[];var catFields=_lodash2.default.get(resp,["aggregations","catFields","buckets"],[]);_lodash2.default.each(catFields,function(f){obj.results.values.push(f.key)}),deferred.resolve(obj)}).catch(function(resp){deferred.reject(resp)}),deferred.promise}})},688:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3394),__webpack_require__(3395),__webpack_require__(674)},689:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3514),__webpack_require__(3516),__webpack_require__(3518),__webpack_require__(3519)},691:function(module,exports,__webpack_require__){"use strict";(function(global){/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
function compare(a,b){if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0}function isBuffer(b){return global.Buffer&&"function"==typeof global.Buffer.isBuffer?global.Buffer.isBuffer(b):!(null==b||!b._isBuffer)}function pToString(obj){return Object.prototype.toString.call(obj)}function isView(arrbuf){return!isBuffer(arrbuf)&&("function"==typeof global.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(arrbuf):!!arrbuf&&(arrbuf instanceof DataView||!!(arrbuf.buffer&&arrbuf.buffer instanceof ArrayBuffer))))}function getName(func){if(util.isFunction(func)){if(functionsHaveNames)return func.name;var str=func.toString(),match=str.match(regex);return match&&match[1]}}function truncate(s,n){return"string"==typeof s?s.length<n?s:s.slice(0,n):s}function inspect(something){if(functionsHaveNames||!util.isFunction(something))return util.inspect(something);var rawname=getName(something);return"[Function"+(rawname?": "+rawname:"")+"]"}function getMessage(self){return truncate(inspect(self.actual),128)+" "+self.operator+" "+truncate(inspect(self.expected),128)}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}function ok(value,message){value||fail(value,!0,message,"==",assert.ok)}function _deepEqual(actual,expected,strict,memos){if(actual===expected)return!0;if(isBuffer(actual)&&isBuffer(expected))return 0===compare(actual,expected);if(util.isDate(actual)&&util.isDate(expected))return actual.getTime()===expected.getTime();if(util.isRegExp(actual)&&util.isRegExp(expected))return actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase;if(null!==actual&&"object"==typeof actual||null!==expected&&"object"==typeof expected){if(isView(actual)&&isView(expected)&&pToString(actual)===pToString(expected)&&!(actual instanceof Float32Array||actual instanceof Float64Array))return 0===compare(new Uint8Array(actual.buffer),new Uint8Array(expected.buffer));if(isBuffer(actual)!==isBuffer(expected))return!1;memos=memos||{actual:[],expected:[]};var actualIndex=memos.actual.indexOf(actual);return-1!==actualIndex&&actualIndex===memos.expected.indexOf(expected)||(memos.actual.push(actual),memos.expected.push(expected),objEquiv(actual,expected,strict,memos))}return strict?actual===expected:actual==expected}function isArguments(object){return"[object Arguments]"==Object.prototype.toString.call(object)}function objEquiv(a,b,strict,actualVisitedObjects){if(null===a||void 0===a||null===b||void 0===b)return!1;if(util.isPrimitive(a)||util.isPrimitive(b))return a===b;if(strict&&Object.getPrototypeOf(a)!==Object.getPrototypeOf(b))return!1;var aIsArgs=isArguments(a),bIsArgs=isArguments(b);if(aIsArgs&&!bIsArgs||!aIsArgs&&bIsArgs)return!1;if(aIsArgs)return a=pSlice.call(a),b=pSlice.call(b),_deepEqual(a,b,strict);var key,i,ka=objectKeys(a),kb=objectKeys(b);if(ka.length!==kb.length)return!1;for(ka.sort(),kb.sort(),i=ka.length-1;i>=0;i--)if(ka[i]!==kb[i])return!1;for(i=ka.length-1;i>=0;i--)if(key=ka[i],!_deepEqual(a[key],b[key],strict,actualVisitedObjects))return!1;return!0}function notDeepStrictEqual(actual,expected,message){_deepEqual(actual,expected,!0)&&fail(actual,expected,message,"notDeepStrictEqual",notDeepStrictEqual)}function expectedException(actual,expected){if(!actual||!expected)return!1;if("[object RegExp]"==Object.prototype.toString.call(expected))return expected.test(actual);try{if(actual instanceof expected)return!0}catch(e){}return!Error.isPrototypeOf(expected)&&!0===expected.call({},actual)}function _tryBlock(block){var error;try{block()}catch(e){error=e}return error}function _throws(shouldThrow,block,expected,message){var actual;if("function"!=typeof block)throw new TypeError('"block" argument must be a function');"string"==typeof expected&&(message=expected,expected=null),actual=_tryBlock(block),message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:"."),shouldThrow&&!actual&&fail(actual,expected,"Missing expected exception"+message);var userProvidedMessage="string"==typeof message,isUnwantedException=!shouldThrow&&util.isError(actual),isUnexpectedException=!shouldThrow&&actual&&!expected;if((isUnwantedException&&userProvidedMessage&&expectedException(actual,expected)||isUnexpectedException)&&fail(actual,expected,"Got unwanted exception"+message),shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual)throw actual}var util=__webpack_require__(309),hasOwn=Object.prototype.hasOwnProperty,pSlice=Array.prototype.slice,functionsHaveNames=function(){return"foo"===function(){}.name}(),assert=module.exports=ok,regex=/\s*function\s+([^\(\s]*)\s*/;assert.AssertionError=function(options){this.name="AssertionError",this.actual=options.actual,this.expected=options.expected,this.operator=options.operator,options.message?(this.message=options.message,this.generatedMessage=!1):(this.message=getMessage(this),this.generatedMessage=!0);var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace)Error.captureStackTrace(this,stackStartFunction);else{var err=new Error;if(err.stack){var out=err.stack,fn_name=getName(stackStartFunction),idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}},util.inherits(assert.AssertionError,Error),assert.fail=fail,assert.ok=ok,assert.equal=function(actual,expected,message){actual!=expected&&fail(actual,expected,message,"==",assert.equal)},assert.notEqual=function(actual,expected,message){actual==expected&&fail(actual,expected,message,"!=",assert.notEqual)},assert.deepEqual=function(actual,expected,message){_deepEqual(actual,expected,!1)||fail(actual,expected,message,"deepEqual",assert.deepEqual)},assert.deepStrictEqual=function(actual,expected,message){_deepEqual(actual,expected,!0)||fail(actual,expected,message,"deepStrictEqual",assert.deepStrictEqual)},assert.notDeepEqual=function(actual,expected,message){_deepEqual(actual,expected,!1)&&fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)},assert.notDeepStrictEqual=notDeepStrictEqual,assert.strictEqual=function(actual,expected,message){actual!==expected&&fail(actual,expected,message,"===",assert.strictEqual)},assert.notStrictEqual=function(actual,expected,message){actual===expected&&fail(actual,expected,message,"!==",assert.notStrictEqual)},assert.throws=function(block,error,message){_throws(!0,block,error,message)},assert.doesNotThrow=function(block,error,message){_throws(!1,block,error,message)},assert.ifError=function(err){if(err)throw err};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)hasOwn.call(obj,key)&&keys.push(key);return keys}}).call(exports,__webpack_require__(24))},93:function(module,exports,__webpack_require__){"use strict";function checkGetJobsPrivilege(Private,Promise,kbnUrl){var mlPrivilegeService=Private(_get_privileges.privilegesProvider);return new Promise(function(resolve,reject){mlPrivilegeService.getPrivileges().then(function(privileges){return privileges.canGetJobs?resolve(privileges):(kbnUrl.redirect("/access-denied"),reject())})})}function checkCreateJobsPrivilege(Private,Promise,kbnUrl){var mlPrivilegeService=Private(_get_privileges.privilegesProvider);return new Promise(function(resolve,reject){mlPrivilegeService.getPrivileges().then(function(privileges){return privileges.canCreateJob?resolve(privileges):(kbnUrl.redirect("/jobs"),reject())})})}function permissionCheckProvider($route){function checkPermission(privilegeType){return!0===privileges[privilegeType]&&!0!==licenseDetails.hasExpired}function createPermissionFailureMessage(privilegeType){var message="";return licenseDetails.hasExpired?message="Your license has expired.":"canCreateJob"===privilegeType?message="You do not have permission to create Machine Learning jobs.":"canStartStopDatafeed"===privilegeType?message="You do not have permission to start or stop datafeeds.":"canUpdateJob"===privilegeType?message="You do not have permission to edit jobs.":"canDeleteJob"===privilegeType?message="You do not have permission to delete jobs.":"canCreateCalendar"===privilegeType?message="You do not have permission to create calendars.":"canDeleteCalendar"===privilegeType?message="You do not have permission to delete calendars.":"canForecastJob"===privilegeType&&(message="You do not have permission to run forecasts."),message+" Please contact your administrator."}var privileges=$route.current.locals.privileges,licenseDetails=$route.current.locals.CheckLicense;return{checkPermission:checkPermission,createPermissionFailureMessage:createPermissionFailureMessage}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.checkGetJobsPrivilege=checkGetJobsPrivilege,exports.checkCreateJobsPrivilege=checkCreateJobsPrivilege,exports.permissionCheckProvider=permissionCheckProvider;var _get_privileges=__webpack_require__(3223)}},[1576]);